"use strict";(self.webpackChunkvpostea=self.webpackChunkvpostea||[]).push([[792],{920:()=>{function Ot(n){return"function"==typeof n}function rl(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const ld=rl(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function sl(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class xi{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(Ot(i))try{i()}catch(s){e=s instanceof ld?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{$x(s)}catch(o){e=e??[],o instanceof ld?e=[...e,...o.errors]:e.push(o)}}if(e)throw new ld(e)}}add(e){var t;if(e&&e!==this)if(this.closed)$x(e);else{if(e instanceof xi){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&sl(t,e)}remove(e){const{_finalizers:t}=this;t&&sl(t,e),e instanceof xi&&e._removeParent(this)}}xi.EMPTY=(()=>{const n=new xi;return n.closed=!0,n})();const Wx=xi.EMPTY;function jx(n){return n instanceof xi||n&&"closed"in n&&Ot(n.remove)&&Ot(n.add)&&Ot(n.unsubscribe)}function $x(n){Ot(n)?n():n.unsubscribe()}const ro={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ud={setTimeout(n,e,...t){const{delegate:i}=ud;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=ud;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function qx(n){ud.setTimeout(()=>{const{onUnhandledError:e}=ro;if(!e)throw n;e(n)})}function im(){}const pP=rm("C",void 0,void 0);function rm(n,e,t){return{kind:n,value:e,error:t}}let so=null;function dd(n){if(ro.useDeprecatedSynchronousErrorHandling){const e=!so;if(e&&(so={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=so;if(so=null,t)throw i}}else n()}class sm extends xi{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,jx(e)&&e.add(this)):this.destination=MP}static create(e,t,i){return new ol(e,t,i)}next(e){this.isStopped?am(function gP(n){return rm("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?am(function mP(n){return rm("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?am(pP,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const yP=Function.prototype.bind;function om(n,e){return yP.call(n,e)}class _P{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){hd(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){hd(i)}else hd(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){hd(t)}}}class ol extends sm{constructor(e,t,i){let r;if(super(),Ot(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&ro.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&om(e.next,s),error:e.error&&om(e.error,s),complete:e.complete&&om(e.complete,s)}):r=e}this.destination=new _P(r)}}function hd(n){ro.useDeprecatedSynchronousErrorHandling?function vP(n){ro.useDeprecatedSynchronousErrorHandling&&so&&(so.errorThrown=!0,so.error=n)}(n):qx(n)}function am(n,e){const{onStoppedNotification:t}=ro;t&&ud.setTimeout(()=>t(n,e))}const MP={closed:!0,next:im,error:function xP(n){throw n},complete:im},cm="function"==typeof Symbol&&Symbol.observable||"@@observable";function bs(n){return n}function Xx(n){return 0===n.length?bs:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}let hn=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const s=function wP(n){return n&&n instanceof sm||function bP(n){return n&&Ot(n.next)&&Ot(n.error)&&Ot(n.complete)}(n)&&jx(n)}(t)?t:new ol(t,i,r);return dd(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=Yx(i))((r,s)=>{const o=new ol({next:a=>{try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[cm](){return this}pipe(...t){return Xx(t)(this)}toPromise(t){return new(t=Yx(t))((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=e=>new n(e),n})();function Yx(n){var e;return null!==(e=n??ro.Promise)&&void 0!==e?e:Promise}const EP=rl(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Qi=(()=>{class n extends hn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new Zx(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new EP}next(t){dd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){dd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){dd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Wx:(this.currentObservers=null,s.push(t),new xi(()=>{this.currentObservers=null,sl(s,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){const t=new hn;return t.source=this,t}}return n.create=(e,t)=>new Zx(e,t),n})();class Zx extends Qi{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:Wx}}function Jx(n){return Ot(n?.lift)}function mn(n){return e=>{if(Jx(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function gn(n,e,t,i,r){return new CP(n,e,t,i,r)}class CP extends sm{constructor(e,t,i,r,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=r?function(a){try{r(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function Dt(n,e){return mn((t,i)=>{let r=0;t.subscribe(gn(i,s=>{i.next(n.call(e,s,r++))}))})}function ws(n){return this instanceof ws?(this.v=n,this):new ws(n)}function tM(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function hm(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){!function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}(a,c,(o=n[s](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const nM=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function iM(n){return Ot(n?.then)}function rM(n){return Ot(n[cm])}function sM(n){return Symbol.asyncIterator&&Ot(n?.[Symbol.asyncIterator])}function oM(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const aM=function QP(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function cM(n){return Ot(n?.[aM])}function lM(n){return function eM(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function o(f){return function(p){return Promise.resolve(p).then(f,d)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(f,p){i[f]&&(r[f]=function(v){return new Promise(function(g,m){s.push([f,v,g,m])>1||c(f,v)})},p&&(r[f]=p(r[f])))}function c(f,p){try{!function l(f){f.value instanceof ws?Promise.resolve(f.value.v).then(u,d):h(s[0][2],f)}(i[f](p))}catch(v){h(s[0][3],v)}}function u(f){c("next",f)}function d(f){c("throw",f)}function h(f,p){f(p),s.shift(),s.length&&c(s[0][0],s[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield ws(t.read());if(r)return yield ws(void 0);yield yield ws(i)}}finally{t.releaseLock()}})}function uM(n){return Ot(n?.getReader)}function Bi(n){if(n instanceof hn)return n;if(null!=n){if(rM(n))return function eN(n){return new hn(e=>{const t=n[cm]();if(Ot(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(nM(n))return function tN(n){return new hn(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(iM(n))return function nN(n){return new hn(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,qx)})}(n);if(sM(n))return dM(n);if(cM(n))return function iN(n){return new hn(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(uM(n))return function rN(n){return dM(lM(n))}(n)}throw oM(n)}function dM(n){return new hn(e=>{(function sN(n,e){var t,i,r,s;return function Kx(n,e,t,i){return new(t||(t=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):function r(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,c)}l((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=tM(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function Br(n,e,t,i=0,r=!1){const s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function En(n,e,t=1/0){return Ot(e)?En((i,r)=>Dt((s,o)=>e(i,s,r,o))(Bi(n(i,r))),t):("number"==typeof e&&(t=e),mn((i,r)=>function oN(n,e,t,i,r,s,o,a){const c=[];let l=0,u=0,d=!1;const h=()=>{d&&!c.length&&!l&&e.complete()},f=v=>l<i?p(v):c.push(v),p=v=>{s&&e.next(v),l++;let g=!1;Bi(t(v,u++)).subscribe(gn(e,m=>{r?.(m),s?f(m):e.next(m)},()=>{g=!0},void 0,()=>{if(g)try{for(l--;c.length&&l<i;){const m=c.shift();o?Br(e,o,()=>p(m)):p(m)}h()}catch(m){e.error(m)}}))};return n.subscribe(gn(e,f,()=>{d=!0,h()})),()=>{a?.()}}(i,r,n,t)))}function ra(n=1/0){return En(bs,n)}const vr=new hn(n=>n.complete());function pm(n){return n[n.length-1]}function al(n){return function cN(n){return n&&Ot(n.schedule)}(pm(n))?n.pop():void 0}function hM(n,e=0){return mn((t,i)=>{t.subscribe(gn(i,r=>Br(i,n,()=>i.next(r),e),()=>Br(i,n,()=>i.complete(),e),r=>Br(i,n,()=>i.error(r),e)))})}function fM(n,e=0){return mn((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function pM(n,e){if(!n)throw new Error("Iterable cannot be null");return new hn(t=>{Br(t,e,()=>{const i=n[Symbol.asyncIterator]();Br(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function Sn(n,e){return e?function gN(n,e){if(null!=n){if(rM(n))return function dN(n,e){return Bi(n).pipe(fM(e),hM(e))}(n,e);if(nM(n))return function fN(n,e){return new hn(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(iM(n))return function hN(n,e){return Bi(n).pipe(fM(e),hM(e))}(n,e);if(sM(n))return pM(n,e);if(cM(n))return function pN(n,e){return new hn(t=>{let i;return Br(t,e,()=>{i=n[aM](),Br(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){return void t.error(o)}s?t.complete():t.next(r)},0,!0)}),()=>Ot(i?.return)&&i.return()})}(n,e);if(uM(n))return function mN(n,e){return pM(lM(n),e)}(n,e)}throw oM(n)}(n,e):Bi(n)}class Vi extends Qi{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}function je(...n){return Sn(n,al(n))}function mM(n={}){const{connector:e=(()=>new Qi),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let o,a,c,l=0,u=!1,d=!1;const h=()=>{a?.unsubscribe(),a=void 0},f=()=>{h(),o=c=void 0,u=d=!1},p=()=>{const v=o;f(),v?.unsubscribe()};return mn((v,g)=>{l++,!d&&!u&&h();const m=c=c??e();g.add(()=>{l--,0===l&&!d&&!u&&(a=mm(p,r))}),m.subscribe(g),!o&&l>0&&(o=new ol({next:y=>m.next(y),error:y=>{d=!0,h(),a=mm(f,t,y),m.error(y)},complete:()=>{u=!0,h(),a=mm(f,i),m.complete()}}),Bi(v).subscribe(o))})(s)}}function mm(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new ol({next:()=>{i.unsubscribe(),n()}});return Bi(e(...t)).subscribe(i)}function er(n,e){return mn((t,i)=>{let r=null,s=0,o=!1;const a=()=>o&&!r&&i.complete();t.subscribe(gn(i,c=>{r?.unsubscribe();let l=0;const u=s++;Bi(n(c,u)).subscribe(r=gn(i,d=>i.next(e?e(c,d,u,l++):d),()=>{r=null,a()}))},()=>{o=!0,a()}))})}function _N(n,e){return n===e}function Nt(n){for(let e in n)if(n[e]===Nt)return e;throw Error("Could not find renamed property on target object.")}function vn(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(vn).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function gm(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const xN=Nt({__forward_ref__:Nt});function vm(n){return n.__forward_ref__=vm,n.toString=function(){return vn(this())},n}function Ye(n){return ym(n)?n():n}function ym(n){return"function"==typeof n&&n.hasOwnProperty(xN)&&n.__forward_ref__===vm}function _m(n){return n&&!!n.\u0275providers}const gM="https://g.co/ng/security#xss";class ce extends Error{constructor(e,t){super(function pd(n,e){return`NG0${Math.abs(n)}${e?": "+e:""}`}(e,t)),this.code=e}}function Ke(n){return"string"==typeof n?n:null==n?"":String(n)}function xm(n,e){throw new ce(-201,!1)}function Hi(n,e){null==n&&function $e(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function Be(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Vr(n){return{providers:n.providers||[],imports:n.imports||[]}}function md(n){return vM(n,vd)||vM(n,yM)}function vM(n,e){return n.hasOwnProperty(e)?n[e]:null}function gd(n){return n&&(n.hasOwnProperty(Mm)||n.hasOwnProperty(AN))?n[Mm]:null}const vd=Nt({\u0275prov:Nt}),Mm=Nt({\u0275inj:Nt}),yM=Nt({ngInjectableDef:Nt}),AN=Nt({ngInjectorDef:Nt});var mt=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(mt||{});let Sm;function si(n){const e=Sm;return Sm=n,e}function xM(n,e,t){const i=md(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&mt.Optional?null:void 0!==e?e:void xm(vn(n))}const Ht=globalThis;class Ee{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Be({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const cl={},Tm="__NG_DI_FLAG__",yd="ngTempTokenPath",RN=/\n/gm,SM="__source";let sa;function Es(n){const e=sa;return sa=n,e}function LN(n,e=mt.Default){if(void 0===sa)throw new ce(-203,!1);return null===sa?xM(n,void 0,e):sa.get(n,e&mt.Optional?null:void 0,e)}function Oe(n,e=mt.Default){return(function _M(){return Sm}()||LN)(Ye(n),e)}function be(n,e=mt.Default){return Oe(n,_d(e))}function _d(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Am(n){const e=[];for(let t=0;t<n.length;t++){const i=Ye(n[t]);if(Array.isArray(i)){if(0===i.length)throw new ce(900,!1);let r,s=mt.Default;for(let o=0;o<i.length;o++){const a=i[o],c=ON(a);"number"==typeof c?-1===c?r=a.token:s|=c:r=a}e.push(Oe(r,s))}else e.push(Oe(i))}return e}function ll(n,e){return n[Tm]=e,n.prototype[Tm]=e,n}function ON(n){return n[Tm]}function Hr(n){return{toString:n}.toString()}var xd=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(xd||{}),tr=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(tr||{});const yr={},Mt=[],Md=Nt({\u0275cmp:Nt}),Dm=Nt({\u0275dir:Nt}),Im=Nt({\u0275pipe:Nt}),wM=Nt({\u0275mod:Nt}),zr=Nt({\u0275fac:Nt}),ul=Nt({__NG_ELEMENT_ID__:Nt}),EM=Nt({__NG_ENV_ID__:Nt});function CM(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}function Rm(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const s=t[i++],o=t[i++],a=t[i++];n.setAttribute(e,o,a,s)}else{const s=r,o=t[++i];AM(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),i++}}return i}function TM(n){return 3===n||4===n||6===n}function AM(n){return 64===n.charCodeAt(0)}function dl(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||DM(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function DM(n,e,t,i,r){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}const IM="ng-template";function kN(n,e,t){let i=0,r=!0;for(;i<n.length;){let s=n[i++];if("string"==typeof s&&r){const o=n[i++];if(t&&"class"===s&&-1!==CM(o.toLowerCase(),e,0))return!0}else{if(1===s){for(;i<n.length&&"string"==typeof(s=n[i++]);)if(s.toLowerCase()===e)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function RM(n){return 4===n.type&&n.value!==IM}function BN(n,e,t){return e===(4!==n.type||t?n.value:IM)}function VN(n,e,t){let i=4;const r=n.attrs||[],s=function GN(n){for(let e=0;e<n.length;e++)if(TM(n[e]))return e;return n.length}(r);let o=!1;for(let a=0;a<e.length;a++){const c=e[a];if("number"!=typeof c){if(!o)if(4&i){if(i=2|1&i,""!==c&&!BN(n,c,t)||""===c&&1===e.length){if(nr(i))return!1;o=!0}}else{const l=8&i?c:e[++a];if(8&i&&null!==n.attrs){if(!kN(n.attrs,l,t)){if(nr(i))return!1;o=!0}continue}const d=HN(8&i?"class":c,r,RM(n),t);if(-1===d){if(nr(i))return!1;o=!0;continue}if(""!==l){let h;h=d>s?"":r[d+1].toLowerCase();const f=8&i?h:null;if(f&&-1!==CM(f,l,0)||2&i&&l!==h){if(nr(i))return!1;o=!0}}}}else{if(!o&&!nr(i)&&!nr(c))return!1;if(o&&nr(c))continue;o=!1,i=c|1&i}}return nr(i)||o}function nr(n){return 0==(1&n)}function HN(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){const o=e[r];if(o===n)return r;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++r];for(;"string"==typeof a;)a=e[++r];continue}if(4===o)break;if(0===o){r+=4;continue}}r+=s?1:2}return-1}return function WN(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function PM(n,e,t=!1){for(let i=0;i<e.length;i++)if(VN(n,e[i],t))return!0;return!1}function NM(n,e){return n?":not("+e.trim()+")":e}function $N(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&i){const a=n[++t];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&i?r+="."+o:4&i&&(r+=" "+o);else""!==r&&!nr(o)&&(e+=NM(s,r),r=""),i=o,s=s||!nr(i);t++}return""!==r&&(e+=NM(s,r)),e}function Cs(n){return Hr(()=>{const e=OM(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===xd.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||tr.Emulated,styles:n.styles||Mt,_:null,schemas:n.schemas||null,tView:null,id:""};FM(t);const i=n.dependencies;return t.directiveDefs=Sd(i,!1),t.pipeDefs=Sd(i,!0),t.id=function eL(n){let e=0;const t=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(const r of t)e=Math.imul(31,e)+r.charCodeAt(0)<<0;return e+=2147483648,"c"+e}(t),t})}function ZN(n){return yt(n)||Cn(n)}function JN(n){return null!==n}function Ts(n){return Hr(()=>({type:n.type,bootstrap:n.bootstrap||Mt,declarations:n.declarations||Mt,imports:n.imports||Mt,exports:n.exports||Mt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function LM(n,e){if(null==n)return yr;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),t[r]=i,e&&(e[r]=s)}return t}function zn(n){return Hr(()=>{const e=OM(n);return FM(e),e})}function yt(n){return n[Md]||null}function Cn(n){return n[Dm]||null}function Gn(n){return n[Im]||null}function Si(n,e){const t=n[wM]||null;if(!t&&!0===e)throw new Error(`Type ${vn(n)} does not have '\u0275mod' property.`);return t}function OM(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:n.inputs||yr,exportAs:n.exportAs||null,standalone:!0===n.standalone,signals:!0===n.signals,selectors:n.selectors||Mt,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:LM(n.inputs,e),outputs:LM(n.outputs)}}function FM(n){n.features?.forEach(e=>e(n))}function Sd(n,e){if(!n)return null;const t=e?Gn:ZN;return()=>("function"==typeof n?n():n).map(i=>t(i)).filter(JN)}const tn=0,ye=1,rt=2,Zt=3,ir=4,hl=5,Pn=6,aa=7,sn=8,As=9,ca=10,Qe=11,fl=12,UM=13,la=14,on=15,pl=16,ua=17,_r=18,ml=19,kM=20,Ds=21,Gr=22,gl=23,vl=24,gt=25,Pm=1,BM=2,xr=7,da=9,Tn=11;function ai(n){return Array.isArray(n)&&"object"==typeof n[Pm]}function Wn(n){return Array.isArray(n)&&!0===n[Pm]}function Nm(n){return 0!=(4&n.flags)}function ao(n){return n.componentOffset>-1}function wd(n){return 1==(1&n.flags)}function rr(n){return!!n.template}function Lm(n){return 0!=(512&n[rt])}function co(n,e){return n.hasOwnProperty(zr)?n[zr]:null}let An=null,Ed=!1;function zi(n){const e=An;return An=n,e}const zM={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function WM(n){if(!_l(n)||n.dirty){if(!n.producerMustRecompute(n)&&!qM(n))return void(n.dirty=!1);n.producerRecomputeValue(n),n.dirty=!1}}function $M(n){n.dirty=!0,function jM(n){if(void 0===n.liveConsumerNode)return;const e=Ed;Ed=!0;try{for(const t of n.liveConsumerNode)t.dirty||$M(t)}finally{Ed=e}}(n),n.consumerMarkedDirty?.(n)}function Fm(n){return n&&(n.nextProducerIndex=0),zi(n)}function Um(n,e){if(zi(e),n&&void 0!==n.producerNode&&void 0!==n.producerIndexOfThis&&void 0!==n.producerLastReadVersion){if(_l(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)Cd(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function qM(n){ha(n);for(let e=0;e<n.producerNode.length;e++){const t=n.producerNode[e],i=n.producerLastReadVersion[e];if(i!==t.version||(WM(t),i!==t.version))return!0}return!1}function XM(n){if(ha(n),_l(n))for(let e=0;e<n.producerNode.length;e++)Cd(n.producerNode[e],n.producerIndexOfThis[e]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function Cd(n,e){if(function ZM(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}(n),ha(n),1===n.liveConsumerNode.length)for(let i=0;i<n.producerNode.length;i++)Cd(n.producerNode[i],n.producerIndexOfThis[i]);const t=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[t],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[t],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){const i=n.liveConsumerIndexOfThis[e],r=n.liveConsumerNode[e];ha(r),r.producerIndexOfThis[i]=e}}function _l(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function ha(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}let JM=null;const tS=()=>{},fL=(()=>({...zM,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:n=>{n.schedule(n.ref)},hasRun:!1,cleanupFn:tS}))();class pL{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function lo(){return nS}function nS(n){return n.type.prototype.ngOnChanges&&(n.setInput=gL),mL}function mL(){const n=rS(this),e=n?.current;if(e){const t=n.previous;if(t===yr)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function gL(n,e,t,i){const r=this.declaredInputs[t],s=rS(n)||function vL(n,e){return n[iS]=e}(n,{previous:yr,current:null}),o=s.current||(s.current={}),a=s.previous,c=a[r];o[r]=new pL(c&&c.currentValue,e,a===yr),n[i]=e}lo.ngInherit=!0;const iS="__ngSimpleChanges__";function rS(n){return n[iS]||null}const Mr=function(n,e,t){};function zt(n){for(;Array.isArray(n);)n=n[tn];return n}function ci(n,e){return zt(e[n.index])}function aS(n,e){return n.data[e]}function bi(n,e){const t=e[n];return ai(t)?t:t[tn]}function Rs(n,e){return null==e?null:n[e]}function cS(n){n[ua]=0}function bL(n){1024&n[rt]||(n[rt]|=1024,uS(n,1))}function lS(n){1024&n[rt]&&(n[rt]&=-1025,uS(n,-1))}function uS(n,e){let t=n[Zt];if(null===t)return;t[hl]+=e;let i=t;for(t=t[Zt];null!==t&&(1===e&&1===i[hl]||-1===e&&0===i[hl]);)t[hl]+=e,i=t,t=t[Zt]}const qe={lFrame:MS(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function fS(){return qe.bindingsEnabled}function Z(){return qe.lFrame.lView}function _t(){return qe.lFrame.tView}function zm(n){return qe.lFrame.contextLView=n,n[sn]}function Gm(n){return qe.lFrame.contextLView=null,n}function Dn(){let n=pS();for(;null!==n&&64===n.type;)n=n.parent;return n}function pS(){return qe.lFrame.currentTNode}function Sr(n,e){const t=qe.lFrame;t.currentTNode=n,t.isParent=e}function Wm(){return qe.lFrame.isParent}function ma(){return qe.lFrame.bindingIndex++}function OL(n,e){const t=qe.lFrame;t.bindingIndex=t.bindingRootIndex=n,$m(e)}function $m(n){qe.lFrame.currentDirectiveIndex=n}function yS(){return qe.lFrame.currentQueryIndex}function Xm(n){qe.lFrame.currentQueryIndex=n}function UL(n){const e=n[ye];return 2===e.type?e.declTNode:1===e.type?n[Pn]:null}function _S(n,e,t){if(t&mt.SkipSelf){let r=e,s=n;for(;!(r=r.parent,null!==r||t&mt.Host||(r=UL(s),null===r||(s=s[la],10&r.type))););if(null===r)return!1;e=r,n=s}const i=qe.lFrame=xS();return i.currentTNode=e,i.lView=n,!0}function Ym(n){const e=xS(),t=n[ye];qe.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function xS(){const n=qe.lFrame,e=null===n?null:n.child;return null===e?MS(n):e}function MS(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function SS(){const n=qe.lFrame;return qe.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const bS=SS;function Zm(){const n=SS();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function $n(){return qe.lFrame.selectedIndex}function uo(n){qe.lFrame.selectedIndex=n}function Jt(){const n=qe.lFrame;return aS(n.tView,n.selectedIndex)}let ES=!0;function Ad(){return ES}function Ps(n){ES=n}function Dd(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),c&&(n.viewHooks??=[]).push(-t,c),l&&((n.viewHooks??=[]).push(t,l),(n.viewCheckHooks??=[]).push(t,l)),null!=u&&(n.destroyHooks??=[]).push(t,u)}}function Id(n,e,t){CS(n,e,3,t)}function Rd(n,e,t,i){(3&n[rt])===t&&CS(n,e,t,i)}function Jm(n,e){let t=n[rt];(3&t)===e&&(t&=8191,t+=1,n[rt]=t)}function CS(n,e,t,i){const s=i??-1,o=e.length-1;let a=0;for(let c=void 0!==i?65535&n[ua]:0;c<o;c++)if("number"==typeof e[c+1]){if(a=e[c],null!=i&&a>=i)break}else e[c]<0&&(n[ua]+=65536),(a<s||-1==s)&&(jL(n,t,e,c),n[ua]=(4294901760&n[ua])+c+2),c++}function TS(n,e){Mr(4,n,e);const t=zi(null);try{e.call(n)}finally{zi(t),Mr(5,n,e)}}function jL(n,e,t,i){const r=t[i]<0,s=t[i+1],a=n[r?-t[i]:t[i]];r?n[rt]>>13<n[ua]>>16&&(3&n[rt])===e&&(n[rt]+=8192,TS(a,s)):TS(a,s)}const ga=-1;class Ml{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function Qm(n){return n!==ga}function Sl(n){return 32767&n}function bl(n,e){let t=function YL(n){return n>>16}(n),i=e;for(;t>0;)i=i[la],t--;return i}let eg=!0;function Pd(n){const e=eg;return eg=n,e}const AS=255,DS=5;let ZL=0;const br={};function Nd(n,e){const t=IS(n,e);if(-1!==t)return t;const i=e[ye];i.firstCreatePass&&(n.injectorIndex=e.length,tg(i.data,n),tg(e,null),tg(i.blueprint,null));const r=Ld(n,e),s=n.injectorIndex;if(Qm(r)){const o=Sl(r),a=bl(r,e),c=a[ye].data;for(let l=0;l<8;l++)e[s+l]=a[o+l]|c[o+l]}return e[s+8]=r,s}function tg(n,e){n.push(0,0,0,0,0,0,0,0,e)}function IS(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function Ld(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=kS(r),null===i)return ga;if(t++,r=r[la],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return ga}function ng(n,e,t){!function JL(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(ul)&&(i=t[ul]),null==i&&(i=t[ul]=ZL++);const r=i&AS;e.data[n+(r>>DS)]|=1<<r}(n,e,t)}function RS(n,e,t){if(t&mt.Optional||void 0!==n)return n;xm()}function PS(n,e,t,i){if(t&mt.Optional&&void 0===i&&(i=null),!(t&(mt.Self|mt.Host))){const r=n[As],s=si(void 0);try{return r?r.get(e,i,t&mt.Optional):xM(e,i,t&mt.Optional)}finally{si(s)}}return RS(i,0,t)}function NS(n,e,t,i=mt.Default,r){if(null!==n){if(2048&e[rt]&&!(i&mt.Self)){const o=function iO(n,e,t,i,r){let s=n,o=e;for(;null!==s&&null!==o&&2048&o[rt]&&!(512&o[rt]);){const a=LS(s,o,t,i|mt.Self,br);if(a!==br)return a;let c=s.parent;if(!c){const l=o[kM];if(l){const u=l.get(t,br,i);if(u!==br)return u}c=kS(o),o=o[la]}s=c}return r}(n,e,t,i,br);if(o!==br)return o}const s=LS(n,e,t,i,br);if(s!==br)return s}return PS(e,t,i,r)}function LS(n,e,t,i,r){const s=function eO(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(ul)?n[ul]:void 0;return"number"==typeof e?e>=0?e&AS:nO:e}(t);if("function"==typeof s){if(!_S(e,n,i))return i&mt.Host?RS(r,0,i):PS(e,t,i,r);try{let o;if(o=s(i),null!=o||i&mt.Optional)return o;xm()}finally{bS()}}else if("number"==typeof s){let o=null,a=IS(n,e),c=ga,l=i&mt.Host?e[on][Pn]:null;for((-1===a||i&mt.SkipSelf)&&(c=-1===a?Ld(n,e):e[a+8],c!==ga&&FS(i,!1)?(o=e[ye],a=Sl(c),e=bl(c,e)):a=-1);-1!==a;){const u=e[ye];if(OS(s,a,u.data)){const d=QL(a,e,t,o,i,l);if(d!==br)return d}c=e[a+8],c!==ga&&FS(i,e[ye].data[a+8]===l)&&OS(s,a,e)?(o=u,a=Sl(c),e=bl(c,e)):a=-1}}return r}function QL(n,e,t,i,r,s){const o=e[ye],a=o.data[n+8],u=Od(a,o,t,null==i?ao(a)&&eg:i!=o&&0!=(3&a.type),r&mt.Host&&s===a);return null!==u?ho(e,o,u,a):br}function Od(n,e,t,i,r){const s=n.providerIndexes,o=e.data,a=1048575&s,c=n.directiveStart,u=s>>20,h=r?a+u:n.directiveEnd;for(let f=i?a:a+u;f<h;f++){const p=o[f];if(f<c&&t===p||f>=c&&p.type===t)return f}if(r){const f=o[c];if(f&&rr(f)&&f.type===t)return c}return null}function ho(n,e,t,i){let r=n[t];const s=e.data;if(function $L(n){return n instanceof Ml}(r)){const o=r;o.resolving&&function MN(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new ce(-200,`Circular dependency in DI detected for ${n}${t}`)}(function It(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Ke(n)}(s[t]));const a=Pd(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?si(o.injectImpl):null;_S(n,i,mt.Default);try{r=n[t]=o.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&function WL(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){const o=nS(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}r&&(t.preOrderHooks??=[]).push(0-n,r),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}(t,s[t],e)}finally{null!==l&&si(l),Pd(a),o.resolving=!1,bS()}}return r}function OS(n,e,t){return!!(t[e+(n>>DS)]&1<<n)}function FS(n,e){return!(n&mt.Self||n&mt.Host&&e)}class qn{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return NS(this._tNode,this._lView,e,_d(i),t)}}function nO(){return new qn(Dn(),Z())}function ig(n){return ym(n)?()=>{const e=ig(Ye(n));return e&&e()}:co(n)}function kS(n){const e=n[ye],t=e.type;return 2===t?e.declTNode:1===t?n[Pn]:null}const ya="__parameters__";function xa(n,e,t){return Hr(()=>{const i=function rg(n){return function(...t){if(n){const i=n(...t);for(const r in i)this[r]=i[r]}}}(e);function r(...s){if(this instanceof r)return i.apply(this,s),this;const o=new r(...s);return a.annotation=o,a;function a(c,l,u){const d=c.hasOwnProperty(ya)?c[ya]:Object.defineProperty(c,ya,{value:[]})[ya];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),c}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}function Sa(n,e){n.forEach(t=>Array.isArray(t)?Sa(t,e):e(t))}function VS(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Ud(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}const Bd=ll(xa("Optional"),8),Vd=ll(xa("SkipSelf"),4);function jd(n){return 128==(128&n.flags)}var Ns=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Ns||{});const ug=new Map;let LO=0;const hg="__ngContext__";function Nn(n,e){ai(e)?(n[hg]=e[ml],function FO(n){ug.set(n[ml],n)}(e)):n[hg]=e}let fg;function pg(n,e){return fg(n,e)}function Dl(n){const e=n[Zt];return Wn(e)?e[Zt]:e}function ab(n){return lb(n[fl])}function cb(n){return lb(n[ir])}function lb(n){for(;null!==n&&!Wn(n);)n=n[ir];return n}function Ca(n,e,t,i,r){if(null!=i){let s,o=!1;Wn(i)?s=i:ai(i)&&(o=!0,i=i[tn]);const a=zt(i);0===n&&null!==t?null==r?fb(e,t,a):fo(e,t,a,r||null,!0):1===n&&null!==t?fo(e,t,a,r||null,!0):2===n?function Kd(n,e,t){const i=Zd(n,e);i&&function tF(n,e,t,i){n.removeChild(e,t,i)}(n,i,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function rF(n,e,t,i,r){const s=t[xr];s!==zt(t)&&Ca(e,n,i,s,r);for(let a=Tn;a<t.length;a++){const c=t[a];Rl(c[ye],c,n,e,i,s)}}(e,n,s,t,r)}}function Xd(n,e,t){return n.createElement(e,t)}function db(n,e){const t=n[da],i=t.indexOf(e);lS(e),t.splice(i,1)}function Yd(n,e){if(n.length<=Tn)return;const t=Tn+e,i=n[t];if(i){const r=i[pl];null!==r&&r!==n&&db(r,i),e>0&&(n[t-1][ir]=i[ir]);const s=Ud(n,Tn+e);!function qO(n,e){Rl(n,e,e[Qe],2,null,null),e[tn]=null,e[Pn]=null}(i[ye],i);const o=s[_r];null!==o&&o.detachView(s[ye]),i[Zt]=null,i[ir]=null,i[rt]&=-129}return i}function gg(n,e){if(!(256&e[rt])){const t=e[Qe];e[gl]&&XM(e[gl]),e[vl]&&XM(e[vl]),t.destroyNode&&Rl(n,e,t,3,null,null),function ZO(n){let e=n[fl];if(!e)return vg(n[ye],n);for(;e;){let t=null;if(ai(e))t=e[fl];else{const i=e[Tn];i&&(t=i)}if(!t){for(;e&&!e[ir]&&e!==n;)ai(e)&&vg(e[ye],e),e=e[Zt];null===e&&(e=n),ai(e)&&vg(e[ye],e),t=e&&e[ir]}e=t}}(e)}}function vg(n,e){if(!(256&e[rt])){e[rt]&=-129,e[rt]|=256,function eF(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof Ml)){const s=t[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=r[s[o]],c=s[o+1];Mr(4,a,c);try{c.call(a)}finally{Mr(5,a,c)}}else{Mr(4,r,s);try{s.call(r)}finally{Mr(5,r,s)}}}}}(n,e),function QO(n,e){const t=n.cleanup,i=e[aa];if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+3];o>=0?i[o]():i[-o].unsubscribe(),s+=2}else t[s].call(i[t[s+1]]);null!==i&&(e[aa]=null);const r=e[Ds];if(null!==r){e[Ds]=null;for(let s=0;s<r.length;s++)(0,r[s])()}}(n,e),1===e[ye].type&&e[Qe].destroy();const t=e[pl];if(null!==t&&Wn(e[Zt])){t!==e[Zt]&&db(t,e);const i=e[_r];null!==i&&i.detachView(n)}!function UO(n){ug.delete(n[ml])}(e)}}function yg(n,e,t){return function hb(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[tn];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:s}=n.data[i.directiveStart+r];if(s===tr.None||s===tr.Emulated)return null}return ci(i,t)}}(n,e.parent,t)}function fo(n,e,t,i,r){n.insertBefore(e,t,i,r)}function fb(n,e,t){n.appendChild(e,t)}function pb(n,e,t,i,r){null!==i?fo(n,e,t,i,r):fb(n,e,t)}function Zd(n,e){return n.parentNode(e)}let _g,bg,eh,vb=function gb(n,e,t){return 40&n.type?ci(n,t):null};function Jd(n,e,t,i){const r=yg(n,i,e),s=e[Qe],a=function mb(n,e,t){return vb(n,e,t)}(i.parent||e[Pn],i,e);if(null!=r)if(Array.isArray(t))for(let c=0;c<t.length;c++)pb(s,r,t[c],a,!1);else pb(s,r,t,a,!1);void 0!==_g&&_g(s,i,e,t,r)}function Il(n,e){if(null!==e){const t=e.type;if(3&t)return ci(e,n);if(4&t)return xg(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return Il(n,i);{const r=n[e.index];return Wn(r)?xg(-1,r):zt(r)}}if(32&t)return pg(e,n)()||zt(n[e.index]);{const i=_b(n,e);return null!==i?Array.isArray(i)?i[0]:Il(Dl(n[on]),i):Il(n,e.next)}}return null}function _b(n,e){return null!==e?n[on][Pn].projection[e.projection]:null}function xg(n,e){const t=Tn+n+1;if(t<e.length){const i=e[t],r=i[ye].firstChild;if(null!==r)return Il(i,r)}return e[xr]}function Mg(n,e,t,i,r,s,o){for(;null!=t;){const a=i[t.index],c=t.type;if(o&&0===e&&(a&&Nn(zt(a),i),t.flags|=2),32!=(32&t.flags))if(8&c)Mg(n,e,t.child,i,r,s,!1),Ca(e,n,r,a,s);else if(32&c){const l=pg(t,i);let u;for(;u=l();)Ca(e,n,r,u,s);Ca(e,n,r,a,s)}else 16&c?Mb(n,e,i,t,r,s):Ca(e,n,r,a,s);t=o?t.projectionNext:t.next}}function Rl(n,e,t,i,r,s){Mg(t,i,n.firstChild,e,r,s,!1)}function Mb(n,e,t,i,r,s){const o=t[on],c=o[Pn].projection[i.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++)Ca(e,n,r,c[l],s);else{let l=c;const u=o[Zt];jd(i)&&(l.flags|=128),Mg(n,e,l,u,r,s,!0)}}function Sb(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function bb(n,e,t){const{mergedAttrs:i,classes:r,styles:s}=t;null!==i&&Rm(n,e,i),null!==r&&Sb(n,e,r),null!==s&&function oF(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}function Cb(n){return function wg(){if(void 0===eh&&(eh=null,Ht.trustedTypes))try{eh=Ht.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return eh}()?.createScriptURL(n)||n}class Tb{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${gM})`}}function Ls(n){return n instanceof Tb?n.changingThisBreaksApplicationSecurity:n}function Pl(n,e){const t=function gF(n){return n instanceof Tb&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${gM})`)}return t===e}const xF=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Da=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(Da||{});function po(n){const e=Ll();return e?e.sanitize(Da.URL,n)||"":Pl(n,"URL")?Ls(n):function Eg(n){return(n=String(n)).match(xF)?n:"unsafe:"+n}(Ke(n))}function Lb(n){const e=Ll();if(e)return Cb(e.sanitize(Da.RESOURCE_URL,n)||"");if(Pl(n,"ResourceURL"))return Cb(Ls(n));throw new ce(904,!1)}function Ll(){const n=Z();return n&&n[ca].sanitizer}const Ol=new Ee("ENVIRONMENT_INITIALIZER"),Fb=new Ee("INJECTOR",-1),Ub=new Ee("INJECTOR_DEF_TYPES");class Dg{get(e,t=cl){if(t===cl){const i=new Error(`NullInjectorError: No provider for ${vn(e)}!`);throw i.name="NullInjectorError",i}return t}}function NF(...n){return{\u0275providers:kb(0,n),\u0275fromNgModule:!0}}function kb(n,...e){const t=[],i=new Set;let r;const s=o=>{t.push(o)};return Sa(e,o=>{const a=o;nh(a,s,[],i)&&(r||=[],r.push(a))}),void 0!==r&&Bb(r,s),t}function Bb(n,e){for(let t=0;t<n.length;t++){const{ngModule:i,providers:r}=n[t];Rg(r,s=>{e(s,i)})}}function nh(n,e,t,i){if(!(n=Ye(n)))return!1;let r=null,s=gd(n);const o=!s&&yt(n);if(s||o){if(o&&!o.standalone)return!1;r=n}else{const c=n.ngModule;if(s=gd(c),!s)return!1;r=c}const a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){const c="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const l of c)nh(l,e,t,i)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let l;i.add(r);try{Sa(s.imports,u=>{nh(u,e,t,i)&&(l||=[],l.push(u))})}finally{}void 0!==l&&Bb(l,e)}if(!a){const l=co(r)||(()=>new r);e({provide:r,useFactory:l,deps:Mt},r),e({provide:Ub,useValue:r,multi:!0},r),e({provide:Ol,useValue:()=>Oe(r),multi:!0},r)}const c=s.providers;if(null!=c&&!a){const l=n;Rg(c,u=>{e(u,l)})}}}return r!==n&&void 0!==n.providers}function Rg(n,e){for(let t of n)_m(t)&&(t=t.\u0275providers),Array.isArray(t)?Rg(t,e):e(t)}const LF=Nt({provide:String,useValue:Nt});function Pg(n){return null!==n&&"object"==typeof n&&LF in n}function mo(n){return"function"==typeof n}const Ng=new Ee("Set Injector scope."),ih={},FF={};let Lg;function rh(){return void 0===Lg&&(Lg=new Dg),Lg}class Ei{}class Ia extends Ei{get destroyed(){return this._destroyed}constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Fg(e,o=>this.processProvider(o)),this.records.set(Fb,Ra(void 0,this)),r.has("environment")&&this.records.set(Ei,Ra(void 0,this));const s=this.records.get(Ng);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(Ub.multi,Mt,mt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of e)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();const t=Es(this),i=si(void 0);try{return e()}finally{Es(t),si(i)}}get(e,t=cl,i=mt.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(EM))return e[EM](this);i=_d(i);const s=Es(this),o=si(void 0);try{if(!(i&mt.SkipSelf)){let c=this.records.get(e);if(void 0===c){const l=function HF(n){return"function"==typeof n||"object"==typeof n&&n instanceof Ee}(e)&&md(e);c=l&&this.injectableDefInScope(l)?Ra(Og(e),ih):null,this.records.set(e,c)}if(null!=c)return this.hydrate(e,c)}return(i&mt.Self?rh():this.parent).get(e,t=i&mt.Optional&&t===cl?null:t)}catch(a){if("NullInjectorError"===a.name){if((a[yd]=a[yd]||[]).unshift(vn(e)),s)throw a;return function FN(n,e,t,i){const r=n[yd];throw e[SM]&&r.unshift(e[SM]),n.message=function UN(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=vn(e);if(Array.isArray(e))r=e.map(vn).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):vn(a)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(RN,"\n  ")}`}("\n"+n.message,r,t,i),n.ngTokenPath=r,n[yd]=null,n}(a,e,"R3InjectorError",this.source)}throw a}finally{si(o),Es(s)}}resolveInjectorInitializers(){const e=Es(this),t=si(void 0);try{const r=this.get(Ol.multi,Mt,mt.Self);for(const s of r)s()}finally{Es(e),si(t)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(vn(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ce(205,!1)}processProvider(e){let t=mo(e=Ye(e))?e:Ye(e&&e.provide);const i=function kF(n){return Pg(n)?Ra(void 0,n.useValue):Ra(function zb(n,e,t){let i;if(mo(n)){const r=Ye(n);return co(r)||Og(r)}if(Pg(n))i=()=>Ye(n.useValue);else if(function Hb(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Am(n.deps||[]));else if(function Vb(n){return!(!n||!n.useExisting)}(n))i=()=>Oe(Ye(n.useExisting));else{const r=Ye(n&&(n.useClass||n.provide));if(!function BF(n){return!!n.deps}(n))return co(r)||Og(r);i=()=>new r(...Am(n.deps))}return i}(n),ih)}(e);if(mo(e)||!0!==e.multi)this.records.get(t);else{let r=this.records.get(t);r||(r=Ra(void 0,ih,!0),r.factory=()=>Am(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){return t.value===ih&&(t.value=FF,t.value=t.factory()),"object"==typeof t.value&&t.value&&function VF(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Ye(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){const t=this._onDestroyHooks.indexOf(e);-1!==t&&this._onDestroyHooks.splice(t,1)}}function Og(n){const e=md(n),t=null!==e?e.factory:co(n);if(null!==t)return t;if(n instanceof Ee)throw new ce(204,!1);if(n instanceof Function)return function UF(n){const e=n.length;if(e>0)throw function Cl(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}(e,"?"),new ce(204,!1);const t=function TN(n){return n&&(n[vd]||n[yM])||null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new ce(204,!1)}function Ra(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Fg(n,e){for(const t of n)Array.isArray(t)?Fg(t,e):t&&_m(t)?Fg(t.\u0275providers,e):e(t)}const sh=new Ee("AppId",{providedIn:"root",factory:()=>zF}),zF="ng",Gb=new Ee("Platform Initializer"),go=new Ee("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Wb=new Ee("CSP nonce",{providedIn:"root",factory:()=>function Aa(){if(void 0!==bg)return bg;if(typeof document<"u")return document;throw new ce(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let jb=(n,e,t)=>null;function Wg(n,e,t=!1){return jb(n,e,t)}class KF{}class Xb{}class e2{resolveComponentFactory(e){throw function QF(n){const e=Error(`No component factory found for ${vn(n)}.`);return e.ngComponent=n,e}(e)}}let dh=(()=>{class n{static{this.NULL=new e2}}return n})();function t2(){return La(Dn(),Z())}function La(n,e){return new Os(ci(n,e))}let Os=(()=>{class n{constructor(t){this.nativeElement=t}static{this.__NG_ELEMENT_ID__=t2}}return n})();function n2(n){return n instanceof Os?n.nativeElement:n}class Zb{}let hh=(()=>{class n{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>function i2(){const n=Z(),t=bi(Dn().index,n);return(ai(t)?t:n)[Qe]}()}}return n})(),r2=(()=>{class n{static{this.\u0275prov=Be({token:n,providedIn:"root",factory:()=>null})}}return n})();class fh{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const s2=new fh("16.2.12"),qg={};function ew(n,e=null,t=null,i){const r=tw(n,e,t,i);return r.resolveInjectorInitializers(),r}function tw(n,e=null,t=null,i,r=new Set){const s=[t||Mt,NF(n)];return i=i||("object"==typeof n?void 0:vn(n)),new Ia(s,e||rh(),i||null,r)}let Wi=(()=>{class n{static{this.THROW_IF_NOT_FOUND=cl}static{this.NULL=new Dg}static create(t,i){if(Array.isArray(t))return ew({name:""},i,t,"");{const r=t.name??"";return ew({name:r},t.parent,t.providers,r)}}static{this.\u0275prov=Be({token:n,providedIn:"any",factory:()=>Oe(Fb)})}static{this.__NG_ELEMENT_ID__=-1}}return n})();function Yg(n){return n.ngOriginalError}class qr{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&Yg(e);for(;t&&Yg(t);)t=Yg(t);return t||null}}function Zg(n){return e=>{setTimeout(n,void 0,e)}}const Xn=class f2 extends Qi{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){let r=e,s=t||(()=>null),o=i;if(e&&"object"==typeof e){const c=e;r=c.next?.bind(c),s=c.error?.bind(c),o=c.complete?.bind(c)}this.__isAsync&&(s=Zg(s),r&&(r=Zg(r)),o&&(o=Zg(o)));const a=super.subscribe({next:r,error:s,complete:o});return e instanceof xi&&e.add(a),a}};function iw(...n){}class Gt{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Xn(!1),this.onMicrotaskEmpty=new Xn(!1),this.onStable=new Xn(!1),this.onError=new Xn(!1),typeof Zone>"u")throw new ce(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function p2(){const n="function"==typeof Ht.requestAnimationFrame;let e=Ht[n?"requestAnimationFrame":"setTimeout"],t=Ht[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&t){const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function v2(n){const e=()=>{!function g2(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Ht,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Kg(n),n.isCheckStableRunning=!0,Jg(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Kg(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,s,o,a)=>{if(function _2(n){return!(!Array.isArray(n)||1!==n.length)&&!0===n[0].data?.__ignore_ng_zone__}(a))return t.invokeTask(r,s,o,a);try{return rw(n),t.invokeTask(r,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),sw(n)}},onInvoke:(t,i,r,s,o,a,c)=>{try{return rw(n),t.invoke(r,s,o,a,c)}finally{n.shouldCoalesceRunChangeDetection&&e(),sw(n)}},onHasTask:(t,i,r,s)=>{t.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,Kg(n),Jg(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,i,r,s)=>(t.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Gt.isInAngularZone())throw new ce(909,!1)}static assertNotInAngularZone(){if(Gt.isInAngularZone())throw new ce(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,e,m2,iw,iw);try{return s.runTask(o,t,i)}finally{s.cancelTask(o)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const m2={};function Jg(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Kg(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function rw(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function sw(n){n._nesting--,Jg(n)}class y2{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Xn,this.onMicrotaskEmpty=new Xn,this.onStable=new Xn,this.onError=new Xn}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}const ow=new Ee("",{providedIn:"root",factory:aw});function aw(){const n=be(Gt);let e=!0;return function vN(...n){const e=al(n),t=function uN(n,e){return"number"==typeof pm(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?Bi(i[0]):ra(t)(Sn(i,e)):vr}(new hn(r=>{e=n.isStable&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks,n.runOutsideAngular(()=>{r.next(e),r.complete()})}),new hn(r=>{let s;n.runOutsideAngular(()=>{s=n.onStable.subscribe(()=>{Gt.assertNotInAngularZone(),queueMicrotask(()=>{!e&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks&&(e=!0,r.next(!0))})})});const o=n.onUnstable.subscribe(()=>{Gt.assertInAngularZone(),e&&(e=!1,n.runOutsideAngular(()=>{r.next(!1)}))});return()=>{s.unsubscribe(),o.unsubscribe()}}).pipe(mM()))}function Xr(n){return n instanceof Function?n():n}let Qg=(()=>{class n{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static{this.\u0275prov=Be({token:n,providedIn:"root",factory:()=>new n})}}return n})();function kl(n){for(;n;){n[rt]|=64;const e=Dl(n);if(Lm(n)&&!e)return n;n=e}return null}const hw=new Ee("",{providedIn:"root",factory:()=>!1});let gh=null;function gw(n,e){return n[e]??_w()}function vw(n,e){const t=_w();t.producerNode?.length&&(n[e]=gh,t.lView=n,gh=yw())}const D2={...zM,consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{kl(n.lView)},lView:null};function yw(){return Object.create(D2)}function _w(){return gh??=yw(),gh}const nt={};function an(n){xw(_t(),Z(),$n()+n,!1)}function xw(n,e,t,i){if(!i)if(3==(3&e[rt])){const s=n.preOrderCheckHooks;null!==s&&Id(e,s,t)}else{const s=n.preOrderHooks;null!==s&&Rd(e,s,0,t)}uo(t)}function Ue(n,e=mt.Default){const t=Z();return null===t?Oe(n,e):NS(Dn(),t,Ye(n),e)}function vh(n,e,t,i,r,s,o,a,c,l,u){const d=e.blueprint.slice();return d[tn]=r,d[rt]=140|i,(null!==l||n&&2048&n[rt])&&(d[rt]|=2048),cS(d),d[Zt]=d[la]=n,d[sn]=t,d[ca]=o||n&&n[ca],d[Qe]=a||n&&n[Qe],d[As]=c||n&&n[As]||null,d[Pn]=s,d[ml]=function OO(){return LO++}(),d[Gr]=u,d[kM]=l,d[on]=2==e.type?n[on]:d,d}function Ua(n,e,t,i,r){let s=n.data[e];if(null===s)s=function ev(n,e,t,i,r){const s=pS(),o=Wm(),c=n.data[e]=function U2(n,e,t,i,r,s){let o=e?e.injectorIndex:-1,a=0;return function pa(){return null!==qe.skipHydrationRootTNode}()&&(a|=128),{type:t,index:i,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=c),null!==s&&(o?null==s.child&&null!==c.parent&&(s.child=c):null===s.next&&(s.next=c,c.prev=s)),c}(n,e,t,i,r),function LL(){return qe.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=i,s.attrs=r;const o=function xl(){const n=qe.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return Sr(s,!0),s}function Bl(n,e,t,i){if(0===t)return-1;const r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function Sw(n,e,t,i,r){const s=gw(e,gl),o=$n(),a=2&i;try{uo(-1),a&&e.length>gt&&xw(n,e,gt,!1),Mr(a?2:0,r);const l=a?s:null,u=Fm(l);try{null!==l&&(l.dirty=!1),t(i,r)}finally{Um(l,u)}}finally{a&&null===e[gl]&&vw(e,gl),uo(o),Mr(a?3:1,r)}}function tv(n,e,t){if(Nm(e)){const i=zi(null);try{const s=e.directiveEnd;for(let o=e.directiveStart;o<s;o++){const a=n.data[o];a.contentQueries&&a.contentQueries(1,t[o],o)}}finally{zi(i)}}}function nv(n,e,t){fS()&&(function W2(n,e,t,i){const r=t.directiveStart,s=t.directiveEnd;ao(t)&&function J2(n,e,t){const i=ci(e,n),r=bw(t);let o=16;t.signals?o=4096:t.onPush&&(o=64);const a=yh(n,vh(n,r,null,o,i,e,null,n[ca].rendererFactory.createRenderer(i,t),null,null,null));n[e.index]=a}(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||Nd(t,e),Nn(i,e);const o=t.initialInputs;for(let a=r;a<s;a++){const c=n.data[a],l=ho(e,n,a,t);Nn(l,e),null!==o&&K2(0,a-r,l,c,0,o),rr(c)&&(bi(t.index,e)[sn]=ho(e,n,a,t))}}(n,e,t,ci(t,e)),64==(64&t.flags)&&Aw(n,e,t))}function iv(n,e,t=ci){const i=e.localNames;if(null!==i){let r=e.index+1;for(let s=0;s<i.length;s+=2){const o=i[s+1],a=-1===o?t(e,n):n[o];n[r++]=a}}}function bw(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=rv(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function rv(n,e,t,i,r,s,o,a,c,l,u){const d=gt+i,h=d+r,f=function R2(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:nt);return t}(d,h),p="function"==typeof l?l():l;return f[ye]={type:n,blueprint:f,template:t,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:c,consts:p,incompleteFirstPass:!1,ssrId:u}}let ww=n=>null;function Ew(n,e,t,i){for(let r in n)if(n.hasOwnProperty(r)){t=null===t?{}:t;const s=n[r];null===i?Cw(t,e,r,s):i.hasOwnProperty(r)&&Cw(t,e,i[r],s)}return t}function Cw(n,e,t,i){n.hasOwnProperty(t)?n[t].push(e,i):n[t]=[e,i]}function Ci(n,e,t,i,r,s,o,a){const c=ci(e,t);let u,l=e.inputs;!a&&null!=l&&(u=l[i])?(lv(n,t,u,i,r),ao(e)&&function V2(n,e){const t=bi(e,n);16&t[rt]||(t[rt]|=64)}(t,e.index)):3&e.type&&(i=function B2(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=o?o(r,e.value||"",i):r,s.setProperty(c,i,r))}function sv(n,e,t,i){if(fS()){const r=null===i?null:{"":-1},s=function $2(n,e){const t=n.directiveRegistry;let i=null,r=null;if(t)for(let s=0;s<t.length;s++){const o=t[s];if(PM(e,o.selectors,!1))if(i||(i=[]),rr(o))if(null!==o.findHostDirectiveDefs){const a=[];r=r||new Map,o.findHostDirectiveDefs(o,a,r),i.unshift(...a,o),ov(n,e,a.length)}else i.unshift(o),ov(n,e,0);else r=r||new Map,o.findHostDirectiveDefs?.(o,i,r),i.push(o)}return null===i?null:[i,r]}(n,t);let o,a;null===s?o=a=null:[o,a]=s,null!==o&&Tw(n,e,t,o,r,a),r&&function q2(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const s=t[e[r+1]];if(null==s)throw new ce(-301,!1);i.push(e[r],s)}}}(t,i,r)}t.mergedAttrs=dl(t.mergedAttrs,t.attrs)}function Tw(n,e,t,i,r,s){for(let l=0;l<i.length;l++)ng(Nd(t,e),n,i[l].type);!function Y2(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,i.length);for(let l=0;l<i.length;l++){const u=i[l];u.providersResolver&&u.providersResolver(u)}let o=!1,a=!1,c=Bl(n,e,i.length,null);for(let l=0;l<i.length;l++){const u=i[l];t.mergedAttrs=dl(t.mergedAttrs,u.hostAttrs),Z2(n,t,e,c,u),X2(c,u,r),null!==u.contentQueries&&(t.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(t.flags|=64);const d=u.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),o=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),a=!0),c++}!function k2(n,e,t){const r=e.directiveEnd,s=n.data,o=e.attrs,a=[];let c=null,l=null;for(let u=e.directiveStart;u<r;u++){const d=s[u],h=t?t.get(d):null,p=h?h.outputs:null;c=Ew(d.inputs,u,c,h?h.inputs:null),l=Ew(d.outputs,u,l,p);const v=null===c||null===o||RM(e)?null:Q2(c,u,o);a.push(v)}null!==c&&(c.hasOwnProperty("class")&&(e.flags|=8),c.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=c,e.outputs=l}(n,t,s)}function Aw(n,e,t){const i=t.directiveStart,r=t.directiveEnd,s=t.index,o=function FL(){return qe.lFrame.currentDirectiveIndex}();try{uo(s);for(let a=i;a<r;a++){const c=n.data[a],l=e[a];$m(a),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&j2(c,l)}}finally{uo(-1),$m(o)}}function j2(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function ov(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function X2(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;rr(e)&&(t[""]=n)}}function Z2(n,e,t,i,r){n.data[i]=r;const s=r.factory||(r.factory=co(r.type)),o=new Ml(s,rr(r),Ue);n.blueprint[i]=o,t[i]=o,function z2(n,e,t,i,r){const s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function G2(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,i,s)}}(n,e,i,Bl(n,t,r.hostVars,nt),r)}function wr(n,e,t,i,r,s){const o=ci(n,e);!function av(n,e,t,i,r,s,o){if(null==s)n.removeAttribute(e,r,t);else{const a=null==o?Ke(s):o(s,i||"",r);n.setAttribute(e,r,a,t)}}(e[Qe],o,s,n.value,t,i,r)}function K2(n,e,t,i,r,s){const o=s[e];if(null!==o)for(let a=0;a<o.length;)Dw(i,t,o[a++],o[a++],o[a++])}function Dw(n,e,t,i,r){const s=zi(null);try{const o=n.inputTransforms;null!==o&&o.hasOwnProperty(i)&&(r=o[i].call(e,r)),null!==n.setInput?n.setInput(e,r,t,i):e[i]=r}finally{zi(s)}}function Q2(n,e,t){let i=null,r=0;for(;r<t.length;){const s=t[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(n.hasOwnProperty(s)){null===i&&(i=[]);const o=n[s];for(let a=0;a<o.length;a+=2)if(o[a]===e){i.push(s,o[a+1],t[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function Iw(n,e,t,i){return[n,!0,!1,e,null,0,i,t,null,null,null]}function Rw(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const s=t[i+1];if(-1!==s){const o=n.data[s];Xm(t[i]),o.contentQueries(2,e[s],s)}}}function yh(n,e){return n[fl]?n[UM][ir]=e:n[fl]=e,n[UM]=e,e}function cv(n,e,t){Xm(0);const i=zi(null);try{e(n,t)}finally{zi(i)}}function Pw(n){return n[aa]||(n[aa]=[])}function Nw(n){return n.cleanup||(n.cleanup=[])}function Ow(n,e){const t=n[As],i=t?t.get(qr,null):null;i&&i.handleError(e)}function lv(n,e,t,i,r){for(let s=0;s<t.length;){const o=t[s++],a=t[s++];Dw(n.data[o],e[o],i,a,r)}}function Yr(n,e,t){const i=function Td(n,e){return zt(e[n])}(e,n);!function ub(n,e,t){n.setValue(e,t)}(n[Qe],i,t)}function eU(n,e){const t=bi(e,n),i=t[ye];!function tU(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}(i,t);const r=t[tn];null!==r&&null===t[Gr]&&(t[Gr]=Wg(r,t[As])),uv(i,t,t[sn])}function uv(n,e,t){Ym(e);try{const i=n.viewQuery;null!==i&&cv(1,i,t);const r=n.template;null!==r&&Sw(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Rw(n,e),n.staticViewQueries&&cv(2,n.viewQuery,t);const s=n.components;null!==s&&function nU(n,e){for(let t=0;t<e.length;t++)eU(n,e[t])}(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[rt]&=-5,Zm()}}let Fw=(()=>{class n{constructor(){this.all=new Set,this.queue=new Map}create(t,i,r){const s=typeof Zone>"u"?null:Zone.current,o=function hL(n,e,t){const i=Object.create(fL);t&&(i.consumerAllowSignalWrites=!0),i.fn=n,i.schedule=e;const r=o=>{i.cleanupFn=o};return i.ref={notify:()=>$M(i),run:()=>{if(i.dirty=!1,i.hasRun&&!qM(i))return;i.hasRun=!0;const o=Fm(i);try{i.cleanupFn(),i.cleanupFn=tS,i.fn(r)}finally{Um(i,o)}},cleanup:()=>i.cleanupFn()},i.ref}(t,l=>{this.all.has(l)&&this.queue.set(l,s)},r);let a;this.all.add(o),o.notify();const c=()=>{o.cleanup(),a?.(),this.all.delete(o),this.queue.delete(o)};return a=i?.onDestroy(c),{destroy:c}}flush(){if(0!==this.queue.size)for(const[t,i]of this.queue)this.queue.delete(t),i?i.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}static{this.\u0275prov=Be({token:n,providedIn:"root",factory:()=>new n})}}return n})();function _h(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?r=gm(r,a):2==s&&(i=gm(i,a+": "+e[++o]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function Vl(n,e,t,i,r=!1){for(;null!==t;){const s=e[t.index];null!==s&&i.push(zt(s)),Wn(s)&&Uw(s,i);const o=t.type;if(8&o)Vl(n,e,t.child,i);else if(32&o){const a=pg(t,e);let c;for(;c=a();)i.push(c)}else if(16&o){const a=_b(e,t);if(Array.isArray(a))i.push(...a);else{const c=Dl(e[on]);Vl(c[ye],c,a,i,!0)}}t=r?t.projectionNext:t.next}return i}function Uw(n,e){for(let t=Tn;t<n.length;t++){const i=n[t],r=i[ye].firstChild;null!==r&&Vl(i[ye],i,r,e)}n[xr]!==n[tn]&&e.push(n[xr])}function xh(n,e,t,i=!0){const r=e[ca],s=r.rendererFactory,o=r.afterRenderEventManager;s.begin?.(),o?.begin();try{kw(n,e,n.template,t)}catch(c){throw i&&Ow(e,c),c}finally{s.end?.(),r.effectManager?.flush(),o?.end()}}function kw(n,e,t,i){const r=e[rt];if(256!=(256&r)){e[ca].effectManager?.flush(),Ym(e);try{cS(e),function gS(n){return qe.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&Sw(n,e,t,2,i);const o=3==(3&r);if(o){const l=n.preOrderCheckHooks;null!==l&&Id(e,l,null)}else{const l=n.preOrderHooks;null!==l&&Rd(e,l,0,null),Jm(e,0)}if(function sU(n){for(let e=ab(n);null!==e;e=cb(e)){if(!e[BM])continue;const t=e[da];for(let i=0;i<t.length;i++){bL(t[i])}}}(e),Bw(e,2),null!==n.contentQueries&&Rw(n,e),o){const l=n.contentCheckHooks;null!==l&&Id(e,l)}else{const l=n.contentHooks;null!==l&&Rd(e,l,1),Jm(e,1)}!function I2(n,e){const t=n.hostBindingOpCodes;if(null===t)return;const i=gw(e,vl);try{for(let r=0;r<t.length;r++){const s=t[r];if(s<0)uo(~s);else{const o=s,a=t[++r],c=t[++r];OL(a,o),i.dirty=!1;const l=Fm(i);try{c(2,e[o])}finally{Um(i,l)}}}}finally{null===e[vl]&&vw(e,vl),uo(-1)}}(n,e);const a=n.components;null!==a&&Hw(e,a,0);const c=n.viewQuery;if(null!==c&&cv(2,c,i),o){const l=n.viewCheckHooks;null!==l&&Id(e,l)}else{const l=n.viewHooks;null!==l&&Rd(e,l,2),Jm(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[rt]&=-73,lS(e)}finally{Zm()}}}function Bw(n,e){for(let t=ab(n);null!==t;t=cb(t))for(let i=Tn;i<t.length;i++)Vw(t[i],e)}function oU(n,e,t){Vw(bi(e,n),t)}function Vw(n,e){if(!function ML(n){return 128==(128&n[rt])}(n))return;const t=n[ye],i=n[rt];if(80&i&&0===e||1024&i||2===e)kw(t,n,t.template,n[sn]);else if(n[hl]>0){Bw(n,1);const r=t.components;null!==r&&Hw(n,r,1)}}function Hw(n,e,t){for(let i=0;i<e.length;i++)oU(n,e[i],t)}class Hl{get rootNodes(){const e=this._lView,t=e[ye];return Vl(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[sn]}set context(e){this._lView[sn]=e}get destroyed(){return 256==(256&this._lView[rt])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[Zt];if(Wn(e)){const t=e[8],i=t?t.indexOf(this):-1;i>-1&&(Yd(e,i),Ud(t,i))}this._attachedToViewContainer=!1}gg(this._lView[ye],this._lView)}onDestroy(e){!function dS(n,e){if(256==(256&n[rt]))throw new ce(911,!1);null===n[Ds]&&(n[Ds]=[]),n[Ds].push(e)}(this._lView,e)}markForCheck(){kl(this._cdRefInjectingView||this._lView)}detach(){this._lView[rt]&=-129}reattach(){this._lView[rt]|=128}detectChanges(){xh(this._lView[ye],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ce(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function YO(n,e){Rl(n,e,e[Qe],2,null,null)}(this._lView[ye],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new ce(902,!1);this._appRef=e}}class aU extends Hl{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;xh(e[ye],e,e[sn],!1)}checkNoChanges(){}get context(){return null}}class zw extends dh{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=yt(e);return new zl(t,this.ngModule)}}function Gw(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class lU{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){i=_d(i);const r=this.injector.get(e,qg,i);return r!==qg||t===qg?r:this.parentInjector.get(e,t,i)}}class zl extends Xb{get inputs(){const e=this.componentDef,t=e.inputTransforms,i=Gw(e.inputs);if(null!==t)for(const r of i)t.hasOwnProperty(r.propName)&&(r.transform=t[r.propName]);return i}get outputs(){return Gw(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function qN(n){return n.map($N).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,i,r){let s=(r=r||this.ngModule)instanceof Ei?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new lU(e,s):e,a=o.get(Zb,null);if(null===a)throw new ce(407,!1);const d={rendererFactory:a,sanitizer:o.get(r2,null),effectManager:o.get(Fw,null),afterRenderEventManager:o.get(Qg,null)},h=a.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",p=i?function P2(n,e,t,i){const s=i.get(hw,!1)||t===tr.ShadowDom,o=n.selectRootElement(e,s);return function N2(n){ww(n)}(o),o}(h,i,this.componentDef.encapsulation,o):Xd(h,f,function cU(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(f)),m=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let y=null;null!==p&&(y=Wg(p,o,!0));const _=rv(0,null,null,1,0,null,null,null,null,null,null),x=vh(null,_,null,m,null,null,d,h,o,null,y);let w,C;Ym(x);try{const D=this.componentDef;let I,b=null;D.findHostDirectiveDefs?(I=[],b=new Map,D.findHostDirectiveDefs(D,I,b),I.push(D)):I=[D];const S=function dU(n,e){const t=n[ye],i=gt;return n[i]=e,Ua(t,i,2,"#host",null)}(x,p),R=function hU(n,e,t,i,r,s,o){const a=r[ye];!function fU(n,e,t,i){for(const r of n)e.mergedAttrs=dl(e.mergedAttrs,r.hostAttrs);null!==e.mergedAttrs&&(_h(e,e.mergedAttrs,!0),null!==t&&bb(i,t,e))}(i,n,e,o);let c=null;null!==e&&(c=Wg(e,r[As]));const l=s.rendererFactory.createRenderer(e,t);let u=16;t.signals?u=4096:t.onPush&&(u=64);const d=vh(r,bw(t),null,u,r[n.index],n,s,l,null,null,c);return a.firstCreatePass&&ov(a,n,i.length-1),yh(r,d),r[n.index]=d}(S,p,D,I,x,d,h);C=aS(_,gt),p&&function mU(n,e,t,i){if(i)Rm(n,t,["ng-version",s2.full]);else{const{attrs:r,classes:s}=function XN(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&e.push(s,n[++i]):8===r&&t.push(s);else{if(!nr(r))break;r=s}i++}return{attrs:e,classes:t}}(e.selectors[0]);r&&Rm(n,t,r),s&&s.length>0&&Sb(n,t,s.join(" "))}}(h,D,p,i),void 0!==t&&function gU(n,e,t){const i=n.projection=[];for(let r=0;r<e.length;r++){const s=t[r];i.push(null!=s?Array.from(s):null)}}(C,this.ngContentSelectors,t),w=function pU(n,e,t,i,r,s){const o=Dn(),a=r[ye],c=ci(o,r);Tw(a,r,o,t,null,i);for(let u=0;u<t.length;u++)Nn(ho(r,a,o.directiveStart+u,o),r);Aw(a,r,o),c&&Nn(c,r);const l=ho(r,a,o.directiveStart+o.componentOffset,o);if(n[sn]=r[sn]=l,null!==s)for(const u of s)u(l,e);return tv(a,o,n),l}(R,D,I,b,x,[vU]),uv(_,x,null)}finally{Zm()}return new uU(this.componentType,w,La(C,x),x,C)}}class uU extends KF{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new aU(r),this.componentType=e}setInput(e,t){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;const s=this._rootLView;lv(s[ye],s,r,e,t),this.previousInputValues.set(e,t),kl(bi(this._tNode.index,s))}}get injector(){return new qn(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function vU(){const n=Dn();Dd(Z()[ye],n)}function Yw(n){const e=n.inputConfig,t={};for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];Array.isArray(r)&&r[2]&&(t[i]=r[2])}n.inputTransforms=t}function Sh(n){return!!function dv(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}function Ln(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function hv(n,e,t,i){const r=Z();return Ln(r,ma(),e)&&(_t(),wr(Jt(),r,n,e,t,i)),hv}function Ba(n,e,t,i){return Ln(n,ma(),t)?e+Ke(t)+i:nt}function sr(n,e,t,i,r,s,o,a){const c=Z(),l=_t(),u=n+gt,d=l.firstCreatePass?function $U(n,e,t,i,r,s,o,a,c){const l=e.consts,u=Ua(e,n,4,o||null,Rs(l,a));sv(e,t,u,Rs(l,c)),Dd(e,u);const d=u.tView=rv(2,u,i,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,l,null);return null!==e.queries&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}(u,l,c,e,t,i,r,s,o):l.data[u];Sr(d,!1);const h=cE(l,c,d,n);Ad()&&Jd(l,c,h,d),Nn(h,c),yh(c,c[u]=Iw(h,c,h,d)),wd(d)&&nv(l,c,d),null!=o&&iv(c,d,a)}let cE=function lE(n,e,t,i){return Ps(!0),e[Qe].createComment("")};function In(n,e,t){const i=Z();return Ln(i,ma(),e)&&Ci(_t(),Jt(),i,n,e,i[Qe],t,!1),In}function yv(n,e,t,i,r){const o=r?"class":"style";lv(n,t,e.inputs[o],o,i)}function et(n,e,t,i){const r=Z(),s=_t(),o=gt+n,a=r[Qe],c=s.firstCreatePass?function JU(n,e,t,i,r,s){const o=e.consts,c=Ua(e,n,2,i,Rs(o,r));return sv(e,t,c,Rs(o,s)),null!==c.attrs&&_h(c,c.attrs,!1),null!==c.mergedAttrs&&_h(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(o,s,r,e,t,i):s.data[o],l=uE(s,r,c,a,e,n);r[o]=l;const u=wd(c);return Sr(c,!0),bb(a,l,c),32!=(32&c.flags)&&Ad()&&Jd(s,r,l,c),0===function EL(){return qe.lFrame.elementDepthCount}()&&Nn(l,r),function CL(){qe.lFrame.elementDepthCount++}(),u&&(nv(s,r,c),tv(s,c,r)),null!==i&&iv(r,c),et}function ht(){let n=Dn();Wm()?function jm(){qe.lFrame.isParent=!1}():(n=n.parent,Sr(n,!1));const e=n;(function AL(n){return qe.skipHydrationRootTNode===n})(e)&&function PL(){qe.skipHydrationRootTNode=null}(),function TL(){qe.lFrame.elementDepthCount--}();const t=_t();return t.firstCreatePass&&(Dd(t,n),Nm(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function qL(n){return 0!=(8&n.flags)}(e)&&yv(t,e,Z(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function XL(n){return 0!=(16&n.flags)}(e)&&yv(t,e,Z(),e.stylesWithoutHost,!1),ht}function Yn(n,e,t,i){return et(n,e,t,i),ht(),Yn}let uE=(n,e,t,i,r,s)=>(Ps(!0),Xd(i,r,function wS(){return qe.lFrame.currentNamespace}()));function Th(n){return!!n&&"function"==typeof n.then}function pE(n){return!!n&&"function"==typeof n.subscribe}function qa(n,e,t,i){const r=Z(),s=_t(),o=Dn();return function gE(n,e,t,i,r,s,o){const a=wd(i),l=n.firstCreatePass&&Nw(n),u=e[sn],d=Pw(e);let h=!0;if(3&i.type||o){const v=ci(i,e),g=o?o(v):v,m=d.length,y=o?x=>o(zt(x[i.index])):i.index;let _=null;if(!o&&a&&(_=function ik(n,e,t,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const o=r[s];if(o===t&&r[s+1]===i){const a=e[aa],c=r[s+2];return a.length>c?a[c]:null}"string"==typeof o&&(s+=2)}return null}(n,e,r,i.index)),null!==_)(_.__ngLastListenerFn__||_).__ngNextListenerFn__=s,_.__ngLastListenerFn__=s,h=!1;else{s=yE(i,e,u,s,!1);const x=t.listen(g,r,s);d.push(s,x),l&&l.push(r,y,m,m+1)}}else s=yE(i,e,u,s,!1);const f=i.outputs;let p;if(h&&null!==f&&(p=f[r])){const v=p.length;if(v)for(let g=0;g<v;g+=2){const w=e[p[g]][p[g+1]].subscribe(s),C=d.length;d.push(s,w),l&&l.push(r,i.index,C,-(C+1))}}}(s,r,r[Qe],o,n,e,i),qa}function vE(n,e,t,i){try{return Mr(6,e,t),!1!==t(i)}catch(r){return Ow(n,r),!1}finally{Mr(7,e,t)}}function yE(n,e,t,i,r){return function s(o){if(o===Function)return i;kl(n.componentOffset>-1?bi(n.index,e):e);let c=vE(e,t,i,o),l=s.__ngNextListenerFn__;for(;l;)c=vE(e,t,l,o)&&c,l=l.__ngNextListenerFn__;return r&&!1===c&&o.preventDefault(),c}}function Fs(n=1){return function kL(n){return(qe.lFrame.contextLView=function BL(n,e){for(;n>0;)e=e[la],n--;return e}(n,qe.lFrame.contextLView))[sn]}(n)}function Ah(n,e,t){return Mv(n,"",e,"",t),Ah}function Mv(n,e,t,i,r){const s=Z(),o=Ba(s,e,t,i);return o!==nt&&Ci(_t(),Jt(),s,n,o,s[Qe],r,!1),Mv}function Ct(n,e=""){const t=Z(),i=_t(),r=n+gt,s=i.firstCreatePass?Ua(i,r,1,e,null):i.data[r],o=zE(i,t,s,e,n);t[r]=o,Ad()&&Jd(i,t,o,s),Sr(s,!1)}let zE=(n,e,t,i,r)=>(Ps(!0),function qd(n,e){return n.createText(e)}(e[Qe],i));function Ar(n){return Cv("",n,""),Ar}function Cv(n,e,t){const i=Z(),r=Ba(i,n,e,t);return r!==nt&&Yr(i,$n(),r),Cv}const Za="en-US";let uC=Za;class xo{}class FC{}class Nv extends xo{constructor(e,t,i){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new zw(this);const r=Si(e);this._bootstrapComponents=Xr(r.bootstrap),this._r3Injector=tw(e,t,[{provide:xo,useValue:this},{provide:dh,useValue:this.componentFactoryResolver},...i],vn(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Lv extends FC{constructor(e){super(),this.moduleType=e}create(e){return new Nv(this.moduleType,e,[])}}class UC extends xo{constructor(e){super(),this.componentFactoryResolver=new zw(this),this.instance=null;const t=new Ia([...e.providers,{provide:xo,useValue:this},{provide:dh,useValue:this.componentFactoryResolver}],e.parent||rh(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function Ov(n,e,t=null){return new UC({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}let Q3=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const i=kb(0,t.type),r=i.length>0?Ov([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,r)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Be({token:n,providedIn:"environment",factory:()=>new n(Oe(Ei))})}}return n})();function kC(n){n.getStandaloneInjector=e=>e.get(Q3).getOrCreateStandaloneInjector(n)}function EB(){return this._results[Symbol.iterator]()}class Uv{get changes(){return this._changes||(this._changes=new Xn)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Uv.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=EB)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const r=function Gi(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function cO(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}(i._results,r,t))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function TB(n,e,t,i=!0){const r=e[ye];if(function JO(n,e,t,i){const r=Tn+i,s=t.length;i>0&&(t[r-1][ir]=e),i<s-Tn?(e[ir]=t[r],VS(t,Tn+i,e)):(t.push(e),e[ir]=null),e[Zt]=t;const o=e[pl];null!==o&&t!==o&&function KO(n,e){const t=n[da];e[on]!==e[Zt][Zt][on]&&(n[BM]=!0),null===t?n[da]=[e]:t.push(e)}(o,e);const a=e[_r];null!==a&&a.insertView(n),e[rt]|=128}(r,e,n,t),i){const s=xg(t,n),o=e[Qe],a=Zd(o,n[xr]);null!==a&&function XO(n,e,t,i,r,s){i[tn]=r,i[Pn]=e,Rl(n,i,t,1,r,s)}(r,n[Pn],o,e,a,s)}}let Zr=(()=>{class n{static{this.__NG_ELEMENT_ID__=IB}}return n})();const AB=Zr,DB=class extends AB{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t)}createEmbeddedViewImpl(e,t,i){const r=function CB(n,e,t,i){const r=e.tView,a=vh(n,r,t,4096&n[rt]?4096:16,null,e,null,null,null,i?.injector??null,i?.hydrationInfo??null);a[pl]=n[e.index];const l=n[_r];return null!==l&&(a[_r]=l.createEmbeddedView(r)),uv(r,a,t),a}(this._declarationLView,this._declarationTContainer,e,{injector:t,hydrationInfo:i});return new Hl(r)}};function IB(){return Oh(Dn(),Z())}function Oh(n,e){return 4&n.type?new DB(e,n,La(n,e)):null}let cr=(()=>{class n{static{this.__NG_ELEMENT_ID__=FB}}return n})();function FB(){return nT(Dn(),Z())}const UB=cr,eT=class extends UB{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return La(this._hostTNode,this._hostLView)}get injector(){return new qn(this._hostTNode,this._hostLView)}get parentInjector(){const e=Ld(this._hostTNode,this._hostLView);if(Qm(e)){const t=bl(e,this._hostLView),i=Sl(e);return new qn(t[ye].data[i+8],t)}return new qn(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=tT(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-Tn}createEmbeddedView(e,t,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const a=e.createEmbeddedViewImpl(t||{},s,null);return this.insertImpl(a,r,false),a}createComponent(e,t,i,r,s){const o=e&&!function El(n){return"function"==typeof n}(e);let a;if(o)a=t;else{const v=t||{};a=v.index,i=v.injector,r=v.projectableNodes,s=v.environmentInjector||v.ngModuleRef}const c=o?e:new zl(yt(e)),l=i||this.parentInjector;if(!s&&null==c.ngModule){const g=(o?l:this.parentInjector).get(Ei,null);g&&(s=g)}yt(c.componentType??{});const f=c.create(l,r,null,s);return this.insertImpl(f.hostView,a,false),f}insert(e,t){return this.insertImpl(e,t,!1)}insertImpl(e,t,i){const r=e._lView;if(function SL(n){return Wn(n[Zt])}(r)){const c=this.indexOf(e);if(-1!==c)this.detach(c);else{const l=r[Zt],u=new eT(l,l[Pn],l[Zt]);u.detach(u.indexOf(e))}}const o=this._adjustIndex(t),a=this._lContainer;return TB(a,r,o,!i),e.attachToViewContainerRef(),VS(kv(a),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=tT(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=Yd(this._lContainer,t);i&&(Ud(kv(this._lContainer),t),gg(i[ye],i))}detach(e){const t=this._adjustIndex(e,-1),i=Yd(this._lContainer,t);return i&&null!=Ud(kv(this._lContainer),t)?new Hl(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function tT(n){return n[8]}function kv(n){return n[8]||(n[8]=[])}function nT(n,e){let t;const i=e[n.index];return Wn(i)?t=i:(t=Iw(i,e,null,n),e[n.index]=t,yh(e,t)),iT(t,e,n,i),new eT(t,n,e)}let iT=function rT(n,e,t,i){if(n[xr])return;let r;r=8&t.type?zt(i):function kB(n,e){const t=n[Qe],i=t.createComment(""),r=ci(e,n);return fo(t,Zd(t,r),i,function nF(n,e){return n.nextSibling(e)}(t,r),!1),i}(e,t),n[xr]=r};class Bv{constructor(e){this.queryList=e,this.matches=null}clone(){return new Bv(this.queryList)}setDirty(){this.queryList.setDirty()}}class Vv{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){const o=t.getByIndex(s);r.push(this.queries[o.indexInDeclarationView].clone())}return new Vv(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==hT(e,t).matches&&this.queries[t].setDirty()}}class sT{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class Hv{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,null!==t?t.push(s):t=[s])}return null!==t?new Hv(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class zv{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new zv(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(e,t,HB(t,s)),this.matchTNodeWithReadOption(e,t,Od(t,e,s,!1,!1))}else i===Zr?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Od(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Os||r===cr||r===Zr&&4&t.type)this.addMatch(t.index,-2);else{const s=Od(t,e,r,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function HB(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function GB(n,e,t,i){return-1===t?function zB(n,e){return 11&n.type?La(n,e):4&n.type?Oh(n,e):null}(e,n):-2===t?function WB(n,e,t){return t===Os?La(e,n):t===Zr?Oh(e,n):t===cr?nT(e,n):void 0}(n,e,i):ho(n,n[ye],t,e)}function oT(n,e,t,i){const r=e[_r].queries[i];if(null===r.matches){const s=n.data,o=t.matches,a=[];for(let c=0;c<o.length;c+=2){const l=o[c];a.push(l<0?null:GB(e,s[l],o[c+1],t.metadata.read))}r.matches=a}return r.matches}function Gv(n,e,t,i){const r=n.queries.getByIndex(t),s=r.matches;if(null!==s){const o=oT(n,e,r,t);for(let a=0;a<s.length;a+=2){const c=s[a];if(c>0)i.push(o[a/2]);else{const l=s[a+1],u=e[-c];for(let d=Tn;d<u.length;d++){const h=u[d];h[pl]===h[Zt]&&Gv(h[ye],h,l,i)}if(null!==u[da]){const d=u[da];for(let h=0;h<d.length;h++){const f=d[h];Gv(f[ye],f,l,i)}}}}}return i}function aT(n){const e=Z(),t=_t(),i=yS();Xm(i+1);const r=hT(t,i);if(n.dirty&&function xL(n){return 4==(4&n[rt])}(e)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?Gv(t,e,i,[]):oT(t,e,r,i);n.reset(s,n2),n.notifyOnChanges()}return!0}return!1}function cT(n,e,t,i){const r=_t();if(r.firstCreatePass){const s=Dn();(function dT(n,e,t){null===n.queries&&(n.queries=new Hv),n.queries.track(new zv(e,t))})(r,new sT(e,t,i),s.index),function qB(n,e){const t=n.contentQueries||(n.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(n.queries.length-1,e)}(r,n),2==(2&t)&&(r.staticContentQueries=!0)}!function uT(n,e,t){const i=new Uv(4==(4&t));(function F2(n,e,t,i){const r=Pw(e);r.push(t),n.firstCreatePass&&Nw(n).push(i,r.length-1)})(n,e,i,i.destroy),null===e[_r]&&(e[_r]=new Vv),e[_r].queries.push(new Bv(i))}(r,Z(),t)}function hT(n,e){return n.queries.getByIndex(e)}const Yv=new Ee("Application Initializer");let Zv=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,i)=>{this.resolve=t,this.reject=i}),this.appInits=be(Yv,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const r of this.appInits){const s=r();if(Th(s))t.push(s);else if(pE(s)){const o=new Promise((a,c)=>{s.subscribe({complete:a,error:c})});t.push(o)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),DT=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"platform"})}}return n})();const Jr=new Ee("LocaleId",{providedIn:"root",factory:()=>be(Jr,mt.Optional|mt.SkipSelf)||function mV(){return typeof $localize<"u"&&$localize.locale||Za}()});let kh=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Vi(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();class yV{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let IT=(()=>{class n{compileModuleSync(t){return new Lv(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const i=this.compileModuleSync(t),s=Xr(Si(t).declarations).reduce((o,a)=>{const c=yt(a);return c&&o.push(new zl(c)),o},[]);return new yV(i,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();const LT=new Ee(""),Vh=new Ee("");let ty,Qv=(()=>{class n{constructor(t,i,r){this._ngZone=t,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ty||(function VV(n){ty=n}(r),r.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Gt.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:r})}whenStable(t,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,r){return[]}static{this.\u0275fac=function(i){return new(i||n)(Oe(Gt),Oe(ey),Oe(Vh))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})(),ey=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return ty?.findTestabilityInTree(this,t,i)??null}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"platform"})}}return n})(),ks=null;const OT=new Ee("AllowMultipleToken"),ny=new Ee("PlatformDestroyListeners"),iy=new Ee("appBootstrapListener");class UT{constructor(e,t){this.name=e,this.token=t}}function BT(n,e,t=[]){const i=`Platform: ${e}`,r=new Ee(i);return(s=[])=>{let o=ry();if(!o||o.injector.get(OT,!1)){const a=[...t,...s,{provide:r,useValue:!0}];n?n(a):function GV(n){if(ks&&!ks.get(OT,!1))throw new ce(400,!1);(function FT(){!function aL(n){JM=n}(()=>{throw new ce(600,!1)})})(),ks=n;const e=n.get(HT);(function kT(n){n.get(Gb,null)?.forEach(t=>t())})(n)}(function VT(n=[],e){return Wi.create({name:e,providers:[{provide:Ng,useValue:"platform"},{provide:ny,useValue:new Set([()=>ks=null])},...n]})}(a,i))}return function jV(n){const e=ry();if(!e)throw new ce(401,!1);return e}()}}function ry(){return ks?.get(HT)??null}let HT=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const r=function $V(n="zone.js",e){return"noop"===n?new y2:"zone.js"===n?new Gt(e):n}(i?.ngZone,function zT(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return r.run(()=>{const s=function K3(n,e,t){return new Nv(n,e,t)}(t.moduleType,this.injector,function qT(n){return[{provide:Gt,useFactory:n},{provide:Ol,multi:!0,useFactory:()=>{const e=be(XV,{optional:!0});return()=>e.initialize()}},{provide:$T,useFactory:qV},{provide:ow,useFactory:aw}]}(()=>r)),o=s.injector.get(qr,null);return r.runOutsideAngular(()=>{const a=r.onError.subscribe({next:c=>{o.handleError(c)}});s.onDestroy(()=>{Hh(this._modules,s),a.unsubscribe()})}),function GT(n,e,t){try{const i=t();return Th(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(o,r,()=>{const a=s.injector.get(Zv);return a.runInitializers(),a.donePromise.then(()=>(function dC(n){Hi(n,"Expected localeId to be defined"),"string"==typeof n&&(uC=n.toLowerCase().replace(/_/g,"-"))}(s.injector.get(Jr,Za)||Za),this._moduleDoBootstrap(s),s))})})}bootstrapModule(t,i=[]){const r=WT({},i);return function HV(n,e,t){const i=new Lv(t);return Promise.resolve(i)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(t){const i=t.injector.get(Qa);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!t.instance.ngDoBootstrap)throw new ce(-403,!1);t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ce(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(ny,null);t&&(t.forEach(i=>i()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static{this.\u0275fac=function(i){return new(i||n)(Oe(Wi))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"platform"})}}return n})();function WT(n,e){return Array.isArray(e)?e.reduce(WT,n):{...n,...e}}let Qa=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=be($T),this.zoneIsStable=be(ow),this.componentTypes=[],this.components=[],this.isStable=be(kh).hasPendingTasks.pipe(er(t=>t?je(!1):this.zoneIsStable),function yN(n,e=bs){return n=n??_N,mn((t,i)=>{let r,s=!0;t.subscribe(gn(i,o=>{const a=e(o);(s||!n(r,a))&&(s=!1,r=a,i.next(o))}))})}(),mM()),this._injector=be(Ei)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,i){const r=t instanceof Xb;if(!this._injector.get(Zv).done)throw!r&&function oa(n){const e=yt(n)||Cn(n)||Gn(n);return null!==e&&e.standalone}(t),new ce(405,!1);let o;o=r?t:this._injector.get(dh).resolveComponentFactory(t),this.componentTypes.push(o.componentType);const a=function zV(n){return n.isBoundToModule}(o)?void 0:this._injector.get(xo),l=o.create(Wi.NULL,[],i||o.selector,a),u=l.location.nativeElement,d=l.injector.get(LT,null);return d?.registerApplication(u),l.onDestroy(()=>{this.detachView(l.hostView),Hh(this.components,l),d?.unregisterApplication(u)}),this._loadComponent(l),l}tick(){if(this._runningTick)throw new ce(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;Hh(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const i=this._injector.get(iy,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>Hh(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ce(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Hh(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const $T=new Ee("",{providedIn:"root",factory:()=>be(qr).handleError.bind(void 0)});function qV(){const n=be(Gt),e=be(qr);return t=>n.runOutsideAngular(()=>e.handleError(t))}let XV=(()=>{class n{constructor(){this.zone=be(Gt),this.applicationRef=be(Qa)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();let sy=(()=>{class n{static{this.__NG_ELEMENT_ID__=ZV}}return n})();function ZV(n){return function JV(n,e,t){if(ao(n)&&!t){const i=bi(n.index,e);return new Hl(i,i)}return 47&n.type?new Hl(e[on],e):null}(Dn(),Z(),16==(16&n))}class KT{constructor(){}supports(e){return Sh(e)}create(e){return new nH(e)}}const tH=(n,e)=>e;class nH{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||tH}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,s=null;for(;t||i;){const o=!i||t&&t.currentIndex<eA(i,r,s)?t:i,a=eA(o,r,s),c=o.currentIndex;if(o===i)r--,i=i._nextRemoved;else if(t=t._next,null==o.previousIndex)r++;else{s||(s=[]);const l=a-r,u=c-r;if(l!=u){for(let h=0;h<l;h++){const f=h<s.length?s[h]:s[h]=0,p=f+h;u<=p&&p<l&&(s[h]=f+1)}s[o.previousIndex]=u-l}}a!==c&&e(o,a,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Sh(e))throw new ce(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let r,s,o,t=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),null!==t&&Object.is(t.trackById,o)?(i&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,o,a),i=!0),t=t._next}else r=0,function AU(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Symbol.iterator]();let i;for(;!(i=t.next()).done;)e(i.value)}}(e,a=>{o=this._trackByFn(r,a),null!==t&&Object.is(t.trackById,o)?(i&&(t=this._verifyReinsertion(t,a,o,r)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,o,r),i=!0),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,r)):e=this._addAfter(new iH(t,i),s,r),e}_verifyReinsertion(e,t,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?e=this._reinsertAfter(s,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,s=e._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new QT),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,i=e._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new QT),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class iH{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class rH{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){const t=e._prevDup,i=e._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class QT{constructor(){this.map=new Map}put(e){const t=e.trackById;let i=this.map.get(t);i||(i=new rH,this.map.set(t,i)),i.add(e)}get(e,t){const r=this.map.get(e);return r?r.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function eA(n,e,t){const i=n.previousIndex;if(null===i)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}function nA(){return new Wh([new KT])}let Wh=(()=>{class n{static{this.\u0275prov=Be({token:n,providedIn:"root",factory:nA})}constructor(t){this.factories=t}static create(t,i){if(null!=i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||nA()),deps:[[n,new Vd,new Bd]]}}find(t){const i=this.factories.find(r=>r.supports(t));if(null!=i)return i;throw new ce(901,!1)}}return n})();const lH=BT(null,"core",[]);let uH=(()=>{class n{constructor(t){}static{this.\u0275fac=function(i){return new(i||n)(Oe(Qa))}}static{this.\u0275mod=Ts({type:n})}static{this.\u0275inj=Vr({})}}return n})();function dy(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let hy=null;function ec(){return hy}class wH{}const Ti=new Ee("DocumentToken");let fy=(()=>{class n{historyGo(t){throw new Error("Not implemented")}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:function(){return be(CH)},providedIn:"platform"})}}return n})();const EH=new Ee("Location Initialized");let CH=(()=>{class n extends fy{constructor(){super(),this._doc=be(Ti),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ec().getBaseHref(this._doc)}onPopState(t){const i=ec().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){const i=ec().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,i,r){this._history.pushState(t,i,r)}replaceState(t,i,r){this._history.replaceState(t,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:function(){return new n},providedIn:"platform"})}}return n})();function py(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function hA(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function Kr(n){return n&&"?"!==n[0]?"?"+n:n}let So=(()=>{class n{historyGo(t){throw new Error("Not implemented")}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:function(){return be(pA)},providedIn:"root"})}}return n})();const fA=new Ee("appBaseHref");let pA=(()=>{class n extends So{constructor(t,i){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??be(Ti).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return py(this._baseHref,t)}path(t=!1){const i=this._platformLocation.pathname+Kr(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,s){const o=this.prepareExternalUrl(r+Kr(s));this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){const o=this.prepareExternalUrl(r+Kr(s));this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(i){return new(i||n)(Oe(fy),Oe(fA,8))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),TH=(()=>{class n extends So{constructor(t,i){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(t){const i=py(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,s){let o=this.prepareExternalUrl(r+Kr(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){let o=this.prepareExternalUrl(r+Kr(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(i){return new(i||n)(Oe(fy),Oe(fA,8))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})(),my=(()=>{class n{constructor(t){this._subject=new Xn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const i=this._locationStrategy.getBaseHref();this._basePath=function IH(n){if(new RegExp("^(https?:)?//").test(n)){const[,t]=n.split(/\/\/[^\/]+/);return t}return n}(hA(mA(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+Kr(i))}normalize(t){return n.stripTrailingSlash(function DH(n,e){if(!n||!e.startsWith(n))return e;const t=e.substring(n.length);return""===t||["/",";","?","#"].includes(t[0])?t:e}(this._basePath,mA(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Kr(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Kr(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i,complete:r})}static{this.normalizeQueryParams=Kr}static{this.joinWithSlash=py}static{this.stripTrailingSlash=hA}static{this.\u0275fac=function(i){return new(i||n)(Oe(So))}}static{this.\u0275prov=Be({token:n,factory:function(){return function AH(){return new my(Oe(So))}()},providedIn:"root"})}}return n})();function mA(n){return n.replace(/\/index.html$/,"")}function wA(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,s]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}class gz{constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Cy=(()=>{class n{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const i=this._viewContainer;t.forEachOperation((r,s,o)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new gz(r.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)i.remove(null===s?void 0:s);else if(null!==s){const a=i.get(s);i.move(a,o),TA(a,r)}});for(let r=0,s=i.length;r<s;r++){const a=i.get(r).context;a.index=r,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{TA(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(t,i){return!0}static{this.\u0275fac=function(i){return new(i||n)(Ue(cr),Ue(Zr),Ue(Wh))}}static{this.\u0275dir=zn({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return n})();function TA(n,e){n.context.$implicit=e.item}let Ty=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new vz,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){AA("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){AA("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}static{this.\u0275fac=function(i){return new(i||n)(Ue(cr),Ue(Zr))}}static{this.\u0275dir=zn({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return n})();class vz{constructor(){this.$implicit=null,this.ngIf=null}}function AA(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${vn(e)}'.`)}let zz=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Ts({type:n})}static{this.\u0275inj=Vr({})}}return n})();function PA(n){return"server"===n}let $z=(()=>{class n{static{this.\u0275prov=Be({token:n,providedIn:"root",factory:()=>new qz(Oe(Ti),window)})}}return n})();class qz{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function Xz(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&"function"==typeof n.body.attachShadow){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}r=i.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){this.supportsScrolling()&&(this.window.history.scrollRestoration=e)}scrollToElement(e){const t=e.getBoundingClientRect(),i=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class NA{}class v4 extends wH{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Ly extends v4{static makeCurrent(){!function bH(n){hy||(hy=n)}(new Ly)}onAndCancel(e,t,i){return e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function y4(){return au=au||document.querySelector("base"),au?au.getAttribute("href"):null}();return null==t?null:function _4(n){sf=sf||document.createElement("a"),sf.setAttribute("href",n);const e=sf.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){au=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return wA(document.cookie,e)}}let sf,au=null,M4=(()=>{class n{build(){return new XMLHttpRequest}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();const Oy=new Ee("EventManagerPlugins");let kA=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){let i=this._eventNameToPlugin.get(t);if(i)return i;if(i=this._plugins.find(s=>s.supports(t)),!i)throw new ce(5101,!1);return this._eventNameToPlugin.set(t,i),i}static{this.\u0275fac=function(i){return new(i||n)(Oe(Oy),Oe(Gt))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();class BA{constructor(e){this._doc=e}}const Fy="ng-app-id";let VA=(()=>{class n{constructor(t,i,r,s={}){this.doc=t,this.appId=i,this.nonce=r,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=PA(s),this.resetHostNodes()}addStyles(t){for(const i of t)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(t){for(const i of t)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(i=>i.remove()),t.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const i of this.getAllStyles())this.addStyleToHost(t,i)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const i of this.hostNodes)this.addStyleToHost(i,t)}onStyleRemoved(t){const i=this.styleRef;i.get(t)?.elements?.forEach(r=>r.remove()),i.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${Fy}="${this.appId}"]`);if(t?.length){const i=new Map;return t.forEach(r=>{null!=r.textContent&&i.set(r.textContent,r)}),i}return null}changeUsageCount(t,i){const r=this.styleRef;if(r.has(t)){const s=r.get(t);return s.usage+=i,s.usage}return r.set(t,{usage:i,elements:[]}),i}getStyleElement(t,i){const r=this.styleNodesInDOM,s=r?.get(i);if(s?.parentNode===t)return r.delete(i),s.removeAttribute(Fy),s;{const o=this.doc.createElement("style");return this.nonce&&o.setAttribute("nonce",this.nonce),o.textContent=i,this.platformIsServer&&o.setAttribute(Fy,this.appId),o}}addStyleToHost(t,i){const r=this.getStyleElement(t,i);t.appendChild(r);const s=this.styleRef,o=s.get(i)?.elements;o?o.push(r):s.set(i,{elements:[r],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static{this.\u0275fac=function(i){return new(i||n)(Oe(Ti),Oe(sh),Oe(Wb,8),Oe(go))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();const Uy={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},ky=/%COMP%/g,E4=new Ee("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function zA(n,e){return e.map(t=>t.replace(ky,n))}let GA=(()=>{class n{constructor(t,i,r,s,o,a,c,l=null){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=PA(a),this.defaultRenderer=new By(t,o,c,this.platformIsServer)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===tr.ShadowDom&&(i={...i,encapsulation:tr.Emulated});const r=this.getOrCreateRenderer(t,i);return r instanceof jA?r.applyToHost(t):r instanceof Vy&&r.applyStyles(),r}getOrCreateRenderer(t,i){const r=this.rendererByCompId;let s=r.get(i.id);if(!s){const o=this.doc,a=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case tr.Emulated:s=new jA(c,l,i,this.appId,u,o,a,d);break;case tr.ShadowDom:return new D4(c,l,t,i,o,a,this.nonce,d);default:s=new Vy(c,l,i,u,o,a,d)}r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(i){return new(i||n)(Oe(kA),Oe(VA),Oe(sh),Oe(E4),Oe(Ti),Oe(go),Oe(Gt),Oe(Wb))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();class By{constructor(e,t,i,r){this.eventManager=e,this.doc=t,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(Uy[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(WA(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(WA(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?this.doc.querySelector(e):e;if(!i)throw new ce(-5104,!1);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const s=Uy[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=Uy[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(Ns.DashCase|Ns.Important)?e.style.setProperty(t,i,r&Ns.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&Ns.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){if("string"==typeof e&&!(e=ec().getGlobalEventTarget(this.doc,e)))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(i))}decoratePreventDefault(e){return t=>{if("__ngUnwrap__"===t)return e;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))&&t.preventDefault()}}}function WA(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class D4 extends By{constructor(e,t,i,r,s,o,a,c){super(e,s,o,c),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const l=zA(r.id,r.styles);for(const u of l){const d=document.createElement("style");a&&d.setAttribute("nonce",a),d.textContent=u,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Vy extends By{constructor(e,t,i,r,s,o,a,c){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=r,this.styles=c?zA(c,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class jA extends Vy{constructor(e,t,i,r,s,o,a,c){const l=r+"-"+i.id;super(e,t,i,s,o,a,c,l),this.contentAttr=function C4(n){return"_ngcontent-%COMP%".replace(ky,n)}(l),this.hostAttr=function T4(n){return"_nghost-%COMP%".replace(ky,n)}(l)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}let I4=(()=>{class n extends BA{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}static{this.\u0275fac=function(i){return new(i||n)(Oe(Ti))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();const $A=["alt","control","meta","shift"],R4={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},P4={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let N4=(()=>{class n extends BA{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const s=n.parseEventName(i),o=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ec().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),$A.forEach(l=>{const u=i.indexOf(l);u>-1&&(i.splice(u,1),o+=l+".")}),o+=s,0!=i.length||0===s.length)return null;const c={};return c.domEventName=r,c.fullKey=o,c}static matchEventFullKeyCode(t,i){let r=R4[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),$A.forEach(o=>{o!==r&&(0,P4[o])(t)&&(s+=o+".")}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}static{this.\u0275fac=function(i){return new(i||n)(Oe(Ti))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();const U4=BT(lH,"browser",[{provide:go,useValue:"browser"},{provide:Gb,useValue:function L4(){Ly.makeCurrent()},multi:!0},{provide:Ti,useFactory:function F4(){return function uF(n){bg=n}(document),document},deps:[]}]),k4=new Ee(""),YA=[{provide:Vh,useClass:class x4{addToWindow(e){Ht.getAngularTestability=(i,r=!0)=>{const s=e.findTestabilityInTree(i,r);if(null==s)throw new ce(5103,!1);return s},Ht.getAllAngularTestabilities=()=>e.getAllTestabilities(),Ht.getAllAngularRootElements=()=>e.getAllRootElements(),Ht.frameworkStabilizers||(Ht.frameworkStabilizers=[]),Ht.frameworkStabilizers.push(i=>{const r=Ht.getAllAngularTestabilities();let s=r.length,o=!1;const a=function(c){o=o||c,s--,0==s&&i(o)};r.forEach(c=>{c.whenStable(a)})})}findTestabilityInTree(e,t,i){return null==t?null:e.getTestability(t)??(i?ec().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:LT,useClass:Qv,deps:[Gt,ey,Vh]},{provide:Qv,useClass:Qv,deps:[Gt,ey,Vh]}],ZA=[{provide:Ng,useValue:"root"},{provide:qr,useFactory:function O4(){return new qr},deps:[]},{provide:Oy,useClass:I4,multi:!0,deps:[Ti,Gt,go]},{provide:Oy,useClass:N4,multi:!0,deps:[Ti]},GA,VA,kA,{provide:Zb,useExisting:GA},{provide:NA,useClass:M4,deps:[]},[]];let B4=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:sh,useValue:t.appId}]}}static{this.\u0275fac=function(i){return new(i||n)(Oe(k4,12))}}static{this.\u0275mod=Ts({type:n})}static{this.\u0275inj=Vr({providers:[...ZA,...YA],imports:[zz,uH]})}}return n})(),JA=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static{this.\u0275fac=function(i){return new(i||n)(Oe(Ti))}}static{this.\u0275prov=Be({token:n,factory:function(i){let r=null;return r=i?new i:function H4(){return new JA(Oe(Ti))}(),r},providedIn:"root"})}}return n})();typeof window<"u"&&window;const{isArray:q4}=Array,{getPrototypeOf:X4,prototype:Y4,keys:Z4}=Object;const{isArray:Q4}=Array;function zy(...n){const e=al(n),t=function lN(n){return Ot(pm(n))?n.pop():void 0}(n),{args:i,keys:r}=function J4(n){if(1===n.length){const e=n[0];if(q4(e))return{args:e,keys:null};if(function K4(n){return n&&"object"==typeof n&&X4(n)===Y4}(e)){const t=Z4(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}(n);if(0===i.length)return Sn([],e);const s=new hn(function iG(n,e,t=bs){return i=>{tD(e,()=>{const{length:r}=n,s=new Array(r);let o=r,a=r;for(let c=0;c<r;c++)tD(e,()=>{const l=Sn(n[c],e);let u=!1;l.subscribe(gn(i,d=>{s[c]=d,u||(u=!0,a--),a||i.next(t(s.slice()))},()=>{--o||i.complete()}))},i)},i)}}(i,e,r?o=>function nG(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}(r,o):bs));return t?s.pipe(function tG(n){return Dt(e=>function eG(n,e){return Q4(e)?n(...e):n(e)}(n,e))}(t)):s}function tD(n,e,t){n?Br(t,n,e):e()}const af=rl(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function Gy(...n){return function rG(){return ra(1)}()(Sn(n,al(n)))}function nD(n){return new hn(e=>{Bi(n()).subscribe(e)})}function cu(n,e){const t=Ot(n)?n:()=>n,i=r=>r.error(t());return new hn(e?r=>e.schedule(i,0,r):i)}function Wy(){return mn((n,e)=>{let t=null;n._refCount++;const i=gn(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const r=n._connection,s=t;t=null,r&&(!s||r===s)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}class iD extends hn{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Jx(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new xi;const t=this.getSubject();e.add(this.source.subscribe(gn(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=xi.EMPTY)}return e}refCount(){return Wy()(this)}}function nc(n){return n<=0?()=>vr:mn((e,t)=>{let i=0;e.subscribe(gn(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function ts(n,e){return mn((t,i)=>{let r=0;t.subscribe(gn(i,s=>n.call(e,s,r++)&&i.next(s)))})}function cf(n){return mn((e,t)=>{let i=!1;e.subscribe(gn(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function rD(n=oG){return mn((e,t)=>{let i=!1;e.subscribe(gn(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function oG(){return new af}function bo(n,e){const t=arguments.length>=2;return i=>i.pipe(n?ts((r,s)=>n(r,s,i)):bs,nc(1),t?cf(e):rD(()=>new af))}function ic(n,e){return Ot(e)?En(n,e,1):En(n,1)}function On(n,e,t){const i=Ot(n)||e||t?{next:n,error:e,complete:t}:n;return i?mn((r,s)=>{var o;null===(o=i.subscribe)||void 0===o||o.call(i);let a=!0;r.subscribe(gn(s,c=>{var l;null===(l=i.next)||void 0===l||l.call(i,c),s.next(c)},()=>{var c;a=!1,null===(c=i.complete)||void 0===c||c.call(i),s.complete()},c=>{var l;a=!1,null===(l=i.error)||void 0===l||l.call(i,c),s.error(c)},()=>{var c,l;a&&(null===(c=i.unsubscribe)||void 0===c||c.call(i)),null===(l=i.finalize)||void 0===l||l.call(i)}))}):bs}function wo(n){return mn((e,t)=>{let s,i=null,r=!1;i=e.subscribe(gn(t,void 0,void 0,o=>{s=Bi(n(o,wo(n)(e))),i?(i.unsubscribe(),i=null,s.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(t))})}function jy(n){return n<=0?()=>vr:mn((e,t)=>{let i=[];e.subscribe(gn(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function lu(n){return mn((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}const ct="primary",uu=Symbol("RouteTitle");class hG{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function rc(n){return new hG(n)}function fG(n,e,t){const i=t.path.split("/");if(i.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const o=i[s],a=n[s];if(o.startsWith(":"))r[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function Dr(n,e){const t=n?Object.keys(n):void 0,i=e?Object.keys(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let s=0;s<t.length;s++)if(r=t[s],!sD(n[r],e[r]))return!1;return!0}function sD(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),i=[...e].sort();return t.every((r,s)=>i[s]===r)}return n===e}function oD(n){return n.length>0?n[n.length-1]:null}function Vs(n){return function $4(n){return!!n&&(n instanceof hn||Ot(n.lift)&&Ot(n.subscribe))}(n)?n:Th(n)?Sn(Promise.resolve(n)):je(n)}const mG={exact:function lD(n,e,t){if(!Eo(n.segments,e.segments)||!lf(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const i in e.children)if(!n.children[i]||!lD(n.children[i],e.children[i],t))return!1;return!0},subset:uD},aD={exact:function gG(n,e){return Dr(n,e)},subset:function vG(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>sD(n[t],e[t]))},ignored:()=>!0};function cD(n,e,t){return mG[t.paths](n.root,e.root,t.matrixParams)&&aD[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function uD(n,e,t){return dD(n,e,e.segments,t)}function dD(n,e,t,i){if(n.segments.length>t.length){const r=n.segments.slice(0,t.length);return!(!Eo(r,t)||e.hasChildren()||!lf(r,t,i))}if(n.segments.length===t.length){if(!Eo(n.segments,t)||!lf(n.segments,t,i))return!1;for(const r in e.children)if(!n.children[r]||!uD(n.children[r],e.children[r],i))return!1;return!0}{const r=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!!(Eo(n.segments,r)&&lf(n.segments,r,i)&&n.children[ct])&&dD(n.children[ct],e,s,i)}}function lf(n,e,t){return e.every((i,r)=>aD[t](n[r].parameters,i.parameters))}class sc{constructor(e=new Lt([],{}),t={},i=null){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=rc(this.queryParams)),this._queryParamMap}toString(){return xG.serialize(this)}}class Lt{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return uf(this)}}class du{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=rc(this.parameters)),this._parameterMap}toString(){return pD(this)}}function Eo(n,e){return n.length===e.length&&n.every((t,i)=>t.path===e[i].path)}let hu=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:function(){return new $y},providedIn:"root"})}}return n})();class $y{parse(e){const t=new RG(e);return new sc(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${fu(e.root,!0)}`,i=function bG(n){const e=Object.keys(n).map(t=>{const i=n[t];return Array.isArray(i)?i.map(r=>`${df(t)}=${df(r)}`).join("&"):`${df(t)}=${df(i)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${i}${"string"==typeof e.fragment?`#${function MG(n){return encodeURI(n)}(e.fragment)}`:""}`}}const xG=new $y;function uf(n){return n.segments.map(e=>pD(e)).join("/")}function fu(n,e){if(!n.hasChildren())return uf(n);if(e){const t=n.children[ct]?fu(n.children[ct],!1):"",i=[];return Object.entries(n.children).forEach(([r,s])=>{r!==ct&&i.push(`${r}:${fu(s,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}{const t=function _G(n,e){let t=[];return Object.entries(n.children).forEach(([i,r])=>{i===ct&&(t=t.concat(e(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==ct&&(t=t.concat(e(r,i)))}),t}(n,(i,r)=>r===ct?[fu(n.children[ct],!1)]:[`${r}:${fu(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[ct]?`${uf(n)}/${t[0]}`:`${uf(n)}/(${t.join("//")})`}}function hD(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function df(n){return hD(n).replace(/%3B/gi,";")}function qy(n){return hD(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function hf(n){return decodeURIComponent(n)}function fD(n){return hf(n.replace(/\+/g,"%20"))}function pD(n){return`${qy(n.path)}${function SG(n){return Object.keys(n).map(e=>`;${qy(e)}=${qy(n[e])}`).join("")}(n.parameters)}`}const wG=/^[^\/()?;#]+/;function Xy(n){const e=n.match(wG);return e?e[0]:""}const EG=/^[^\/()?;=#]+/,TG=/^[^=?&#]+/,DG=/^[^&#]+/;class RG{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Lt([],{}):new Lt([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[ct]=new Lt(e,t)),i}parseSegment(){const e=Xy(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new ce(4009,!1);return this.capture(e),new du(hf(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=function CG(n){const e=n.match(EG);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const r=Xy(this.remaining);r&&(i=r,this.capture(i))}e[hf(t)]=hf(i)}parseQueryParam(e){const t=function AG(n){const e=n.match(TG);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const o=function IG(n){const e=n.match(DG);return e?e[0]:""}(this.remaining);o&&(i=o,this.capture(i))}const r=fD(t),s=fD(i);if(e.hasOwnProperty(r)){let o=e[r];Array.isArray(o)||(o=[o],e[r]=o),o.push(s)}else e[r]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=Xy(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new ce(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=ct);const o=this.parseChildren();t[s]=1===Object.keys(o).length?o[ct]:new Lt([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new ce(4011,!1)}}function mD(n){return n.segments.length>0?new Lt([],{[ct]:n}):n}function gD(n){const e={};for(const i of Object.keys(n.children)){const s=gD(n.children[i]);if(i===ct&&0===s.segments.length&&s.hasChildren())for(const[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[i]=s)}return function PG(n){if(1===n.numberOfChildren&&n.children[ct]){const e=n.children[ct];return new Lt(n.segments.concat(e.segments),e.children)}return n}(new Lt(n.segments,e))}function Co(n){return n instanceof sc}function vD(n){let e;const r=mD(function t(s){const o={};for(const c of s.children){const l=t(c);o[c.outlet]=l}const a=new Lt(s.url,o);return s===n&&(e=a),a}(n.root));return e??r}function yD(n,e,t,i){let r=n;for(;r.parent;)r=r.parent;if(0===e.length)return Yy(r,r,r,t,i);const s=function LG(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new xD(!0,0,n);let e=0,t=!1;const i=n.reduce((r,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return Object.entries(s.outlets).forEach(([c,l])=>{a[c]="string"==typeof l?l.split("/"):l}),[...r,{outlets:a}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===o?(s.split("/").forEach((a,c)=>{0==c&&"."===a||(0==c&&""===a?t=!0:".."===a?e++:""!=a&&r.push(a))}),r):[...r,s]},[]);return new xD(t,e,i)}(e);if(s.toRoot())return Yy(r,r,new Lt([],{}),t,i);const o=function OG(n,e,t){if(n.isAbsolute)return new pf(e,!0,0);if(!t)return new pf(e,!1,NaN);if(null===t.parent)return new pf(t,!0,0);const i=ff(n.commands[0])?0:1;return function FG(n,e,t){let i=n,r=e,s=t;for(;s>r;){if(s-=r,i=i.parent,!i)throw new ce(4005,!1);r=i.segments.length}return new pf(i,!1,r-s)}(t,t.segments.length-1+i,n.numberOfDoubleDots)}(s,r,n),a=o.processChildren?mu(o.segmentGroup,o.index,s.commands):MD(o.segmentGroup,o.index,s.commands);return Yy(r,o.segmentGroup,a,t,i)}function ff(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function pu(n){return"object"==typeof n&&null!=n&&n.outlets}function Yy(n,e,t,i,r){let o,s={};i&&Object.entries(i).forEach(([c,l])=>{s[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`}),o=n===e?t:_D(n,e,t);const a=mD(gD(o));return new sc(a,s,r)}function _D(n,e,t){const i={};return Object.entries(n.children).forEach(([r,s])=>{i[r]=s===e?t:_D(s,e,t)}),new Lt(n.segments,i)}class xD{constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&ff(i[0]))throw new ce(4003,!1);const r=i.find(pu);if(r&&r!==oD(i))throw new ce(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class pf{constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}}function MD(n,e,t){if(n||(n=new Lt([],{})),0===n.segments.length&&n.hasChildren())return mu(n,e,t);const i=function kG(n,e,t){let i=0,r=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return s;const o=n.segments[r],a=t[i];if(pu(a))break;const c=`${a}`,l=i<t.length-1?t[i+1]:null;if(r>0&&void 0===c)break;if(c&&l&&"object"==typeof l&&void 0===l.outlets){if(!bD(c,l,o))return s;i+=2}else{if(!bD(c,{},o))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new Lt(n.segments.slice(0,i.pathIndex),{});return s.children[ct]=new Lt(n.segments.slice(i.pathIndex),n.children),mu(s,0,r)}return i.match&&0===r.length?new Lt(n.segments,{}):i.match&&!n.hasChildren()?Zy(n,e,t):i.match?mu(n,0,r):Zy(n,e,t)}function mu(n,e,t){if(0===t.length)return new Lt(n.segments,{});{const i=function UG(n){return pu(n[0])?n[0].outlets:{[ct]:n}}(t),r={};if(Object.keys(i).some(s=>s!==ct)&&n.children[ct]&&1===n.numberOfChildren&&0===n.children[ct].segments.length){const s=mu(n.children[ct],e,t);return new Lt(n.segments,s.children)}return Object.entries(i).forEach(([s,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(r[s]=MD(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{void 0===i[s]&&(r[s]=o)}),new Lt(n.segments,r)}}function Zy(n,e,t){const i=n.segments.slice(0,e);let r=0;for(;r<t.length;){const s=t[r];if(pu(s)){const c=BG(s.outlets);return new Lt(i,c)}if(0===r&&ff(t[0])){i.push(new du(n.segments[e].path,SD(t[0]))),r++;continue}const o=pu(s)?s.outlets[ct]:`${s}`,a=r<t.length-1?t[r+1]:null;o&&a&&ff(a)?(i.push(new du(o,SD(a))),r+=2):(i.push(new du(o,{})),r++)}return new Lt(i,{})}function BG(n){const e={};return Object.entries(n).forEach(([t,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(e[t]=Zy(new Lt([],{}),0,i))}),e}function SD(n){const e={};return Object.entries(n).forEach(([t,i])=>e[t]=`${i}`),e}function bD(n,e,t){return n==t.path&&Dr(e,t.parameters)}const gu="imperative";class Ir{constructor(e,t){this.id=e,this.url=t}}class mf extends Ir{constructor(e,t,i="imperative",r=null){super(e,t),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Hs extends Ir{constructor(e,t,i){super(e,t),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class vu extends Ir{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class oc extends Ir{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=16}}class gf extends Ir{constructor(e,t,i,r){super(e,t),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class wD extends Ir{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class VG extends Ir{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class HG extends Ir{constructor(e,t,i,r,s){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class zG extends Ir{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class GG extends Ir{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class WG{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class jG{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class $G{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qG{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class XG{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class YG{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ED{constructor(e,t,i){this.routerEvent=e,this.position=t,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Jy{}class Ky{constructor(e){this.url=e}}class ZG{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new yu,this.attachRef=null}}let yu=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,i){const r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){const i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new ZG,this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();class CD{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Qy(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){const t=Qy(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=e_(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return e_(e,this._root).map(t=>t.value)}}function Qy(n,e){if(n===e.value)return e;for(const t of e.children){const i=Qy(n,t);if(i)return i}return null}function e_(n,e){if(n===e.value)return[e];for(const t of e.children){const i=e_(n,t);if(i.length)return i.unshift(e),i}return[]}class ns{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function ac(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class TD extends CD{constructor(e,t){super(e),this.snapshot=t,t_(this,e)}toString(){return this.snapshot.toString()}}function AD(n,e){const t=function JG(n,e){const o=new vf([],{},{},"",{},ct,e,null,{});return new ID("",new ns(o,[]))}(0,e),i=new Vi([new du("",{})]),r=new Vi({}),s=new Vi({}),o=new Vi({}),a=new Vi(""),c=new To(i,r,o,a,s,ct,e,t.root);return c.snapshot=t.root,new TD(new ns(c,[]),t)}class To{constructor(e,t,i,r,s,o,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(Dt(l=>l[uu]))??je(void 0),this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Dt(e=>rc(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Dt(e=>rc(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function DD(n,e="emptyOnly"){const t=n.pathFromRoot;let i=0;if("always"!==e)for(i=t.length-1;i>=1;){const r=t[i],s=t[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function KG(n){return n.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(i))}class vf{get title(){return this.data?.[uu]}constructor(e,t,i,r,s,o,a,c,l){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=rc(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=rc(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ID extends CD{constructor(e,t){super(t),this.url=e,t_(this,t)}toString(){return RD(this._root)}}function t_(n,e){e.value._routerState=n,e.children.forEach(t=>t_(n,t))}function RD(n){const e=n.children.length>0?` { ${n.children.map(RD).join(", ")} } `:"";return`${n.value}${e}`}function n_(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Dr(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),Dr(e.params,t.params)||n.paramsSubject.next(t.params),function pG(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Dr(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.urlSubject.next(t.url),Dr(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function i_(n,e){const t=Dr(n.params,e.params)&&function yG(n,e){return Eo(n,e)&&n.every((t,i)=>Dr(t.parameters,e[i].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||i_(n.parent,e.parent))}let r_=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=ct,this.activateEvents=new Xn,this.deactivateEvents=new Xn,this.attachEvents=new Xn,this.detachEvents=new Xn,this.parentContexts=be(yu),this.location=be(cr),this.changeDetector=be(sy),this.environmentInjector=be(Ei),this.inputBinder=be(yf,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:i,previousValue:r}=t.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ce(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ce(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ce(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new ce(4013,!1);this._activatedRoute=t;const r=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,c=new QG(t,a,r.injector);this.activated=r.createComponent(o,{index:r.length,injector:c,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=zn({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[lo]})}}return n})();class QG{constructor(e,t,i){this.route=e,this.childContexts=t,this.parent=i}get(e,t){return e===To?this.route:e===yu?this.childContexts:this.parent.get(e,t)}}const yf=new Ee("");let PD=(()=>{class n{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:i}=t,r=zy([i.queryParams,i.params,i.data]).pipe(er(([s,o,a],c)=>(a={...s,...o,...a},0===c?je(a):Promise.resolve(a)))).subscribe(s=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==i||null===i.component)return void this.unsubscribeFromRouteData(t);const o=function SH(n){const e=yt(n);if(!e)return null;const t=new zl(e);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return e.standalone},get isSignal(){return e.signals}}}(i.component);if(o)for(const{templateName:a}of o.inputs)t.activatedComponentRef.setInput(a,s[a]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,r)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();function _u(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const i=t.value;i._futureSnapshot=e.value;const r=function t5(n,e,t){return e.children.map(i=>{for(const r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return _u(n,i,r);return _u(n,i)})}(n,e,t);return new ns(i,r)}{if(n.shouldAttach(e.value)){const s=n.retrieve(e.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>_u(n,a)),o}}const i=function n5(n){return new To(new Vi(n.url),new Vi(n.params),new Vi(n.queryParams),new Vi(n.fragment),new Vi(n.data),n.outlet,n.component,n)}(e.value),r=e.children.map(s=>_u(n,s));return new ns(i,r)}}const s_="ngNavigationCancelingError";function ND(n,e){const{redirectTo:t,navigationBehaviorOptions:i}=Co(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=LD(!1,0,e);return r.url=t,r.navigationBehaviorOptions=i,r}function LD(n,e,t){const i=new Error("NavigationCancelingError: "+(n||""));return i[s_]=!0,i.cancellationCode=e,t&&(i.url=t),i}function OD(n){return n&&n[s_]}let FD=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=Cs({type:n,selectors:[["ng-component"]],standalone:!0,features:[kC],decls:1,vars:0,template:function(i,r){1&i&&Yn(0,"router-outlet")},dependencies:[r_],encapsulation:2})}}return n})();function o_(n){const e=n.children&&n.children.map(o_),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ct&&(t.component=FD),t}function dr(n){return n.outlet||ct}function xu(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class u5{constructor(e,t,i,r,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=s}activate(e){const t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),n_(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){const r=ac(t);e.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,r[o],i),delete r[o]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(r===s)if(r.component){const o=i.getContext(r.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,i);else s&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=ac(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],r);if(i&&i.outlet){const o=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=ac(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(e,t,i){const r=ac(t);e.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new YG(s.value.snapshot))}),e.children.length&&this.forwardEvent(new qG(e.value.snapshot))}activateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(n_(r),r===s)if(r.component){const o=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,i);else if(r.component){const o=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),n_(a.route.value),this.activateChildRoutes(e,null,o.children)}else{const a=xu(r.snapshot);o.attachRef=null,o.route=r,o.injector=a,o.outlet&&o.outlet.activateWith(r,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,i)}}class UD{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class _f{constructor(e,t){this.component=e,this.route=t}}function d5(n,e,t){const i=n._root;return Mu(i,e?e._root:null,t,[i.value])}function cc(n,e){const t=Symbol(),i=e.get(n,t);return i===t?"function"!=typeof n||function CN(n){return null!==md(n)}(n)?e.get(n):n:i}function Mu(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=ac(e);return n.children.forEach(o=>{(function f5(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const c=function p5(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!Eo(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Eo(n.url,e.url)||!Dr(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!i_(n,e)||!Dr(n.queryParams,e.queryParams);default:return!i_(n,e)}}(o,s,s.routeConfig.runGuardsAndResolvers);c?r.canActivateChecks.push(new UD(i)):(s.data=o.data,s._resolvedData=o._resolvedData),Mu(n,e,s.component?a?a.children:null:t,i,r),c&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new _f(a.outlet.component,o))}else o&&Su(e,a,r),r.canActivateChecks.push(new UD(i)),Mu(n,null,s.component?a?a.children:null:t,i,r)})(o,s[o.value.outlet],t,i.concat([o.value]),r),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Su(a,t.getContext(o),r)),r}function Su(n,e,t){const i=ac(n),r=n.value;Object.entries(i).forEach(([s,o])=>{Su(o,r.component?e?e.children.getContext(s):null:e,t)}),t.canDeactivateChecks.push(new _f(r.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,r))}function bu(n){return"function"==typeof n}function kD(n){return n instanceof af||"EmptyError"===n?.name}const xf=Symbol("INITIAL_VALUE");function lc(){return er(n=>zy(n.map(e=>e.pipe(nc(1),function sG(...n){const e=al(n);return mn((t,i)=>{(e?Gy(n,t,e):Gy(n,t)).subscribe(i)})}(xf)))).pipe(Dt(e=>{for(const t of e)if(!0!==t){if(t===xf)return xf;if(!1===t||t instanceof sc)return t}return!0}),ts(e=>e!==xf),nc(1)))}function BD(n){return function SP(...n){return Xx(n)}(On(e=>{if(Co(e))throw ND(0,e)}),Dt(e=>!0===e))}class Mf{constructor(e){this.segmentGroup=e||null}}class VD{constructor(e){this.urlTree=e}}function uc(n){return cu(new Mf(n))}function HD(n){return cu(new VD(n))}class L5{constructor(e,t){this.urlSerializer=e,this.urlTree=t}noMatchError(e){return new ce(4002,!1)}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return je(i);if(r.numberOfChildren>1||!r.children[ct])return cu(new ce(4e3,!1));r=r.children[ct]}}applyRedirectCommands(e,t,i){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,i)}applyRedirectCreateUrlTree(e,t,i,r){const s=this.createSegmentGroup(e,t.root,i,r);return new sc(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const i={};return Object.entries(e).forEach(([r,s])=>{if("string"==typeof s&&s.startsWith(":")){const a=s.substring(1);i[r]=t[a]}else i[r]=s}),i}createSegmentGroup(e,t,i,r){const s=this.createSegments(e,t.segments,i,r);let o={};return Object.entries(t.children).forEach(([a,c])=>{o[a]=this.createSegmentGroup(e,c,i,r)}),new Lt(s,o)}createSegments(e,t,i,r){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,r):this.findOrReturn(s,i))}findPosParam(e,t,i){const r=i[t.path.substring(1)];if(!r)throw new ce(4001,!1);return r}findOrReturn(e,t){let i=0;for(const r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}}const a_={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function O5(n,e,t,i,r){const s=c_(n,e,t);return s.matched?(i=function r5(n,e){return n.providers&&!n._injector&&(n._injector=Ov(n.providers,e,`Route: ${n.path}`)),n._injector??e}(e,i),function R5(n,e,t,i){const r=e.canMatch;return r&&0!==r.length?je(r.map(o=>{const a=cc(o,n);return Vs(function x5(n){return n&&bu(n.canMatch)}(a)?a.canMatch(e,t):n.runInContext(()=>a(e,t)))})).pipe(lc(),BD()):je(!0)}(i,e,t).pipe(Dt(o=>!0===o?s:{...a_}))):je(s)}function c_(n,e,t){if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...a_}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const r=(e.matcher||fG)(t,n,e);if(!r)return{...a_};const s={};Object.entries(r.posParams??{}).forEach(([a,c])=>{s[a]=c.path});const o=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:o,positionalParamSegments:r.posParams??{}}}function zD(n,e,t,i){return t.length>0&&function k5(n,e,t){return t.some(i=>Sf(n,e,i)&&dr(i)!==ct)}(n,t,i)?{segmentGroup:new Lt(e,U5(i,new Lt(t,n.children))),slicedSegments:[]}:0===t.length&&function B5(n,e,t){return t.some(i=>Sf(n,e,i))}(n,t,i)?{segmentGroup:new Lt(n.segments,F5(n,0,t,i,n.children)),slicedSegments:t}:{segmentGroup:new Lt(n.segments,n.children),slicedSegments:t}}function F5(n,e,t,i,r){const s={};for(const o of i)if(Sf(n,t,o)&&!r[dr(o)]){const a=new Lt([],{});s[dr(o)]=a}return{...r,...s}}function U5(n,e){const t={};t[ct]=e;for(const i of n)if(""===i.path&&dr(i)!==ct){const r=new Lt([],{});t[dr(i)]=r}return t}function Sf(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}class G5{constructor(e,t,i,r,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=i,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.allowRedirects=!0,this.applyRedirects=new L5(this.urlSerializer,this.urlTree)}noMatchError(e){return new ce(4002,!1)}recognize(){const e=zD(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,ct).pipe(wo(t=>{if(t instanceof VD)return this.allowRedirects=!1,this.urlTree=t.urlTree,this.match(t.urlTree);throw t instanceof Mf?this.noMatchError(t):t}),Dt(t=>{const i=new vf([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ct,this.rootComponentType,null,{}),r=new ns(i,t),s=new ID("",r),o=function NG(n,e,t=null,i=null){return yD(vD(n),e,t,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e.root,ct).pipe(wo(i=>{throw i instanceof Mf?this.noMatchError(i):i}))}inheritParamsAndData(e){const t=e.value,i=DD(t,this.paramsInheritanceStrategy);t.params=Object.freeze(i.params),t.data=Object.freeze(i.data),e.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(e,t,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(e,t,i):this.processSegment(e,t,i,i.segments,r,!0)}processChildren(e,t,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return Sn(r).pipe(ic(s=>{const o=i.children[s],a=function c5(n,e){const t=n.filter(i=>dr(i)===e);return t.push(...n.filter(i=>dr(i)!==e)),t}(t,s);return this.processSegmentGroup(e,a,o,s)}),function cG(n,e){return mn(function aG(n,e,t,i,r){return(s,o)=>{let a=t,c=e,l=0;s.subscribe(gn(o,u=>{const d=l++;c=a?n(c,u,d):(a=!0,u),i&&o.next(c)},r&&(()=>{a&&o.next(c),o.complete()})))}}(n,e,arguments.length>=2,!0))}((s,o)=>(s.push(...o),s)),cf(null),function lG(n,e){const t=arguments.length>=2;return i=>i.pipe(n?ts((r,s)=>n(r,s,i)):bs,jy(1),t?cf(e):rD(()=>new af))}(),En(s=>{if(null===s)return uc(i);const o=GD(s);return function W5(n){n.sort((e,t)=>e.value.outlet===ct?-1:t.value.outlet===ct?1:e.value.outlet.localeCompare(t.value.outlet))}(o),je(o)}))}processSegment(e,t,i,r,s,o){return Sn(t).pipe(ic(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,i,r,s,o).pipe(wo(c=>{if(c instanceof Mf)return je(null);throw c}))),bo(a=>!!a),wo(a=>{if(kD(a))return function H5(n,e,t){return 0===e.length&&!n.children[t]}(i,r,s)?je([]):uc(i);throw a}))}processSegmentAgainstRoute(e,t,i,r,s,o,a){return function V5(n,e,t,i){return!!(dr(n)===i||i!==ct&&Sf(e,t,n))&&("**"===n.path||c_(e,n,t).matched)}(i,r,s,o)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,r,i,s,o,a):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,r,t,i,s,o):uc(r):uc(r)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,i,r,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,i,r){const s=this.applyRedirects.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?HD(s):this.applyRedirects.lineralizeSegments(i,s).pipe(En(o=>{const a=new Lt(o,{});return this.processSegment(e,t,a,o,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o){const{matched:a,consumedSegments:c,remainingSegments:l,positionalParamSegments:u}=c_(t,r,s);if(!a)return uc(t);const d=this.applyRedirects.applyRedirectCommands(c,r.redirectTo,u);return r.redirectTo.startsWith("/")?HD(d):this.applyRedirects.lineralizeSegments(r,d).pipe(En(h=>this.processSegment(e,i,t,h.concat(l),o,!1)))}matchSegmentAgainstRoute(e,t,i,r,s,o){let a;if("**"===i.path){const c=r.length>0?oD(r).parameters:{};a=je({snapshot:new vf(r,c,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,WD(i),dr(i),i.component??i._loadedComponent??null,i,jD(i)),consumedSegments:[],remainingSegments:[]}),t.children={}}else a=O5(t,i,r,e).pipe(Dt(({matched:c,consumedSegments:l,remainingSegments:u,parameters:d})=>c?{snapshot:new vf(l,d,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,WD(i),dr(i),i.component??i._loadedComponent??null,i,jD(i)),consumedSegments:l,remainingSegments:u}:null));return a.pipe(er(c=>null===c?uc(t):this.getChildConfig(e=i._injector??e,i,r).pipe(er(({routes:l})=>{const u=i._loadedInjector??e,{snapshot:d,consumedSegments:h,remainingSegments:f}=c,{segmentGroup:p,slicedSegments:v}=zD(t,h,f,l);if(0===v.length&&p.hasChildren())return this.processChildren(u,l,p).pipe(Dt(m=>null===m?null:[new ns(d,m)]));if(0===l.length&&0===v.length)return je([new ns(d,[])]);const g=dr(i)===s;return this.processSegment(u,l,p,v,g?ct:s,!0).pipe(Dt(m=>[new ns(d,m)]))}))))}getChildConfig(e,t,i){return t.children?je({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?je({routes:t._loadedRoutes,injector:t._loadedInjector}):function I5(n,e,t,i){const r=e.canLoad;return void 0===r||0===r.length?je(!0):je(r.map(o=>{const a=cc(o,n);return Vs(function g5(n){return n&&bu(n.canLoad)}(a)?a.canLoad(e,t):n.runInContext(()=>a(e,t)))})).pipe(lc(),BD())}(e,t,i).pipe(En(r=>r?this.configLoader.loadChildren(e,t).pipe(On(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):function N5(n){return cu(LD(!1,3))}())):je({routes:[],injector:e})}}function j5(n){const e=n.value.routeConfig;return e&&""===e.path}function GD(n){const e=[],t=new Set;for(const i of n){if(!j5(i)){e.push(i);continue}const r=e.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),t.add(r)):e.push(i)}for(const i of t){const r=GD(i.children);e.push(new ns(i.value,r))}return e.filter(i=>!t.has(i))}function WD(n){return n.data||{}}function jD(n){return n.resolve||{}}function $D(n){return"string"==typeof n.title||null===n.title}function l_(n){return er(e=>{const t=n(e);return t?Sn(t).pipe(Dt(()=>e)):je(e)})}const dc=new Ee("ROUTES");let u_=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=be(IT)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return je(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const i=Vs(t.loadComponent()).pipe(Dt(qD),On(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),lu(()=>{this.componentLoaders.delete(t)})),r=new iD(i,()=>new Qi).pipe(Wy());return this.componentLoaders.set(t,r),r}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return je({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=function K5(n,e,t,i){return Vs(n.loadChildren()).pipe(Dt(qD),En(r=>r instanceof FC||Array.isArray(r)?je(r):Sn(e.compileModuleAsync(r))),Dt(r=>{i&&i(n);let s,o,a=!1;return Array.isArray(r)?(o=r,!0):(s=r.create(t).injector,o=s.get(dc,[],{optional:!0,self:!0}).flat()),{routes:o.map(o_),injector:s}}))}(i,this.compiler,t,this.onLoadEndListener).pipe(lu(()=>{this.childrenLoaders.delete(i)})),o=new iD(s,()=>new Qi).pipe(Wy());return this.childrenLoaders.set(i,o),o}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function qD(n){return function Q5(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let bf=(()=>{class n{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Qi,this.transitionAbortSubject=new Qi,this.configLoader=be(u_),this.environmentInjector=be(Ei),this.urlSerializer=be(hu),this.rootContexts=be(yu),this.inputBindingEnabled=null!==be(yf,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>je(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=r=>this.events.next(new jG(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new WG(r))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:i})}setupNavigations(t,i,r){return this.transitions=new Vi({id:0,currentUrlTree:i,currentRawUrl:i,currentBrowserUrl:i,extractedUrl:t.urlHandlingStrategy.extract(i),urlAfterRedirects:t.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:gu,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(ts(s=>0!==s.id),Dt(s=>({...s,extractedUrl:t.urlHandlingStrategy.extract(s.rawUrl)})),er(s=>{this.currentTransition=s;let o=!1,a=!1;return je(s).pipe(On(c=>{this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),er(c=>{const l=c.currentBrowserUrl.toString(),u=!t.navigated||c.extractedUrl.toString()!==l||l!==c.currentUrlTree.toString();if(!u&&"reload"!==(c.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const h="";return this.events.next(new oc(c.id,this.urlSerializer.serialize(c.rawUrl),h,0)),c.resolve(null),vr}if(t.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return je(c).pipe(er(h=>{const f=this.transitions?.getValue();return this.events.next(new mf(h.id,this.urlSerializer.serialize(h.extractedUrl),h.source,h.restoredState)),f!==this.transitions?.getValue()?vr:Promise.resolve(h)}),function $5(n,e,t,i,r,s){return En(o=>function z5(n,e,t,i,r,s,o="emptyOnly"){return new G5(n,e,t,i,r,o,s).recognize()}(n,e,t,i,o.extractedUrl,r,s).pipe(Dt(({state:a,tree:c})=>({...o,targetSnapshot:a,urlAfterRedirects:c}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),On(h=>{s.targetSnapshot=h.targetSnapshot,s.urlAfterRedirects=h.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:h.urlAfterRedirects};const f=new wD(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(f)}));if(u&&t.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){const{id:h,extractedUrl:f,source:p,restoredState:v,extras:g}=c,m=new mf(h,this.urlSerializer.serialize(f),p,v);this.events.next(m);const y=AD(0,this.rootComponentType).snapshot;return this.currentTransition=s={...c,targetSnapshot:y,urlAfterRedirects:f,extras:{...g,skipLocationChange:!1,replaceUrl:!1}},je(s)}{const h="";return this.events.next(new oc(c.id,this.urlSerializer.serialize(c.extractedUrl),h,1)),c.resolve(null),vr}}),On(c=>{const l=new VG(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),Dt(c=>(this.currentTransition=s={...c,guards:d5(c.targetSnapshot,c.currentSnapshot,this.rootContexts)},s)),function S5(n,e){return En(t=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return 0===o.length&&0===s.length?je({...t,guardsResult:!0}):function b5(n,e,t,i){return Sn(n).pipe(En(r=>function D5(n,e,t,i,r){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?je(s.map(a=>{const c=xu(e)??r,l=cc(a,c);return Vs(function _5(n){return n&&bu(n.canDeactivate)}(l)?l.canDeactivate(n,e,t,i):c.runInContext(()=>l(n,e,t,i))).pipe(bo())})).pipe(lc()):je(!0)}(r.component,r.route,t,e,i)),bo(r=>!0!==r,!0))}(o,i,r,n).pipe(En(a=>a&&function m5(n){return"boolean"==typeof n}(a)?function w5(n,e,t,i){return Sn(e).pipe(ic(r=>Gy(function C5(n,e){return null!==n&&e&&e(new $G(n)),je(!0)}(r.route.parent,i),function E5(n,e){return null!==n&&e&&e(new XG(n)),je(!0)}(r.route,i),function A5(n,e,t){const i=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>function h5(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(o)).filter(o=>null!==o).map(o=>nD(()=>je(o.guards.map(c=>{const l=xu(o.node)??t,u=cc(c,l);return Vs(function y5(n){return n&&bu(n.canActivateChild)}(u)?u.canActivateChild(i,n):l.runInContext(()=>u(i,n))).pipe(bo())})).pipe(lc())));return je(s).pipe(lc())}(n,r.path,t),function T5(n,e,t){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return je(!0);const r=i.map(s=>nD(()=>{const o=xu(e)??t,a=cc(s,o);return Vs(function v5(n){return n&&bu(n.canActivate)}(a)?a.canActivate(e,n):o.runInContext(()=>a(e,n))).pipe(bo())}));return je(r).pipe(lc())}(n,r.route,t))),bo(r=>!0!==r,!0))}(i,s,n,e):je(a)),Dt(a=>({...t,guardsResult:a})))})}(this.environmentInjector,c=>this.events.next(c)),On(c=>{if(s.guardsResult=c.guardsResult,Co(c.guardsResult))throw ND(0,c.guardsResult);const l=new HG(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),ts(c=>!!c.guardsResult||(this.cancelNavigationTransition(c,"",3),!1)),l_(c=>{if(c.guards.canActivateChecks.length)return je(c).pipe(On(l=>{const u=new zG(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(u)}),er(l=>{let u=!1;return je(l).pipe(function q5(n,e){return En(t=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return je(t);let s=0;return Sn(r).pipe(ic(o=>function X5(n,e,t,i){const r=n.routeConfig,s=n._resolve;return void 0!==r?.title&&!$D(r)&&(s[uu]=r.title),function Y5(n,e,t,i){const r=function Z5(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return je({});const s={};return Sn(r).pipe(En(o=>function J5(n,e,t,i){const r=xu(e)??i,s=cc(n,r);return Vs(s.resolve?s.resolve(e,t):r.runInContext(()=>s(e,t)))}(n[o],e,t,i).pipe(bo(),On(a=>{s[o]=a}))),jy(1),function uG(n){return Dt(()=>n)}(s),wo(o=>kD(o)?vr:cu(o)))}(s,n,e,i).pipe(Dt(o=>(n._resolvedData=o,n.data=DD(n,t).resolve,r&&$D(r)&&(n.data[uu]=r.title),null)))}(o.route,i,n,e)),On(()=>s++),jy(1),En(o=>s===r.length?je(t):vr))})}(t.paramsInheritanceStrategy,this.environmentInjector),On({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(l,"",2)}}))}),On(l=>{const u=new GG(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(u)}))}),l_(c=>{const l=u=>{const d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(On(h=>{u.component=h}),Dt(()=>{})));for(const h of u.children)d.push(...l(h));return d};return zy(l(c.targetSnapshot.root)).pipe(cf(),nc(1))}),l_(()=>this.afterPreactivation()),Dt(c=>{const l=function e5(n,e,t){const i=_u(n,e._root,t?t._root:void 0);return new TD(i,e)}(t.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=s={...c,targetRouterState:l},s}),On(()=>{this.events.next(new Jy)}),((n,e,t,i)=>Dt(r=>(new u5(e,r.targetRouterState,r.currentRouterState,t,i).activate(n),r)))(this.rootContexts,t.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),nc(1),On({next:c=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Hs(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),t.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{o=!0}}),function dG(n){return mn((e,t)=>{Bi(n).subscribe(gn(t,()=>t.complete(),im)),!t.closed&&e.subscribe(t)})}(this.transitionAbortSubject.pipe(On(c=>{throw c}))),lu(()=>{o||a||this.cancelNavigationTransition(s,"",1),this.currentNavigation?.id===s.id&&(this.currentNavigation=null)}),wo(c=>{if(a=!0,OD(c))this.events.next(new vu(s.id,this.urlSerializer.serialize(s.extractedUrl),c.message,c.cancellationCode)),function i5(n){return OD(n)&&Co(n.url)}(c)?this.events.next(new Ky(c.url)):s.resolve(!1);else{this.events.next(new gf(s.id,this.urlSerializer.serialize(s.extractedUrl),c,s.targetSnapshot??void 0));try{s.resolve(t.errorHandler(c))}catch(l){s.reject(l)}}return vr}))}))}cancelNavigationTransition(t,i,r){const s=new vu(t.id,this.urlSerializer.serialize(t.extractedUrl),i,r);this.events.next(s),t.resolve(!1)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function XD(n){return n!==gu}let YD=(()=>{class n{buildTitle(t){let i,r=t.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===ct);return i}getResolvedTitleForRoute(t){return t.data[uu]}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:function(){return be(eW)},providedIn:"root"})}}return n})(),eW=(()=>{class n extends YD{constructor(t){super(),this.title=t}updateTitle(t){const i=this.buildTitle(t);void 0!==i&&this.title.setTitle(i)}static{this.\u0275fac=function(i){return new(i||n)(Oe(JA))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),tW=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:function(){return be(iW)},providedIn:"root"})}}return n})();class nW{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let iW=(()=>{class n extends nW{static{this.\u0275fac=function(){let t;return function(r){return(t||(t=function US(n){return Hr(()=>{const e=n.prototype.constructor,t=e[zr]||ig(e),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[zr]||ig(r);if(s&&s!==t)return s;r=Object.getPrototypeOf(r)}return s=>new s})}(n)))(r||n)}}()}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();const wf=new Ee("",{providedIn:"root",factory:()=>({})});let rW=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:function(){return be(sW)},providedIn:"root"})}}return n})(),sW=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var wu=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(wu||{});function ZD(n,e){n.events.pipe(ts(t=>t instanceof Hs||t instanceof vu||t instanceof gf||t instanceof oc),Dt(t=>t instanceof Hs||t instanceof oc?wu.COMPLETE:t instanceof vu&&(0===t.code||1===t.code)?wu.REDIRECTING:wu.FAILED),ts(t=>t!==wu.REDIRECTING),nc(1)).subscribe(()=>{e()})}function oW(n){throw n}function aW(n,e,t){return e.parse("/")}const cW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},lW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let hi=(()=>{class n{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=be(DT),this.isNgZoneEnabled=!1,this._events=new Qi,this.options=be(wf,{optional:!0})||{},this.pendingTasks=be(kh),this.errorHandler=this.options.errorHandler||oW,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||aW,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=be(rW),this.routeReuseStrategy=be(tW),this.titleStrategy=be(YD),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=be(dc,{optional:!0})?.flat()??[],this.navigationTransitions=be(bf),this.urlSerializer=be(hu),this.location=be(my),this.componentInputBindingEnabled=!!be(yf,{optional:!0}),this.eventsSubscription=new xi,this.isNgZoneEnabled=be(Gt)instanceof Gt&&Gt.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new sc,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=AD(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(i=>{try{const{currentTransition:r}=this.navigationTransitions;if(null===r)return void(JD(i)&&this._events.next(i));if(i instanceof mf)XD(r.source)&&(this.browserUrlTree=r.extractedUrl);else if(i instanceof oc)this.rawUrlTree=r.rawUrl;else if(i instanceof wD){if("eager"===this.urlUpdateStrategy){if(!r.extras.skipLocationChange){const s=this.urlHandlingStrategy.merge(r.urlAfterRedirects,r.rawUrl);this.setBrowserUrl(s,r)}this.browserUrlTree=r.urlAfterRedirects}}else if(i instanceof Jy)this.currentUrlTree=r.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(r.urlAfterRedirects,r.rawUrl),this.routerState=r.targetRouterState,"deferred"===this.urlUpdateStrategy&&(r.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,r),this.browserUrlTree=r.urlAfterRedirects);else if(i instanceof vu)0!==i.code&&1!==i.code&&(this.navigated=!0),(3===i.code||2===i.code)&&this.restoreHistory(r);else if(i instanceof Ky){const s=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),o={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||XD(r.source)};this.scheduleNavigation(s,gu,null,o,{resolve:r.resolve,reject:r.reject,promise:r.promise})}i instanceof gf&&this.restoreHistory(r,!0),i instanceof Hs&&(this.navigated=!0),JD(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),gu,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const i="popstate"===t.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,i,t.state)},0)}))}navigateToSyncWithBrowser(t,i,r){const s={replaceUrl:!0},o=r?.navigationId?r:null;if(r){const c={...r};delete c.navigationId,delete c.\u0275routerPageId,0!==Object.keys(c).length&&(s.state=c)}const a=this.parseUrl(t);this.scheduleNavigation(a,i,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(o_),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,i={}){const{relativeTo:r,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:o;let d,u=null;switch(a){case"merge":u={...this.currentUrlTree.queryParams,...s};break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=s||null}null!==u&&(u=this.removeEmptyProps(u));try{d=vD(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),d=this.currentUrlTree.root}return yD(d,t,u,l??null)}navigateByUrl(t,i={skipLocationChange:!1}){const r=Co(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,gu,null,i)}navigate(t,i={skipLocationChange:!1}){return function uW(n){for(let e=0;e<n.length;e++)if(null==n[e])throw new ce(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let i;try{i=this.urlSerializer.parse(t)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,t)}return i}isActive(t,i){let r;if(r=!0===i?{...cW}:!1===i?{...lW}:i,Co(t))return cD(this.currentUrlTree,t,r);const s=this.parseUrl(t);return cD(this.currentUrlTree,s,r)}removeEmptyProps(t){return Object.keys(t).reduce((i,r)=>{const s=t[r];return null!=s&&(i[r]=s),i},{})}scheduleNavigation(t,i,r,s,o){if(this.disposed)return Promise.resolve(!1);let a,c,l;o?(a=o.resolve,c=o.reject,l=o.promise):l=new Promise((d,h)=>{a=d,c=h});const u=this.pendingTasks.add();return ZD(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:t,extras:s,resolve:a,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}setBrowserUrl(t,i){const r=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl){const o={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(r,"",o)}else{const s={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId+1)};this.location.go(r,"",s)}}restoreHistory(t,i=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-this.browserPageId;0!==s?this.location.historyGo(s):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===s&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function JD(n){return!(n instanceof Jy||n instanceof Ky)}let Ef=(()=>{class n{constructor(t,i,r,s,o,a){this.router=t,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=o,this.locationStrategy=a,this.href=null,this.commands=null,this.onChanges=new Qi,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const c=o.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===c||"area"===c,this.isAnchorElement?this.subscription=t.events.subscribe(l=>{l instanceof Hs&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null!=t?(this.commands=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(t,i,r,s,o){return!!(null===this.urlTree||this.isAnchorElement&&(0!==t||i||r||s||o||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const t=null===this.href?null:function Ob(n,e,t){return function PF(n,e){return"src"===e&&("embed"===n||"frame"===n||"iframe"===n||"media"===n||"script"===n)||"href"===e&&("base"===n||"link"===n)?Lb:po}(e,t)(n)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",t)}applyAttributeValue(t,i){const r=this.renderer,s=this.el.nativeElement;null!==i?r.setAttribute(s,t,i):r.removeAttribute(s,t)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static{this.\u0275fac=function(i){return new(i||n)(Ue(hi),Ue(To),function Fd(n){return function KL(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const i=t.length;let r=0;for(;r<i;){const s=t[r];if(TM(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof t[r];)r++;else{if(s===e)return t[r+1];r+=2}}}return null}(Dn(),n)}("tabindex"),Ue(hh),Ue(Os),Ue(So))}}static{this.\u0275dir=zn({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,r){1&i&&qa("click",function(o){return r.onClick(o.button,o.ctrlKey,o.shiftKey,o.altKey,o.metaKey)}),2&i&&hv("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",dy],skipLocationChange:["skipLocationChange","skipLocationChange",dy],replaceUrl:["replaceUrl","replaceUrl",dy],routerLink:"routerLink"},standalone:!0,features:[Yw,lo]})}}return n})(),KD=(()=>{class n{get isActive(){return this._isActive}constructor(t,i,r,s,o){this.router=t,this.element=i,this.renderer=r,this.cdr=s,this.link=o,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Xn,this.routerEventsSubscription=t.events.subscribe(a=>{a instanceof Hs&&this.update()})}ngAfterContentInit(){je(this.links.changes,je(null)).pipe(ra()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const t=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=Sn(t).pipe(ra()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(t){const i=Array.isArray(t)?t:t.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const t=this.hasActiveLinks();this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.classes.forEach(i=>{t?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),t&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(t))})}isLinkActive(t){const i=function dW(n){return!!n.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>!!r.urlTree&&t.isActive(r.urlTree,i)}hasActiveLinks(){const t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static{this.\u0275fac=function(i){return new(i||n)(Ue(hi),Ue(Os),Ue(hh),Ue(sy),Ue(Ef,8))}}static{this.\u0275dir=zn({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(i,r,s){if(1&i&&cT(s,Ef,5),2&i){let o;aT(o=function lT(){return function $B(n,e){return n[_r].queries[e].queryList}(Z(),yS())}())&&(r.links=o)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[lo]})}}return n})();class QD{}let hW=(()=>{class n{constructor(t,i,r,s,o){this.router=t,this.injector=r,this.preloadingStrategy=s,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(ts(t=>t instanceof Hs),ic(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,i){const r=[];for(const s of i){s.providers&&!s._injector&&(s._injector=Ov(s.providers,t,`Route: ${s.path}`));const o=s._injector??t,a=s._loadedInjector??o;(s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent)&&r.push(this.preloadConfig(o,s)),(s.children||s._loadedRoutes)&&r.push(this.processRoutes(a,s.children??s._loadedRoutes))}return Sn(r).pipe(ra())}preloadConfig(t,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(t,i):je(null);const s=r.pipe(En(o=>null===o?je(void 0):(i._loadedRoutes=o.routes,i._loadedInjector=o.injector,this.processRoutes(o.injector??t,o.routes))));return i.loadComponent&&!i._loadedComponent?Sn([s,this.loader.loadComponent(i)]).pipe(ra()):s})}static{this.\u0275fac=function(i){return new(i||n)(Oe(hi),Oe(IT),Oe(Ei),Oe(QD),Oe(u_))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();const d_=new Ee("");let eI=(()=>{class n{constructor(t,i,r,s,o={}){this.urlSerializer=t,this.transitions=i,this.viewportScroller=r,this.zone=s,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof mf?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Hs?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof oc&&0===t.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof ED&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new ED(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(i){!function Mw(){throw new Error("invalid")}()}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();function is(n,e){return{\u0275kind:n,\u0275providers:e}}function nI(){const n=be(Wi);return e=>{const t=n.get(Qa);if(e!==t.components[0])return;const i=n.get(hi),r=n.get(iI);1===n.get(h_)&&i.initialNavigation(),n.get(rI,null,mt.Optional)?.setUpPreloading(),n.get(d_,null,mt.Optional)?.init(),i.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const iI=new Ee("",{factory:()=>new Qi}),h_=new Ee("",{providedIn:"root",factory:()=>1}),rI=new Ee("");function gW(n){return is(0,[{provide:rI,useExisting:hW},{provide:QD,useExisting:n}])}const sI=new Ee("ROUTER_FORROOT_GUARD"),yW=[my,{provide:hu,useClass:$y},hi,yu,{provide:To,useFactory:function tI(n){return n.routerState.root},deps:[hi]},u_,[]];function _W(){return new UT("Router",hi)}let oI=(()=>{class n{constructor(t){}static forRoot(t,i){return{ngModule:n,providers:[yW,[],{provide:dc,multi:!0,useValue:t},{provide:sI,useFactory:bW,deps:[[hi,new Bd,new Vd]]},{provide:wf,useValue:i||{}},i?.useHash?{provide:So,useClass:TH}:{provide:So,useClass:pA},{provide:d_,useFactory:()=>{const n=be($z),e=be(Gt),t=be(wf),i=be(bf),r=be(hu);return t.scrollOffset&&n.setOffset(t.scrollOffset),new eI(r,i,n,e,t)}},i?.preloadingStrategy?gW(i.preloadingStrategy).\u0275providers:[],{provide:UT,multi:!0,useFactory:_W},i?.initialNavigation?wW(i):[],i?.bindToComponentInputs?is(8,[PD,{provide:yf,useExisting:PD}]).\u0275providers:[],[{provide:aI,useFactory:nI},{provide:iy,multi:!0,useExisting:aI}]]}}static forChild(t){return{ngModule:n,providers:[{provide:dc,multi:!0,useValue:t}]}}static{this.\u0275fac=function(i){return new(i||n)(Oe(sI,8))}}static{this.\u0275mod=Ts({type:n})}static{this.\u0275inj=Vr({})}}return n})();function bW(n){return"guarded"}function wW(n){return["disabled"===n.initialNavigation?is(3,[{provide:Yv,multi:!0,useFactory:()=>{const e=be(hi);return()=>{e.setUpLocationChangeListener()}}},{provide:h_,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?is(2,[{provide:h_,useValue:0},{provide:Yv,multi:!0,deps:[Wi],useFactory:e=>{const t=e.get(EH,Promise.resolve());return()=>t.then(()=>new Promise(i=>{const r=e.get(hi),s=e.get(iI);ZD(r,()=>{i(!0)}),e.get(bf).afterPreactivation=()=>(i(!0),s.closed?je(void 0):s),r.initialNavigation()}))}}]).\u0275providers:[]]}const aI=new Ee("");function cI(n,e,t,i,r,s,o){try{var a=n[s](o),c=a.value}catch(l){return void t(l)}a.done?e(c):Promise.resolve(c).then(i,r)}function hc(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var s=n.apply(e,t);function o(c){cI(s,i,r,o,a,"next",c)}function a(c){cI(s,i,r,o,a,"throw",c)}o(void 0)})}}const uI=1,AW=2,rs=3,Cf=0,qW=1,XW=2,Gs=0,YW=1,ZW=2,JW=3,KW=4,QW=5,ej=6,tj=7,Ws=301,Do=302,Eu=306,hr=1001,Fn=1003,bn=1006,as=1008,Rr=1009,mI=1010,gI=1011,Tu=1012,E_=1013,js=1014,Di=1015,cs=1016,C_=1017,T_=1018,Au=1020,vI=35902,yI=1021,_I=1022,pi=1023,Du=1026,Iu=1027,A_=1028,Pf=1029,xI=1030,D_=1031,I_=1033,Nf=33776,Lf=33777,Of=33778,Ff=33779,R_=35840,P_=35841,N_=35842,L_=35843,O_=36196,F_=37492,U_=37496,k_=37808,B_=37809,V_=37810,H_=37811,z_=37812,G_=37813,W_=37814,j_=37815,$_=37816,q_=37817,X_=37818,Y_=37819,Z_=37820,J_=37821,Uf=36492,K_=36494,Q_=36495,MI=36283,e0=36284,t0=36285,n0=36286,Ii="srgb",vc="srgb-linear",Vf="linear",Ft="srgb",yc=7680,EI="300 es",Xi=2e3;class ls{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return void 0!==i&&void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){const i=this._listeners;if(void 0===i)return;const r=i[e];if(void 0!==r){const s=r.indexOf(t);-1!==s&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const i=t[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Un=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Ro=Math.PI/180,_c=180/Math.PI;function Ri(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Un[255&n]+Un[n>>8&255]+Un[n>>16&255]+Un[n>>24&255]+"-"+Un[255&e]+Un[e>>8&255]+"-"+Un[e>>16&15|64]+Un[e>>24&255]+"-"+Un[63&t|128]+Un[t>>8&255]+"-"+Un[t>>16&255]+Un[t>>24&255]+Un[255&i]+Un[i>>8&255]+Un[i>>16&255]+Un[i>>24&255]).toLowerCase()}function Ge(n,e,t){return Math.max(e,Math.min(t,n))}function Pu(n,e,t){return(1-t)*n+t*e}function Qn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function lt(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(4294967295*n);case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int32Array:return Math.round(2147483647*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}class q{constructor(e=0,t=0){q.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Ge(this.x,e.x,t.x),this.y=Ge(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Ge(this.x,e,t),this.y=Ge(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ge(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ge(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Pi{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let c=i[r+0],l=i[r+1],u=i[r+2],d=i[r+3];const h=s[o+0],f=s[o+1],p=s[o+2],v=s[o+3];if(0===a)return e[t+0]=c,e[t+1]=l,e[t+2]=u,void(e[t+3]=d);if(1===a)return e[t+0]=h,e[t+1]=f,e[t+2]=p,void(e[t+3]=v);if(d!==v||c!==h||l!==f||u!==p){let g=1-a;const m=c*h+l*f+u*p+d*v,y=m>=0?1:-1,_=1-m*m;if(_>Number.EPSILON){const w=Math.sqrt(_),C=Math.atan2(w,m*y);g=Math.sin(g*C)/w,a=Math.sin(a*C)/w}const x=a*y;if(c=c*g+h*x,l=l*g+f*x,u=u*g+p*x,d=d*g+v*x,g===1-a){const w=1/Math.sqrt(c*c+l*l+u*u+d*d);c*=w,l*=w,u*=w,d*=w}}e[t]=c,e[t+1]=l,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],c=i[r+1],l=i[r+2],u=i[r+3],d=s[o],h=s[o+1],f=s[o+2],p=s[o+3];return e[t]=a*p+u*d+c*f-l*h,e[t+1]=c*p+u*h+l*d-a*f,e[t+2]=l*p+u*f+a*h-c*d,e[t+3]=u*p-a*d-c*h-l*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(i/2),u=a(r/2),d=a(s/2),h=c(i/2),f=c(r/2),p=c(s/2);switch(o){case"XYZ":this._x=h*u*d+l*f*p,this._y=l*f*d-h*u*p,this._z=l*u*p+h*f*d,this._w=l*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+l*f*p,this._y=l*f*d-h*u*p,this._z=l*u*p-h*f*d,this._w=l*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-l*f*p,this._y=l*f*d+h*u*p,this._z=l*u*p+h*f*d,this._w=l*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-l*f*p,this._y=l*f*d+h*u*p,this._z=l*u*p-h*f*d,this._w=l*u*d+h*f*p;break;case"YZX":this._x=h*u*d+l*f*p,this._y=l*f*d+h*u*p,this._z=l*u*p-h*f*d,this._w=l*u*d-h*f*p;break;case"XZY":this._x=h*u*d-l*f*p,this._y=l*f*d-h*u*p,this._z=l*u*p+h*f*d,this._w=l*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],c=t[9],l=t[2],u=t[6],d=t[10],h=i+a+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-c)*f,this._y=(s-l)*f,this._z=(o-r)*f}else if(i>a&&i>d){const f=2*Math.sqrt(1+i-a-d);this._w=(u-c)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+l)/f}else if(a>d){const f=2*Math.sqrt(1+a-i-d);this._w=(s-l)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(c+u)/f}else{const f=2*Math.sqrt(1+d-i-a);this._w=(o-r)/f,this._x=(s+l)/f,this._y=(c+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ge(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,c=t._y,l=t._z,u=t._w;return this._x=i*u+o*a+r*l-s*c,this._y=r*u+o*c+s*a-i*l,this._z=s*u+o*l+i*c-r*a,this._w=o*u-i*a-r*c-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),d=Math.sin((1-t)*u)/l,h=Math.sin(t*u)/l;return this._w=o*d+this._w*h,this._x=i*d+this._x*h,this._y=r*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class T{constructor(e=0,t=0,i=0){T.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(TI.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(TI.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*r-a*i),u=2*(a*t-s*r),d=2*(s*i-o*t);return this.x=t+c*l+o*d-a*u,this.y=i+c*u+a*l-s*d,this.z=r+c*d+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Ge(this.x,e.x,t.x),this.y=Ge(this.y,e.y,t.y),this.z=Ge(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Ge(this.x,e,t),this.y=Ge(this.y,e,t),this.z=Ge(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ge(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=r*c-s*a,this.y=s*o-i*c,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return c0.copy(this).projectOnVector(e),this.sub(c0)}reflect(e){return this.sub(c0.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ge(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const c0=new T,TI=new Pi;class ut{constructor(e,t,i,r,s,o,a,c,l){ut.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,c,l)}set(e,t,i,r,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=c,u[6]=i,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],c=i[6],l=i[1],u=i[4],d=i[7],h=i[2],f=i[5],p=i[8],v=r[0],g=r[3],m=r[6],y=r[1],_=r[4],x=r[7],w=r[2],C=r[5],D=r[8];return s[0]=o*v+a*y+c*w,s[3]=o*g+a*_+c*C,s[6]=o*m+a*x+c*D,s[1]=l*v+u*y+d*w,s[4]=l*g+u*_+d*C,s[7]=l*m+u*x+d*D,s[2]=h*v+f*y+p*w,s[5]=h*g+f*_+p*C,s[8]=h*m+f*x+p*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-i*s*u+i*a*c+r*s*l-r*o*c}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=u*o-a*l,h=a*c-u*s,f=l*s-o*c,p=t*d+i*h+r*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const v=1/p;return e[0]=d*v,e[1]=(r*l-u*i)*v,e[2]=(a*i-r*o)*v,e[3]=h*v,e[4]=(u*t-r*c)*v,e[5]=(r*s-a*t)*v,e[6]=f*v,e[7]=(i*c-l*t)*v,e[8]=(o*t-i*s)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(i*c,i*l,-i*(c*o+l*a)+o+e,-r*l,r*c,-r*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(l0.makeScale(e,t)),this}rotate(e){return this.premultiply(l0.makeRotation(-e)),this}translate(e,t){return this.premultiply(l0.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const l0=new ut;function AI(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Nu(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Nj(){const n=Nu("canvas");return n.style.display="block",n}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const DI={};function Mc(n){n in DI||(DI[n]=!0,console.warn(n))}const II=(new ut).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),RI=(new ut).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Oj(){const n={enabled:!0,workingColorSpace:vc,spaces:{},convert:function(r,s,o){return!1===this.enabled||s===o||!s||!o||(this.spaces[s].transfer===Ft&&(r.r=us(r.r),r.g=us(r.g),r.b=us(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Ft&&(r.r=Sc(r.r),r.g=Sc(r.g),r.b=Sc(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return""===r?Vf:this.spaces[r].transfer},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return Mc("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return Mc("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[vc]:{primaries:e,whitePoint:i,transfer:Vf,toXYZ:II,fromXYZ:RI,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Ii},outputColorSpaceConfig:{drawingBufferColorSpace:Ii}},[Ii]:{primaries:e,whitePoint:i,transfer:Ft,toXYZ:II,fromXYZ:RI,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Ii}}}),n}const xt=Oj();function us(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function Sc(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}let bc;class Fj{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{void 0===bc&&(bc=Nu("canvas")),bc.width=e.width,bc.height=e.height;const r=bc.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=bc}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Nu("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=255*us(s[o]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*us(t[i]/255)):us(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Uj=0;class Po{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Uj++}),this.uuid=Ri(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)s.push(u0(r[o].isDataTexture?r[o].image:r[o]))}else s=u0(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function u0(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Fj.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let kj=0;const d0=new T;let mi=(()=>{class n extends ls{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=hr,s=hr,o=bn,a=as,c=pi,l=Rr,u=n.DEFAULT_ANISOTROPY,d=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kj++}),this.uuid=Ri(),this.name="",this.source=new Po(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=c,this.internalFormat=null,this.type=l,this.offset=new q(0,0),this.repeat=new q(1,1),this.center=new q(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ut,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(d0).x}get height(){return this.source.getSize(d0).y}get depth(){return this.source.getSize(d0).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const i in t){const r=t[i];if(void 0===r){console.warn(`THREE.Texture.setValues(): parameter '${i}' has value of undefined.`);continue}const s=this[i];void 0!==s?s&&r&&s.isVector2&&r.isVector2||s&&r&&s.isVector3&&r.isVector3||s&&r&&s.isMatrix3&&r.isMatrix3?s.copy(r):this[i]=r:console.warn(`THREE.Texture.setValues(): property '${i}' does not exist.`)}}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case hr:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case hr:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class St{constructor(e=0,t=0,i=0,r=1){St.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const c=e.elements,l=c[0],u=c[4],d=c[8],h=c[1],f=c[5],p=c[9],v=c[2],g=c[6],m=c[10];if(Math.abs(u-h)<.01&&Math.abs(d-v)<.01&&Math.abs(p-g)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+v)<.1&&Math.abs(p+g)<.1&&Math.abs(l+f+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(l+1)/2,x=(f+1)/2,w=(m+1)/2,C=(u+h)/4,D=(d+v)/4,I=(p+g)/4;return _>x&&_>w?_<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(_),r=C/i,s=D/i):x>w?x<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),i=C/r,s=I/r):w<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(w),i=D/s,r=I/s),this.set(i,r,s,t),this}let y=Math.sqrt((g-p)*(g-p)+(d-v)*(d-v)+(h-u)*(h-u));return Math.abs(y)<.001&&(y=1),this.x=(g-p)/y,this.y=(d-v)/y,this.z=(h-u)/y,this.w=Math.acos((l+f+m-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Ge(this.x,e.x,t.x),this.y=Ge(this.y,e.y,t.y),this.z=Ge(this.z,e.z,t.z),this.w=Ge(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Ge(this.x,e,t),this.y=Ge(this.y,e,t),this.z=Ge(this.z,e,t),this.w=Ge(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ge(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class PI extends ls{constructor(e=1,t=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:bn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=i.depth,this.scissor=new St(0,0,e,t),this.scissorTest=!1,this.viewport=new St(0,0,e,t);const s=new mi({width:e,height:t,depth:i.depth});this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(e={}){const t={minFilter:bn,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let i=0;i<this.textures.length;i++)this.textures[i].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new Po(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ni extends PI{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class h0 extends mi{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Fn,this.minFilter=Fn,this.wrapR=hr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class f0 extends mi{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Fn,this.minFilter=Fn,this.wrapR=hr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ei{constructor(e=new T(1/0,1/0,1/0),t=new T(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(fr.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(fr.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=fr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i){const s=i.getAttribute("position");if(!0===t&&void 0!==s&&!0!==e.isInstancedMesh)for(let o=0,a=s.count;o<a;o++)!0===e.isMesh?e.getVertexPosition(o,fr):fr.fromBufferAttribute(s,o),fr.applyMatrix4(e.matrixWorld),this.expandByPoint(fr);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),zf.copy(e.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),zf.copy(i.boundingBox)),zf.applyMatrix4(e.matrixWorld),this.union(zf)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,fr),fr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Lu),Gf.subVectors(this.max,Lu),wc.subVectors(e.a,Lu),Ec.subVectors(e.b,Lu),Cc.subVectors(e.c,Lu),qs.subVectors(Ec,wc),Xs.subVectors(Cc,Ec),No.subVectors(wc,Cc);let t=[0,-qs.z,qs.y,0,-Xs.z,Xs.y,0,-No.z,No.y,qs.z,0,-qs.x,Xs.z,0,-Xs.x,No.z,0,-No.x,-qs.y,qs.x,0,-Xs.y,Xs.x,0,-No.y,No.x,0];return!(!p0(t,wc,Ec,Cc,Gf)||(t=[1,0,0,0,1,0,0,0,1],!p0(t,wc,Ec,Cc,Gf)))&&(Wf.crossVectors(qs,Xs),t=[Wf.x,Wf.y,Wf.z],p0(t,wc,Ec,Cc,Gf))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,fr).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(fr).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ds[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ds[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ds[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ds[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ds[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ds[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ds[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ds[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ds)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const ds=[new T,new T,new T,new T,new T,new T,new T,new T],fr=new T,zf=new ei,wc=new T,Ec=new T,Cc=new T,qs=new T,Xs=new T,No=new T,Lu=new T,Gf=new T,Wf=new T,Lo=new T;function p0(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){Lo.fromArray(n,s);const a=r.x*Math.abs(Lo.x)+r.y*Math.abs(Lo.y)+r.z*Math.abs(Lo.z),c=e.dot(Lo),l=t.dot(Lo),u=i.dot(Lo);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const Bj=new ei,Ou=new T,m0=new T;class kn{constructor(e=new T,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):Bj.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ou.subVectors(e,this.center);const t=Ou.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.addScaledVector(Ou,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(m0.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ou.copy(e.center).add(m0)),this.expandByPoint(Ou.copy(e.center).sub(m0))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const hs=new T,g0=new T,jf=new T,Ys=new T,v0=new T,$f=new T,y0=new T;class Fu{constructor(e=new T,t=new T(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,hs)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=hs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(hs.copy(this.origin).addScaledVector(this.direction,t),hs.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){g0.copy(e).add(t).multiplyScalar(.5),jf.copy(t).sub(e).normalize(),Ys.copy(this.origin).sub(g0);const s=.5*e.distanceTo(t),o=-this.direction.dot(jf),a=Ys.dot(this.direction),c=-Ys.dot(jf),l=Ys.lengthSq(),u=Math.abs(1-o*o);let d,h,f,p;if(u>0)if(d=o*c-a,h=o*a-c,p=s*u,d>=0)if(h>=-p)if(h<=p){const v=1/u;d*=v,h*=v,f=d*(d+o*h+2*a)+h*(o*d+h+2*c)+l}else h=s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;else h=-s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;else h<=-p?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-c),s),f=-d*d+h*(h+2*c)+l):h<=p?(d=0,h=Math.min(Math.max(-s,-c),s),f=h*(h+2*c)+l):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-c),s),f=-d*d+h*(h+2*c)+l);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,d),r&&r.copy(g0).addScaledVector(jf,h),f}intersectSphere(e,t){hs.subVectors(e.center,this.origin);const i=hs.dot(this.direction),r=hs.dot(hs)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,c=i+o;return c<0?null:this.at(a<0?c:a,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),d>=0?(a=(e.min.z-h.z)*d,c=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,c=(e.min.z-h.z)*d),i>c||a>r)||((a>i||i!=i)&&(i=a),(c<r||r!=r)&&(r=c),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,hs)}intersectTriangle(e,t,i,r,s){v0.subVectors(t,e),$f.subVectors(i,e),y0.crossVectors(v0,$f);let a,o=this.direction.dot(y0);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Ys.subVectors(this.origin,e);const c=a*this.direction.dot($f.crossVectors(Ys,$f));if(c<0)return null;const l=a*this.direction.dot(v0.cross(Ys));if(l<0||c+l>o)return null;const u=-a*Ys.dot(y0);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ze{constructor(e,t,i,r,s,o,a,c,l,u,d,h,f,p,v,g){Ze.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,c,l,u,d,h,f,p,v,g)}set(e,t,i,r,s,o,a,c,l,u,d,h,f,p,v,g){const m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=r,m[1]=s,m[5]=o,m[9]=a,m[13]=c,m[2]=l,m[6]=u,m[10]=d,m[14]=h,m[3]=f,m[7]=p,m[11]=v,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ze).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Tc.setFromMatrixColumn(e,0).length(),s=1/Tc.setFromMatrixColumn(e,1).length(),o=1/Tc.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),c=Math.cos(r),l=Math.sin(r),u=Math.cos(s),d=Math.sin(s);if("XYZ"===e.order){const h=o*u,f=o*d,p=a*u,v=a*d;t[0]=c*u,t[4]=-c*d,t[8]=l,t[1]=f+p*l,t[5]=h-v*l,t[9]=-a*c,t[2]=v-h*l,t[6]=p+f*l,t[10]=o*c}else if("YXZ"===e.order){const h=c*u,f=c*d,p=l*u,v=l*d;t[0]=h+v*a,t[4]=p*a-f,t[8]=o*l,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=f*a-p,t[6]=v+h*a,t[10]=o*c}else if("ZXY"===e.order){const h=c*u,f=c*d,p=l*u,v=l*d;t[0]=h-v*a,t[4]=-o*d,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*u,t[9]=v-h*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if("ZYX"===e.order){const h=o*u,f=o*d,p=a*u,v=a*d;t[0]=c*u,t[4]=p*l-f,t[8]=h*l+v,t[1]=c*d,t[5]=v*l+h,t[9]=f*l-p,t[2]=-l,t[6]=a*c,t[10]=o*c}else if("YZX"===e.order){const h=o*c,f=o*l,p=a*c,v=a*l;t[0]=c*u,t[4]=v-h*d,t[8]=p*d+f,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=f*d+p,t[10]=h-v*d}else if("XZY"===e.order){const h=o*c,f=o*l,p=a*c,v=a*l;t[0]=c*u,t[4]=-d,t[8]=l*u,t[1]=h*d+v,t[5]=o*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=a*u,t[10]=v*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Vj,e,Hj)}lookAt(e,t,i){const r=this.elements;return Li.subVectors(e,t),0===Li.lengthSq()&&(Li.z=1),Li.normalize(),Zs.crossVectors(i,Li),0===Zs.lengthSq()&&(1===Math.abs(i.z)?Li.x+=1e-4:Li.z+=1e-4,Li.normalize(),Zs.crossVectors(i,Li)),Zs.normalize(),qf.crossVectors(Li,Zs),r[0]=Zs.x,r[4]=qf.x,r[8]=Li.x,r[1]=Zs.y,r[5]=qf.y,r[9]=Li.y,r[2]=Zs.z,r[6]=qf.z,r[10]=Li.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],c=i[8],l=i[12],u=i[1],d=i[5],h=i[9],f=i[13],p=i[2],v=i[6],g=i[10],m=i[14],y=i[3],_=i[7],x=i[11],w=i[15],C=r[0],D=r[4],I=r[8],b=r[12],S=r[1],R=r[5],B=r[9],V=r[13],H=r[2],Y=r[6],W=r[10],ie=r[14],G=r[3],pe=r[7],Me=r[11],Ae=r[15];return s[0]=o*C+a*S+c*H+l*G,s[4]=o*D+a*R+c*Y+l*pe,s[8]=o*I+a*B+c*W+l*Me,s[12]=o*b+a*V+c*ie+l*Ae,s[1]=u*C+d*S+h*H+f*G,s[5]=u*D+d*R+h*Y+f*pe,s[9]=u*I+d*B+h*W+f*Me,s[13]=u*b+d*V+h*ie+f*Ae,s[2]=p*C+v*S+g*H+m*G,s[6]=p*D+v*R+g*Y+m*pe,s[10]=p*I+v*B+g*W+m*Me,s[14]=p*b+v*V+g*ie+m*Ae,s[3]=y*C+_*S+x*H+w*G,s[7]=y*D+_*R+x*Y+w*pe,s[11]=y*I+_*B+x*W+w*Me,s[15]=y*b+_*V+x*ie+w*Ae,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],d=e[6],h=e[10],f=e[14];return e[3]*(+s*c*d-r*l*d-s*a*h+i*l*h+r*a*f-i*c*f)+e[7]*(+t*c*f-t*l*h+s*o*h-r*o*f+r*l*u-s*c*u)+e[11]*(+t*l*d-t*a*f-s*o*d+i*o*f+s*a*u-i*l*u)+e[15]*(-r*a*u-t*c*d+t*a*h+r*o*d-i*o*h+i*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],v=e[13],g=e[14],m=e[15],y=d*g*l-v*h*l+v*c*f-a*g*f-d*c*m+a*h*m,_=p*h*l-u*g*l-p*c*f+o*g*f+u*c*m-o*h*m,x=u*v*l-p*d*l+p*a*f-o*v*f-u*a*m+o*d*m,w=p*d*c-u*v*c-p*a*h+o*v*h+u*a*g-o*d*g,C=t*y+i*_+r*x+s*w;if(0===C)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const D=1/C;return e[0]=y*D,e[1]=(v*h*s-d*g*s-v*r*f+i*g*f+d*r*m-i*h*m)*D,e[2]=(a*g*s-v*c*s+v*r*l-i*g*l-a*r*m+i*c*m)*D,e[3]=(d*c*s-a*h*s-d*r*l+i*h*l+a*r*f-i*c*f)*D,e[4]=_*D,e[5]=(u*g*s-p*h*s+p*r*f-t*g*f-u*r*m+t*h*m)*D,e[6]=(p*c*s-o*g*s-p*r*l+t*g*l+o*r*m-t*c*m)*D,e[7]=(o*h*s-u*c*s+u*r*l-t*h*l-o*r*f+t*c*f)*D,e[8]=x*D,e[9]=(p*d*s-u*v*s-p*i*f+t*v*f+u*i*m-t*d*m)*D,e[10]=(o*v*s-p*a*s+p*i*l-t*v*l-o*i*m+t*a*m)*D,e[11]=(u*a*s-o*d*s-u*i*l+t*d*l+o*i*f-t*a*f)*D,e[12]=w*D,e[13]=(u*v*r-p*d*r+p*i*h-t*v*h-u*i*g+t*d*g)*D,e[14]=(p*a*r-o*v*r-p*i*c+t*v*c+o*i*g-t*a*g)*D,e[15]=(o*d*r-u*a*r+u*i*c-t*d*c-o*i*h+t*a*h)*D,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+i,l*a-r*c,l*c+r*a,0,l*a+r*c,u*a+i,u*c-r*o,0,l*c-r*a,u*c+r*o,s*c*c+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,l=s+s,u=o+o,d=a+a,h=s*l,f=s*u,p=s*d,v=o*u,g=o*d,m=a*d,y=c*l,_=c*u,x=c*d,w=i.x,C=i.y,D=i.z;return r[0]=(1-(v+m))*w,r[1]=(f+x)*w,r[2]=(p-_)*w,r[3]=0,r[4]=(f-x)*C,r[5]=(1-(h+m))*C,r[6]=(g+y)*C,r[7]=0,r[8]=(p+_)*D,r[9]=(g-y)*D,r[10]=(1-(h+v))*D,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Tc.set(r[0],r[1],r[2]).length();const o=Tc.set(r[4],r[5],r[6]).length(),a=Tc.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],pr.copy(this);const l=1/s,u=1/o,d=1/a;return pr.elements[0]*=l,pr.elements[1]*=l,pr.elements[2]*=l,pr.elements[4]*=u,pr.elements[5]*=u,pr.elements[6]*=u,pr.elements[8]*=d,pr.elements[9]*=d,pr.elements[10]*=d,t.setFromRotationMatrix(pr),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=Xi,c=!1){const l=this.elements,u=2*s/(t-e),d=2*s/(i-r),h=(t+e)/(t-e),f=(i+r)/(i-r);let p,v;if(c)p=s/(o-s),v=o*s/(o-s);else if(a===Xi)p=-(o+s)/(o-s),v=-2*o*s/(o-s);else{if(2001!==a)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);p=-o/(o-s),v=-o*s/(o-s)}return l[0]=u,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=d,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=v,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=Xi,c=!1){const l=this.elements,u=2/(t-e),d=2/(i-r),h=-(t+e)/(t-e),f=-(i+r)/(i-r);let p,v;if(c)p=1/(o-s),v=o/(o-s);else if(a===Xi)p=-2/(o-s),v=-(o+s)/(o-s);else{if(2001!==a)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=-1/(o-s),v=-s/(o-s)}return l[0]=u,l[4]=0,l[8]=0,l[12]=h,l[1]=0,l[5]=d,l[9]=0,l[13]=f,l[2]=0,l[6]=0,l[10]=p,l[14]=v,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Tc=new T,pr=new Ze,Vj=new T(0,0,0),Hj=new T(1,1,1),Zs=new T,qf=new T,Li=new T,NI=new Ze,LI=new Pi;let fs=(()=>{class n{constructor(t=0,i=0,r=0,s=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,s=this._order){return this._x=t,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const s=t.elements,o=s[0],a=s[4],c=s[8],l=s[1],u=s[5],d=s[9],h=s[2],f=s[6],p=s[10];switch(i){case"XYZ":this._y=Math.asin(Ge(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Ge(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(c,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(Ge(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-Ge(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Ge(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(c,p));break;case"XZY":this._z=Math.asin(-Ge(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-d,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return NI.makeRotationFromQuaternion(t),this.setFromRotationMatrix(NI,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return LI.setFromEuler(this),this.setFromQuaternion(LI,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class _0{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let zj=0;const OI=new T,Ac=new Pi,ps=new Ze,Xf=new T,Uu=new T,Gj=new T,Wj=new Pi,FI=new T(1,0,0),UI=new T(0,1,0),kI=new T(0,0,1),BI={type:"added"},jj={type:"removed"},Dc={type:"childadded",child:null},x0={type:"childremoved",child:null};let qt=(()=>{class n extends ls{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:zj++}),this.uuid=Ri(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new T,i=new fs,r=new Pi,s=new T(1,1,1);i._onChange(function o(){r.setFromEuler(i,!1)}),r._onChange(function a(){i.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Ze},normalMatrix:{value:new ut}}),this.matrix=new Ze,this.matrixWorld=new Ze,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new _0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Ac.setFromAxisAngle(t,i),this.quaternion.multiply(Ac),this}rotateOnWorldAxis(t,i){return Ac.setFromAxisAngle(t,i),this.quaternion.premultiply(Ac),this}rotateX(t){return this.rotateOnAxis(FI,t)}rotateY(t){return this.rotateOnAxis(UI,t)}rotateZ(t){return this.rotateOnAxis(kI,t)}translateOnAxis(t,i){return OI.copy(t).applyQuaternion(this.quaternion),this.position.add(OI.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(FI,t)}translateY(t){return this.translateOnAxis(UI,t)}translateZ(t){return this.translateOnAxis(kI,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(ps.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?Xf.copy(t):Xf.set(t,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),Uu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ps.lookAt(Uu,Xf,this.up):ps.lookAt(Xf,Uu,this.up),this.quaternion.setFromRotationMatrix(ps),s&&(ps.extractRotation(s.matrixWorld),Ac.setFromRotationMatrix(ps),this.quaternion.premultiply(Ac.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(BI),Dc.child=t,this.dispatchEvent(Dc),Dc.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(jj),x0.child=t,this.dispatchEvent(x0),x0.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),ps.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ps.multiply(t.parent.matrixWorld)),t.applyMatrix4(ps),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(BI),Dc.child=t,this.dispatchEvent(Dc),Dc.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(t,i);if(void 0!==a)return a}}getObjectsByProperty(t,i,r=[]){this[t]===i&&r.push(this);const s=this.children;for(let o=0,a=s.length;o<a;o++)s[o].getObjectsByProperty(t,i,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uu,t,Gj),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uu,Wj,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].updateMatrixWorld(t)}updateWorldMatrix(t,i){const r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===i){const s=this.children;for(let o=0,a=s.length;o<a;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(t){const i=void 0===t||"string"==typeof t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};function o(c,l){return void 0===c[l.uuid]&&(c[l.uuid]=l.toJSON(t)),l.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(c=>({...c,boundingBox:c.boundingBox?c.boundingBox.toJSON():void 0,boundingSphere:c.boundingSphere?c.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(c=>({...c})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(t),s.indirectTexture=this._indirectTexture.toJSON(t),null!==this._colorsTexture&&(s.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(s.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(s.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(t.geometries,this.geometry);const c=this.geometry.parameters;if(void 0!==c&&void 0!==c.shapes){const l=c.shapes;if(Array.isArray(l))for(let u=0,d=l.length;u<d;u++)o(t.shapes,l[u]);else o(t.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const c=[];for(let l=0,u=this.material.length;l<u;l++)c.push(o(t.materials,this.material[l]));s.material=c}else s.material=o(t.materials,this.material);if(this.children.length>0){s.children=[];for(let c=0;c<this.children.length;c++)s.children.push(this.children[c].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let c=0;c<this.animations.length;c++)s.animations.push(o(t.animations,this.animations[c]))}if(i){const c=a(t.geometries),l=a(t.materials),u=a(t.textures),d=a(t.images),h=a(t.shapes),f=a(t.skeletons),p=a(t.animations),v=a(t.nodes);c.length>0&&(r.geometries=c),l.length>0&&(r.materials=l),u.length>0&&(r.textures=u),d.length>0&&(r.images=d),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),p.length>0&&(r.animations=p),v.length>0&&(r.nodes=v)}return r.object=s,r;function a(c){const l=[];for(const u in c){const d=c[u];delete d.metadata,l.push(d)}return l}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}return n.DEFAULT_UP=new T(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const mr=new T,ms=new T,M0=new T,gs=new T,Ic=new T,Rc=new T,VI=new T,S0=new T,b0=new T,w0=new T,E0=new St,C0=new St,T0=new St;class Oi{constructor(e=new T,t=new T,i=new T){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),mr.subVectors(e,t),r.cross(mr);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){mr.subVectors(r,t),ms.subVectors(i,t),M0.subVectors(e,t);const o=mr.dot(mr),a=mr.dot(ms),c=mr.dot(M0),l=ms.dot(ms),u=ms.dot(M0),d=o*l-a*a;if(0===d)return s.set(0,0,0),null;const h=1/d,f=(l*c-a*u)*h,p=(o*u-a*c)*h;return s.set(1-f-p,p,f)}static containsPoint(e,t,i,r){return null!==this.getBarycoord(e,t,i,r,gs)&&gs.x>=0&&gs.y>=0&&gs.x+gs.y<=1}static getInterpolation(e,t,i,r,s,o,a,c){return null===this.getBarycoord(e,t,i,r,gs)?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,gs.x),c.addScaledVector(o,gs.y),c.addScaledVector(a,gs.z),c)}static getInterpolatedAttribute(e,t,i,r,s,o){return E0.setScalar(0),C0.setScalar(0),T0.setScalar(0),E0.fromBufferAttribute(e,t),C0.fromBufferAttribute(e,i),T0.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(E0,s.x),o.addScaledVector(C0,s.y),o.addScaledVector(T0,s.z),o}static isFrontFacing(e,t,i,r){return mr.subVectors(i,t),ms.subVectors(e,t),mr.cross(ms).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return mr.subVectors(this.c,this.b),ms.subVectors(this.a,this.b),.5*mr.cross(ms).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Oi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Oi.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return Oi.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Oi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Oi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;Ic.subVectors(r,i),Rc.subVectors(s,i),S0.subVectors(e,i);const c=Ic.dot(S0),l=Rc.dot(S0);if(c<=0&&l<=0)return t.copy(i);b0.subVectors(e,r);const u=Ic.dot(b0),d=Rc.dot(b0);if(u>=0&&d<=u)return t.copy(r);const h=c*d-u*l;if(h<=0&&c>=0&&u<=0)return o=c/(c-u),t.copy(i).addScaledVector(Ic,o);w0.subVectors(e,s);const f=Ic.dot(w0),p=Rc.dot(w0);if(p>=0&&f<=p)return t.copy(s);const v=f*l-c*p;if(v<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(Rc,a);const g=u*p-f*d;if(g<=0&&d-u>=0&&f-p>=0)return VI.subVectors(s,r),a=(d-u)/(d-u+(f-p)),t.copy(r).addScaledVector(VI,a);const m=1/(g+v+h);return o=v*m,a=h*m,t.copy(i).addScaledVector(Ic,o).addScaledVector(Rc,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const HI={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Js={h:0,s:0,l:0},Yf={h:0,s:0,l:0};function A0(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}class xe{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(void 0===t&&void 0===i){const r=e;r&&r.isColor?this.copy(r):"number"==typeof r?this.setHex(r):"string"==typeof r&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ii){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,xt.colorSpaceToWorking(this,t),this}setRGB(e,t,i,r=xt.workingColorSpace){return this.r=e,this.g=t,this.b=i,xt.colorSpaceToWorking(this,r),this}setHSL(e,t,i,r=xt.workingColorSpace){if(e=function a0(n,e){return(n%e+e)%e}(e,1),t=Ge(t,0,1),i=Ge(i,0,1),0===t)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=A0(o,s,e+1/3),this.g=A0(o,s,e),this.b=A0(o,s,e-1/3)}return xt.colorSpaceToWorking(this,r),this}setStyle(e,t=Ii){function i(s){void 0!==s&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[2];switch(r[1]){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(3===o)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(6===o)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ii){const i=HI[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=us(e.r),this.g=us(e.g),this.b=us(e.b),this}copyLinearToSRGB(e){return this.r=Sc(e.r),this.g=Sc(e.g),this.b=Sc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ii){return xt.workingToColorSpace(Bn.copy(this),e),65536*Math.round(Ge(255*Bn.r,0,255))+256*Math.round(Ge(255*Bn.g,0,255))+Math.round(Ge(255*Bn.b,0,255))}getHexString(e=Ii){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=xt.workingColorSpace){xt.workingToColorSpace(Bn.copy(this),t);const i=Bn.r,r=Bn.g,s=Bn.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const d=o-a;switch(l=u<=.5?d/(o+a):d/(2-o-a),o){case i:c=(r-s)/d+(r<s?6:0);break;case r:c=(s-i)/d+2;break;case s:c=(i-r)/d+4}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,t=xt.workingColorSpace){return xt.workingToColorSpace(Bn.copy(this),t),e.r=Bn.r,e.g=Bn.g,e.b=Bn.b,e}getStyle(e=Ii){xt.workingToColorSpace(Bn.copy(this),e);const t=Bn.r,i=Bn.g,r=Bn.b;return e!==Ii?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*r)})`}offsetHSL(e,t,i){return this.getHSL(Js),this.setHSL(Js.h+e,Js.s+t,Js.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Js),e.getHSL(Yf);const i=Pu(Js.h,Yf.h,t),r=Pu(Js.s,Yf.s,t),s=Pu(Js.l,Yf.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Bn=new xe;xe.NAMES=HI;let $j=0;class ti extends ls{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:$j++}),this.uuid=Ri(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new xe(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=yc,this.stencilZFail=yc,this.stencilZPass=yc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function r(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(i.dispersion=this.dispersion),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapRotation&&(i.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),204!==this.blendSrc&&(i.blendSrc=this.blendSrc),205!==this.blendDst&&(i.blendDst=this.blendDst),100!==this.blendEquation&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==yc&&(i.stencilFail=this.stencilFail),this.stencilZFail!==yc&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==yc&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class Ks extends ti{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new xe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fs,this.combine=Cf,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const pn=new T,Zf=new q;let Xj=0;class Bt{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Xj++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this.updateRanges=[],this.gpuType=Di,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Zf.fromBufferAttribute(this,t),Zf.applyMatrix3(e),this.setXY(t,Zf.x,Zf.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)pn.fromBufferAttribute(this,t),pn.applyMatrix3(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)pn.fromBufferAttribute(this,t),pn.applyMatrix4(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)pn.fromBufferAttribute(this,t),pn.applyNormalMatrix(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)pn.fromBufferAttribute(this,t),pn.transformDirection(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Qn(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=lt(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Qn(t,this.array)),t}setX(e,t){return this.normalized&&(t=lt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Qn(t,this.array)),t}setY(e,t){return this.normalized&&(t=lt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Qn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=lt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Qn(t,this.array)),t}setW(e,t){return this.normalized&&(t=lt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=lt(t,this.array),i=lt(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=lt(t,this.array),i=lt(i,this.array),r=lt(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=lt(t,this.array),i=lt(i,this.array),r=lt(r,this.array),s=lt(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class zI extends Bt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class GI extends Bt{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class we extends Bt{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Yj=0;const Yi=new Ze,D0=new qt,Pc=new T,Fi=new ei,Bu=new ei,wn=new T;class dt extends ls{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Yj++}),this.uuid=Ri(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(AI(e)?GI:zI)(e,1):e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const s=(new ut).getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Yi.makeRotationFromQuaternion(e),this.applyMatrix4(Yi),this}rotateX(e){return Yi.makeRotationX(e),this.applyMatrix4(Yi),this}rotateY(e){return Yi.makeRotationY(e),this.applyMatrix4(Yi),this}rotateZ(e){return Yi.makeRotationZ(e),this.applyMatrix4(Yi),this}translate(e,t,i){return Yi.makeTranslation(e,t,i),this.applyMatrix4(Yi),this}scale(e,t,i){return Yi.makeScale(e,t,i),this.applyMatrix4(Yi),this}lookAt(e){return D0.lookAt(e),D0.updateMatrix(),this.applyMatrix4(D0.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Pc).negate(),this.translate(Pc.x,Pc.y,Pc.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const i=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new we(i,3))}else{const i=Math.min(e.length,t.count);for(let r=0;r<i;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ei);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new T(-1/0,-1/0,-1/0),new T(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)Fi.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(wn.addVectors(this.boundingBox.min,Fi.min),this.boundingBox.expandByPoint(wn),wn.addVectors(this.boundingBox.max,Fi.max),this.boundingBox.expandByPoint(wn)):(this.boundingBox.expandByPoint(Fi.min),this.boundingBox.expandByPoint(Fi.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new kn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new T,1/0);if(e){const i=this.boundingSphere.center;if(Fi.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)Bu.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(wn.addVectors(Fi.min,Bu.min),Fi.expandByPoint(wn),wn.addVectors(Fi.max,Bu.max),Fi.expandByPoint(wn)):(Fi.expandByPoint(Bu.min),Fi.expandByPoint(Bu.max));Fi.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)wn.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(wn));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)wn.fromBufferAttribute(a,l),c&&(Pc.fromBufferAttribute(e,l),wn.add(Pc)),r=Math.max(r,i.distanceToSquared(wn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.position,r=t.normal,s=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Bt(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let I=0;I<i.count;I++)a[I]=new T,c[I]=new T;const l=new T,u=new T,d=new T,h=new q,f=new q,p=new q,v=new T,g=new T;function m(I,b,S){l.fromBufferAttribute(i,I),u.fromBufferAttribute(i,b),d.fromBufferAttribute(i,S),h.fromBufferAttribute(s,I),f.fromBufferAttribute(s,b),p.fromBufferAttribute(s,S),u.sub(l),d.sub(l),f.sub(h),p.sub(h);const R=1/(f.x*p.y-p.x*f.y);isFinite(R)&&(v.copy(u).multiplyScalar(p.y).addScaledVector(d,-f.y).multiplyScalar(R),g.copy(d).multiplyScalar(f.x).addScaledVector(u,-p.x).multiplyScalar(R),a[I].add(v),a[b].add(v),a[S].add(v),c[I].add(g),c[b].add(g),c[S].add(g))}let y=this.groups;0===y.length&&(y=[{start:0,count:e.count}]);for(let I=0,b=y.length;I<b;++I){const S=y[I],R=S.start;for(let V=R,H=R+S.count;V<H;V+=3)m(e.getX(V+0),e.getX(V+1),e.getX(V+2))}const _=new T,x=new T,w=new T,C=new T;function D(I){w.fromBufferAttribute(r,I),C.copy(w);const b=a[I];_.copy(b),_.sub(w.multiplyScalar(w.dot(b))).normalize(),x.crossVectors(C,b);const R=x.dot(c[I])<0?-1:1;o.setXYZW(I,_.x,_.y,_.z,R)}for(let I=0,b=y.length;I<b;++I){const S=y[I],R=S.start;for(let V=R,H=R+S.count;V<H;V+=3)D(e.getX(V+0)),D(e.getX(V+1)),D(e.getX(V+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new Bt(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let h=0,f=i.count;h<f;h++)i.setXYZ(h,0,0,0);const r=new T,s=new T,o=new T,a=new T,c=new T,l=new T,u=new T,d=new T;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),v=e.getX(h+1),g=e.getX(h+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,v),o.fromBufferAttribute(t,g),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),a.fromBufferAttribute(i,p),c.fromBufferAttribute(i,v),l.fromBufferAttribute(i,g),a.add(u),c.add(u),l.add(u),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(v,c.x,c.y,c.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let h=0,f=t.count;h<f;h+=3)r.fromBufferAttribute(t,h+0),s.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),i.setXYZ(h+0,u.x,u.y,u.z),i.setXYZ(h+1,u.x,u.y,u.z),i.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)wn.fromBufferAttribute(e,t),wn.normalize(),e.setXYZ(t,wn.x,wn.y,wn.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,d=a.normalized,h=new l.constructor(c.length*u);let f=0,p=0;for(let v=0,g=c.length;v<g;v++){f=a.isInterleavedBufferAttribute?c[v]*a.data.stride+a.offset:c[v]*u;for(let m=0;m<u;m++)h[p++]=l[f++]}return new Bt(h,u,d)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new dt,i=this.index.array,r=this.attributes;for(const a in r){const l=e(r[a],i);t.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,d=l.length;u<d;u++){const f=e(l[u],i);c.push(f)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const c=this.parameters;for(const l in c)void 0!==c[l]&&(e[l]=c[l]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const c in i)e.data.attributes[c]=i[c].toJSON(e.data);const r={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let d=0,h=l.length;d<h;d++)u.push(l[d].toJSON(e.data));u.length>0&&(r[c]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere=a.toJSON()),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone());const r=e.attributes;for(const l in r)this.setAttribute(l,r[l].clone(t));const s=e.morphAttributes;for(const l in s){const u=[],d=s[l];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const d=o[l];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const c=e.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const WI=new Ze,Oo=new Fu,Jf=new kn,jI=new T,Kf=new T,Qf=new T,ep=new T,I0=new T,tp=new T,$I=new T,np=new T;class ln extends qt{constructor(e=new dt,t=new Ks){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);const a=this.morphTargetInfluences;if(s&&a){tp.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c];0!==u&&(I0.fromBufferAttribute(s[c],e),tp.addScaledVector(o?I0:I0.sub(t),u))}t.add(tp)}return t}raycast(e,t){const i=this.geometry,s=this.matrixWorld;void 0!==this.material&&(null===i.boundingSphere&&i.computeBoundingSphere(),Jf.copy(i.boundingSphere),Jf.applyMatrix4(s),Oo.copy(e.ray).recast(e.near),(!1!==Jf.containsPoint(Oo.origin)||!(null===Oo.intersectSphere(Jf,jI)||Oo.origin.distanceToSquared(jI)>(e.far-e.near)**2))&&(WI.copy(s).invert(),Oo.copy(e.ray).applyMatrix4(WI),(null===i.boundingBox||!1!==Oo.intersectsBox(i.boundingBox))&&this._computeIntersections(e,t,Oo)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,d=s.attributes.normal,h=s.groups,f=s.drawRange;if(null!==a)if(Array.isArray(o))for(let p=0,v=h.length;p<v;p++){const g=h[p],m=o[g.materialIndex];for(let x=Math.max(g.start,f.start),w=Math.min(a.count,Math.min(g.start+g.count,f.start+f.count));x<w;x+=3)r=ip(this,m,e,i,l,u,d,a.getX(x),a.getX(x+1),a.getX(x+2)),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,t.push(r))}else for(let g=Math.max(0,f.start),m=Math.min(a.count,f.start+f.count);g<m;g+=3)r=ip(this,o,e,i,l,u,d,a.getX(g),a.getX(g+1),a.getX(g+2)),r&&(r.faceIndex=Math.floor(g/3),t.push(r));else if(void 0!==c)if(Array.isArray(o))for(let p=0,v=h.length;p<v;p++){const g=h[p],m=o[g.materialIndex];for(let x=Math.max(g.start,f.start),w=Math.min(c.count,Math.min(g.start+g.count,f.start+f.count));x<w;x+=3)r=ip(this,m,e,i,l,u,d,x,x+1,x+2),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,t.push(r))}else for(let g=Math.max(0,f.start),m=Math.min(c.count,f.start+f.count);g<m;g+=3)r=ip(this,o,e,i,l,u,d,g,g+1,g+2),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}function ip(n,e,t,i,r,s,o,a,c,l){n.getVertexPosition(a,Kf),n.getVertexPosition(c,Qf),n.getVertexPosition(l,ep);const u=function Zj(n,e,t,i,r,s,o,a){let c;if(c=1===e.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,0===e.side,a),null===c)return null;np.copy(a),np.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(np);return l<t.near||l>t.far?null:{distance:l,point:np.clone(),object:n}}(n,e,t,i,Kf,Qf,ep,$I);if(u){const d=new T;Oi.getBarycoord($I,Kf,Qf,ep,d),r&&(u.uv=Oi.getInterpolatedAttribute(r,a,c,l,d,new q)),s&&(u.uv1=Oi.getInterpolatedAttribute(s,a,c,l,d,new q)),o&&(u.normal=Oi.getInterpolatedAttribute(o,a,c,l,d,new T),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:c,c:l,normal:new T,materialIndex:0};Oi.getNormal(Kf,Qf,ep,h.normal),u.face=h,u.barycoord=d}return u}class Nc extends dt{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],d=[];let h=0,f=0;function p(v,g,m,y,_,x,w,C,D,I,b){const S=x/D,R=w/I,B=x/2,V=w/2,H=C/2,Y=D+1,W=I+1;let ie=0,G=0;const pe=new T;for(let Me=0;Me<W;Me++){const Ae=Me*R-V;for(let it=0;it<Y;it++)pe[v]=(it*S-B)*y,pe[g]=Ae*_,pe[m]=H,l.push(pe.x,pe.y,pe.z),pe[v]=0,pe[g]=0,pe[m]=C>0?1:-1,u.push(pe.x,pe.y,pe.z),d.push(it/D),d.push(1-Me/I),ie+=1}for(let Me=0;Me<I;Me++)for(let Ae=0;Ae<D;Ae++){const bt=h+Ae+Y*(Me+1),wt=h+(Ae+1)+Y*(Me+1),$=h+(Ae+1)+Y*Me;c.push(h+Ae+Y*Me,bt,$),c.push(bt,wt,$),G+=6}a.addGroup(f,G,b),f+=G,h+=ie}p("z","y","x",-1,-1,i,t,e,o,s,0),p("z","y","x",1,-1,i,t,-e,o,s,1),p("x","z","y",1,1,e,i,t,r,o,2),p("x","z","y",1,-1,e,i,-t,r,o,3),p("x","y","z",1,-1,e,t,i,r,s,4),p("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(c),this.setAttribute("position",new we(l,3)),this.setAttribute("normal",new we(u,3)),this.setAttribute("uv",new we(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Nc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Lc(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():e[t][i]=Array.isArray(r)?r.slice():r}}return e}function ni(n){const e={};for(let t=0;t<n.length;t++){const i=Lc(n[t]);for(const r in i)e[r]=i[r]}return e}function qI(n){const e=n.getRenderTarget();return null===e?n.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:xt.workingColorSpace}const rp={clone:Lc,merge:ni};class Rn extends ti{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Lc(e.uniforms),this.uniformsGroups=function Jj(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;t.uniforms[r]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class R0 extends qt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ze,this.projectionMatrix=new Ze,this.projectionMatrixInverse=new Ze,this.coordinateSystem=Xi,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Qs=new T,XI=new q,YI=new q;class Vn extends R0{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*_c*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Ro*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*_c*Math.atan(Math.tan(.5*Ro*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Qs.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Qs.x,Qs.y).multiplyScalar(-e/Qs.z),Qs.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Qs.x,Qs.y).multiplyScalar(-e/Qs.z)}getViewSize(e,t){return this.getViewBounds(e,XI,YI),t.subVectors(YI,XI)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Ro*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*r/c,t-=o.offsetY*i/l,r*=o.width/c,i*=o.height/l}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class e8 extends qt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Vn(-90,1,e,t);r.layers=this.layers,this.add(r);const s=new Vn(-90,1,e,t);s.layers=this.layers,this.add(s);const o=new Vn(-90,1,e,t);o.layers=this.layers,this.add(o);const a=new Vn(-90,1,e,t);a.layers=this.layers,this.add(a);const c=new Vn(-90,1,e,t);c.layers=this.layers,this.add(c);const l=new Vn(-90,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,c]=t;for(const l of t)this.remove(l);if(e===Xi)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else{if(2001!==e)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const v=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,o),e.setRenderTarget(i,2,r),e.render(t,a),e.setRenderTarget(i,3,r),e.render(t,c),e.setRenderTarget(i,4,r),e.render(t,l),i.texture.generateMipmaps=v,e.setRenderTarget(i,5,r),e.render(t,u),e.setRenderTarget(d,h,f),e.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class sp extends mi{constructor(e=[],t=Ws,i,r,s,o,a,c,l,u){super(e,t,i,r,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class t8 extends Ni{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1};this.texture=new sp([i,i,i,i,i,i]),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new Nc(5,5,5),s=new Rn({name:"CubemapFromEquirect",uniforms:Lc(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=t;const o=new ln(r,s),a=t.minFilter;return t.minFilter===as&&(t.minFilter=bn),new e8(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,i=!0,r=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}class Vu extends qt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const n8={type:"move"};class P0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Vu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Vu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new T,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new T),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Vu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new T,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new T),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const v of e.hand.values()){const g=t.getJointPose(v,i),m=this._getHandJoint(l,v);null!==g&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=g.radius),m.visible=null!==g}const h=l.joints["index-finger-tip"].position.distanceTo(l.joints["thumb-tip"].position),f=.02,p=.005;l.inputState.pinching&&h>f+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=f-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==c&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==s&&(r=s),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(n8)))}return null!==a&&(a.visible=null!==r),null!==c&&(c.visible=null!==s),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new Vu;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class ZI extends qt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new fs,this.environmentIntensity=1,this.environmentRotation=new fs,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const V0=new T,u8=new T,d8=new ut;class Fo{constructor(e=new T(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=V0.subVectors(i,t).cross(u8.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(V0),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||d8.getNormalMatrix(e),r=this.coplanarPoint(V0).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Uo=new kn,h8=new q(.5,.5),hp=new T;class qu{constructor(e=new Fo,t=new Fo,i=new Fo,r=new Fo,s=new Fo,o=new Fo){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Xi,i=!1){const r=this.planes,s=e.elements,o=s[0],a=s[1],c=s[2],l=s[3],u=s[4],d=s[5],h=s[6],f=s[7],p=s[8],v=s[9],g=s[10],m=s[11],y=s[12],_=s[13],x=s[14],w=s[15];if(r[0].setComponents(l-o,f-u,m-p,w-y).normalize(),r[1].setComponents(l+o,f+u,m+p,w+y).normalize(),r[2].setComponents(l+a,f+d,m+v,w+_).normalize(),r[3].setComponents(l-a,f-d,m-v,w-_).normalize(),i)r[4].setComponents(c,h,g,x).normalize(),r[5].setComponents(l-c,f-h,m-g,w-x).normalize();else if(r[4].setComponents(l-c,f-h,m-g,w-x).normalize(),t===Xi)r[5].setComponents(l+c,f+h,m+g,w+x).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(c,h,g,x).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Uo.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Uo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Uo)}intersectsSprite(e){Uo.center.set(0,0,0);const t=h8.distanceTo(e.center);return Uo.radius=.7071067811865476+t,Uo.applyMatrix4(e.matrixWorld),this.intersectsSphere(Uo)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(hp.x=r.normal.x>0?e.max.x:e.min.x,hp.y=r.normal.y>0?e.max.y:e.min.y,hp.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(hp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class x1 extends mi{constructor(e,t,i=js,r,s,o,a=Fn,c=Fn,l,u=Du,d=1){if(u!==Du&&u!==Iu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:d},r,s,o,a,c,u,i,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Po(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class jc extends dt{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),c=Math.floor(r),l=a+1,u=c+1,d=e/a,h=t/c,f=[],p=[],v=[],g=[];for(let m=0;m<u;m++){const y=m*h-o;for(let _=0;_<l;_++)p.push(_*d-s,-y,0),v.push(0,0,1),g.push(_/a),g.push(1-m/c)}for(let m=0;m<c;m++)for(let y=0;y<a;y++){const x=y+l*(m+1),w=y+1+l*(m+1),C=y+1+l*m;f.push(y+l*m,x,C),f.push(x,w,C)}this.setIndex(f),this.setAttribute("position",new we(p,3)),this.setAttribute("normal",new we(v,3)),this.setAttribute("uv",new we(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jc(e.width,e.height,e.widthSegments,e.heightSegments)}}class U1 extends ti{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class k1 extends ti{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Go(n,e){return n&&n.constructor!==e?"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n):n}class Pp{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(void 0===r){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(e>=s)break e;{const a=t[1];e<a&&(i=2,s=a);for(let c=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===c)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0}}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class g$ extends Pp{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],c=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:s=e,a=2*t-i;break;case 2402:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(void 0===c)switch(this.getSettings_().endingEnd){case 2401:o=e,c=2*i-t;break;case 2402:o=1,c=i+r[1]-r[0];break;default:o=e-1,c=t}const l=.5*(i-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(c-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(i-t)/(r-t),v=p*p,g=v*p,m=-h*g+2*h*v-h*p,y=(1+h)*g+(-1.5-2*h)*v+(-.5+h)*p+1,_=(-1-f)*g+(1.5+f)*v+.5*p,x=f*g-f*v;for(let w=0;w!==a;++w)s[w]=m*o[u+w]+y*o[l+w]+_*o[c+w]+x*o[d+w];return s}}class H1 extends Pp{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=(i-t)/(r-t),d=1-u;for(let h=0;h!==a;++h)s[h]=o[l+h]*d+o[c+h]*u;return s}}class v$ extends Pp{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class gr{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Go(t,this.TimeBufferType),this.values=Go(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Go(e.times,Array),values:Go(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new v$(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new H1(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new g$(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==s||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=i.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const c=i[a];if("number"==typeof c&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(null!==o&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),e=!1;break}o=c}if(void 0!==r&&function B1(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}(r))for(let a=0,c=r.length;a!==c;++a){const l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=2302===this.getInterpolation(),s=e.length-1;let o=1;for(let a=1;a<s;++a){let c=!1;const l=e[a];if(l!==e[a+1]&&(1!==a||l!==e[0]))if(r)c=!0;else{const d=a*i,h=d-i,f=d+i;for(let p=0;p!==i;++p){const v=t[d+p];if(v!==t[h+p]||v!==t[f+p]){c=!0;break}}}if(c){if(a!==o){e[o]=e[a];const d=a*i,h=o*i;for(let f=0;f!==i;++f)t[h+f]=t[d+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,c=o*i,l=0;l!==i;++l)t[c+l]=t[a+l];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}gr.prototype.ValueTypeName="",gr.prototype.TimeBufferType=Float32Array,gr.prototype.ValueBufferType=Float32Array,gr.prototype.DefaultInterpolation=2301;class $c extends gr{constructor(e,t,i){super(e,t,i)}}$c.prototype.ValueTypeName="bool",$c.prototype.ValueBufferType=Array,$c.prototype.DefaultInterpolation=2300,$c.prototype.InterpolantFactoryMethodLinear=void 0,$c.prototype.InterpolantFactoryMethodSmooth=void 0;(class z1 extends gr{constructor(e,t,i,r){super(e,t,i,r)}}).prototype.ValueTypeName="color";(class Np extends gr{constructor(e,t,i,r){super(e,t,i,r)}}).prototype.ValueTypeName="number";class y$ extends Pp{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(i-t)/(r-t);let l=e*a;for(let u=l+a;l!==u;l+=4)Pi.slerpFlat(s,0,o,l-a,o,l,c);return s}}class Lp extends gr{constructor(e,t,i,r){super(e,t,i,r)}InterpolantFactoryMethodLinear(e){return new y$(this.times,this.values,this.getValueSize(),e)}}Lp.prototype.ValueTypeName="quaternion",Lp.prototype.InterpolantFactoryMethodSmooth=void 0;class qc extends gr{constructor(e,t,i){super(e,t,i)}}qc.prototype.ValueTypeName="string",qc.prototype.ValueBufferType=Array,qc.prototype.DefaultInterpolation=2300,qc.prototype.InterpolantFactoryMethodLinear=void 0,qc.prototype.InterpolantFactoryMethodSmooth=void 0;(class Op extends gr{constructor(e,t,i,r){super(e,t,i,r)}}).prototype.ValueTypeName="vector",Error;class id extends R0{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,c=r-t;if(null!==this.view&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class U$ extends Vn{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class Q1{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Sx="\\[\\]\\.:\\/",z$=new RegExp("["+Sx+"]","g"),bx="[^"+Sx+"]",G$="[^"+Sx.replace("\\.","")+"]",X$=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",bx)+/(WCOD+)?/.source.replace("WCOD",G$)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",bx)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",bx)+"$"),Y$=["material","materials","bones","map"];class Z${constructor(e,t,i){const r=i||Xt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let Xt=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(z$,"")}static parseTrackName(t){const i=X$.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=r.nodeName.substring(s+1);-1!==Y$.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(o){for(let a=0;a<o.length;a++){const c=o[a];if(c.name===i||c.uuid===i)return c;const l=r(c.children);if(l)return l}return null},s=r(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)t[i++]=r[s]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(r){let u=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===u){u=d;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==u){if(void 0===t[u])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[u]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+s+" but it wasn't found.",t);let c=this.Versioning.None;this.targetObject=t,!0===t.isMaterial?c=this.Versioning.NeedsUpdate:!0===t.isObject3D&&(c=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=Z$,n})();function Ax(n,e,t,i){const r=function a6(n){switch(n){case Rr:case mI:return{byteLength:1,components:1};case Tu:case gI:case cs:return{byteLength:2,components:1};case C_:case T_:return{byteLength:2,components:4};case js:case E_:case Di:return{byteLength:4,components:1};case vI:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}(i);switch(t){case yI:return n*e;case A_:case Pf:return n*e/r.components*r.byteLength;case xI:case D_:return n*e*2/r.components*r.byteLength;case _I:return n*e*3/r.components*r.byteLength;case pi:case I_:return n*e*4/r.components*r.byteLength;case Nf:case Lf:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Of:case Ff:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case P_:case L_:return Math.max(n,16)*Math.max(e,8)/4;case R_:case N_:return Math.max(n,8)*Math.max(e,8)/2;case O_:case F_:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case U_:case k_:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case B_:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case V_:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case H_:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case z_:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case G_:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case W_:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case j_:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case $_:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case q_:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case X_:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case Y_:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case Z_:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case J_:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Uf:case K_:case Q_:return Math.ceil(n/4)*Math.ceil(e/4)*16;case MI:case e0:return Math.ceil(n/4)*Math.ceil(e/4)*8;case t0:case n0:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function pR(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function c6(n){const e=new WeakMap;return{get:function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)},remove:function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(n.deleteBuffer(c.buffer),e.delete(a))},update:function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);return void((!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version}))}const l=e.get(a);if(void 0===l)e.set(a,function t(a,c){const l=a.array,u=a.usage,d=l.byteLength,h=n.createBuffer();let f;if(n.bindBuffer(c,h),n.bufferData(c,l,u),a.onUploadCallback(),l instanceof Float32Array)f=n.FLOAT;else if(typeof Float16Array<"u"&&l instanceof Float16Array)f=n.HALF_FLOAT;else if(l instanceof Uint16Array)f=a.isFloat16BufferAttribute?n.HALF_FLOAT:n.UNSIGNED_SHORT;else if(l instanceof Int16Array)f=n.SHORT;else if(l instanceof Uint32Array)f=n.UNSIGNED_INT;else if(l instanceof Int32Array)f=n.INT;else if(l instanceof Int8Array)f=n.BYTE;else if(l instanceof Uint8Array)f=n.UNSIGNED_BYTE;else{if(!(l instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);f=n.UNSIGNED_BYTE}return{buffer:h,type:f,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:d}}(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function i(a,c,l){const u=c.array,d=c.updateRanges;if(n.bindBuffer(l,a),0===d.length)n.bufferSubData(l,0,u);else{d.sort((f,p)=>f.start-p.start);let h=0;for(let f=1;f<d.length;f++){const p=d[h],v=d[f];v.start<=p.start+p.count+1?p.count=Math.max(p.count,v.start+v.count-p.start):(++h,d[h]=v)}d.length=h+1;for(let f=0,p=d.length;f<p;f++){const v=d[f];n.bufferSubData(l,v.start*u.BYTES_PER_ELEMENT,u,v.start,v.count)}c.clearUpdateRanges()}c.onUploadCallback()})(l.buffer,a,c),l.version=a.version}}}}Xt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Xt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Xt.prototype.GetterByBindingType=[Xt.prototype._getValue_direct,Xt.prototype._getValue_array,Xt.prototype._getValue_arrayElement,Xt.prototype._getValue_toArray],Xt.prototype.SetterByBindingTypeAndVersioning=[[Xt.prototype._setValue_direct,Xt.prototype._setValue_direct_setNeedsUpdate,Xt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_array,Xt.prototype._setValue_array_setNeedsUpdate,Xt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_arrayElement,Xt.prototype._setValue_arrayElement_setNeedsUpdate,Xt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_fromArray,Xt.prototype._setValue_fromArray_setNeedsUpdate,Xt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"179"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="179");const pt={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\tfloat depth = unpackRGBAToDepth( texture2D( depths, uv ) );\n\t\t#ifdef USE_REVERSEDEPTHBUF\n\t\t\treturn step( depth, compare );\n\t\t#else\n\t\t\treturn step( compare, depth );\n\t\t#endif\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\t#ifdef USE_REVERSEDEPTHBUF\n\t\t\tfloat hard_shadow = step( distribution.x, compare );\n\t\t#else\n\t\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\t#endif\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSEDEPTHBUF\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},ge={common:{diffuse:{value:new xe(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ut},alphaMap:{value:null},alphaMapTransform:{value:new ut},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ut}},envmap:{envMap:{value:null},envMapRotation:{value:new ut},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ut}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ut}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ut},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ut},normalScale:{value:new q(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ut},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ut}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ut}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ut}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new xe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new xe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ut},alphaTest:{value:0},uvTransform:{value:new ut}},sprite:{diffuse:{value:new xe(16777215)},opacity:{value:1},center:{value:new q(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ut},alphaMap:{value:null},alphaMapTransform:{value:new ut},alphaTest:{value:0}}},Fr={basic:{uniforms:ni([ge.common,ge.specularmap,ge.envmap,ge.aomap,ge.lightmap,ge.fog]),vertexShader:pt.meshbasic_vert,fragmentShader:pt.meshbasic_frag},lambert:{uniforms:ni([ge.common,ge.specularmap,ge.envmap,ge.aomap,ge.lightmap,ge.emissivemap,ge.bumpmap,ge.normalmap,ge.displacementmap,ge.fog,ge.lights,{emissive:{value:new xe(0)}}]),vertexShader:pt.meshlambert_vert,fragmentShader:pt.meshlambert_frag},phong:{uniforms:ni([ge.common,ge.specularmap,ge.envmap,ge.aomap,ge.lightmap,ge.emissivemap,ge.bumpmap,ge.normalmap,ge.displacementmap,ge.fog,ge.lights,{emissive:{value:new xe(0)},specular:{value:new xe(1118481)},shininess:{value:30}}]),vertexShader:pt.meshphong_vert,fragmentShader:pt.meshphong_frag},standard:{uniforms:ni([ge.common,ge.envmap,ge.aomap,ge.lightmap,ge.emissivemap,ge.bumpmap,ge.normalmap,ge.displacementmap,ge.roughnessmap,ge.metalnessmap,ge.fog,ge.lights,{emissive:{value:new xe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:pt.meshphysical_vert,fragmentShader:pt.meshphysical_frag},toon:{uniforms:ni([ge.common,ge.aomap,ge.lightmap,ge.emissivemap,ge.bumpmap,ge.normalmap,ge.displacementmap,ge.gradientmap,ge.fog,ge.lights,{emissive:{value:new xe(0)}}]),vertexShader:pt.meshtoon_vert,fragmentShader:pt.meshtoon_frag},matcap:{uniforms:ni([ge.common,ge.bumpmap,ge.normalmap,ge.displacementmap,ge.fog,{matcap:{value:null}}]),vertexShader:pt.meshmatcap_vert,fragmentShader:pt.meshmatcap_frag},points:{uniforms:ni([ge.points,ge.fog]),vertexShader:pt.points_vert,fragmentShader:pt.points_frag},dashed:{uniforms:ni([ge.common,ge.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:pt.linedashed_vert,fragmentShader:pt.linedashed_frag},depth:{uniforms:ni([ge.common,ge.displacementmap]),vertexShader:pt.depth_vert,fragmentShader:pt.depth_frag},normal:{uniforms:ni([ge.common,ge.bumpmap,ge.normalmap,ge.displacementmap,{opacity:{value:1}}]),vertexShader:pt.meshnormal_vert,fragmentShader:pt.meshnormal_frag},sprite:{uniforms:ni([ge.sprite,ge.fog]),vertexShader:pt.sprite_vert,fragmentShader:pt.sprite_frag},background:{uniforms:{uvTransform:{value:new ut},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:pt.background_vert,fragmentShader:pt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ut}},vertexShader:pt.backgroundCube_vert,fragmentShader:pt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:pt.cube_vert,fragmentShader:pt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:pt.equirect_vert,fragmentShader:pt.equirect_frag},distanceRGBA:{uniforms:ni([ge.common,ge.displacementmap,{referencePosition:{value:new T},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:pt.distanceRGBA_vert,fragmentShader:pt.distanceRGBA_frag},shadow:{uniforms:ni([ge.lights,ge.fog,{color:{value:new xe(0)},opacity:{value:1}}]),vertexShader:pt.shadow_vert,fragmentShader:pt.shadow_frag}};Fr.physical={uniforms:ni([Fr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ut},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ut},clearcoatNormalScale:{value:new q(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ut},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ut},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ut},sheen:{value:0},sheenColor:{value:new xe(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ut},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ut},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ut},transmissionSamplerSize:{value:new q},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ut},attenuationDistance:{value:0},attenuationColor:{value:new xe(0)},specularColor:{value:new xe(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ut},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ut},anisotropyVector:{value:new q},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ut}}]),vertexShader:pt.meshphysical_vert,fragmentShader:pt.meshphysical_frag};const jp={r:0,b:0,g:0},Jo=new fs,cq=new Ze;function lq(n,e,t,i,r,s,o){const a=new xe(0);let l,u,c=!0===s?0:1,d=null,h=0,f=null;function p(_){let x=!0===_.isScene?_.background:null;return x&&x.isTexture&&(x=(_.backgroundBlurriness>0?t:e).get(x)),x}function m(_,x){_.getRGB(jp,qI(n)),i.buffers.color.setClear(jp.r,jp.g,jp.b,x,o)}return{getClearColor:function(){return a},setClearColor:function(_,x=1){a.set(_),c=x,m(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(_){c=_,m(a,c)},render:function v(_){let x=!1;const w=p(_);null===w?m(a,c):w&&w.isColor&&(m(w,1),x=!0);const C=n.xr.getEnvironmentBlendMode();"additive"===C?i.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===C&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||x)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))},addToRenderList:function g(_,x){const w=p(x);w&&(w.isCubeTexture||w.mapping===Eu)?(void 0===u&&(u=new ln(new Nc(1,1,1),new Rn({name:"BackgroundCubeMaterial",uniforms:Lc(Fr.backgroundCube.uniforms),vertexShader:Fr.backgroundCube.vertexShader,fragmentShader:Fr.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(C,D,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),Jo.copy(x.backgroundRotation),Jo.x*=-1,Jo.y*=-1,Jo.z*=-1,w.isCubeTexture&&!1===w.isRenderTargetTexture&&(Jo.y*=-1,Jo.z*=-1),u.material.uniforms.envMap.value=w,u.material.uniforms.flipEnvMap.value=w.isCubeTexture&&!1===w.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(cq.makeRotationFromEuler(Jo)),u.material.toneMapped=xt.getTransfer(w.colorSpace)!==Ft,(d!==w||h!==w.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,d=w,h=w.version,f=n.toneMapping),u.layers.enableAll(),_.unshift(u,u.geometry,u.material,0,0,null)):w&&w.isTexture&&(void 0===l&&(l=new ln(new jc(2,2),new Rn({name:"BackgroundMaterial",uniforms:Lc(Fr.background.uniforms),vertexShader:Fr.background.vertexShader,fragmentShader:Fr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=w,l.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,l.material.toneMapped=xt.getTransfer(w.colorSpace)!==Ft,!0===w.matrixAutoUpdate&&w.updateMatrix(),l.material.uniforms.uvTransform.value.copy(w.matrix),(d!==w||h!==w.version||f!==n.toneMapping)&&(l.material.needsUpdate=!0,d=w,h=w.version,f=n.toneMapping),l.layers.enableAll(),_.unshift(l,l.geometry,l.material,0,0,null))},dispose:function y(){void 0!==u&&(u.geometry.dispose(),u.material.dispose(),u=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function uq(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=h(null);let s=r,o=!1;function l(S){return n.bindVertexArray(S)}function u(S){return n.deleteVertexArray(S)}function h(S){const R=[],B=[],V=[];for(let H=0;H<t;H++)R[H]=0,B[H]=0,V[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:B,attributeDivisors:V,object:S,attributes:{},index:null}}function v(){const S=s.newAttributes;for(let R=0,B=S.length;R<B;R++)S[R]=0}function g(S){m(S,0)}function m(S,R){const V=s.enabledAttributes,H=s.attributeDivisors;s.newAttributes[S]=1,0===V[S]&&(n.enableVertexAttribArray(S),V[S]=1),H[S]!==R&&(n.vertexAttribDivisor(S,R),H[S]=R)}function y(){const S=s.newAttributes,R=s.enabledAttributes;for(let B=0,V=R.length;B<V;B++)R[B]!==S[B]&&(n.disableVertexAttribArray(B),R[B]=0)}function _(S,R,B,V,H,Y,W){!0===W?n.vertexAttribIPointer(S,R,B,H,Y):n.vertexAttribPointer(S,R,B,V,H,Y)}function I(){b(),o=!0,s!==r&&(s=r,l(s.object))}function b(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function a(S,R,B,V,H){let Y=!1;const W=function d(S,R,B){const V=!0===B.wireframe;let H=i[S.id];void 0===H&&(H={},i[S.id]=H);let Y=H[R.id];void 0===Y&&(Y={},H[R.id]=Y);let W=Y[V];return void 0===W&&(W=h(function c(){return n.createVertexArray()}()),Y[V]=W),W}(V,B,R);s!==W&&(s=W,l(s.object)),Y=function f(S,R,B,V){const H=s.attributes,Y=R.attributes;let W=0;const ie=B.getAttributes();for(const G in ie)if(ie[G].location>=0){const Me=H[G];let Ae=Y[G];if(void 0===Ae&&("instanceMatrix"===G&&S.instanceMatrix&&(Ae=S.instanceMatrix),"instanceColor"===G&&S.instanceColor&&(Ae=S.instanceColor)),void 0===Me||Me.attribute!==Ae||Ae&&Me.data!==Ae.data)return!0;W++}return s.attributesNum!==W||s.index!==V}(S,V,B,H),Y&&function p(S,R,B,V){const H={},Y=R.attributes;let W=0;const ie=B.getAttributes();for(const G in ie)if(ie[G].location>=0){let Me=Y[G];void 0===Me&&("instanceMatrix"===G&&S.instanceMatrix&&(Me=S.instanceMatrix),"instanceColor"===G&&S.instanceColor&&(Me=S.instanceColor));const Ae={};Ae.attribute=Me,Me&&Me.data&&(Ae.data=Me.data),H[G]=Ae,W++}s.attributes=H,s.attributesNum=W,s.index=V}(S,V,B,H),null!==H&&e.update(H,n.ELEMENT_ARRAY_BUFFER),(Y||o)&&(o=!1,function x(S,R,B,V){v();const H=V.attributes,Y=B.getAttributes(),W=R.defaultAttributeValues;for(const ie in Y){const G=Y[ie];if(G.location>=0){let pe=H[ie];if(void 0===pe&&("instanceMatrix"===ie&&S.instanceMatrix&&(pe=S.instanceMatrix),"instanceColor"===ie&&S.instanceColor&&(pe=S.instanceColor)),void 0!==pe){const Me=pe.normalized,Ae=pe.itemSize,it=e.get(pe);if(void 0===it)continue;const bt=it.buffer,wt=it.type,$=it.bytesPerElement,me=wt===n.INT||wt===n.UNSIGNED_INT||pe.gpuType===E_;if(pe.isInterleavedBufferAttribute){const de=pe.data,ke=de.stride,Ne=pe.offset;if(de.isInstancedInterleavedBuffer){for(let We=0;We<G.locationSize;We++)m(G.location+We,de.meshPerAttribute);!0!==S.isInstancedMesh&&void 0===V._maxInstanceCount&&(V._maxInstanceCount=de.meshPerAttribute*de.count)}else for(let We=0;We<G.locationSize;We++)g(G.location+We);n.bindBuffer(n.ARRAY_BUFFER,bt);for(let We=0;We<G.locationSize;We++)_(G.location+We,Ae/G.locationSize,wt,Me,ke*$,(Ne+Ae/G.locationSize*We)*$,me)}else{if(pe.isInstancedBufferAttribute){for(let de=0;de<G.locationSize;de++)m(G.location+de,pe.meshPerAttribute);!0!==S.isInstancedMesh&&void 0===V._maxInstanceCount&&(V._maxInstanceCount=pe.meshPerAttribute*pe.count)}else for(let de=0;de<G.locationSize;de++)g(G.location+de);n.bindBuffer(n.ARRAY_BUFFER,bt);for(let de=0;de<G.locationSize;de++)_(G.location+de,Ae/G.locationSize,wt,Me,Ae*$,Ae/G.locationSize*de*$,me)}}else if(void 0!==W){const Me=W[ie];if(void 0!==Me)switch(Me.length){case 2:n.vertexAttrib2fv(G.location,Me);break;case 3:n.vertexAttrib3fv(G.location,Me);break;case 4:n.vertexAttrib4fv(G.location,Me);break;default:n.vertexAttrib1fv(G.location,Me)}}}}y()}(S,R,B,V),null!==H&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(H).buffer))},reset:I,resetDefaultState:b,dispose:function w(){I();for(const S in i){const R=i[S];for(const B in R){const V=R[B];for(const H in V)u(V[H].object),delete V[H];delete R[B]}delete i[S]}},releaseStatesOfGeometry:function C(S){if(void 0===i[S.id])return;const R=i[S.id];for(const B in R){const V=R[B];for(const H in V)u(V[H].object),delete V[H];delete R[B]}delete i[S.id]},releaseStatesOfProgram:function D(S){for(const R in i){const B=i[R];if(void 0===B[S.id])continue;const V=B[S.id];for(const H in V)u(V[H].object),delete V[H];delete B[S.id]}},initAttributes:v,enableAttribute:g,disableUnusedAttributes:y}}function dq(n,e,t){let i;function o(l,u,d){0!==d&&(n.drawArraysInstanced(i,l,u,d),t.update(u,i,d))}this.setMode=function r(l){i=l},this.render=function s(l,u){n.drawArrays(i,l,u),t.update(u,i,1)},this.renderInstances=o,this.renderMultiDraw=function a(l,u,d){if(0===d)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,l,0,u,0,d);let f=0;for(let p=0;p<d;p++)f+=u[p];t.update(f,i,1)},this.renderMultiDrawInstances=function c(l,u,d,h){if(0===d)return;const f=e.get("WEBGL_multi_draw");if(null===f)for(let p=0;p<l.length;p++)o(l[p],u[p],h[p]);else{f.multiDrawArraysInstancedWEBGL(i,l,0,u,0,h,0,d);let p=0;for(let v=0;v<d;v++)p+=u[v]*h[v];t.update(p,i,1)}}}function hq(n,e,t,i){let r;function c(D){if("highp"===D){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";D="mediump"}return"mediump"===D&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=void 0!==t.precision?t.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const d=!0===t.logarithmicDepthBuffer,h=!0===t.reversedDepthBuffer&&e.has("EXT_clip_control"),f=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function s(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const D=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(D.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:c,textureFormatReadable:function o(D){return!(D!==pi&&i.convert(D)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))},textureTypeReadable:function a(D){const I=D===cs&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(D!==Rr&&i.convert(D)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&D!==Di&&!I)},precision:l,logarithmicDepthBuffer:d,reversedDepthBuffer:h,maxTextures:f,maxVertexTextures:p,maxTextureSize:n.getParameter(n.MAX_TEXTURE_SIZE),maxCubemapSize:n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:n.getParameter(n.MAX_VERTEX_ATTRIBS),maxVertexUniforms:n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:n.getParameter(n.MAX_VARYING_VECTORS),maxFragmentUniforms:n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:p>0,maxSamples:n.getParameter(n.MAX_SAMPLES)}}function fq(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new Fo,a=new ut,c={value:null,needsUpdate:!1};function u(d,h,f,p){const v=null!==d?d.length:0;let g=null;if(0!==v){if(g=c.value,!0!==p||null===g){const m=f+4*v,y=h.matrixWorldInverse;a.getNormalMatrix(y),(null===g||g.length<m)&&(g=new Float32Array(m));for(let _=0,x=f;_!==v;++_,x+=4)o.copy(d[_]).applyMatrix4(y,a),o.normal.toArray(g,x),g[x+3]=o.constant}c.value=g,c.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,g}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=0!==d.length||h||0!==i||r;return r=h,i=d.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,h){t=u(d,h,0)},this.setState=function(d,h,f){const p=d.clippingPlanes,v=d.clipIntersection,g=d.clipShadows,m=n.get(d);if(!r||null===p||0===p.length||s&&!g)s?u(null):function l(){c.value!==t&&(c.value=t,c.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}();else{const y=s?0:i,_=4*y;let x=m.clippingState||null;c.value=x,x=u(p,h,_,f);for(let w=0;w!==_;++w)x[w]=t[w];m.clippingState=x,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=y}}}function pq(n){let e=new WeakMap;function t(o,a){return 303===a?o.mapping=Ws:304===a&&(o.mapping=Do),o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const c=e.get(a);void 0!==c&&(e.delete(a),c.dispose())}return{get:function i(o){if(o&&o.isTexture){const a=o.mapping;if(303===a||304===a){if(e.has(o))return t(e.get(o).texture,o.mapping);{const c=o.image;if(c&&c.height>0){const l=new t8(c.height);return l.fromEquirectangularTexture(n,o),e.set(o,l),o.addEventListener("dispose",r),t(l.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}const mR=[.125,.215,.35,.446,.526,.582],Dx=new id,gR=new xe;let Ix=null,Rx=0,Px=0,Nx=!1;const Qo=(1+Math.sqrt(5))/2,Kc=1/Qo,vR=[new T(-Qo,Kc,0),new T(Qo,Kc,0),new T(-Kc,0,Qo),new T(Kc,0,Qo),new T(0,Qo,-Kc),new T(0,Qo,Kc),new T(-1,1,-1),new T(1,1,-1),new T(-1,1,1),new T(1,1,1)],mq=new T;class yR{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100,s={}){const{size:o=256,position:a=mq}=s;Ix=this._renderer.getRenderTarget(),Rx=this._renderer.getActiveCubeFace(),Px=this._renderer.getActiveMipmapLevel(),Nx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,i,r,c,a),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=MR(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=xR(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ix,Rx,Px),this._renderer.xr.enabled=Nx,e.scissorTest=!1,$p(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===Ws||e.mapping===Do?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),Ix=this._renderer.getRenderTarget(),Rx=this._renderer.getActiveCubeFace(),Px=this._renderer.getActiveMipmapLevel(),Nx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:bn,minFilter:bn,generateMipmaps:!1,type:cs,format:pi,colorSpace:vc,depthBuffer:!1},r=_R(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=_R(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function gq(n){const e=[],t=[],i=[];let r=n;const s=n-4+1+mR.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let c=1/a;o>n-4?c=mR[o-n+4-1]:0===o&&(c=0),i.push(c);const l=1/(a-2),u=-l,d=1+l,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,v=3,g=2,m=1,y=new Float32Array(v*p*f),_=new Float32Array(g*p*f),x=new Float32Array(m*p*f);for(let C=0;C<f;C++){const D=C%3*2/3-1,I=C>2?0:-1;y.set([D,I,0,D+2/3,I,0,D+2/3,I+1,0,D,I,0,D+2/3,I+1,0,D,I+1,0],v*p*C),_.set(h,g*p*C),x.set([C,C,C,C,C,C],m*p*C)}const w=new dt;w.setAttribute("position",new Bt(y,v)),w.setAttribute("uv",new Bt(_,g)),w.setAttribute("faceIndex",new Bt(x,m)),e.push(w),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(s)),this._blurMaterial=function vq(n,e,t){const i=new Float32Array(20),r=new T(0,1,0);return new Rn({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(s,e,t)}return r}_compileMaterial(e){const t=new ln(this._lodPlanes[0],e);this._renderer.compile(t,Dx)}_sceneToCubeUV(e,t,i,r,s){const c=new Vn(90,1,t,i),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],d=this._renderer,h=d.autoClear,f=d.toneMapping;d.getClearColor(gR),d.toneMapping=Gs,d.autoClear=!1,d.state.buffers.depth.getReversed()&&(d.setRenderTarget(r),d.clearDepth(),d.setRenderTarget(null));const v=new Ks({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),g=new ln(new Nc,v);let m=!1;const y=e.background;y?y.isColor&&(v.color.copy(y),e.background=null,m=!0):(v.color.copy(gR),m=!0);for(let _=0;_<6;_++){const x=_%3;0===x?(c.up.set(0,l[_],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+u[_],s.y,s.z)):1===x?(c.up.set(0,0,l[_]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+u[_],s.z)):(c.up.set(0,l[_],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+u[_]));const w=this._cubeSize;$p(r,x*w,_>2?w:0,w,w),d.setRenderTarget(r),m&&d.render(g,c),d.render(e,c)}g.geometry.dispose(),g.material.dispose(),d.toneMapping=f,d.autoClear=h,e.background=y}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Ws||e.mapping===Do;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=MR()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=xR());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new ln(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const c=this._cubeSize;$p(t,0,0,3*c,2*c),i.setRenderTarget(t),i.render(o,Dx)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]);this._blur(e,s-1,s,o,vR[(r-s-1)%vR.length])}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const c=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const d=new ln(this._lodPlanes[r],l),h=l.uniforms,f=this._sizeLods[i]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/39,v=s/p,g=isFinite(s)?1+Math.floor(3*v):20;g>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to 20`);const m=[];let y=0;for(let D=0;D<20;++D){const I=D/v,b=Math.exp(-I*I/2);m.push(b),0===D?y+=b:D<g&&(y+=2*b)}for(let D=0;D<m.length;D++)m[D]=m[D]/y;h.envMap.value=e.texture,h.samples.value=g,h.weights.value=m,h.latitudinal.value="latitudinal"===o,a&&(h.poleAxis.value=a);const{_lodMax:_}=this;h.dTheta.value=p,h.mipInt.value=_-i;const x=this._sizeLods[r];$p(t,3*x*(r>_-4?r-_+4:0),4*(this._cubeSize-x),3*x,2*x),c.setRenderTarget(t),c.render(d,Dx)}}function _R(n,e,t){const i=new Ni(n,e,t);return i.texture.mapping=Eu,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function $p(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function xR(){return new Rn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function MR(){return new Rn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function yq(n){let e=new WeakMap,t=null;function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);void 0!==l&&(e.delete(c),l.dispose())}return{get:function i(a){if(a&&a.isTexture){const c=a.mapping,l=303===c||304===c,u=c===Ws||c===Do;if(l||u){let d=e.get(a);if(a.isRenderTargetTexture&&a.pmremVersion!==(void 0!==d?d.texture.pmremVersion:0))return null===t&&(t=new yR(n)),d=l?t.fromEquirectangular(a,d):t.fromCubemap(a,d),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),d.texture;if(void 0!==d)return d.texture;{const f=a.image;return l&&f&&f.height>0||u&&f&&function r(a){let c=0;for(let u=0;u<6;u++)void 0!==a[u]&&c++;return 6===c}(f)?(null===t&&(t=new yR(n)),d=l?t.fromEquirectangular(a):t.fromCubemap(a),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),a.addEventListener("dispose",s),d.texture):null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function _q(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return null===r&&Mc("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function xq(n,e,t,i){const r={},s=new WeakMap;function o(d){const h=d.target;null!==h.index&&e.remove(h.index);for(const p in h.attributes)e.remove(h.attributes[p]);h.removeEventListener("dispose",o),delete r[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),i.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,t.memory.geometries--}function l(d){const h=[],f=d.index,p=d.attributes.position;let v=0;if(null!==f){const y=f.array;v=f.version;for(let _=0,x=y.length;_<x;_+=3){const w=y[_+0],C=y[_+1],D=y[_+2];h.push(w,C,C,D,D,w)}}else{if(void 0===p)return;v=p.version;for(let _=0,x=p.array.length/3-1;_<x;_+=3){const w=_+0,C=_+1,D=_+2;h.push(w,C,C,D,D,w)}}const g=new(AI(h)?GI:zI)(h,1);g.version=v;const m=s.get(d);m&&e.remove(m),s.set(d,g)}return{get:function a(d,h){return!0===r[h.id]||(h.addEventListener("dispose",o),r[h.id]=!0,t.memory.geometries++),h},update:function c(d){const h=d.attributes;for(const f in h)e.update(h[f],n.ARRAY_BUFFER)},getWireframeAttribute:function u(d){const h=s.get(d);if(h){const f=d.index;null!==f&&h.version<f.version&&l(d)}else l(d);return s.get(d)}}}function Mq(n,e,t){let i,s,o;function l(h,f,p){0!==p&&(n.drawElementsInstanced(i,f,s,h*o,p),t.update(f,i,p))}this.setMode=function r(h){i=h},this.setIndex=function a(h){s=h.type,o=h.bytesPerElement},this.render=function c(h,f){n.drawElements(i,f,s,h*o),t.update(f,i,1)},this.renderInstances=l,this.renderMultiDraw=function u(h,f,p){if(0===p)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,f,0,s,h,0,p);let g=0;for(let m=0;m<p;m++)g+=f[m];t.update(g,i,1)},this.renderMultiDrawInstances=function d(h,f,p,v){if(0===p)return;const g=e.get("WEBGL_multi_draw");if(null===g)for(let m=0;m<h.length;m++)l(h[m]/o,f[m],v[m]);else{g.multiDrawElementsInstancedWEBGL(i,f,0,s,h,0,v,0,p);let m=0;for(let y=0;y<p;y++)m+=f[y]*v[y];t.update(m,i,1)}}}function Sq(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function bq(n,e,t){const i=new WeakMap,r=new St;return{update:function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,d=void 0!==u?u.length:0;let h=i.get(a);if(void 0===h||h.count!==d){let b=function(){D.dispose(),i.delete(a),a.removeEventListener("dispose",b)};void 0!==h&&h.texture.dispose();const f=void 0!==a.morphAttributes.position,p=void 0!==a.morphAttributes.normal,v=void 0!==a.morphAttributes.color,g=a.morphAttributes.position||[],m=a.morphAttributes.normal||[],y=a.morphAttributes.color||[];let _=0;!0===f&&(_=1),!0===p&&(_=2),!0===v&&(_=3);let x=a.attributes.position.count*_,w=1;x>e.maxTextureSize&&(w=Math.ceil(x/e.maxTextureSize),x=e.maxTextureSize);const C=new Float32Array(x*w*4*d),D=new h0(C,x,w,d);D.type=Di,D.needsUpdate=!0;const I=4*_;for(let S=0;S<d;S++){const R=g[S],B=m[S],V=y[S],H=x*w*4*S;for(let Y=0;Y<R.count;Y++){const W=Y*I;!0===f&&(r.fromBufferAttribute(R,Y),C[H+W+0]=r.x,C[H+W+1]=r.y,C[H+W+2]=r.z,C[H+W+3]=0),!0===p&&(r.fromBufferAttribute(B,Y),C[H+W+4]=r.x,C[H+W+5]=r.y,C[H+W+6]=r.z,C[H+W+7]=0),!0===v&&(r.fromBufferAttribute(V,Y),C[H+W+8]=r.x,C[H+W+9]=r.y,C[H+W+10]=r.z,C[H+W+11]=4===V.itemSize?r.w:1)}}h={count:d,texture:D,size:new q(x,w)},i.set(a,h),a.addEventListener("dispose",b)}if(!0===o.isInstancedMesh&&null!==o.morphTexture)c.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let f=0;for(let v=0;v<l.length;v++)f+=l[v];const p=a.morphTargetsRelative?1:1-f;c.getUniforms().setValue(n,"morphTargetBaseInfluence",p),c.getUniforms().setValue(n,"morphTargetInfluences",l)}c.getUniforms().setValue(n,"morphTargetsTexture",h.texture,t),c.getUniforms().setValue(n,"morphTargetsTextureSize",h.size)}}}function wq(n,e,t,i){let r=new WeakMap;function a(c){const l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),null!==l.instanceColor&&t.remove(l.instanceColor)}return{update:function s(c){const l=i.render.frame,d=e.get(c,c.geometry);if(r.get(d)!==l&&(e.update(d),r.set(d,l)),c.isInstancedMesh&&(!1===c.hasEventListener("dispose",a)&&c.addEventListener("dispose",a),r.get(c)!==l&&(t.update(c.instanceMatrix,n.ARRAY_BUFFER),null!==c.instanceColor&&t.update(c.instanceColor,n.ARRAY_BUFFER),r.set(c,l))),c.isSkinnedMesh){const h=c.skeleton;r.get(h)!==l&&(h.update(),r.set(h,l))}return d},dispose:function o(){r=new WeakMap}}}const SR=new mi,bR=new x1(1,1),wR=new h0,ER=new f0,CR=new sp,TR=[],AR=[],DR=new Float32Array(16),IR=new Float32Array(9),RR=new Float32Array(4);function Qc(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=TR[r];if(void 0===s&&(s=new Float32Array(r),TR[r]=s),0!==e){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function xn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Mn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function qp(n,e){let t=AR[e];void 0===t&&(t=new Int32Array(e),AR[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function Eq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Cq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(xn(t,e))return;n.uniform2fv(this.addr,e),Mn(t,e)}}function Tq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(xn(t,e))return;n.uniform3fv(this.addr,e),Mn(t,e)}}function Aq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(xn(t,e))return;n.uniform4fv(this.addr,e),Mn(t,e)}}function Dq(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(xn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Mn(t,e)}else{if(xn(t,i))return;RR.set(i),n.uniformMatrix2fv(this.addr,!1,RR),Mn(t,i)}}function Iq(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(xn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Mn(t,e)}else{if(xn(t,i))return;IR.set(i),n.uniformMatrix3fv(this.addr,!1,IR),Mn(t,i)}}function Rq(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(xn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Mn(t,e)}else{if(xn(t,i))return;DR.set(i),n.uniformMatrix4fv(this.addr,!1,DR),Mn(t,i)}}function Pq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function Nq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(xn(t,e))return;n.uniform2iv(this.addr,e),Mn(t,e)}}function Lq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(xn(t,e))return;n.uniform3iv(this.addr,e),Mn(t,e)}}function Oq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(xn(t,e))return;n.uniform4iv(this.addr,e),Mn(t,e)}}function Fq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function Uq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(xn(t,e))return;n.uniform2uiv(this.addr,e),Mn(t,e)}}function kq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(xn(t,e))return;n.uniform3uiv(this.addr,e),Mn(t,e)}}function Bq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(xn(t,e))return;n.uniform4uiv(this.addr,e),Mn(t,e)}}function Vq(n,e,t){const i=this.cache,r=t.allocateTextureUnit();let s;i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),this.type===n.SAMPLER_2D_SHADOW?(bR.compareFunction=515,s=bR):s=SR,t.setTexture2D(e||s,r)}function Hq(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||ER,r)}function zq(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||CR,r)}function Gq(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||wR,r)}function jq(n,e){n.uniform1fv(this.addr,e)}function $q(n,e){const t=Qc(e,this.size,2);n.uniform2fv(this.addr,t)}function qq(n,e){const t=Qc(e,this.size,3);n.uniform3fv(this.addr,t)}function Xq(n,e){const t=Qc(e,this.size,4);n.uniform4fv(this.addr,t)}function Yq(n,e){const t=Qc(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function Zq(n,e){const t=Qc(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function Jq(n,e){const t=Qc(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function Kq(n,e){n.uniform1iv(this.addr,e)}function Qq(n,e){n.uniform2iv(this.addr,e)}function eX(n,e){n.uniform3iv(this.addr,e)}function tX(n,e){n.uniform4iv(this.addr,e)}function nX(n,e){n.uniform1uiv(this.addr,e)}function iX(n,e){n.uniform2uiv(this.addr,e)}function rX(n,e){n.uniform3uiv(this.addr,e)}function sX(n,e){n.uniform4uiv(this.addr,e)}function oX(n,e,t){const i=this.cache,r=e.length,s=qp(t,r);xn(i,s)||(n.uniform1iv(this.addr,s),Mn(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||SR,s[o])}function aX(n,e,t){const i=this.cache,r=e.length,s=qp(t,r);xn(i,s)||(n.uniform1iv(this.addr,s),Mn(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||ER,s[o])}function cX(n,e,t){const i=this.cache,r=e.length,s=qp(t,r);xn(i,s)||(n.uniform1iv(this.addr,s),Mn(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||CR,s[o])}function lX(n,e,t){const i=this.cache,r=e.length,s=qp(t,r);xn(i,s)||(n.uniform1iv(this.addr,s),Mn(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||wR,s[o])}class dX{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=function Wq(n){switch(n){case 5126:return Eq;case 35664:return Cq;case 35665:return Tq;case 35666:return Aq;case 35674:return Dq;case 35675:return Iq;case 35676:return Rq;case 5124:case 35670:return Pq;case 35667:case 35671:return Nq;case 35668:case 35672:return Lq;case 35669:case 35673:return Oq;case 5125:return Fq;case 36294:return Uq;case 36295:return kq;case 36296:return Bq;case 35678:case 36198:case 36298:case 36306:case 35682:return Vq;case 35679:case 36299:case 36307:return Hq;case 35680:case 36300:case 36308:case 36293:return zq;case 36289:case 36303:case 36311:case 36292:return Gq}}(t.type)}}class hX{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function uX(n){switch(n){case 5126:return jq;case 35664:return $q;case 35665:return qq;case 35666:return Xq;case 35674:return Yq;case 35675:return Zq;case 35676:return Jq;case 5124:case 35670:return Kq;case 35667:case 35671:return Qq;case 35668:case 35672:return eX;case 35669:case 35673:return tX;case 5125:return nX;case 36294:return iX;case 36295:return rX;case 36296:return sX;case 35678:case 36198:case 36298:case 36306:case 35682:return oX;case 35679:case 36299:case 36307:return aX;case 35680:case 36300:case 36308:case 36293:return cX;case 36289:case 36303:case 36311:case 36292:return lX}}(t.type)}}class fX{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const Ox=/(\w+)(\])?(\[|\.)?/g;function PR(n,e){n.seq.push(e),n.map[e.id]=e}function pX(n,e,t){const i=n.name,r=i.length;for(Ox.lastIndex=0;;){const s=Ox.exec(i);let a=s[1];const l=s[3];if("]"===s[2]&&(a|=0),void 0===l||"["===l&&Ox.lastIndex+2===r){PR(t,void 0===l?new dX(a,n,e):new hX(a,n,e));break}{let d=t.map[a];void 0===d&&(d=new fX(a),PR(t,d)),t=d}}}class Xp{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r);pX(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,i,r){const s=this.map[t];void 0!==s&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],c=i[a.id];!1!==c.needsUpdate&&a.setValue(e,c.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function NR(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const mX=37297;let gX=0;const LR=new ut;function OR(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=(n.getShaderInfoLog(e)||"").trim();if(i&&""===s)return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const a=parseInt(o[1]);return t.toUpperCase()+"\n\n"+s+"\n\n"+function vX(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join("\n")}(n.getShaderSource(e),a)}return s}function _X(n,e){const t=function yX(n){xt._getMatrix(LR,xt.workingColorSpace,n);const e=`mat3( ${LR.elements.map(t=>t.toFixed(4))} )`;switch(xt.getTransfer(n)){case Vf:return[e,"LinearTransferOETF"];case Ft:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}(e);return[`vec4 ${n}( vec4 value ) {`,`\treturn ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join("\n")}function xX(n,e){let t;switch(e){case YW:t="Linear";break;case ZW:t="Reinhard";break;case JW:t="Cineon";break;case KW:t="ACESFilmic";break;case ej:t="AgX";break;case tj:t="Neutral";break;case QW:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Yp=new T;function rd(n){return""!==n}function FR(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function UR(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const EX=/^[ \t]*#include +<([\w\d./]+)>/gm;function Fx(n){return n.replace(EX,TX)}const CX=new Map;function TX(n,e){let t=pt[e];if(void 0===t){const i=CX.get(e);if(void 0===i)throw new Error("Can not resolve #include <"+e+">");t=pt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i)}return Fx(t)}const AX=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function kR(n){return n.replace(AX,DX)}function DX(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function BR(n){let e=`precision ${n.precision} float;\n\tprecision ${n.precision} int;\n\tprecision ${n.precision} sampler2D;\n\tprecision ${n.precision} samplerCube;\n\tprecision ${n.precision} sampler3D;\n\tprecision ${n.precision} sampler2DArray;\n\tprecision ${n.precision} sampler2DShadow;\n\tprecision ${n.precision} samplerCubeShadow;\n\tprecision ${n.precision} sampler2DArrayShadow;\n\tprecision ${n.precision} isampler2D;\n\tprecision ${n.precision} isampler3D;\n\tprecision ${n.precision} isamplerCube;\n\tprecision ${n.precision} isampler2DArray;\n\tprecision ${n.precision} usampler2D;\n\tprecision ${n.precision} usampler3D;\n\tprecision ${n.precision} usamplerCube;\n\tprecision ${n.precision} usampler2DArray;\n\t`;return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function OX(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=function IX(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===uI?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===AW?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===rs&&(e="SHADOWMAP_TYPE_VSM"),e}(t),l=function RX(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ws:case Do:e="ENVMAP_TYPE_CUBE";break;case Eu:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),u=function PX(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&n.envMapMode===Do&&(e="ENVMAP_MODE_REFRACTION"),e}(t),d=function NX(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Cf:e="ENVMAP_BLENDING_MULTIPLY";break;case qW:e="ENVMAP_BLENDING_MIX";break;case XW:e="ENVMAP_BLENDING_ADD"}return e}(t),h=function LX(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),f=function SX(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(rd).join("\n")}(t),p=function bX(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(s),v=r.createProgram();let g,m,y=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(rd).join("\n"),g.length>0&&(g+="\n"),m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(rd).join("\n"),m.length>0&&(m+="\n")):(g=[BR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reversedDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(rd).join("\n"),m=[BR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reversedDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Gs?"#define TONE_MAPPING":"",t.toneMapping!==Gs?pt.tonemapping_pars_fragment:"",t.toneMapping!==Gs?xX("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",pt.colorspace_pars_fragment,_X("linearToOutputTexel",t.outputColorSpace),(xt.getLuminanceCoefficients(Yp),["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${Yp.x.toFixed(4)}, ${Yp.y.toFixed(4)}, ${Yp.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(rd).join("\n")),o=Fx(o),o=FR(o,t),o=UR(o,t),a=Fx(a),a=FR(a,t),a=UR(a,t),o=kR(o),a=kR(a),!0!==t.isRawShaderMaterial&&(y="#version 300 es\n",g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,m=["#define varying in",t.glslVersion===EI?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===EI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+m);const x=y+m+a,w=NR(r,r.VERTEX_SHADER,y+g+o),C=NR(r,r.FRAGMENT_SHADER,x);function D(R){if(n.debug.checkShaderErrors){const B=r.getProgramInfoLog(v)||"",V=r.getShaderInfoLog(w)||"",H=r.getShaderInfoLog(C)||"",Y=B.trim(),W=V.trim(),ie=H.trim();let G=!0,pe=!0;if(!1===r.getProgramParameter(v,r.LINK_STATUS))if(G=!1,"function"==typeof n.debug.onShaderError)n.debug.onShaderError(r,v,w,C);else{const Me=OR(r,w,"vertex"),Ae=OR(r,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(v,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+R.name+"\nMaterial Type: "+R.type+"\n\nProgram Info Log: "+Y+"\n"+Me+"\n"+Ae)}else""!==Y?console.warn("THREE.WebGLProgram: Program Info Log:",Y):(""===W||""===ie)&&(pe=!1);pe&&(R.diagnostics={runnable:G,programLog:Y,vertexShader:{log:W,prefix:g},fragmentShader:{log:ie,prefix:m}})}r.deleteShader(w),r.deleteShader(C),I=new Xp(r,v),b=function wX(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(r,v)}let I,b;r.attachShader(v,w),r.attachShader(v,C),void 0!==t.index0AttributeName?r.bindAttribLocation(v,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v),this.getUniforms=function(){return void 0===I&&D(this),I},this.getAttributes=function(){return void 0===b&&D(this),b};let S=!1===t.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===S&&(S=r.getProgramParameter(v,mX)),S},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=gX++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=C,this}let FX=0;class UX{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new kX(e),t.set(e,i)),i}}class kX{constructor(e){this.id=FX++,this.code=e,this.usedTimes=0}}function BX(n,e,t,i,r,s,o){const a=new _0,c=new UX,l=new Set,u=[],d=r.logarithmicDepthBuffer,h=r.vertexTextures;let f=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(b){return l.add(b),0===b?"uv":`uv${b}`}return{getParameters:function g(b,S,R,B,V){const H=B.fog,Y=V.geometry,ie=(b.isMeshStandardMaterial?t:e).get(b.envMap||(b.isMeshStandardMaterial?B.environment:null)),G=ie&&ie.mapping===Eu?ie.image.height:null,pe=p[b.type];null!==b.precision&&(f=r.getMaxPrecision(b.precision),f!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",f,"instead."));const Me=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,Ae=void 0!==Me?Me.length:0;let bt,wt,$,me,it=0;if(void 0!==Y.morphAttributes.position&&(it=1),void 0!==Y.morphAttributes.normal&&(it=2),void 0!==Y.morphAttributes.color&&(it=3),pe){const Rt=Fr[pe];bt=Rt.vertexShader,wt=Rt.fragmentShader}else bt=b.vertexShader,wt=b.fragmentShader,c.update(b),$=c.getVertexShaderID(b),me=c.getFragmentShaderID(b);const de=n.getRenderTarget(),ke=n.state.buffers.depth.getReversed(),Ne=!0===V.isInstancedMesh,We=!0===V.isBatchedMesh,Yt=!!b.map,P=!!ie,Q=!!b.aoMap,X=!!b.lightMap,te=!!b.bumpMap,J=!!b.normalMap,ue=!!b.displacementMap,ne=!!b.emissiveMap,he=!!b.metalnessMap,ot=!!b.roughnessMap,tt=b.anisotropy>0,A=b.clearcoat>0,F=b.iridescence>0,z=b.sheen>0,ee=b.transmission>0,j=tt&&!!b.anisotropyMap,Le=A&&!!b.clearcoatMap,le=A&&!!b.clearcoatNormalMap,Ie=A&&!!b.clearcoatRoughnessMap,Re=F&&!!b.iridescenceMap,re=F&&!!b.iridescenceThicknessMap,Se=z&&!!b.sheenColorMap,Xe=z&&!!b.sheenRoughnessMap,Fe=!!b.specularMap,_e=!!b.specularColorMap,ft=!!b.specularIntensityMap,N=ee&&!!b.transmissionMap,ae=ee&&!!b.thicknessMap,Ce=!!b.alphaMap,Pe=!!b.extensions;let at=Gs;b.toneMapped&&(null===de||!0===de.isXRRenderTarget)&&(at=n.toneMapping);const $t={shaderID:pe,shaderType:b.type,shaderName:b.name,vertexShader:bt,fragmentShader:wt,defines:b.defines,customVertexShaderID:$,customFragmentShaderID:me,isRawShaderMaterial:!0===b.isRawShaderMaterial,glslVersion:b.glslVersion,precision:f,batching:We,batchingColor:We&&null!==V._colorsTexture,instancing:Ne,instancingColor:Ne&&null!==V.instanceColor,instancingMorph:Ne&&null!==V.morphTexture,supportsVertexTextures:h,outputColorSpace:null===de?n.outputColorSpace:!0===de.isXRRenderTarget?de.texture.colorSpace:vc,alphaToCoverage:!!b.alphaToCoverage,map:Yt,matcap:!!b.matcap,envMap:P,envMapMode:P&&ie.mapping,envMapCubeUVHeight:G,aoMap:Q,lightMap:X,bumpMap:te,normalMap:J,displacementMap:h&&ue,emissiveMap:ne,normalMapObjectSpace:J&&1===b.normalMapType,normalMapTangentSpace:J&&0===b.normalMapType,metalnessMap:he,roughnessMap:ot,anisotropy:tt,anisotropyMap:j,clearcoat:A,clearcoatMap:Le,clearcoatNormalMap:le,clearcoatRoughnessMap:Ie,dispersion:b.dispersion>0,iridescence:F,iridescenceMap:Re,iridescenceThicknessMap:re,sheen:z,sheenColorMap:Se,sheenRoughnessMap:Xe,specularMap:Fe,specularColorMap:_e,specularIntensityMap:ft,transmission:ee,transmissionMap:N,thicknessMap:ae,gradientMap:!!b.gradientMap,opaque:!1===b.transparent&&1===b.blending&&!1===b.alphaToCoverage,alphaMap:Ce,alphaTest:b.alphaTest>0,alphaHash:!!b.alphaHash,combine:b.combine,mapUv:Yt&&v(b.map.channel),aoMapUv:Q&&v(b.aoMap.channel),lightMapUv:X&&v(b.lightMap.channel),bumpMapUv:te&&v(b.bumpMap.channel),normalMapUv:J&&v(b.normalMap.channel),displacementMapUv:ue&&v(b.displacementMap.channel),emissiveMapUv:ne&&v(b.emissiveMap.channel),metalnessMapUv:he&&v(b.metalnessMap.channel),roughnessMapUv:ot&&v(b.roughnessMap.channel),anisotropyMapUv:j&&v(b.anisotropyMap.channel),clearcoatMapUv:Le&&v(b.clearcoatMap.channel),clearcoatNormalMapUv:le&&v(b.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ie&&v(b.clearcoatRoughnessMap.channel),iridescenceMapUv:Re&&v(b.iridescenceMap.channel),iridescenceThicknessMapUv:re&&v(b.iridescenceThicknessMap.channel),sheenColorMapUv:Se&&v(b.sheenColorMap.channel),sheenRoughnessMapUv:Xe&&v(b.sheenRoughnessMap.channel),specularMapUv:Fe&&v(b.specularMap.channel),specularColorMapUv:_e&&v(b.specularColorMap.channel),specularIntensityMapUv:ft&&v(b.specularIntensityMap.channel),transmissionMapUv:N&&v(b.transmissionMap.channel),thicknessMapUv:ae&&v(b.thicknessMap.channel),alphaMapUv:Ce&&v(b.alphaMap.channel),vertexTangents:!!Y.attributes.tangent&&(J||tt),vertexColors:b.vertexColors,vertexAlphas:!0===b.vertexColors&&!!Y.attributes.color&&4===Y.attributes.color.itemSize,pointsUvs:!0===V.isPoints&&!!Y.attributes.uv&&(Yt||Ce),fog:!!H,useFog:!0===b.fog,fogExp2:!!H&&H.isFogExp2,flatShading:!0===b.flatShading&&!1===b.wireframe,sizeAttenuation:!0===b.sizeAttenuation,logarithmicDepthBuffer:d,reversedDepthBuffer:ke,skinning:!0===V.isSkinnedMesh,morphTargets:void 0!==Y.morphAttributes.position,morphNormals:void 0!==Y.morphAttributes.normal,morphColors:void 0!==Y.morphAttributes.color,morphTargetsCount:Ae,morphTextureStride:it,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numLightProbes:S.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:b.dithering,shadowMapEnabled:n.shadowMap.enabled&&R.length>0,shadowMapType:n.shadowMap.type,toneMapping:at,decodeVideoTexture:Yt&&!0===b.map.isVideoTexture&&xt.getTransfer(b.map.colorSpace)===Ft,decodeVideoTextureEmissive:ne&&!0===b.emissiveMap.isVideoTexture&&xt.getTransfer(b.emissiveMap.colorSpace)===Ft,premultipliedAlpha:b.premultipliedAlpha,doubleSided:2===b.side,flipSided:1===b.side,useDepthPacking:b.depthPacking>=0,depthPacking:b.depthPacking||0,index0AttributeName:b.index0AttributeName,extensionClipCullDistance:Pe&&!0===b.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Pe&&!0===b.extensions.multiDraw||We)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:b.customProgramCacheKey()};return $t.vertexUv1s=l.has(1),$t.vertexUv2s=l.has(2),$t.vertexUv3s=l.has(3),l.clear(),$t},getProgramCacheKey:function m(b){const S=[];if(b.shaderID?S.push(b.shaderID):(S.push(b.customVertexShaderID),S.push(b.customFragmentShaderID)),void 0!==b.defines)for(const R in b.defines)S.push(R),S.push(b.defines[R]);return!1===b.isRawShaderMaterial&&(function y(b,S){b.push(S.precision),b.push(S.outputColorSpace),b.push(S.envMapMode),b.push(S.envMapCubeUVHeight),b.push(S.mapUv),b.push(S.alphaMapUv),b.push(S.lightMapUv),b.push(S.aoMapUv),b.push(S.bumpMapUv),b.push(S.normalMapUv),b.push(S.displacementMapUv),b.push(S.emissiveMapUv),b.push(S.metalnessMapUv),b.push(S.roughnessMapUv),b.push(S.anisotropyMapUv),b.push(S.clearcoatMapUv),b.push(S.clearcoatNormalMapUv),b.push(S.clearcoatRoughnessMapUv),b.push(S.iridescenceMapUv),b.push(S.iridescenceThicknessMapUv),b.push(S.sheenColorMapUv),b.push(S.sheenRoughnessMapUv),b.push(S.specularMapUv),b.push(S.specularColorMapUv),b.push(S.specularIntensityMapUv),b.push(S.transmissionMapUv),b.push(S.thicknessMapUv),b.push(S.combine),b.push(S.fogExp2),b.push(S.sizeAttenuation),b.push(S.morphTargetsCount),b.push(S.morphAttributeCount),b.push(S.numDirLights),b.push(S.numPointLights),b.push(S.numSpotLights),b.push(S.numSpotLightMaps),b.push(S.numHemiLights),b.push(S.numRectAreaLights),b.push(S.numDirLightShadows),b.push(S.numPointLightShadows),b.push(S.numSpotLightShadows),b.push(S.numSpotLightShadowsWithMaps),b.push(S.numLightProbes),b.push(S.shadowMapType),b.push(S.toneMapping),b.push(S.numClippingPlanes),b.push(S.numClipIntersection),b.push(S.depthPacking)}(S,b),function _(b,S){a.disableAll(),S.supportsVertexTextures&&a.enable(0),S.instancing&&a.enable(1),S.instancingColor&&a.enable(2),S.instancingMorph&&a.enable(3),S.matcap&&a.enable(4),S.envMap&&a.enable(5),S.normalMapObjectSpace&&a.enable(6),S.normalMapTangentSpace&&a.enable(7),S.clearcoat&&a.enable(8),S.iridescence&&a.enable(9),S.alphaTest&&a.enable(10),S.vertexColors&&a.enable(11),S.vertexAlphas&&a.enable(12),S.vertexUv1s&&a.enable(13),S.vertexUv2s&&a.enable(14),S.vertexUv3s&&a.enable(15),S.vertexTangents&&a.enable(16),S.anisotropy&&a.enable(17),S.alphaHash&&a.enable(18),S.batching&&a.enable(19),S.dispersion&&a.enable(20),S.batchingColor&&a.enable(21),S.gradientMap&&a.enable(22),b.push(a.mask),a.disableAll(),S.fog&&a.enable(0),S.useFog&&a.enable(1),S.flatShading&&a.enable(2),S.logarithmicDepthBuffer&&a.enable(3),S.reversedDepthBuffer&&a.enable(4),S.skinning&&a.enable(5),S.morphTargets&&a.enable(6),S.morphNormals&&a.enable(7),S.morphColors&&a.enable(8),S.premultipliedAlpha&&a.enable(9),S.shadowMapEnabled&&a.enable(10),S.doubleSided&&a.enable(11),S.flipSided&&a.enable(12),S.useDepthPacking&&a.enable(13),S.dithering&&a.enable(14),S.transmission&&a.enable(15),S.sheen&&a.enable(16),S.opaque&&a.enable(17),S.pointsUvs&&a.enable(18),S.decodeVideoTexture&&a.enable(19),S.decodeVideoTextureEmissive&&a.enable(20),S.alphaToCoverage&&a.enable(21),b.push(a.mask)}(S,b),S.push(n.outputColorSpace)),S.push(b.customProgramCacheKey),S.join()},getUniforms:function x(b){const S=p[b.type];let R;return R=S?rp.clone(Fr[S].uniforms):b.uniforms,R},acquireProgram:function w(b,S){let R;for(let B=0,V=u.length;B<V;B++){const H=u[B];if(H.cacheKey===S){R=H,++R.usedTimes;break}}return void 0===R&&(R=new OX(n,S,b,s),u.push(R)),R},releaseProgram:function C(b){if(0==--b.usedTimes){const S=u.indexOf(b);u[S]=u[u.length-1],u.pop(),b.destroy()}},releaseShaderCache:function D(b){c.remove(b)},programs:u,dispose:function I(){c.dispose()}}}function VX(){let n=new WeakMap;return{has:function e(o){return n.has(o)},get:function t(o){let a=n.get(o);return void 0===a&&(a={},n.set(o,a)),a},remove:function i(o){n.delete(o)},update:function r(o,a,c){n.get(o)[a]=c},dispose:function s(){n=new WeakMap}}}function HX(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function VR(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function HR(){const n=[];let e=0;const t=[],i=[],r=[];function o(d,h,f,p,v,g){let m=n[e];return void 0===m?(m={id:d.id,object:d,geometry:h,material:f,groupOrder:p,renderOrder:d.renderOrder,z:v,group:g},n[e]=m):(m.id=d.id,m.object=d,m.geometry=h,m.material=f,m.groupOrder=p,m.renderOrder=d.renderOrder,m.z=v,m.group=g),e++,m}return{opaque:t,transmissive:i,transparent:r,init:function s(){e=0,t.length=0,i.length=0,r.length=0},push:function a(d,h,f,p,v,g){const m=o(d,h,f,p,v,g);f.transmission>0?i.push(m):!0===f.transparent?r.push(m):t.push(m)},unshift:function c(d,h,f,p,v,g){const m=o(d,h,f,p,v,g);f.transmission>0?i.unshift(m):!0===f.transparent?r.unshift(m):t.unshift(m)},finish:function u(){for(let d=e,h=n.length;d<h;d++){const f=n[d];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function l(d,h){t.length>1&&t.sort(d||HX),i.length>1&&i.sort(h||VR),r.length>1&&r.sort(h||VR)}}}function zX(){let n=new WeakMap;return{get:function e(i,r){const s=n.get(i);let o;return void 0===s?(o=new HR,n.set(i,[o])):r>=s.length?(o=new HR,s.push(o)):o=s[r],o},dispose:function t(){n=new WeakMap}}}function GX(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new T,color:new xe};break;case"SpotLight":t={position:new T,direction:new T,color:new xe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new T,color:new xe,distance:0,decay:0};break;case"HemisphereLight":t={direction:new T,skyColor:new xe,groundColor:new xe};break;case"RectAreaLight":t={color:new xe,position:new T,halfWidth:new T,halfHeight:new T}}return n[e.id]=t,t}}}let jX=0;function $X(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function qX(n){const e=new GX,t=function WX(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new q};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new q,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)i.probe.push(new T);const r=new T,s=new Ze,o=new Ze;return{setup:function a(l){let u=0,d=0,h=0;for(let b=0;b<9;b++)i.probe[b].set(0,0,0);let f=0,p=0,v=0,g=0,m=0,y=0,_=0,x=0,w=0,C=0,D=0;l.sort($X);for(let b=0,S=l.length;b<S;b++){const R=l[b],B=R.color,V=R.intensity,H=R.distance,Y=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)u+=B.r*V,d+=B.g*V,h+=B.b*V;else if(R.isLightProbe){for(let W=0;W<9;W++)i.probe[W].addScaledVector(R.sh.coefficients[W],V);D++}else if(R.isDirectionalLight){const W=e.get(R);if(W.color.copy(R.color).multiplyScalar(R.intensity),R.castShadow){const ie=R.shadow,G=t.get(R);G.shadowIntensity=ie.intensity,G.shadowBias=ie.bias,G.shadowNormalBias=ie.normalBias,G.shadowRadius=ie.radius,G.shadowMapSize=ie.mapSize,i.directionalShadow[f]=G,i.directionalShadowMap[f]=Y,i.directionalShadowMatrix[f]=R.shadow.matrix,y++}i.directional[f]=W,f++}else if(R.isSpotLight){const W=e.get(R);W.position.setFromMatrixPosition(R.matrixWorld),W.color.copy(B).multiplyScalar(V),W.distance=H,W.coneCos=Math.cos(R.angle),W.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),W.decay=R.decay,i.spot[v]=W;const ie=R.shadow;if(R.map&&(i.spotLightMap[w]=R.map,w++,ie.updateMatrices(R),R.castShadow&&C++),i.spotLightMatrix[v]=ie.matrix,R.castShadow){const G=t.get(R);G.shadowIntensity=ie.intensity,G.shadowBias=ie.bias,G.shadowNormalBias=ie.normalBias,G.shadowRadius=ie.radius,G.shadowMapSize=ie.mapSize,i.spotShadow[v]=G,i.spotShadowMap[v]=Y,x++}v++}else if(R.isRectAreaLight){const W=e.get(R);W.color.copy(B).multiplyScalar(V),W.halfWidth.set(.5*R.width,0,0),W.halfHeight.set(0,.5*R.height,0),i.rectArea[g]=W,g++}else if(R.isPointLight){const W=e.get(R);if(W.color.copy(R.color).multiplyScalar(R.intensity),W.distance=R.distance,W.decay=R.decay,R.castShadow){const ie=R.shadow,G=t.get(R);G.shadowIntensity=ie.intensity,G.shadowBias=ie.bias,G.shadowNormalBias=ie.normalBias,G.shadowRadius=ie.radius,G.shadowMapSize=ie.mapSize,G.shadowCameraNear=ie.camera.near,G.shadowCameraFar=ie.camera.far,i.pointShadow[p]=G,i.pointShadowMap[p]=Y,i.pointShadowMatrix[p]=R.shadow.matrix,_++}i.point[p]=W,p++}else if(R.isHemisphereLight){const W=e.get(R);W.skyColor.copy(R.color).multiplyScalar(V),W.groundColor.copy(R.groundColor).multiplyScalar(V),i.hemi[m]=W,m++}}g>0&&(!0===n.has("OES_texture_float_linear")?(i.rectAreaLTC1=ge.LTC_FLOAT_1,i.rectAreaLTC2=ge.LTC_FLOAT_2):(i.rectAreaLTC1=ge.LTC_HALF_1,i.rectAreaLTC2=ge.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=d,i.ambient[2]=h;const I=i.hash;(I.directionalLength!==f||I.pointLength!==p||I.spotLength!==v||I.rectAreaLength!==g||I.hemiLength!==m||I.numDirectionalShadows!==y||I.numPointShadows!==_||I.numSpotShadows!==x||I.numSpotMaps!==w||I.numLightProbes!==D)&&(i.directional.length=f,i.spot.length=v,i.rectArea.length=g,i.point.length=p,i.hemi.length=m,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=_,i.pointShadowMap.length=_,i.spotShadow.length=x,i.spotShadowMap.length=x,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=_,i.spotLightMatrix.length=x+w-C,i.spotLightMap.length=w,i.numSpotLightShadowsWithMaps=C,i.numLightProbes=D,I.directionalLength=f,I.pointLength=p,I.spotLength=v,I.rectAreaLength=g,I.hemiLength=m,I.numDirectionalShadows=y,I.numPointShadows=_,I.numSpotShadows=x,I.numSpotMaps=w,I.numLightProbes=D,i.version=jX++)},setupView:function c(l,u){let d=0,h=0,f=0,p=0,v=0;const g=u.matrixWorldInverse;for(let m=0,y=l.length;m<y;m++){const _=l[m];if(_.isDirectionalLight){const x=i.directional[d];x.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),d++}else if(_.isSpotLight){const x=i.spot[f];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(g),x.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),f++}else if(_.isRectAreaLight){const x=i.rectArea[p];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(g),o.identity(),s.copy(_.matrixWorld),s.premultiply(g),o.extractRotation(s),x.halfWidth.set(.5*_.width,0,0),x.halfHeight.set(0,.5*_.height,0),x.halfWidth.applyMatrix4(o),x.halfHeight.applyMatrix4(o),p++}else if(_.isPointLight){const x=i.point[h];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(g),h++}else if(_.isHemisphereLight){const x=i.hemi[v];x.direction.setFromMatrixPosition(_.matrixWorld),x.direction.transformDirection(g),v++}}},state:i}}function zR(n){const e=new qX(n),t=[],i=[],l={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function r(u){l.camera=u,t.length=0,i.length=0},state:l,setupLights:function a(){e.setup(t)},setupLightsView:function c(u){e.setupView(t,u)},pushLight:function s(u){t.push(u)},pushShadow:function o(u){i.push(u)}}}function XX(n){let e=new WeakMap;return{get:function t(r,s=0){const o=e.get(r);let a;return void 0===o?(a=new zR(n),e.set(r,[a])):s>=o.length?(a=new zR(n),o.push(a)):a=o[s],a},dispose:function i(){e=new WeakMap}}}function JX(n,e,t){let i=new qu;const r=new q,s=new q,o=new St,a=new U1({depthPacking:3201}),c=new k1,l={},u=t.maxTextureSize,d={0:1,1:0,2:2},h=new Rn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new q},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new dt;p.setAttribute("position",new Bt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new ln(p,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=uI;let m=this.type;function y(C,D){const I=e.update(v);h.defines.VSM_SAMPLES!==C.blurSamples&&(h.defines.VSM_SAMPLES=C.blurSamples,f.defines.VSM_SAMPLES=C.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),null===C.mapPass&&(C.mapPass=new Ni(r.x,r.y)),h.uniforms.shadow_pass.value=C.map.texture,h.uniforms.resolution.value=C.mapSize,h.uniforms.radius.value=C.radius,n.setRenderTarget(C.mapPass),n.clear(),n.renderBufferDirect(D,null,I,h,v,null),f.uniforms.shadow_pass.value=C.mapPass.texture,f.uniforms.resolution.value=C.mapSize,f.uniforms.radius.value=C.radius,n.setRenderTarget(C.map),n.clear(),n.renderBufferDirect(D,null,I,f,v,null)}function _(C,D,I,b){let S=null;const R=!0===I.isPointLight?C.customDistanceMaterial:C.customDepthMaterial;if(void 0!==R)S=R;else if(S=!0===I.isPointLight?c:a,n.localClippingEnabled&&!0===D.clipShadows&&Array.isArray(D.clippingPlanes)&&0!==D.clippingPlanes.length||D.displacementMap&&0!==D.displacementScale||D.alphaMap&&D.alphaTest>0||D.map&&D.alphaTest>0||!0===D.alphaToCoverage){const B=S.uuid,V=D.uuid;let H=l[B];void 0===H&&(H={},l[B]=H);let Y=H[V];void 0===Y&&(Y=S.clone(),H[V]=Y,D.addEventListener("dispose",w)),S=Y}return S.visible=D.visible,S.wireframe=D.wireframe,S.side=b===rs?null!==D.shadowSide?D.shadowSide:D.side:null!==D.shadowSide?D.shadowSide:d[D.side],S.alphaMap=D.alphaMap,S.alphaTest=!0===D.alphaToCoverage?.5:D.alphaTest,S.map=D.map,S.clipShadows=D.clipShadows,S.clippingPlanes=D.clippingPlanes,S.clipIntersection=D.clipIntersection,S.displacementMap=D.displacementMap,S.displacementScale=D.displacementScale,S.displacementBias=D.displacementBias,S.wireframeLinewidth=D.wireframeLinewidth,S.linewidth=D.linewidth,!0===I.isPointLight&&!0===S.isMeshDistanceMaterial&&(n.properties.get(S).light=I),S}function x(C,D,I,b,S){if(!1===C.visible)return;if(C.layers.test(D.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&S===rs)&&(!C.frustumCulled||i.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,C.matrixWorld);const V=e.update(C),H=C.material;if(Array.isArray(H)){const Y=V.groups;for(let W=0,ie=Y.length;W<ie;W++){const G=Y[W],pe=H[G.materialIndex];if(pe&&pe.visible){const Me=_(C,pe,b,S);C.onBeforeShadow(n,C,D,I,V,Me,G),n.renderBufferDirect(I,null,V,Me,C,G),C.onAfterShadow(n,C,D,I,V,Me,G)}}}else if(H.visible){const Y=_(C,H,b,S);C.onBeforeShadow(n,C,D,I,V,Y,null),n.renderBufferDirect(I,null,V,Y,C,null),C.onAfterShadow(n,C,D,I,V,Y,null)}}const B=C.children;for(let V=0,H=B.length;V<H;V++)x(B[V],D,I,b,S)}function w(C){C.target.removeEventListener("dispose",w);for(const I in l){const b=l[I],S=C.target.uuid;S in b&&(b[S].dispose(),delete b[S])}}this.render=function(C,D,I){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===C.length)return;const b=n.getRenderTarget(),S=n.getActiveCubeFace(),R=n.getActiveMipmapLevel(),B=n.state;B.setBlending(0),B.buffers.depth.getReversed()?B.buffers.color.setClear(0,0,0,0):B.buffers.color.setClear(1,1,1,1),B.buffers.depth.setTest(!0),B.setScissorTest(!1);const V=m!==rs&&this.type===rs,H=m===rs&&this.type!==rs;for(let Y=0,W=C.length;Y<W;Y++){const ie=C[Y],G=ie.shadow;if(void 0===G){console.warn("THREE.WebGLShadowMap:",ie,"has no shadow.");continue}if(!1===G.autoUpdate&&!1===G.needsUpdate)continue;r.copy(G.mapSize);const pe=G.getFrameExtents();if(r.multiply(pe),s.copy(G.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/pe.x),r.x=s.x*pe.x,G.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/pe.y),r.y=s.y*pe.y,G.mapSize.y=s.y)),null===G.map||!0===V||!0===H){const Ae=this.type!==rs?{minFilter:Fn,magFilter:Fn}:{};null!==G.map&&G.map.dispose(),G.map=new Ni(r.x,r.y,Ae),G.map.texture.name=ie.name+".shadowMap",G.camera.updateProjectionMatrix()}n.setRenderTarget(G.map),n.clear();const Me=G.getViewportCount();for(let Ae=0;Ae<Me;Ae++){const it=G.getViewport(Ae);o.set(s.x*it.x,s.y*it.y,s.x*it.z,s.y*it.w),B.viewport(o),G.updateMatrices(ie,Ae),i=G.getFrustum(),x(D,I,G.camera,ie,this.type)}!0!==G.isPointLightShadow&&this.type===rs&&y(G,I),G.needsUpdate=!1}m=this.type,g.needsUpdate=!1,n.setRenderTarget(b,S,R)}}const KX={0:1,2:6,4:7,3:5,1:0,6:2,7:4,5:3};function QX(n,e){const s=new function t(){let N=!1;const ae=new St;let fe=null;const Ce=new St(0,0,0,0);return{setMask:function(se){fe!==se&&!N&&(n.colorMask(se,se,se,se),fe=se)},setLocked:function(se){N=se},setClear:function(se,K,Pe,at,$t){!0===$t&&(se*=at,K*=at,Pe*=at),ae.set(se,K,Pe,at),!1===Ce.equals(ae)&&(n.clearColor(se,K,Pe,at),Ce.copy(ae))},reset:function(){N=!1,fe=null,Ce.set(-1,0,0,0)}}},o=new function i(){let N=!1,ae=!1,fe=null,Ce=null,se=null;return{setReversed:function(K){if(ae!==K){const Pe=e.get("EXT_clip_control");Pe.clipControlEXT(Pe.LOWER_LEFT_EXT,K?Pe.ZERO_TO_ONE_EXT:Pe.NEGATIVE_ONE_TO_ONE_EXT),ae=K;const at=se;se=null,this.setClear(at)}},getReversed:function(){return ae},setTest:function(K){K?de(n.DEPTH_TEST):ke(n.DEPTH_TEST)},setMask:function(K){fe!==K&&!N&&(n.depthMask(K),fe=K)},setFunc:function(K){if(ae&&(K=KX[K]),Ce!==K){switch(K){case 0:n.depthFunc(n.NEVER);break;case 1:n.depthFunc(n.ALWAYS);break;case 2:n.depthFunc(n.LESS);break;case 3:default:n.depthFunc(n.LEQUAL);break;case 4:n.depthFunc(n.EQUAL);break;case 5:n.depthFunc(n.GEQUAL);break;case 6:n.depthFunc(n.GREATER);break;case 7:n.depthFunc(n.NOTEQUAL)}Ce=K}},setLocked:function(K){N=K},setClear:function(K){se!==K&&(ae&&(K=1-K),n.clearDepth(K),se=K)},reset:function(){N=!1,fe=null,Ce=null,se=null,ae=!1}}},a=new function r(){let N=!1,ae=null,fe=null,Ce=null,se=null,K=null,Pe=null,at=null,$t=null;return{setTest:function(Rt){N||(Rt?de(n.STENCIL_TEST):ke(n.STENCIL_TEST))},setMask:function(Rt){ae!==Rt&&!N&&(n.stencilMask(Rt),ae=Rt)},setFunc:function(Rt,Ss,kr){(fe!==Rt||Ce!==Ss||se!==kr)&&(n.stencilFunc(Rt,Ss,kr),fe=Rt,Ce=Ss,se=kr)},setOp:function(Rt,Ss,kr){(K!==Rt||Pe!==Ss||at!==kr)&&(n.stencilOp(Rt,Ss,kr),K=Rt,Pe=Ss,at=kr)},setLocked:function(Rt){N=Rt},setClear:function(Rt){$t!==Rt&&(n.clearStencil(Rt),$t=Rt)},reset:function(){N=!1,ae=null,fe=null,Ce=null,se=null,K=null,Pe=null,at=null,$t=null}}},c=new WeakMap,l=new WeakMap;let u={},d={},h=new WeakMap,f=[],p=null,v=!1,g=null,m=null,y=null,_=null,x=null,w=null,C=null,D=new xe(0,0,0),I=0,b=!1,S=null,R=null,B=null,V=null,H=null;const Y=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let W=!1,ie=0;const G=n.getParameter(n.VERSION);-1!==G.indexOf("WebGL")?(ie=parseFloat(/^WebGL (\d)/.exec(G)[1]),W=ie>=1):-1!==G.indexOf("OpenGL ES")&&(ie=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),W=ie>=2);let pe=null,Me={};const Ae=n.getParameter(n.SCISSOR_BOX),it=n.getParameter(n.VIEWPORT),bt=(new St).fromArray(Ae),wt=(new St).fromArray(it);function $(N,ae,fe,Ce){const se=new Uint8Array(4),K=n.createTexture();n.bindTexture(N,K),n.texParameteri(N,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(N,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Pe=0;Pe<fe;Pe++)N===n.TEXTURE_3D||N===n.TEXTURE_2D_ARRAY?n.texImage3D(ae,0,n.RGBA,1,1,Ce,0,n.RGBA,n.UNSIGNED_BYTE,se):n.texImage2D(ae+Pe,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,se);return K}const me={};function de(N){!0!==u[N]&&(n.enable(N),u[N]=!0)}function ke(N){!1!==u[N]&&(n.disable(N),u[N]=!1)}me[n.TEXTURE_2D]=$(n.TEXTURE_2D,n.TEXTURE_2D,1),me[n.TEXTURE_CUBE_MAP]=$(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),me[n.TEXTURE_2D_ARRAY]=$(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),me[n.TEXTURE_3D]=$(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),de(n.DEPTH_TEST),o.setFunc(3),te(!1),J(1),de(n.CULL_FACE),Q(0);const st={100:n.FUNC_ADD,101:n.FUNC_SUBTRACT,102:n.FUNC_REVERSE_SUBTRACT};st[103]=n.MIN,st[104]=n.MAX;const P={200:n.ZERO,201:n.ONE,202:n.SRC_COLOR,204:n.SRC_ALPHA,210:n.SRC_ALPHA_SATURATE,208:n.DST_COLOR,206:n.DST_ALPHA,203:n.ONE_MINUS_SRC_COLOR,205:n.ONE_MINUS_SRC_ALPHA,209:n.ONE_MINUS_DST_COLOR,207:n.ONE_MINUS_DST_ALPHA,211:n.CONSTANT_COLOR,212:n.ONE_MINUS_CONSTANT_COLOR,213:n.CONSTANT_ALPHA,214:n.ONE_MINUS_CONSTANT_ALPHA};function Q(N,ae,fe,Ce,se,K,Pe,at,$t,Rt){if(0!==N){if(!1===v&&(de(n.BLEND),v=!0),5===N)se=se||ae,K=K||fe,Pe=Pe||Ce,(ae!==m||se!==x)&&(n.blendEquationSeparate(st[ae],st[se]),m=ae,x=se),(fe!==y||Ce!==_||K!==w||Pe!==C)&&(n.blendFuncSeparate(P[fe],P[Ce],P[K],P[Pe]),y=fe,_=Ce,w=K,C=Pe),(!1===at.equals(D)||$t!==I)&&(n.blendColor(at.r,at.g,at.b,$t),D.copy(at),I=$t),g=N,b=!1;else if(N!==g||Rt!==b){if((100!==m||100!==x)&&(n.blendEquation(n.FUNC_ADD),m=100,x=100),Rt)switch(N){case 1:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.ONE,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",N)}else switch(N){case 1:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case 3:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case 4:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",N)}y=null,_=null,w=null,C=null,D.set(0,0,0),I=0,g=N,b=Rt}}else!0===v&&(ke(n.BLEND),v=!1)}function te(N){S!==N&&(n.frontFace(N?n.CW:n.CCW),S=N)}function J(N){0!==N?(de(n.CULL_FACE),N!==R&&n.cullFace(1===N?n.BACK:2===N?n.FRONT:n.FRONT_AND_BACK)):ke(n.CULL_FACE),R=N}function ne(N,ae,fe){N?(de(n.POLYGON_OFFSET_FILL),(V!==ae||H!==fe)&&(n.polygonOffset(ae,fe),V=ae,H=fe)):ke(n.POLYGON_OFFSET_FILL)}return{buffers:{color:s,depth:o,stencil:a},enable:de,disable:ke,bindFramebuffer:function Ne(N,ae){return d[N]!==ae&&(n.bindFramebuffer(N,ae),d[N]=ae,N===n.DRAW_FRAMEBUFFER&&(d[n.FRAMEBUFFER]=ae),N===n.FRAMEBUFFER&&(d[n.DRAW_FRAMEBUFFER]=ae),!0)},drawBuffers:function We(N,ae){let fe=f,Ce=!1;if(N){fe=h.get(ae),void 0===fe&&(fe=[],h.set(ae,fe));const se=N.textures;if(fe.length!==se.length||fe[0]!==n.COLOR_ATTACHMENT0){for(let K=0,Pe=se.length;K<Pe;K++)fe[K]=n.COLOR_ATTACHMENT0+K;fe.length=se.length,Ce=!0}}else fe[0]!==n.BACK&&(fe[0]=n.BACK,Ce=!0);Ce&&n.drawBuffers(fe)},useProgram:function Yt(N){return p!==N&&(n.useProgram(N),p=N,!0)},setBlending:Q,setMaterial:function X(N,ae){2===N.side?ke(n.CULL_FACE):de(n.CULL_FACE);let fe=1===N.side;ae&&(fe=!fe),te(fe),1===N.blending&&!1===N.transparent?Q(0):Q(N.blending,N.blendEquation,N.blendSrc,N.blendDst,N.blendEquationAlpha,N.blendSrcAlpha,N.blendDstAlpha,N.blendColor,N.blendAlpha,N.premultipliedAlpha),o.setFunc(N.depthFunc),o.setTest(N.depthTest),o.setMask(N.depthWrite),s.setMask(N.colorWrite);const Ce=N.stencilWrite;a.setTest(Ce),Ce&&(a.setMask(N.stencilWriteMask),a.setFunc(N.stencilFunc,N.stencilRef,N.stencilFuncMask),a.setOp(N.stencilFail,N.stencilZFail,N.stencilZPass)),ne(N.polygonOffset,N.polygonOffsetFactor,N.polygonOffsetUnits),!0===N.alphaToCoverage?de(n.SAMPLE_ALPHA_TO_COVERAGE):ke(n.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:te,setCullFace:J,setLineWidth:function ue(N){N!==B&&(W&&n.lineWidth(N),B=N)},setPolygonOffset:ne,setScissorTest:function he(N){N?de(n.SCISSOR_TEST):ke(n.SCISSOR_TEST)},activeTexture:function ot(N){void 0===N&&(N=n.TEXTURE0+Y-1),pe!==N&&(n.activeTexture(N),pe=N)},bindTexture:function tt(N,ae,fe){void 0===fe&&(fe=null===pe?n.TEXTURE0+Y-1:pe);let Ce=Me[fe];void 0===Ce&&(Ce={type:void 0,texture:void 0},Me[fe]=Ce),(Ce.type!==N||Ce.texture!==ae)&&(pe!==fe&&(n.activeTexture(fe),pe=fe),n.bindTexture(N,ae||me[N]),Ce.type=N,Ce.texture=ae)},unbindTexture:function A(){const N=Me[pe];void 0!==N&&void 0!==N.type&&(n.bindTexture(N.type,null),N.type=void 0,N.texture=void 0)},compressedTexImage2D:function M(){try{n.compressedTexImage2D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},compressedTexImage3D:function F(){try{n.compressedTexImage3D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},texImage2D:function Re(){try{n.texImage2D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},texImage3D:function re(){try{n.texImage3D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},updateUBOMapping:function Fe(N,ae){let fe=l.get(ae);void 0===fe&&(fe=new WeakMap,l.set(ae,fe));let Ce=fe.get(N);void 0===Ce&&(Ce=n.getUniformBlockIndex(ae,N.name),fe.set(N,Ce))},uniformBlockBinding:function _e(N,ae){const Ce=l.get(ae).get(N);c.get(ae)!==Ce&&(n.uniformBlockBinding(ae,Ce,N.__bindingPointIndex),c.set(ae,Ce))},texStorage2D:function le(){try{n.texStorage2D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},texStorage3D:function Ie(){try{n.texStorage3D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},texSubImage2D:function z(){try{n.texSubImage2D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},texSubImage3D:function ee(){try{n.texSubImage3D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},compressedTexSubImage2D:function j(){try{n.compressedTexSubImage2D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},compressedTexSubImage3D:function Le(){try{n.compressedTexSubImage3D(...arguments)}catch(N){console.error("THREE.WebGLState:",N)}},scissor:function Se(N){!1===bt.equals(N)&&(n.scissor(N.x,N.y,N.z,N.w),bt.copy(N))},viewport:function Xe(N){!1===wt.equals(N)&&(n.viewport(N.x,N.y,N.z,N.w),wt.copy(N))},reset:function ft(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},pe=null,Me={},d={},h=new WeakMap,f=[],p=null,v=!1,g=null,m=null,y=null,_=null,x=null,w=null,C=null,D=new xe(0,0,0),I=0,b=!1,S=null,R=null,B=null,V=null,H=null,bt.set(0,0,n.canvas.width,n.canvas.height),wt.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}}}function e7(n,e,t,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),l=new q,u=new WeakMap;let d;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function p(A,M){return f?new OffscreenCanvas(A,M):Nu("canvas")}function v(A,M,F){let z=1;const ee=tt(A);if((ee.width>F||ee.height>F)&&(z=F/Math.max(ee.width,ee.height)),z<1){if(typeof HTMLImageElement<"u"&&A instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&A instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&A instanceof ImageBitmap||typeof VideoFrame<"u"&&A instanceof VideoFrame){const j=Math.floor(z*ee.width),Le=Math.floor(z*ee.height);void 0===d&&(d=p(j,Le));const le=M?p(j,Le):d;return le.width=j,le.height=Le,le.getContext("2d").drawImage(A,0,0,j,Le),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ee.width+"x"+ee.height+") to ("+j+"x"+Le+")."),le}return"data"in A&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ee.width+"x"+ee.height+")."),A}return A}function g(A){return A.generateMipmaps}function m(A){n.generateMipmap(A)}function y(A){return A.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:A.isWebGL3DRenderTarget?n.TEXTURE_3D:A.isWebGLArrayRenderTarget||A.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function _(A,M,F,z,ee=!1){if(null!==A){if(void 0!==n[A])return n[A];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+A+"'")}let j=M;if(M===n.RED&&(F===n.FLOAT&&(j=n.R32F),F===n.HALF_FLOAT&&(j=n.R16F),F===n.UNSIGNED_BYTE&&(j=n.R8)),M===n.RED_INTEGER&&(F===n.UNSIGNED_BYTE&&(j=n.R8UI),F===n.UNSIGNED_SHORT&&(j=n.R16UI),F===n.UNSIGNED_INT&&(j=n.R32UI),F===n.BYTE&&(j=n.R8I),F===n.SHORT&&(j=n.R16I),F===n.INT&&(j=n.R32I)),M===n.RG&&(F===n.FLOAT&&(j=n.RG32F),F===n.HALF_FLOAT&&(j=n.RG16F),F===n.UNSIGNED_BYTE&&(j=n.RG8)),M===n.RG_INTEGER&&(F===n.UNSIGNED_BYTE&&(j=n.RG8UI),F===n.UNSIGNED_SHORT&&(j=n.RG16UI),F===n.UNSIGNED_INT&&(j=n.RG32UI),F===n.BYTE&&(j=n.RG8I),F===n.SHORT&&(j=n.RG16I),F===n.INT&&(j=n.RG32I)),M===n.RGB_INTEGER&&(F===n.UNSIGNED_BYTE&&(j=n.RGB8UI),F===n.UNSIGNED_SHORT&&(j=n.RGB16UI),F===n.UNSIGNED_INT&&(j=n.RGB32UI),F===n.BYTE&&(j=n.RGB8I),F===n.SHORT&&(j=n.RGB16I),F===n.INT&&(j=n.RGB32I)),M===n.RGBA_INTEGER&&(F===n.UNSIGNED_BYTE&&(j=n.RGBA8UI),F===n.UNSIGNED_SHORT&&(j=n.RGBA16UI),F===n.UNSIGNED_INT&&(j=n.RGBA32UI),F===n.BYTE&&(j=n.RGBA8I),F===n.SHORT&&(j=n.RGBA16I),F===n.INT&&(j=n.RGBA32I)),M===n.RGB&&F===n.UNSIGNED_INT_5_9_9_9_REV&&(j=n.RGB9_E5),M===n.RGBA){const Le=ee?Vf:xt.getTransfer(z);F===n.FLOAT&&(j=n.RGBA32F),F===n.HALF_FLOAT&&(j=n.RGBA16F),F===n.UNSIGNED_BYTE&&(j=Le===Ft?n.SRGB8_ALPHA8:n.RGBA8),F===n.UNSIGNED_SHORT_4_4_4_4&&(j=n.RGBA4),F===n.UNSIGNED_SHORT_5_5_5_1&&(j=n.RGB5_A1)}return(j===n.R16F||j===n.R32F||j===n.RG16F||j===n.RG32F||j===n.RGBA16F||j===n.RGBA32F)&&e.get("EXT_color_buffer_float"),j}function x(A,M){let F;return A?null===M||M===js||M===Au?F=n.DEPTH24_STENCIL8:M===Di?F=n.DEPTH32F_STENCIL8:M===Tu&&(F=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===M||M===js||M===Au?F=n.DEPTH_COMPONENT24:M===Di?F=n.DEPTH_COMPONENT32F:M===Tu&&(F=n.DEPTH_COMPONENT16),F}function w(A,M){return!0===g(A)||A.isFramebufferTexture&&A.minFilter!==Fn&&A.minFilter!==bn?Math.log2(Math.max(M.width,M.height))+1:void 0!==A.mipmaps&&A.mipmaps.length>0?A.mipmaps.length:A.isCompressedTexture&&Array.isArray(A.image)?M.mipmaps.length:1}function C(A){const M=A.target;M.removeEventListener("dispose",C),function I(A){const M=i.get(A);if(void 0===M.__webglInit)return;const F=A.source,z=h.get(F);if(z){const ee=z[M.__cacheKey];ee.usedTimes--,0===ee.usedTimes&&b(A),0===Object.keys(z).length&&h.delete(F)}i.remove(A)}(M),M.isVideoTexture&&u.delete(M)}function D(A){const M=A.target;M.removeEventListener("dispose",D),function S(A){const M=i.get(A);if(A.depthTexture&&(A.depthTexture.dispose(),i.remove(A.depthTexture)),A.isWebGLCubeRenderTarget)for(let z=0;z<6;z++){if(Array.isArray(M.__webglFramebuffer[z]))for(let ee=0;ee<M.__webglFramebuffer[z].length;ee++)n.deleteFramebuffer(M.__webglFramebuffer[z][ee]);else n.deleteFramebuffer(M.__webglFramebuffer[z]);M.__webglDepthbuffer&&n.deleteRenderbuffer(M.__webglDepthbuffer[z])}else{if(Array.isArray(M.__webglFramebuffer))for(let z=0;z<M.__webglFramebuffer.length;z++)n.deleteFramebuffer(M.__webglFramebuffer[z]);else n.deleteFramebuffer(M.__webglFramebuffer);if(M.__webglDepthbuffer&&n.deleteRenderbuffer(M.__webglDepthbuffer),M.__webglMultisampledFramebuffer&&n.deleteFramebuffer(M.__webglMultisampledFramebuffer),M.__webglColorRenderbuffer)for(let z=0;z<M.__webglColorRenderbuffer.length;z++)M.__webglColorRenderbuffer[z]&&n.deleteRenderbuffer(M.__webglColorRenderbuffer[z]);M.__webglDepthRenderbuffer&&n.deleteRenderbuffer(M.__webglDepthRenderbuffer)}const F=A.textures;for(let z=0,ee=F.length;z<ee;z++){const j=i.get(F[z]);j.__webglTexture&&(n.deleteTexture(j.__webglTexture),o.memory.textures--),i.remove(F[z])}i.remove(A)}(M)}function b(A){const M=i.get(A);n.deleteTexture(M.__webglTexture),delete h.get(A.source)[M.__cacheKey],o.memory.textures--}let R=0;function Y(A,M){const F=i.get(A);if(A.isVideoTexture&&function he(A){const M=o.render.frame;u.get(A)!==M&&(u.set(A,M),A.update())}(A),!1===A.isRenderTargetTexture&&!0!==A.isExternalTexture&&A.version>0&&F.__version!==A.version){const z=A.image;if(null===z)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==z.complete)return void me(F,A,M);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}else A.isExternalTexture&&(F.__webglTexture=A.sourceTexture?A.sourceTexture:null);t.bindTexture(n.TEXTURE_2D,F.__webglTexture,n.TEXTURE0+M)}const pe={1e3:n.REPEAT,[hr]:n.CLAMP_TO_EDGE,1002:n.MIRRORED_REPEAT},Me={[Fn]:n.NEAREST,1004:n.NEAREST_MIPMAP_NEAREST,1005:n.NEAREST_MIPMAP_LINEAR,[bn]:n.LINEAR,1007:n.LINEAR_MIPMAP_NEAREST,[as]:n.LINEAR_MIPMAP_LINEAR},Ae={512:n.NEVER,519:n.ALWAYS,513:n.LESS,515:n.LEQUAL,514:n.EQUAL,518:n.GEQUAL,516:n.GREATER,517:n.NOTEQUAL};function it(A,M){if(M.type===Di&&!1===e.has("OES_texture_float_linear")&&(M.magFilter===bn||1007===M.magFilter||1005===M.magFilter||M.magFilter===as||M.minFilter===bn||1007===M.minFilter||1005===M.minFilter||M.minFilter===as)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(A,n.TEXTURE_WRAP_S,pe[M.wrapS]),n.texParameteri(A,n.TEXTURE_WRAP_T,pe[M.wrapT]),(A===n.TEXTURE_3D||A===n.TEXTURE_2D_ARRAY)&&n.texParameteri(A,n.TEXTURE_WRAP_R,pe[M.wrapR]),n.texParameteri(A,n.TEXTURE_MAG_FILTER,Me[M.magFilter]),n.texParameteri(A,n.TEXTURE_MIN_FILTER,Me[M.minFilter]),M.compareFunction&&(n.texParameteri(A,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(A,n.TEXTURE_COMPARE_FUNC,Ae[M.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(M.magFilter===Fn||1005!==M.minFilter&&M.minFilter!==as||M.type===Di&&!1===e.has("OES_texture_float_linear"))return;if(M.anisotropy>1||i.get(M).__currentAnisotropy){const F=e.get("EXT_texture_filter_anisotropic");n.texParameterf(A,F.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(M.anisotropy,r.getMaxAnisotropy())),i.get(M).__currentAnisotropy=M.anisotropy}}}function bt(A,M){let F=!1;void 0===A.__webglInit&&(A.__webglInit=!0,M.addEventListener("dispose",C));const z=M.source;let ee=h.get(z);void 0===ee&&(ee={},h.set(z,ee));const j=function H(A){const M=[];return M.push(A.wrapS),M.push(A.wrapT),M.push(A.wrapR||0),M.push(A.magFilter),M.push(A.minFilter),M.push(A.anisotropy),M.push(A.internalFormat),M.push(A.format),M.push(A.type),M.push(A.generateMipmaps),M.push(A.premultiplyAlpha),M.push(A.flipY),M.push(A.unpackAlignment),M.push(A.colorSpace),M.join()}(M);if(j!==A.__cacheKey){void 0===ee[j]&&(ee[j]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,F=!0),ee[j].usedTimes++;const Le=ee[A.__cacheKey];void 0!==Le&&(ee[A.__cacheKey].usedTimes--,0===Le.usedTimes&&b(M)),A.__cacheKey=j,A.__webglTexture=ee[j].texture}return F}function wt(A,M,F){return Math.floor(Math.floor(A/F)/M)}function me(A,M,F){let z=n.TEXTURE_2D;(M.isDataArrayTexture||M.isCompressedArrayTexture)&&(z=n.TEXTURE_2D_ARRAY),M.isData3DTexture&&(z=n.TEXTURE_3D);const ee=bt(A,M),j=M.source;t.bindTexture(z,A.__webglTexture,n.TEXTURE0+F);const Le=i.get(j);if(j.version!==Le.__version||!0===ee){t.activeTexture(n.TEXTURE0+F);const le=xt.getPrimaries(xt.workingColorSpace),Ie=""===M.colorSpace?null:xt.getPrimaries(M.colorSpace),Re=""===M.colorSpace||le===Ie?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,M.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,M.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,M.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Re);let re=v(M.image,!1,r.maxTextureSize);re=ot(M,re);const Se=s.convert(M.format,M.colorSpace),Xe=s.convert(M.type);let _e,Fe=_(M.internalFormat,Se,Xe,M.colorSpace,M.isVideoTexture);it(z,M);const ft=M.mipmaps,N=!0!==M.isVideoTexture,ae=void 0===Le.__version||!0===ee,fe=j.dataReady,Ce=w(M,re);if(M.isDepthTexture)Fe=x(M.format===Iu,M.type),ae&&(N?t.texStorage2D(n.TEXTURE_2D,1,Fe,re.width,re.height):t.texImage2D(n.TEXTURE_2D,0,Fe,re.width,re.height,0,Se,Xe,null));else if(M.isDataTexture)if(ft.length>0){N&&ae&&t.texStorage2D(n.TEXTURE_2D,Ce,Fe,ft[0].width,ft[0].height);for(let se=0,K=ft.length;se<K;se++)_e=ft[se],N?fe&&t.texSubImage2D(n.TEXTURE_2D,se,0,0,_e.width,_e.height,Se,Xe,_e.data):t.texImage2D(n.TEXTURE_2D,se,Fe,_e.width,_e.height,0,Se,Xe,_e.data);M.generateMipmaps=!1}else N?(ae&&t.texStorage2D(n.TEXTURE_2D,Ce,Fe,re.width,re.height),fe&&function $(A,M,F,z){const j=A.updateRanges;if(0===j.length)t.texSubImage2D(n.TEXTURE_2D,0,0,0,M.width,M.height,F,z,M.data);else{j.sort((re,Se)=>re.start-Se.start);let Le=0;for(let re=1;re<j.length;re++){const Se=j[Le],Xe=j[re],Fe=Se.start+Se.count,_e=wt(Xe.start,M.width,4),ft=wt(Se.start,M.width,4);Xe.start<=Fe+1&&_e===ft&&wt(Xe.start+Xe.count-1,M.width,4)===_e?Se.count=Math.max(Se.count,Xe.start+Xe.count-Se.start):(++Le,j[Le]=Xe)}j.length=Le+1;const le=n.getParameter(n.UNPACK_ROW_LENGTH),Ie=n.getParameter(n.UNPACK_SKIP_PIXELS),Re=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,M.width);for(let re=0,Se=j.length;re<Se;re++){const Xe=j[re],Fe=Math.floor(Xe.start/4),_e=Math.ceil(Xe.count/4),ft=Fe%M.width,N=Math.floor(Fe/M.width),ae=_e,fe=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,ft),n.pixelStorei(n.UNPACK_SKIP_ROWS,N),t.texSubImage2D(n.TEXTURE_2D,0,ft,N,ae,fe,F,z,M.data)}A.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,le),n.pixelStorei(n.UNPACK_SKIP_PIXELS,Ie),n.pixelStorei(n.UNPACK_SKIP_ROWS,Re)}}(M,re,Se,Xe)):t.texImage2D(n.TEXTURE_2D,0,Fe,re.width,re.height,0,Se,Xe,re.data);else if(M.isCompressedTexture)if(M.isCompressedArrayTexture){N&&ae&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ce,Fe,ft[0].width,ft[0].height,re.depth);for(let se=0,K=ft.length;se<K;se++)if(_e=ft[se],M.format!==pi)if(null!==Se)if(N){if(fe)if(M.layerUpdates.size>0){const Pe=Ax(_e.width,_e.height,M.format,M.type);for(const at of M.layerUpdates){const $t=_e.data.subarray(at*Pe/_e.data.BYTES_PER_ELEMENT,(at+1)*Pe/_e.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,se,0,0,at,_e.width,_e.height,1,Se,$t)}M.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,se,0,0,0,_e.width,_e.height,re.depth,Se,_e.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,se,Fe,_e.width,_e.height,re.depth,0,_e.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else N?fe&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,se,0,0,0,_e.width,_e.height,re.depth,Se,Xe,_e.data):t.texImage3D(n.TEXTURE_2D_ARRAY,se,Fe,_e.width,_e.height,re.depth,0,Se,Xe,_e.data)}else{N&&ae&&t.texStorage2D(n.TEXTURE_2D,Ce,Fe,ft[0].width,ft[0].height);for(let se=0,K=ft.length;se<K;se++)_e=ft[se],M.format!==pi?null!==Se?N?fe&&t.compressedTexSubImage2D(n.TEXTURE_2D,se,0,0,_e.width,_e.height,Se,_e.data):t.compressedTexImage2D(n.TEXTURE_2D,se,Fe,_e.width,_e.height,0,_e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):N?fe&&t.texSubImage2D(n.TEXTURE_2D,se,0,0,_e.width,_e.height,Se,Xe,_e.data):t.texImage2D(n.TEXTURE_2D,se,Fe,_e.width,_e.height,0,Se,Xe,_e.data)}else if(M.isDataArrayTexture)if(N){if(ae&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ce,Fe,re.width,re.height,re.depth),fe)if(M.layerUpdates.size>0){const se=Ax(re.width,re.height,M.format,M.type);for(const K of M.layerUpdates){const Pe=re.data.subarray(K*se/re.data.BYTES_PER_ELEMENT,(K+1)*se/re.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,K,re.width,re.height,1,Se,Xe,Pe)}M.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,re.width,re.height,re.depth,Se,Xe,re.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Fe,re.width,re.height,re.depth,0,Se,Xe,re.data);else if(M.isData3DTexture)N?(ae&&t.texStorage3D(n.TEXTURE_3D,Ce,Fe,re.width,re.height,re.depth),fe&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,re.width,re.height,re.depth,Se,Xe,re.data)):t.texImage3D(n.TEXTURE_3D,0,Fe,re.width,re.height,re.depth,0,Se,Xe,re.data);else if(M.isFramebufferTexture){if(ae)if(N)t.texStorage2D(n.TEXTURE_2D,Ce,Fe,re.width,re.height);else{let se=re.width,K=re.height;for(let Pe=0;Pe<Ce;Pe++)t.texImage2D(n.TEXTURE_2D,Pe,Fe,se,K,0,Se,Xe,null),se>>=1,K>>=1}}else if(ft.length>0){if(N&&ae){const se=tt(ft[0]);t.texStorage2D(n.TEXTURE_2D,Ce,Fe,se.width,se.height)}for(let se=0,K=ft.length;se<K;se++)_e=ft[se],N?fe&&t.texSubImage2D(n.TEXTURE_2D,se,0,0,Se,Xe,_e):t.texImage2D(n.TEXTURE_2D,se,Fe,Se,Xe,_e);M.generateMipmaps=!1}else if(N){if(ae){const se=tt(re);t.texStorage2D(n.TEXTURE_2D,Ce,Fe,se.width,se.height)}fe&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Se,Xe,re)}else t.texImage2D(n.TEXTURE_2D,0,Fe,Se,Xe,re);g(M)&&m(z),Le.__version=j.version,M.onUpdate&&M.onUpdate(M)}A.__version=M.version}function ke(A,M,F,z,ee,j){const Le=s.convert(F.format,F.colorSpace),le=s.convert(F.type),Ie=_(F.internalFormat,Le,le,F.colorSpace),Re=i.get(M),re=i.get(F);if(re.__renderTarget=M,!Re.__hasExternalTextures){const Se=Math.max(1,M.width>>j),Xe=Math.max(1,M.height>>j);ee===n.TEXTURE_3D||ee===n.TEXTURE_2D_ARRAY?t.texImage3D(ee,j,Ie,Se,Xe,M.depth,0,Le,le,null):t.texImage2D(ee,j,Ie,Se,Xe,0,Le,le,null)}t.bindFramebuffer(n.FRAMEBUFFER,A),ne(M)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,z,ee,re.__webglTexture,0,ue(M)):(ee===n.TEXTURE_2D||ee>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ee<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,z,ee,re.__webglTexture,j),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ne(A,M,F){if(n.bindRenderbuffer(n.RENDERBUFFER,A),M.depthBuffer){const z=M.depthTexture,j=x(M.stencilBuffer,z&&z.isDepthTexture?z.type:null),Le=M.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,le=ue(M);ne(M)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,le,j,M.width,M.height):F?n.renderbufferStorageMultisample(n.RENDERBUFFER,le,j,M.width,M.height):n.renderbufferStorage(n.RENDERBUFFER,j,M.width,M.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Le,n.RENDERBUFFER,A)}else{const z=M.textures;for(let ee=0;ee<z.length;ee++){const j=z[ee],Le=s.convert(j.format,j.colorSpace),le=s.convert(j.type),Ie=_(j.internalFormat,Le,le,j.colorSpace),Re=ue(M);F&&!1===ne(M)?n.renderbufferStorageMultisample(n.RENDERBUFFER,Re,Ie,M.width,M.height):ne(M)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Re,Ie,M.width,M.height):n.renderbufferStorage(n.RENDERBUFFER,Ie,M.width,M.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Yt(A){const M=i.get(A),F=!0===A.isWebGLCubeRenderTarget;if(M.__boundDepthTexture!==A.depthTexture){const z=A.depthTexture;if(M.__depthDisposeCallback&&M.__depthDisposeCallback(),z){const ee=()=>{delete M.__boundDepthTexture,delete M.__depthDisposeCallback,z.removeEventListener("dispose",ee)};z.addEventListener("dispose",ee),M.__depthDisposeCallback=ee}M.__boundDepthTexture=z}if(A.depthTexture&&!M.__autoAllocateDepthBuffer){if(F)throw new Error("target.depthTexture not supported in Cube render targets");const z=A.texture.mipmaps;!function We(A,M){if(M&&M.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,A),!M.depthTexture||!M.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const z=i.get(M.depthTexture);z.__renderTarget=M,(!z.__webglTexture||M.depthTexture.image.width!==M.width||M.depthTexture.image.height!==M.height)&&(M.depthTexture.image.width=M.width,M.depthTexture.image.height=M.height,M.depthTexture.needsUpdate=!0),Y(M.depthTexture,0);const ee=z.__webglTexture,j=ue(M);if(M.depthTexture.format===Du)ne(M)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ee,0,j):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ee,0);else{if(M.depthTexture.format!==Iu)throw new Error("Unknown depthTexture format");ne(M)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ee,0,j):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ee,0)}}(z&&z.length>0?M.__webglFramebuffer[0]:M.__webglFramebuffer,A)}else if(F){M.__webglDepthbuffer=[];for(let z=0;z<6;z++)if(t.bindFramebuffer(n.FRAMEBUFFER,M.__webglFramebuffer[z]),void 0===M.__webglDepthbuffer[z])M.__webglDepthbuffer[z]=n.createRenderbuffer(),Ne(M.__webglDepthbuffer[z],A,!1);else{const ee=A.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,j=M.__webglDepthbuffer[z];n.bindRenderbuffer(n.RENDERBUFFER,j),n.framebufferRenderbuffer(n.FRAMEBUFFER,ee,n.RENDERBUFFER,j)}}else{const z=A.texture.mipmaps;if(t.bindFramebuffer(n.FRAMEBUFFER,z&&z.length>0?M.__webglFramebuffer[0]:M.__webglFramebuffer),void 0===M.__webglDepthbuffer)M.__webglDepthbuffer=n.createRenderbuffer(),Ne(M.__webglDepthbuffer,A,!1);else{const ee=A.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,j=M.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,j),n.framebufferRenderbuffer(n.FRAMEBUFFER,ee,n.RENDERBUFFER,j)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}const X=[],te=[];function ue(A){return Math.min(r.maxSamples,A.samples)}function ne(A){const M=i.get(A);return A.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==M.__useRenderToTexture}function ot(A,M){const F=A.colorSpace,z=A.format,ee=A.type;return!0===A.isCompressedTexture||!0===A.isVideoTexture||F!==vc&&""!==F&&(xt.getTransfer(F)===Ft?(z!==pi||ee!==Rr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",F)),M}function tt(A){return typeof HTMLImageElement<"u"&&A instanceof HTMLImageElement?(l.width=A.naturalWidth||A.width,l.height=A.naturalHeight||A.height):typeof VideoFrame<"u"&&A instanceof VideoFrame?(l.width=A.displayWidth,l.height=A.displayHeight):(l.width=A.width,l.height=A.height),l}this.allocateTextureUnit=function V(){const A=R;return A>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+A+" texture units while this GPU supports only "+r.maxTextures),R+=1,A},this.resetTextureUnits=function B(){R=0},this.setTexture2D=Y,this.setTexture2DArray=function W(A,M){const F=i.get(A);!1===A.isRenderTargetTexture&&A.version>0&&F.__version!==A.version?me(F,A,M):t.bindTexture(n.TEXTURE_2D_ARRAY,F.__webglTexture,n.TEXTURE0+M)},this.setTexture3D=function ie(A,M){const F=i.get(A);!1===A.isRenderTargetTexture&&A.version>0&&F.__version!==A.version?me(F,A,M):t.bindTexture(n.TEXTURE_3D,F.__webglTexture,n.TEXTURE0+M)},this.setTextureCube=function G(A,M){const F=i.get(A);A.version>0&&F.__version!==A.version?function de(A,M,F){if(6!==M.image.length)return;const z=bt(A,M),ee=M.source;t.bindTexture(n.TEXTURE_CUBE_MAP,A.__webglTexture,n.TEXTURE0+F);const j=i.get(ee);if(ee.version!==j.__version||!0===z){t.activeTexture(n.TEXTURE0+F);const Le=xt.getPrimaries(xt.workingColorSpace),le=""===M.colorSpace?null:xt.getPrimaries(M.colorSpace),Ie=""===M.colorSpace||Le===le?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,M.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,M.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,M.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ie);const Re=M.isCompressedTexture||M.image[0].isCompressedTexture,re=M.image[0]&&M.image[0].isDataTexture,Se=[];for(let K=0;K<6;K++)Se[K]=Re||re?re?M.image[K].image:M.image[K]:v(M.image[K],!0,r.maxCubemapSize),Se[K]=ot(M,Se[K]);const Xe=Se[0],Fe=s.convert(M.format,M.colorSpace),_e=s.convert(M.type),ft=_(M.internalFormat,Fe,_e,M.colorSpace),N=!0!==M.isVideoTexture,ae=void 0===j.__version||!0===z,fe=ee.dataReady;let se,Ce=w(M,Xe);if(it(n.TEXTURE_CUBE_MAP,M),Re){N&&ae&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Ce,ft,Xe.width,Xe.height);for(let K=0;K<6;K++){se=Se[K].mipmaps;for(let Pe=0;Pe<se.length;Pe++){const at=se[Pe];M.format!==pi?null!==Fe?N?fe&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,Pe,0,0,at.width,at.height,Fe,at.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,Pe,ft,at.width,at.height,0,at.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):N?fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,Pe,0,0,at.width,at.height,Fe,_e,at.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,Pe,ft,at.width,at.height,0,Fe,_e,at.data)}}}else{if(se=M.mipmaps,N&&ae){se.length>0&&Ce++;const K=tt(Se[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Ce,ft,K.width,K.height)}for(let K=0;K<6;K++)if(re){N?fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,0,0,Se[K].width,Se[K].height,Fe,_e,Se[K].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,ft,Se[K].width,Se[K].height,0,Fe,_e,Se[K].data);for(let Pe=0;Pe<se.length;Pe++){const $t=se[Pe].image[K].image;N?fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,Pe+1,0,0,$t.width,$t.height,Fe,_e,$t.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,Pe+1,ft,$t.width,$t.height,0,Fe,_e,$t.data)}}else{N?fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,0,0,Fe,_e,Se[K]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,ft,Fe,_e,Se[K]);for(let Pe=0;Pe<se.length;Pe++){const at=se[Pe];N?fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,Pe+1,0,0,Fe,_e,at.image[K]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+K,Pe+1,ft,Fe,_e,at.image[K])}}}g(M)&&m(n.TEXTURE_CUBE_MAP),j.__version=ee.version,M.onUpdate&&M.onUpdate(M)}A.__version=M.version}(F,A,M):t.bindTexture(n.TEXTURE_CUBE_MAP,F.__webglTexture,n.TEXTURE0+M)},this.rebindTextures=function st(A,M,F){const z=i.get(A);void 0!==M&&ke(z.__webglFramebuffer,A,A.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),void 0!==F&&Yt(A)},this.setupRenderTarget=function P(A){const M=A.texture,F=i.get(A),z=i.get(M);A.addEventListener("dispose",D);const ee=A.textures,j=!0===A.isWebGLCubeRenderTarget,Le=ee.length>1;if(Le||(void 0===z.__webglTexture&&(z.__webglTexture=n.createTexture()),z.__version=M.version,o.memory.textures++),j){F.__webglFramebuffer=[];for(let le=0;le<6;le++)if(M.mipmaps&&M.mipmaps.length>0){F.__webglFramebuffer[le]=[];for(let Ie=0;Ie<M.mipmaps.length;Ie++)F.__webglFramebuffer[le][Ie]=n.createFramebuffer()}else F.__webglFramebuffer[le]=n.createFramebuffer()}else{if(M.mipmaps&&M.mipmaps.length>0){F.__webglFramebuffer=[];for(let le=0;le<M.mipmaps.length;le++)F.__webglFramebuffer[le]=n.createFramebuffer()}else F.__webglFramebuffer=n.createFramebuffer();if(Le)for(let le=0,Ie=ee.length;le<Ie;le++){const Re=i.get(ee[le]);void 0===Re.__webglTexture&&(Re.__webglTexture=n.createTexture(),o.memory.textures++)}if(A.samples>0&&!1===ne(A)){F.__webglMultisampledFramebuffer=n.createFramebuffer(),F.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,F.__webglMultisampledFramebuffer);for(let le=0;le<ee.length;le++){const Ie=ee[le];F.__webglColorRenderbuffer[le]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,F.__webglColorRenderbuffer[le]);const Re=s.convert(Ie.format,Ie.colorSpace),re=s.convert(Ie.type),Se=_(Ie.internalFormat,Re,re,Ie.colorSpace,!0===A.isXRRenderTarget),Xe=ue(A);n.renderbufferStorageMultisample(n.RENDERBUFFER,Xe,Se,A.width,A.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+le,n.RENDERBUFFER,F.__webglColorRenderbuffer[le])}n.bindRenderbuffer(n.RENDERBUFFER,null),A.depthBuffer&&(F.__webglDepthRenderbuffer=n.createRenderbuffer(),Ne(F.__webglDepthRenderbuffer,A,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(j){t.bindTexture(n.TEXTURE_CUBE_MAP,z.__webglTexture),it(n.TEXTURE_CUBE_MAP,M);for(let le=0;le<6;le++)if(M.mipmaps&&M.mipmaps.length>0)for(let Ie=0;Ie<M.mipmaps.length;Ie++)ke(F.__webglFramebuffer[le][Ie],A,M,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+le,Ie);else ke(F.__webglFramebuffer[le],A,M,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+le,0);g(M)&&m(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Le){for(let le=0,Ie=ee.length;le<Ie;le++){const Re=ee[le],re=i.get(Re);let Se=n.TEXTURE_2D;(A.isWebGL3DRenderTarget||A.isWebGLArrayRenderTarget)&&(Se=A.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Se,re.__webglTexture),it(Se,Re),ke(F.__webglFramebuffer,A,Re,n.COLOR_ATTACHMENT0+le,Se,0),g(Re)&&m(Se)}t.unbindTexture()}else{let le=n.TEXTURE_2D;if((A.isWebGL3DRenderTarget||A.isWebGLArrayRenderTarget)&&(le=A.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(le,z.__webglTexture),it(le,M),M.mipmaps&&M.mipmaps.length>0)for(let Ie=0;Ie<M.mipmaps.length;Ie++)ke(F.__webglFramebuffer[Ie],A,M,n.COLOR_ATTACHMENT0,le,Ie);else ke(F.__webglFramebuffer,A,M,n.COLOR_ATTACHMENT0,le,0);g(M)&&m(le),t.unbindTexture()}A.depthBuffer&&Yt(A)},this.updateRenderTargetMipmap=function Q(A){const M=A.textures;for(let F=0,z=M.length;F<z;F++){const ee=M[F];if(g(ee)){const j=y(A),Le=i.get(ee).__webglTexture;t.bindTexture(j,Le),m(j),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function J(A){if(A.samples>0)if(!1===ne(A)){const M=A.textures,F=A.width,z=A.height;let ee=n.COLOR_BUFFER_BIT;const j=A.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Le=i.get(A),le=M.length>1;if(le)for(let Re=0;Re<M.length;Re++)t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Re,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Re,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Le.__webglMultisampledFramebuffer);const Ie=A.texture.mipmaps;t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ie&&Ie.length>0?Le.__webglFramebuffer[0]:Le.__webglFramebuffer);for(let Re=0;Re<M.length;Re++){if(A.resolveDepthBuffer&&(A.depthBuffer&&(ee|=n.DEPTH_BUFFER_BIT),A.stencilBuffer&&A.resolveStencilBuffer&&(ee|=n.STENCIL_BUFFER_BIT)),le){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Le.__webglColorRenderbuffer[Re]);const re=i.get(M[Re]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,re,0)}n.blitFramebuffer(0,0,F,z,0,0,F,z,ee,n.NEAREST),!0===c&&(X.length=0,te.length=0,X.push(n.COLOR_ATTACHMENT0+Re),A.depthBuffer&&!1===A.resolveDepthBuffer&&(X.push(j),te.push(j),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,te)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,X))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),le)for(let Re=0;Re<M.length;Re++){t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Re,n.RENDERBUFFER,Le.__webglColorRenderbuffer[Re]);const re=i.get(M[Re]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Re,n.TEXTURE_2D,re,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Le.__webglMultisampledFramebuffer)}else A.depthBuffer&&!1===A.resolveDepthBuffer&&c&&n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[A.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT])},this.setupDepthRenderbuffer=Yt,this.setupFrameBufferTexture=ke,this.useMultisampledRTT=ne}function t7(n,e){return{convert:function t(i,r=""){let s;const o=xt.getTransfer(r);if(i===Rr)return n.UNSIGNED_BYTE;if(i===C_)return n.UNSIGNED_SHORT_4_4_4_4;if(i===T_)return n.UNSIGNED_SHORT_5_5_5_1;if(i===vI)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===mI)return n.BYTE;if(i===gI)return n.SHORT;if(i===Tu)return n.UNSIGNED_SHORT;if(i===E_)return n.INT;if(i===js)return n.UNSIGNED_INT;if(i===Di)return n.FLOAT;if(i===cs)return n.HALF_FLOAT;if(i===yI)return n.ALPHA;if(i===_I)return n.RGB;if(i===pi)return n.RGBA;if(i===Du)return n.DEPTH_COMPONENT;if(i===Iu)return n.DEPTH_STENCIL;if(i===A_)return n.RED;if(i===Pf)return n.RED_INTEGER;if(i===xI)return n.RG;if(i===D_)return n.RG_INTEGER;if(i===I_)return n.RGBA_INTEGER;if(i===Nf||i===Lf||i===Of||i===Ff)if(o===Ft){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===Nf)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Lf)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Of)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Ff)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===Nf)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Lf)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Of)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Ff)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===R_||i===P_||i===N_||i===L_){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(i===R_)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===P_)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===N_)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===L_)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===O_||i===F_||i===U_){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(i===O_||i===F_)return o===Ft?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===U_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(i===k_||i===B_||i===V_||i===H_||i===z_||i===G_||i===W_||i===j_||i===$_||i===q_||i===X_||i===Y_||i===Z_||i===J_){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(i===k_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===B_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===V_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===H_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===z_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===G_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===W_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===j_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===$_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===q_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===X_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Y_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Z_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===J_)return o===Ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===Uf||i===K_||i===Q_){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(i===Uf)return o===Ft?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===K_)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Q_)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(i===MI||i===e0||i===t0||i===n0){if(s=e.get("EXT_texture_compression_rgtc"),null===s)return null;if(i===Uf)return s.COMPRESSED_RED_RGTC1_EXT;if(i===e0)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===t0)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===n0)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===Au?n.UNSIGNED_INT_24_8:void 0!==n[i]?n[i]:null}}}class GR extends mi{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}}class r7{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(null===this.texture){const i=new GR(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,i=new Rn({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new ln(new jc(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class s7 extends ls{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,d=null,h=null,f=null,p=null;const v=new r7,g={},m=t.getContextAttributes();let y=null,_=null;const x=[],w=[],C=new q;let D=null;const I=new Vn;I.viewport=new St;const b=new Vn;b.viewport=new St;const S=[I,b],R=new U$;let B=null,V=null;function H($){const me=w.indexOf($.inputSource);if(-1===me)return;const de=x[me];void 0!==de&&(de.update($.inputSource,$.frame,l||o),de.dispatchEvent({type:$.type,data:$.inputSource}))}function Y(){r.removeEventListener("select",H),r.removeEventListener("selectstart",H),r.removeEventListener("selectend",H),r.removeEventListener("squeeze",H),r.removeEventListener("squeezestart",H),r.removeEventListener("squeezeend",H),r.removeEventListener("end",Y),r.removeEventListener("inputsourceschange",W);for(let $=0;$<x.length;$++){const me=w[$];null!==me&&(w[$]=null,x[$].disconnect(me))}B=null,V=null,v.reset();for(const $ in g)delete g[$];e.setRenderTarget(y),f=null,h=null,d=null,r=null,_=null,wt.stop(),i.isPresenting=!1,e.setPixelRatio(D),e.setSize(C.width,C.height,!1),i.dispatchEvent({type:"sessionend"})}function W($){for(let me=0;me<$.removed.length;me++){const de=$.removed[me],ke=w.indexOf(de);ke>=0&&(w[ke]=null,x[ke].disconnect(de))}for(let me=0;me<$.added.length;me++){const de=$.added[me];let ke=w.indexOf(de);if(-1===ke){for(let We=0;We<x.length;We++){if(We>=w.length){w.push(de),ke=We;break}if(null===w[We]){w[We]=de,ke=We;break}}if(-1===ke)break}const Ne=x[ke];Ne&&Ne.connect(de)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function($){let me=x[$];return void 0===me&&(me=new P0,x[$]=me),me.getTargetRaySpace()},this.getControllerGrip=function($){let me=x[$];return void 0===me&&(me=new P0,x[$]=me),me.getGripSpace()},this.getHand=function($){let me=x[$];return void 0===me&&(me=new P0,x[$]=me),me.getHandSpace()},this.setFramebufferScaleFactor=function($){s=$,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function($){a=$,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function($){l=$},this.getBaseLayer=function(){return null!==h?h:f},this.getBinding=function(){return d},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=function(){var $=hc(function*(me){if(r=me,null!==r){if(y=e.getRenderTarget(),r.addEventListener("select",H),r.addEventListener("selectstart",H),r.addEventListener("selectend",H),r.addEventListener("squeeze",H),r.addEventListener("squeezestart",H),r.addEventListener("squeezeend",H),r.addEventListener("end",Y),r.addEventListener("inputsourceschange",W),!0!==m.xrCompatible&&(yield t.makeXRCompatible()),D=e.getPixelRatio(),e.getSize(C),typeof XRWebGLBinding<"u"&&(d=new XRWebGLBinding(r,t)),null!==d&&"createProjectionLayer"in XRWebGLBinding.prototype){let ke=null,Ne=null,We=null;m.depth&&(We=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ke=m.stencil?Iu:Du,Ne=m.stencil?Au:js),h=d.createProjectionLayer({colorFormat:t.RGBA8,depthFormat:We,scaleFactor:s}),r.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),_=new Ni(h.textureWidth,h.textureHeight,{format:pi,type:Rr,depthTexture:new x1(h.textureWidth,h.textureHeight,Ne,void 0,void 0,void 0,void 0,void 0,void 0,ke),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}else f=new XRWebGLLayer(r,t,{antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:s}),r.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),_=new Ni(f.framebufferWidth,f.framebufferHeight,{format:pi,type:Rr,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil,resolveDepthBuffer:!1===f.ignoreDepthValues,resolveStencilBuffer:!1===f.ignoreDepthValues});_.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=yield r.requestReferenceSpace(a),wt.setContext(r),wt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(me){return $.apply(this,arguments)}}(),this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};const ie=new T,G=new T;function Me($,me){null===me?$.matrixWorld.copy($.matrix):$.matrixWorld.multiplyMatrices(me.matrixWorld,$.matrix),$.matrixWorldInverse.copy($.matrixWorld).invert()}this.updateCamera=function($){if(null===r)return;let me=$.near,de=$.far;null!==v.texture&&(v.depthNear>0&&(me=v.depthNear),v.depthFar>0&&(de=v.depthFar)),R.near=b.near=I.near=me,R.far=b.far=I.far=de,(B!==R.near||V!==R.far)&&(r.updateRenderState({depthNear:R.near,depthFar:R.far}),B=R.near,V=R.far),R.layers.mask=6|$.layers.mask,I.layers.mask=3&R.layers.mask,b.layers.mask=5&R.layers.mask;const ke=$.parent,Ne=R.cameras;Me(R,ke);for(let We=0;We<Ne.length;We++)Me(Ne[We],ke);2===Ne.length?function pe($,me,de){ie.setFromMatrixPosition(me.matrixWorld),G.setFromMatrixPosition(de.matrixWorld);const ke=ie.distanceTo(G),Ne=me.projectionMatrix.elements,We=de.projectionMatrix.elements,Yt=Ne[14]/(Ne[10]-1),st=Ne[14]/(Ne[10]+1),P=(Ne[9]+1)/Ne[5],Q=(Ne[9]-1)/Ne[5],X=(Ne[8]-1)/Ne[0],te=(We[8]+1)/We[0],J=Yt*X,ue=Yt*te,ne=ke/(-X+te),he=ne*-X;if(me.matrixWorld.decompose($.position,$.quaternion,$.scale),$.translateX(he),$.translateZ(ne),$.matrixWorld.compose($.position,$.quaternion,$.scale),$.matrixWorldInverse.copy($.matrixWorld).invert(),-1===Ne[10])$.projectionMatrix.copy(me.projectionMatrix),$.projectionMatrixInverse.copy(me.projectionMatrixInverse);else{const ot=Yt+ne,tt=st+ne;$.projectionMatrix.makePerspective(J-he,ue+(ke-he),P*st/tt*ot,Q*st/tt*ot,ot,tt),$.projectionMatrixInverse.copy($.projectionMatrix).invert()}}(R,I,b):R.projectionMatrix.copy(I.projectionMatrix),function Ae($,me,de){null===de?$.matrix.copy(me.matrixWorld):($.matrix.copy(de.matrixWorld),$.matrix.invert(),$.matrix.multiply(me.matrixWorld)),$.matrix.decompose($.position,$.quaternion,$.scale),$.updateMatrixWorld(!0),$.projectionMatrix.copy(me.projectionMatrix),$.projectionMatrixInverse.copy(me.projectionMatrixInverse),$.isPerspectiveCamera&&($.fov=2*_c*Math.atan(1/$.projectionMatrix.elements[5]),$.zoom=1)}($,R,ke)},this.getCamera=function(){return R},this.getFoveation=function(){if(null!==h||null!==f)return c},this.setFoveation=function($){c=$,null!==h&&(h.fixedFoveation=$),null!==f&&void 0!==f.fixedFoveation&&(f.fixedFoveation=$)},this.hasDepthSensing=function(){return null!==v.texture},this.getDepthSensingMesh=function(){return v.getMesh(R)},this.getCameraTexture=function($){return g[$]};let it=null;const wt=new pR;wt.setAnimationLoop(function bt($,me){if(u=me.getViewerPose(l||o),p=me,null!==u){const de=u.views;null!==f&&(e.setRenderTargetFramebuffer(_,f.framebuffer),e.setRenderTarget(_));let ke=!1;de.length!==R.cameras.length&&(R.cameras.length=0,ke=!0);for(let st=0;st<de.length;st++){const P=de[st];let Q=null;if(null!==f)Q=f.getViewport(P);else{const te=d.getViewSubImage(h,P);Q=te.viewport,0===st&&(e.setRenderTargetTextures(_,te.colorTexture,te.depthStencilTexture),e.setRenderTarget(_))}let X=S[st];void 0===X&&(X=new Vn,X.layers.enable(st),X.viewport=new St,S[st]=X),X.matrix.fromArray(P.transform.matrix),X.matrix.decompose(X.position,X.quaternion,X.scale),X.projectionMatrix.fromArray(P.projectionMatrix),X.projectionMatrixInverse.copy(X.projectionMatrix).invert(),X.viewport.set(Q.x,Q.y,Q.width,Q.height),0===st&&(R.matrix.copy(X.matrix),R.matrix.decompose(R.position,R.quaternion,R.scale)),!0===ke&&R.cameras.push(X)}const Ne=r.enabledFeatures;if(Ne&&Ne.includes("depth-sensing")&&"gpu-optimized"==r.depthUsage&&d){const st=d.getDepthInformation(de[0]);st&&st.isValid&&st.texture&&v.init(st,r.renderState)}if(Ne&&Ne.includes("camera-access")&&(e.state.unbindTexture(),d))for(let st=0;st<de.length;st++){const P=de[st].camera;if(P){let Q=g[P];Q||(Q=new GR,g[P]=Q);const X=d.getCameraImage(P);Q.sourceTexture=X}}}for(let de=0;de<x.length;de++){const ke=w[de],Ne=x[de];null!==ke&&void 0!==Ne&&Ne.update(ke,me,l||o)}it&&it($,me),me.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:me}),p=null}),this.setAnimationLoop=function($){it=$},this.dispose=function(){}}}const ea=new fs,o7=new Ze;function a7(n,e){function t(g,m){!0===g.matrixAutoUpdate&&g.updateMatrix(),m.value.copy(g.matrix)}function s(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.bumpMap&&(g.bumpMap.value=m.bumpMap,t(m.bumpMap,g.bumpMapTransform),g.bumpScale.value=m.bumpScale,1===m.side&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,t(m.normalMap,g.normalMapTransform),g.normalScale.value.copy(m.normalScale),1===m.side&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,t(m.displacementMap,g.displacementMapTransform),g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap,t(m.emissiveMap,g.emissiveMapTransform)),m.specularMap&&(g.specularMap.value=m.specularMap,t(m.specularMap,g.specularMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const y=e.get(m),_=y.envMap,x=y.envMapRotation;_&&(g.envMap.value=_,ea.copy(x),ea.x*=-1,ea.y*=-1,ea.z*=-1,_.isCubeTexture&&!1===_.isRenderTargetTexture&&(ea.y*=-1,ea.z*=-1),g.envMapRotation.value.setFromMatrix4(o7.makeRotationFromEuler(ea)),g.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap&&(g.lightMap.value=m.lightMap,g.lightMapIntensity.value=m.lightMapIntensity,t(m.lightMap,g.lightMapTransform)),m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity,t(m.aoMap,g.aoMapTransform))}return{refreshFogUniforms:function i(g,m){m.color.getRGB(g.fogColor.value,qI(n)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)},refreshMaterialUniforms:function r(g,m,y,_,x){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(g,m):m.isMeshToonMaterial?(s(g,m),function d(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}(g,m)):m.isMeshPhongMaterial?(s(g,m),function u(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}(g,m)):m.isMeshStandardMaterial?(s(g,m),function h(g,m){g.metalness.value=m.metalness,m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap,t(m.metalnessMap,g.metalnessMapTransform)),g.roughness.value=m.roughness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap,t(m.roughnessMap,g.roughnessMapTransform)),m.envMap&&(g.envMapIntensity.value=m.envMapIntensity)}(g,m),m.isMeshPhysicalMaterial&&function f(g,m,y){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap,t(m.sheenColorMap,g.sheenColorMapTransform)),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap,t(m.sheenRoughnessMap,g.sheenRoughnessMapTransform))),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap,t(m.clearcoatMap,g.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,t(m.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(g.clearcoatNormalMap.value=m.clearcoatNormalMap,t(m.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),1===m.side&&g.clearcoatNormalScale.value.negate())),m.dispersion>0&&(g.dispersion.value=m.dispersion),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap,t(m.iridescenceMap,g.iridescenceMapTransform)),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap,t(m.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap,t(m.transmissionMap,g.transmissionMapTransform)),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap,t(m.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(g.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(g.anisotropyMap.value=m.anisotropyMap,t(m.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap,t(m.specularColorMap,g.specularColorMapTransform)),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap,t(m.specularIntensityMap,g.specularIntensityMapTransform))}(g,m,x)):m.isMeshMatcapMaterial?(s(g,m),function p(g,m){m.matcap&&(g.matcap.value=m.matcap)}(g,m)):m.isMeshDepthMaterial?s(g,m):m.isMeshDistanceMaterial?(s(g,m),function v(g,m){const y=e.get(m).light;g.referencePosition.value.setFromMatrixPosition(y.matrixWorld),g.nearDistance.value=y.shadow.camera.near,g.farDistance.value=y.shadow.camera.far}(g,m)):m.isMeshNormalMaterial?s(g,m):m.isLineBasicMaterial?(function o(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform))}(g,m),m.isLineDashedMaterial&&function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}(g,m)):m.isPointsMaterial?function c(g,m,y,_){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*y,g.scale.value=.5*_,m.map&&(g.map.value=m.map,t(m.map,g.uvTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}(g,m,y,_):m.isSpriteMaterial?function l(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}}}function c7(n,e,t,i){let r={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function f(y,_,x,w){const C=y.value,D=_+"_"+x;if(void 0===w[D])return w[D]="number"==typeof C||"boolean"==typeof C?C:C.clone(),!0;{const I=w[D];if("number"==typeof C||"boolean"==typeof C){if(I!==C)return w[D]=C,!0}else if(!1===I.equals(C))return I.copy(C),!0}return!1}function v(y){const _={boundary:0,storage:0};return"number"==typeof y||"boolean"==typeof y?(_.boundary=4,_.storage=4):y.isVector2?(_.boundary=8,_.storage=8):y.isVector3||y.isColor?(_.boundary=16,_.storage=12):y.isVector4?(_.boundary=16,_.storage=16):y.isMatrix3?(_.boundary=48,_.storage=48):y.isMatrix4?(_.boundary=64,_.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),_}function g(y){const _=y.target;_.removeEventListener("dispose",g);const x=o.indexOf(_.__bindingPointIndex);o.splice(x,1),n.deleteBuffer(r[_.id]),delete r[_.id],delete s[_.id]}return{bind:function c(y,_){i.uniformBlockBinding(y,_.program)},update:function l(y,_){let x=r[y.id];void 0===x&&(function p(y){const _=y.uniforms;let x=0;for(let D=0,I=_.length;D<I;D++){const b=Array.isArray(_[D])?_[D]:[_[D]];for(let S=0,R=b.length;S<R;S++){const B=b[S],V=Array.isArray(B.value)?B.value:[B.value];for(let H=0,Y=V.length;H<Y;H++){const ie=v(V[H]),G=x%16,pe=G%ie.boundary,Me=G+pe;x+=pe,0!==Me&&16-Me<ie.storage&&(x+=16-Me),B.__data=new Float32Array(ie.storage/Float32Array.BYTES_PER_ELEMENT),B.__offset=x,x+=ie.storage}}}const C=x%16;C>0&&(x+=16-C),y.__size=x,y.__cache={}}(y),x=function u(y){const _=function d(){for(let y=0;y<a;y++)if(-1===o.indexOf(y))return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();y.__bindingPointIndex=_;const x=n.createBuffer(),w=y.__size,C=y.usage;return n.bindBuffer(n.UNIFORM_BUFFER,x),n.bufferData(n.UNIFORM_BUFFER,w,C),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,_,x),x}(y),r[y.id]=x,y.addEventListener("dispose",g)),i.updateUBOMapping(y,_.program);const C=e.render.frame;s[y.id]!==C&&(function h(y){const x=y.uniforms,w=y.__cache;n.bindBuffer(n.UNIFORM_BUFFER,r[y.id]);for(let C=0,D=x.length;C<D;C++){const I=Array.isArray(x[C])?x[C]:[x[C]];for(let b=0,S=I.length;b<S;b++){const R=I[b];if(!0===f(R,C,b,w)){const B=R.__offset,V=Array.isArray(R.value)?R.value:[R.value];let H=0;for(let Y=0;Y<V.length;Y++){const W=V[Y],ie=v(W);"number"==typeof W||"boolean"==typeof W?(R.__data[0]=W,n.bufferSubData(n.UNIFORM_BUFFER,B+H,R.__data)):W.isMatrix3?(R.__data[0]=W.elements[0],R.__data[1]=W.elements[1],R.__data[2]=W.elements[2],R.__data[3]=0,R.__data[4]=W.elements[3],R.__data[5]=W.elements[4],R.__data[6]=W.elements[5],R.__data[7]=0,R.__data[8]=W.elements[6],R.__data[9]=W.elements[7],R.__data[10]=W.elements[8],R.__data[11]=0):(W.toArray(R.__data,H),H+=ie.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,B,R.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}(y),s[y.id]=C)},dispose:function m(){for(const y in r)n.deleteBuffer(r[y]);o=[],r={},s={}}}}class l7{constructor(e={}){const{canvas:t=Nj(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1,reversedDepthBuffer:h=!1}=e;let f;if(this.isWebGLRenderer=!0,null!==i){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=i.getContextAttributes().alpha}else f=o;const p=new Uint32Array(4),v=new Int32Array(4);let g=null,m=null;const y=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Gs,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const x=this;let w=!1;this._outputColorSpace=Ii;let C=0,D=0,I=null,b=-1,S=null;const R=new St,B=new St;let V=null;const H=new xe(0);let Y=0,W=t.width,ie=t.height,G=1,pe=null,Me=null;const Ae=new St(0,0,W,ie),it=new St(0,0,W,ie);let bt=!1;const wt=new qu;let $=!1,me=!1;const de=new Ze,ke=new T,Ne=new St,We={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Yt=!1;function st(){return null===I?G:1}let X,te,J,ue,ne,he,ot,tt,A,M,F,z,ee,j,Le,le,Ie,Re,re,Se,Xe,Fe,_e,ft,P=i;function Q(E,L){return t.getContext(E,L)}try{const E={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r179"),t.addEventListener("webglcontextlost",fe,!1),t.addEventListener("webglcontextrestored",Ce,!1),t.addEventListener("webglcontextcreationerror",se,!1),null===P){const L="webgl2";if(P=Q(L,E),null===P)throw Q(L)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(E){throw console.error("THREE.WebGLRenderer: "+E.message),E}function N(){X=new _q(P),X.init(),Fe=new t7(P,X),te=new hq(P,X,e,Fe),J=new QX(P,X),te.reversedDepthBuffer&&h&&J.buffers.depth.setReversed(!0),ue=new Sq(P),ne=new VX,he=new e7(P,X,J,ne,te,Fe,ue),ot=new pq(x),tt=new yq(x),A=new c6(P),_e=new uq(P,A),M=new xq(P,A,ue,_e),F=new wq(P,M,A,ue),re=new bq(P,te,he),le=new fq(ne),z=new BX(x,ot,tt,X,te,_e,le),ee=new a7(x,ne),j=new zX,Le=new XX(X),Re=new lq(x,ot,tt,J,F,f,c),Ie=new JX(x,F,te),ft=new c7(P,ue,te,J),Se=new dq(P,X,ue),Xe=new Mq(P,X,ue),ue.programs=z.programs,x.capabilities=te,x.extensions=X,x.properties=ne,x.renderLists=j,x.shadowMap=Ie,x.state=J,x.info=ue}N();const ae=new s7(x,P);function fe(E){E.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function Ce(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const E=ue.autoReset,L=Ie.enabled,U=Ie.autoUpdate,k=Ie.needsUpdate,O=Ie.type;N(),ue.autoReset=E,Ie.enabled=L,Ie.autoUpdate=U,Ie.needsUpdate=k,Ie.type=O}function se(E){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",E.statusMessage)}function K(E){const L=E.target;L.removeEventListener("dispose",K),function Pe(E){(function at(E){const L=ne.get(E).programs;void 0!==L&&(L.forEach(function(U){z.releaseProgram(U)}),E.isShaderMaterial&&z.releaseShaderCache(E))})(E),ne.remove(E)}(L)}function $t(E,L,U){!0===E.transparent&&2===E.side&&!1===E.forceSinglePass?(E.side=1,E.needsUpdate=!0,nm(E,L,U),E.side=0,E.needsUpdate=!0,nm(E,L,U),E.side=2):nm(E,L,U)}this.xr=ae,this.getContext=function(){return P},this.getContextAttributes=function(){return P.getContextAttributes()},this.forceContextLoss=function(){const E=X.get("WEBGL_lose_context");E&&E.loseContext()},this.forceContextRestore=function(){const E=X.get("WEBGL_lose_context");E&&E.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(E){void 0!==E&&(G=E,this.setSize(W,ie,!1))},this.getSize=function(E){return E.set(W,ie)},this.setSize=function(E,L,U=!0){ae.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(W=E,ie=L,t.width=Math.floor(E*G),t.height=Math.floor(L*G),!0===U&&(t.style.width=E+"px",t.style.height=L+"px"),this.setViewport(0,0,E,L))},this.getDrawingBufferSize=function(E){return E.set(W*G,ie*G).floor()},this.setDrawingBufferSize=function(E,L,U){W=E,ie=L,G=U,t.width=Math.floor(E*U),t.height=Math.floor(L*U),this.setViewport(0,0,E,L)},this.getCurrentViewport=function(E){return E.copy(R)},this.getViewport=function(E){return E.copy(Ae)},this.setViewport=function(E,L,U,k){E.isVector4?Ae.set(E.x,E.y,E.z,E.w):Ae.set(E,L,U,k),J.viewport(R.copy(Ae).multiplyScalar(G).round())},this.getScissor=function(E){return E.copy(it)},this.setScissor=function(E,L,U,k){E.isVector4?it.set(E.x,E.y,E.z,E.w):it.set(E,L,U,k),J.scissor(B.copy(it).multiplyScalar(G).round())},this.getScissorTest=function(){return bt},this.setScissorTest=function(E){J.setScissorTest(bt=E)},this.setOpaqueSort=function(E){pe=E},this.setTransparentSort=function(E){Me=E},this.getClearColor=function(E){return E.copy(Re.getClearColor())},this.setClearColor=function(){Re.setClearColor(...arguments)},this.getClearAlpha=function(){return Re.getClearAlpha()},this.setClearAlpha=function(){Re.setClearAlpha(...arguments)},this.clear=function(E=!0,L=!0,U=!0){let k=0;if(E){let O=!1;if(null!==I){const oe=I.texture.format;O=oe===I_||oe===D_||oe===Pf}if(O){const oe=I.texture.type,ve=oe===Rr||oe===js||oe===Tu||oe===Au||oe===C_||oe===T_,De=Re.getClearColor(),Te=Re.getClearAlpha(),He=De.r,Je=De.g,Ve=De.b;ve?(p[0]=He,p[1]=Je,p[2]=Ve,p[3]=Te,P.clearBufferuiv(P.COLOR,0,p)):(v[0]=He,v[1]=Je,v[2]=Ve,v[3]=Te,P.clearBufferiv(P.COLOR,0,v))}else k|=P.COLOR_BUFFER_BIT}L&&(k|=P.DEPTH_BUFFER_BIT),U&&(k|=P.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),P.clear(k)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",fe,!1),t.removeEventListener("webglcontextrestored",Ce,!1),t.removeEventListener("webglcontextcreationerror",se,!1),Re.dispose(),j.dispose(),Le.dispose(),ne.dispose(),ot.dispose(),tt.dispose(),F.dispose(),_e.dispose(),ft.dispose(),z.dispose(),ae.dispose(),ae.removeEventListener("sessionstart",kr),ae.removeEventListener("sessionend",cP),na.stop()},this.renderBufferDirect=function(E,L,U,k,O,oe){null===L&&(L=We);const ve=O.isMesh&&O.matrixWorld.determinant()<0,De=function dY(E,L,U,k,O){!0!==L.isScene&&(L=We),he.resetTextureUnits();const oe=L.fog,De=null===I?x.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:vc,Te=(k.isMeshStandardMaterial?tt:ot).get(k.envMap||(k.isMeshStandardMaterial?L.environment:null)),He=!0===k.vertexColors&&!!U.attributes.color&&4===U.attributes.color.itemSize,Je=!!U.attributes.tangent&&(!!k.normalMap||k.anisotropy>0),Ve=!!U.morphAttributes.position,vt=!!U.morphAttributes.normal,Pt=!!U.morphAttributes.color;let dn=Gs;k.toneMapped&&(null===I||!0===I.isXRRenderTarget)&&(dn=x.toneMapping);const Ut=U.morphAttributes.position||U.morphAttributes.normal||U.morphAttributes.color,Vt=void 0!==Ut?Ut.length:0,ze=ne.get(k),Qt=m.state.lights;!0!==$||!0!==me&&E===S||le.setState(k,E,E===S&&k.id===b);let Et=!1;k.version===ze.__version?(ze.needsLights&&ze.lightsStateVersion!==Qt.state.version||ze.outputColorSpace!==De||O.isBatchedMesh&&!1===ze.batching||!O.isBatchedMesh&&!0===ze.batching||O.isBatchedMesh&&!0===ze.batchingColor&&null===O.colorTexture||O.isBatchedMesh&&!1===ze.batchingColor&&null!==O.colorTexture||O.isInstancedMesh&&!1===ze.instancing||!O.isInstancedMesh&&!0===ze.instancing||O.isSkinnedMesh&&!1===ze.skinning||!O.isSkinnedMesh&&!0===ze.skinning||O.isInstancedMesh&&!0===ze.instancingColor&&null===O.instanceColor||O.isInstancedMesh&&!1===ze.instancingColor&&null!==O.instanceColor||O.isInstancedMesh&&!0===ze.instancingMorph&&null===O.morphTexture||O.isInstancedMesh&&!1===ze.instancingMorph&&null!==O.morphTexture||ze.envMap!==Te||!0===k.fog&&ze.fog!==oe||void 0!==ze.numClippingPlanes&&(ze.numClippingPlanes!==le.numPlanes||ze.numIntersection!==le.numIntersection)||ze.vertexAlphas!==He||ze.vertexTangents!==Je||ze.morphTargets!==Ve||ze.morphNormals!==vt||ze.morphColors!==Pt||ze.toneMapping!==dn||ze.morphTargetsCount!==Vt)&&(Et=!0):(Et=!0,ze.__version=k.version);let Ui=ze.currentProgram;!0===Et&&(Ui=nm(k,L,O));let il=!1,ki=!1,cd=!1;const en=Ui.getUniforms(),Ji=ze.uniforms;if(J.useProgram(Ui.program)&&(il=!0,ki=!0,cd=!0),k.id!==b&&(b=k.id,ki=!0),il||S!==E){J.buffers.depth.getReversed()&&!0!==E.reversedDepth&&(E._reversedDepth=!0,E.updateProjectionMatrix()),en.setValue(P,"projectionMatrix",E.projectionMatrix),en.setValue(P,"viewMatrix",E.matrixWorldInverse);const _i=en.map.cameraPosition;void 0!==_i&&_i.setValue(P,ke.setFromMatrixPosition(E.matrixWorld)),te.logarithmicDepthBuffer&&en.setValue(P,"logDepthBufFC",2/(Math.log(E.far+1)/Math.LN2)),(k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshLambertMaterial||k.isMeshBasicMaterial||k.isMeshStandardMaterial||k.isShaderMaterial)&&en.setValue(P,"isOrthographic",!0===E.isOrthographicCamera),S!==E&&(S=E,ki=!0,cd=!0)}if(O.isSkinnedMesh){en.setOptional(P,O,"bindMatrix"),en.setOptional(P,O,"bindMatrixInverse");const ri=O.skeleton;ri&&(null===ri.boneTexture&&ri.computeBoneTexture(),en.setValue(P,"boneTexture",ri.boneTexture,he))}O.isBatchedMesh&&(en.setOptional(P,O,"batchingTexture"),en.setValue(P,"batchingTexture",O._matricesTexture,he),en.setOptional(P,O,"batchingIdTexture"),en.setValue(P,"batchingIdTexture",O._indirectTexture,he),en.setOptional(P,O,"batchingColorTexture"),null!==O._colorsTexture&&en.setValue(P,"batchingColorTexture",O._colorsTexture,he));const Ki=U.morphAttributes;if((void 0!==Ki.position||void 0!==Ki.normal||void 0!==Ki.color)&&re.update(O,U,Ui),(ki||ze.receiveShadow!==O.receiveShadow)&&(ze.receiveShadow=O.receiveShadow,en.setValue(P,"receiveShadow",O.receiveShadow)),k.isMeshGouraudMaterial&&null!==k.envMap&&(Ji.envMap.value=Te,Ji.flipEnvMap.value=Te.isCubeTexture&&!1===Te.isRenderTargetTexture?-1:1),k.isMeshStandardMaterial&&null===k.envMap&&null!==L.environment&&(Ji.envMapIntensity.value=L.environmentIntensity),ki&&(en.setValue(P,"toneMappingExposure",x.toneMappingExposure),ze.needsLights&&function hY(E,L){E.ambientLightColor.needsUpdate=L,E.lightProbe.needsUpdate=L,E.directionalLights.needsUpdate=L,E.directionalLightShadows.needsUpdate=L,E.pointLights.needsUpdate=L,E.pointLightShadows.needsUpdate=L,E.spotLights.needsUpdate=L,E.spotLightShadows.needsUpdate=L,E.rectAreaLights.needsUpdate=L,E.hemisphereLights.needsUpdate=L}(Ji,cd),oe&&!0===k.fog&&ee.refreshFogUniforms(Ji,oe),ee.refreshMaterialUniforms(Ji,k,G,ie,m.state.transmissionRenderTarget[E.id]),Xp.upload(P,hP(ze),Ji,he)),k.isShaderMaterial&&!0===k.uniformsNeedUpdate&&(Xp.upload(P,hP(ze),Ji,he),k.uniformsNeedUpdate=!1),k.isSpriteMaterial&&en.setValue(P,"center",O.center),en.setValue(P,"modelViewMatrix",O.modelViewMatrix),en.setValue(P,"normalMatrix",O.normalMatrix),en.setValue(P,"modelMatrix",O.matrixWorld),k.isShaderMaterial||k.isRawShaderMaterial){const ri=k.uniformsGroups;for(let _i=0,Gx=ri.length;_i<Gx;_i++){const ia=ri[_i];ft.update(ia,Ui),ft.bind(ia,Ui)}}return Ui}(E,L,U,k,O);J.setMaterial(k,ve);let Te=U.index,He=1;if(!0===k.wireframe){if(Te=M.getWireframeAttribute(U),void 0===Te)return;He=2}const Je=U.drawRange,Ve=U.attributes.position;let vt=Je.start*He,Pt=(Je.start+Je.count)*He;null!==oe&&(vt=Math.max(vt,oe.start*He),Pt=Math.min(Pt,(oe.start+oe.count)*He)),null!==Te?(vt=Math.max(vt,0),Pt=Math.min(Pt,Te.count)):null!=Ve&&(vt=Math.max(vt,0),Pt=Math.min(Pt,Ve.count));const dn=Pt-vt;if(dn<0||dn===1/0)return;_e.setup(O,k,De,U,Te);let Ut,Vt=Se;if(null!==Te&&(Ut=A.get(Te),Vt=Xe,Vt.setIndex(Ut)),O.isMesh)!0===k.wireframe?(J.setLineWidth(k.wireframeLinewidth*st()),Vt.setMode(P.LINES)):Vt.setMode(P.TRIANGLES);else if(O.isLine){let ze=k.linewidth;void 0===ze&&(ze=1),J.setLineWidth(ze*st()),Vt.setMode(O.isLineSegments?P.LINES:O.isLineLoop?P.LINE_LOOP:P.LINE_STRIP)}else O.isPoints?Vt.setMode(P.POINTS):O.isSprite&&Vt.setMode(P.TRIANGLES);if(O.isBatchedMesh)if(null!==O._multiDrawInstances)Mc("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Vt.renderMultiDrawInstances(O._multiDrawStarts,O._multiDrawCounts,O._multiDrawCount,O._multiDrawInstances);else if(X.get("WEBGL_multi_draw"))Vt.renderMultiDraw(O._multiDrawStarts,O._multiDrawCounts,O._multiDrawCount);else{const ze=O._multiDrawStarts,Qt=O._multiDrawCounts,Et=O._multiDrawCount,Ui=Te?A.get(Te).bytesPerElement:1,il=ne.get(k).currentProgram.getUniforms();for(let ki=0;ki<Et;ki++)il.setValue(P,"_gl_DrawID",ki),Vt.render(ze[ki]/Ui,Qt[ki])}else if(O.isInstancedMesh)Vt.renderInstances(vt,dn,O.count);else if(U.isInstancedBufferGeometry){const Qt=Math.min(U.instanceCount,void 0!==U._maxInstanceCount?U._maxInstanceCount:1/0);Vt.renderInstances(vt,dn,Qt)}else Vt.render(vt,dn)},this.compile=function(E,L,U=null){null===U&&(U=E),m=Le.get(U),m.init(L),_.push(m),U.traverseVisible(function(O){O.isLight&&O.layers.test(L.layers)&&(m.pushLight(O),O.castShadow&&m.pushShadow(O))}),E!==U&&E.traverseVisible(function(O){O.isLight&&O.layers.test(L.layers)&&(m.pushLight(O),O.castShadow&&m.pushShadow(O))}),m.setupLights();const k=new Set;return E.traverse(function(O){if(!(O.isMesh||O.isPoints||O.isLine||O.isSprite))return;const oe=O.material;if(oe)if(Array.isArray(oe))for(let ve=0;ve<oe.length;ve++){const De=oe[ve];$t(De,U,O),k.add(De)}else $t(oe,U,O),k.add(oe)}),m=_.pop(),k},this.compileAsync=function(E,L,U=null){const k=this.compile(E,L,U);return new Promise(O=>{function oe(){k.forEach(function(ve){ne.get(ve).currentProgram.isReady()&&k.delete(ve)}),0!==k.size?setTimeout(oe,10):O(E)}null!==X.get("KHR_parallel_shader_compile")?oe():setTimeout(oe,10)})};let Rt=null;function kr(){na.stop()}function cP(){na.start()}const na=new pR;function zx(E,L,U,k){if(!1===E.visible)return;if(E.layers.test(L.layers))if(E.isGroup)U=E.renderOrder;else if(E.isLOD)!0===E.autoUpdate&&E.update(L);else if(E.isLight)m.pushLight(E),E.castShadow&&m.pushShadow(E);else if(E.isSprite){if(!E.frustumCulled||wt.intersectsSprite(E)){k&&Ne.setFromMatrixPosition(E.matrixWorld).applyMatrix4(de);const ve=F.update(E),De=E.material;De.visible&&g.push(E,ve,De,U,Ne.z,null)}}else if((E.isMesh||E.isLine||E.isPoints)&&(!E.frustumCulled||wt.intersectsObject(E))){const ve=F.update(E),De=E.material;if(k&&(void 0!==E.boundingSphere?(null===E.boundingSphere&&E.computeBoundingSphere(),Ne.copy(E.boundingSphere.center)):(null===ve.boundingSphere&&ve.computeBoundingSphere(),Ne.copy(ve.boundingSphere.center)),Ne.applyMatrix4(E.matrixWorld).applyMatrix4(de)),Array.isArray(De)){const Te=ve.groups;for(let He=0,Je=Te.length;He<Je;He++){const Ve=Te[He],vt=De[Ve.materialIndex];vt&&vt.visible&&g.push(E,ve,vt,U,Ne.z,Ve)}}else De.visible&&g.push(E,ve,De,U,Ne.z,null)}const oe=E.children;for(let ve=0,De=oe.length;ve<De;ve++)zx(oe[ve],L,U,k)}function lP(E,L,U,k){const O=E.opaque,oe=E.transmissive,ve=E.transparent;m.setupLightsView(U),!0===$&&le.setGlobalState(x.clippingPlanes,U),k&&J.viewport(R.copy(k)),O.length>0&&tm(O,L,U),oe.length>0&&tm(oe,L,U),ve.length>0&&tm(ve,L,U),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1)}function uP(E,L,U,k){if(null!==(!0===U.isScene?U.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[k.id]&&(m.state.transmissionRenderTarget[k.id]=new Ni(1,1,{generateMipmaps:!0,type:X.has("EXT_color_buffer_half_float")||X.has("EXT_color_buffer_float")?cs:Rr,minFilter:as,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:xt.workingColorSpace}));const oe=m.state.transmissionRenderTarget[k.id],ve=k.viewport||R;oe.setSize(ve.z*x.transmissionResolutionScale,ve.w*x.transmissionResolutionScale);const De=x.getRenderTarget(),Te=x.getActiveCubeFace(),He=x.getActiveMipmapLevel();x.setRenderTarget(oe),x.getClearColor(H),Y=x.getClearAlpha(),Y<1&&x.setClearColor(16777215,.5),x.clear(),Yt&&Re.render(U);const Je=x.toneMapping;x.toneMapping=Gs;const Ve=k.viewport;if(void 0!==k.viewport&&(k.viewport=void 0),m.setupLightsView(k),!0===$&&le.setGlobalState(x.clippingPlanes,k),tm(E,U,k),he.updateMultisampleRenderTarget(oe),he.updateRenderTargetMipmap(oe),!1===X.has("WEBGL_multisampled_render_to_texture")){let vt=!1;for(let Pt=0,dn=L.length;Pt<dn;Pt++){const Ut=L[Pt],Vt=Ut.object,ze=Ut.geometry,Qt=Ut.material,Et=Ut.group;if(2===Qt.side&&Vt.layers.test(k.layers)){const Ui=Qt.side;Qt.side=1,Qt.needsUpdate=!0,dP(Vt,U,k,ze,Qt,Et),Qt.side=Ui,Qt.needsUpdate=!0,vt=!0}}!0===vt&&(he.updateMultisampleRenderTarget(oe),he.updateRenderTargetMipmap(oe))}x.setRenderTarget(De,Te,He),x.setClearColor(H,Y),void 0!==Ve&&(k.viewport=Ve),x.toneMapping=Je}function tm(E,L,U){const k=!0===L.isScene?L.overrideMaterial:null;for(let O=0,oe=E.length;O<oe;O++){const ve=E[O],De=ve.object,Te=ve.geometry,He=ve.group;let Je=ve.material;!0===Je.allowOverride&&null!==k&&(Je=k),De.layers.test(U.layers)&&dP(De,L,U,Te,Je,He)}}function dP(E,L,U,k,O,oe){E.onBeforeRender(x,L,U,k,O,oe),E.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,E.matrixWorld),E.normalMatrix.getNormalMatrix(E.modelViewMatrix),O.onBeforeRender(x,L,U,k,E,oe),!0===O.transparent&&2===O.side&&!1===O.forceSinglePass?(O.side=1,O.needsUpdate=!0,x.renderBufferDirect(U,L,k,O,E,oe),O.side=0,O.needsUpdate=!0,x.renderBufferDirect(U,L,k,O,E,oe),O.side=2):x.renderBufferDirect(U,L,k,O,E,oe),E.onAfterRender(x,L,U,k,O,oe)}function nm(E,L,U){!0!==L.isScene&&(L=We);const k=ne.get(E),O=m.state.lights,ve=O.state.version,De=z.getParameters(E,O.state,m.state.shadowsArray,L,U),Te=z.getProgramCacheKey(De);let He=k.programs;k.environment=E.isMeshStandardMaterial?L.environment:null,k.fog=L.fog,k.envMap=(E.isMeshStandardMaterial?tt:ot).get(E.envMap||k.environment),k.envMapRotation=null!==k.environment&&null===E.envMap?L.environmentRotation:E.envMapRotation,void 0===He&&(E.addEventListener("dispose",K),He=new Map,k.programs=He);let Je=He.get(Te);if(void 0!==Je){if(k.currentProgram===Je&&k.lightsStateVersion===ve)return fP(E,De),Je}else De.uniforms=z.getUniforms(E),E.onBeforeCompile(De,x),Je=z.acquireProgram(De,Te),He.set(Te,Je),k.uniforms=De.uniforms;const Ve=k.uniforms;return(!E.isShaderMaterial&&!E.isRawShaderMaterial||!0===E.clipping)&&(Ve.clippingPlanes=le.uniform),fP(E,De),k.needsLights=function fY(E){return E.isMeshLambertMaterial||E.isMeshToonMaterial||E.isMeshPhongMaterial||E.isMeshStandardMaterial||E.isShadowMaterial||E.isShaderMaterial&&!0===E.lights}(E),k.lightsStateVersion=ve,k.needsLights&&(Ve.ambientLightColor.value=O.state.ambient,Ve.lightProbe.value=O.state.probe,Ve.directionalLights.value=O.state.directional,Ve.directionalLightShadows.value=O.state.directionalShadow,Ve.spotLights.value=O.state.spot,Ve.spotLightShadows.value=O.state.spotShadow,Ve.rectAreaLights.value=O.state.rectArea,Ve.ltc_1.value=O.state.rectAreaLTC1,Ve.ltc_2.value=O.state.rectAreaLTC2,Ve.pointLights.value=O.state.point,Ve.pointLightShadows.value=O.state.pointShadow,Ve.hemisphereLights.value=O.state.hemi,Ve.directionalShadowMap.value=O.state.directionalShadowMap,Ve.directionalShadowMatrix.value=O.state.directionalShadowMatrix,Ve.spotShadowMap.value=O.state.spotShadowMap,Ve.spotLightMatrix.value=O.state.spotLightMatrix,Ve.spotLightMap.value=O.state.spotLightMap,Ve.pointShadowMap.value=O.state.pointShadowMap,Ve.pointShadowMatrix.value=O.state.pointShadowMatrix),k.currentProgram=Je,k.uniformsList=null,Je}function hP(E){if(null===E.uniformsList){const L=E.currentProgram.getUniforms();E.uniformsList=Xp.seqWithValue(L.seq,E.uniforms)}return E.uniformsList}function fP(E,L){const U=ne.get(E);U.outputColorSpace=L.outputColorSpace,U.batching=L.batching,U.batchingColor=L.batchingColor,U.instancing=L.instancing,U.instancingColor=L.instancingColor,U.instancingMorph=L.instancingMorph,U.skinning=L.skinning,U.morphTargets=L.morphTargets,U.morphNormals=L.morphNormals,U.morphColors=L.morphColors,U.morphTargetsCount=L.morphTargetsCount,U.numClippingPlanes=L.numClippingPlanes,U.numIntersection=L.numClipIntersection,U.vertexAlphas=L.vertexAlphas,U.vertexTangents=L.vertexTangents,U.toneMapping=L.toneMapping}na.setAnimationLoop(function Ss(E){Rt&&Rt(E)}),typeof self<"u"&&na.setContext(self),this.setAnimationLoop=function(E){Rt=E,ae.setAnimationLoop(E),null===E?na.stop():na.start()},ae.addEventListener("sessionstart",kr),ae.addEventListener("sessionend",cP),this.render=function(E,L){if(void 0!==L&&!0!==L.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===w)return;if(!0===E.matrixWorldAutoUpdate&&E.updateMatrixWorld(),null===L.parent&&!0===L.matrixWorldAutoUpdate&&L.updateMatrixWorld(),!0===ae.enabled&&!0===ae.isPresenting&&(!0===ae.cameraAutoUpdate&&ae.updateCamera(L),L=ae.getCamera()),!0===E.isScene&&E.onBeforeRender(x,E,L,I),m=Le.get(E,_.length),m.init(L),_.push(m),de.multiplyMatrices(L.projectionMatrix,L.matrixWorldInverse),wt.setFromProjectionMatrix(de,Xi,L.reversedDepth),me=this.localClippingEnabled,$=le.init(this.clippingPlanes,me),g=j.get(E,y.length),g.init(),y.push(g),!0===ae.enabled&&!0===ae.isPresenting){const oe=x.xr.getDepthSensingMesh();null!==oe&&zx(oe,L,-1/0,x.sortObjects)}zx(E,L,0,x.sortObjects),g.finish(),!0===x.sortObjects&&g.sort(pe,Me),Yt=!1===ae.enabled||!1===ae.isPresenting||!1===ae.hasDepthSensing(),Yt&&Re.addToRenderList(g,E),this.info.render.frame++,!0===$&&le.beginShadows(),Ie.render(m.state.shadowsArray,E,L),!0===$&&le.endShadows(),!0===this.info.autoReset&&this.info.reset();const k=g.opaque,O=g.transmissive;if(m.setupLights(),L.isArrayCamera){const oe=L.cameras;if(O.length>0)for(let ve=0,De=oe.length;ve<De;ve++)uP(k,O,E,oe[ve]);Yt&&Re.render(E);for(let ve=0,De=oe.length;ve<De;ve++){const Te=oe[ve];lP(g,E,Te,Te.viewport)}}else O.length>0&&uP(k,O,E,L),Yt&&Re.render(E),lP(g,E,L);null!==I&&0===D&&(he.updateMultisampleRenderTarget(I),he.updateRenderTargetMipmap(I)),!0===E.isScene&&E.onAfterRender(x,E,L),_e.resetDefaultState(),b=-1,S=null,_.pop(),_.length>0?(m=_[_.length-1],!0===$&&le.setGlobalState(x.clippingPlanes,m.state.camera)):m=null,y.pop(),g=y.length>0?y[y.length-1]:null},this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function(E,L,U){const k=ne.get(E);k.__autoAllocateDepthBuffer=!1===E.resolveDepthBuffer,!1===k.__autoAllocateDepthBuffer&&(k.__useRenderToTexture=!1),ne.get(E.texture).__webglTexture=L,ne.get(E.depthTexture).__webglTexture=k.__autoAllocateDepthBuffer?void 0:U,k.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(E,L){const U=ne.get(E);U.__webglFramebuffer=L,U.__useDefaultFramebuffer=void 0===L};const pY=P.createFramebuffer();this.setRenderTarget=function(E,L=0,U=0){I=E,C=L,D=U;let k=!0,O=null,oe=!1,ve=!1;if(E){const Te=ne.get(E);if(void 0!==Te.__useDefaultFramebuffer)J.bindFramebuffer(P.FRAMEBUFFER,null),k=!1;else if(void 0===Te.__webglFramebuffer)he.setupRenderTarget(E);else if(Te.__hasExternalTextures)he.rebindTextures(E,ne.get(E.texture).__webglTexture,ne.get(E.depthTexture).__webglTexture);else if(E.depthBuffer){const Ve=E.depthTexture;if(Te.__boundDepthTexture!==Ve){if(null!==Ve&&ne.has(Ve)&&(E.width!==Ve.image.width||E.height!==Ve.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");he.setupDepthRenderbuffer(E)}}const He=E.texture;(He.isData3DTexture||He.isDataArrayTexture||He.isCompressedArrayTexture)&&(ve=!0);const Je=ne.get(E).__webglFramebuffer;E.isWebGLCubeRenderTarget?(O=Array.isArray(Je[L])?Je[L][U]:Je[L],oe=!0):O=E.samples>0&&!1===he.useMultisampledRTT(E)?ne.get(E).__webglMultisampledFramebuffer:Array.isArray(Je)?Je[U]:Je,R.copy(E.viewport),B.copy(E.scissor),V=E.scissorTest}else R.copy(Ae).multiplyScalar(G).floor(),B.copy(it).multiplyScalar(G).floor(),V=bt;if(0!==U&&(O=pY),J.bindFramebuffer(P.FRAMEBUFFER,O)&&k&&J.drawBuffers(E,O),J.viewport(R),J.scissor(B),J.setScissorTest(V),oe){const Te=ne.get(E.texture);P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_CUBE_MAP_POSITIVE_X+L,Te.__webglTexture,U)}else if(ve){const Te=L;for(let He=0;He<E.textures.length;He++){const Je=ne.get(E.textures[He]);P.framebufferTextureLayer(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0+He,Je.__webglTexture,U,Te)}}else if(null!==E&&0!==U){const Te=ne.get(E.texture);P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_2D,Te.__webglTexture,U)}b=-1},this.readRenderTargetPixels=function(E,L,U,k,O,oe,ve,De=0){if(!E||!E.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Te=ne.get(E).__webglFramebuffer;if(E.isWebGLCubeRenderTarget&&void 0!==ve&&(Te=Te[ve]),Te){J.bindFramebuffer(P.FRAMEBUFFER,Te);try{const He=E.textures[De],Je=He.format,Ve=He.type;if(!te.textureFormatReadable(Je))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!te.textureTypeReadable(Ve))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");L>=0&&L<=E.width-k&&U>=0&&U<=E.height-O&&(E.textures.length>1&&P.readBuffer(P.COLOR_ATTACHMENT0+De),P.readPixels(L,U,k,O,Fe.convert(Je),Fe.convert(Ve),oe))}finally{const He=null!==I?ne.get(I).__webglFramebuffer:null;J.bindFramebuffer(P.FRAMEBUFFER,He)}}},this.readRenderTargetPixelsAsync=function(){var E=hc(function*(L,U,k,O,oe,ve,De,Te=0){if(!L||!L.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let He=ne.get(L).__webglFramebuffer;if(L.isWebGLCubeRenderTarget&&void 0!==De&&(He=He[De]),He){if(U>=0&&U<=L.width-O&&k>=0&&k<=L.height-oe){J.bindFramebuffer(P.FRAMEBUFFER,He);const Je=L.textures[Te],Ve=Je.format,vt=Je.type;if(!te.textureFormatReadable(Ve))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!te.textureTypeReadable(vt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Pt=P.createBuffer();P.bindBuffer(P.PIXEL_PACK_BUFFER,Pt),P.bufferData(P.PIXEL_PACK_BUFFER,ve.byteLength,P.STREAM_READ),L.textures.length>1&&P.readBuffer(P.COLOR_ATTACHMENT0+Te),P.readPixels(U,k,O,oe,Fe.convert(Ve),Fe.convert(vt),0);const dn=null!==I?ne.get(I).__webglFramebuffer:null;J.bindFramebuffer(P.FRAMEBUFFER,dn);const Ut=P.fenceSync(P.SYNC_GPU_COMMANDS_COMPLETE,0);return P.flush(),yield function Lj(n,e,t){return new Promise(function(i,r){setTimeout(function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}},t)})}(P,Ut,4),P.bindBuffer(P.PIXEL_PACK_BUFFER,Pt),P.getBufferSubData(P.PIXEL_PACK_BUFFER,0,ve),P.deleteBuffer(Pt),P.deleteSync(Ut),ve}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}});return function(L,U,k,O,oe,ve,De){return E.apply(this,arguments)}}(),this.copyFramebufferToTexture=function(E,L=null,U=0){const k=Math.pow(2,-U),O=Math.floor(E.image.width*k),oe=Math.floor(E.image.height*k),ve=null!==L?L.x:0,De=null!==L?L.y:0;he.setTexture2D(E,0),P.copyTexSubImage2D(P.TEXTURE_2D,U,0,0,ve,De,O,oe),J.unbindTexture()};const mY=P.createFramebuffer(),gY=P.createFramebuffer();this.copyTextureToTexture=function(E,L,U=null,k=null,O=0,oe=null){let ve,De,Te,He,Je,Ve,vt,Pt,dn;null===oe&&(0!==O?(Mc("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),oe=O,O=0):oe=0);const Ut=E.isCompressedTexture?E.mipmaps[oe]:E.image;if(null!==U)ve=U.max.x-U.min.x,De=U.max.y-U.min.y,Te=U.isBox3?U.max.z-U.min.z:1,He=U.min.x,Je=U.min.y,Ve=U.isBox3?U.min.z:0;else{const Ki=Math.pow(2,-O);ve=Math.floor(Ut.width*Ki),De=Math.floor(Ut.height*Ki),Te=E.isDataArrayTexture?Ut.depth:E.isData3DTexture?Math.floor(Ut.depth*Ki):1,He=0,Je=0,Ve=0}null!==k?(vt=k.x,Pt=k.y,dn=k.z):(vt=0,Pt=0,dn=0);const Vt=Fe.convert(L.format),ze=Fe.convert(L.type);let Qt;L.isData3DTexture?(he.setTexture3D(L,0),Qt=P.TEXTURE_3D):L.isDataArrayTexture||L.isCompressedArrayTexture?(he.setTexture2DArray(L,0),Qt=P.TEXTURE_2D_ARRAY):(he.setTexture2D(L,0),Qt=P.TEXTURE_2D),P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,L.flipY),P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.premultiplyAlpha),P.pixelStorei(P.UNPACK_ALIGNMENT,L.unpackAlignment);const Et=P.getParameter(P.UNPACK_ROW_LENGTH),Ui=P.getParameter(P.UNPACK_IMAGE_HEIGHT),il=P.getParameter(P.UNPACK_SKIP_PIXELS),ki=P.getParameter(P.UNPACK_SKIP_ROWS),cd=P.getParameter(P.UNPACK_SKIP_IMAGES);P.pixelStorei(P.UNPACK_ROW_LENGTH,Ut.width),P.pixelStorei(P.UNPACK_IMAGE_HEIGHT,Ut.height),P.pixelStorei(P.UNPACK_SKIP_PIXELS,He),P.pixelStorei(P.UNPACK_SKIP_ROWS,Je),P.pixelStorei(P.UNPACK_SKIP_IMAGES,Ve);const en=E.isDataArrayTexture||E.isData3DTexture,Ji=L.isDataArrayTexture||L.isData3DTexture;if(E.isDepthTexture){const Ki=ne.get(E),ri=ne.get(L),_i=ne.get(Ki.__renderTarget),Gx=ne.get(ri.__renderTarget);J.bindFramebuffer(P.READ_FRAMEBUFFER,_i.__webglFramebuffer),J.bindFramebuffer(P.DRAW_FRAMEBUFFER,Gx.__webglFramebuffer);for(let ia=0;ia<Te;ia++)en&&(P.framebufferTextureLayer(P.READ_FRAMEBUFFER,P.COLOR_ATTACHMENT0,ne.get(E).__webglTexture,O,Ve+ia),P.framebufferTextureLayer(P.DRAW_FRAMEBUFFER,P.COLOR_ATTACHMENT0,ne.get(L).__webglTexture,oe,dn+ia)),P.blitFramebuffer(He,Je,ve,De,vt,Pt,ve,De,P.DEPTH_BUFFER_BIT,P.NEAREST);J.bindFramebuffer(P.READ_FRAMEBUFFER,null),J.bindFramebuffer(P.DRAW_FRAMEBUFFER,null)}else if(0!==O||E.isRenderTargetTexture||ne.has(E)){const Ki=ne.get(E),ri=ne.get(L);J.bindFramebuffer(P.READ_FRAMEBUFFER,mY),J.bindFramebuffer(P.DRAW_FRAMEBUFFER,gY);for(let _i=0;_i<Te;_i++)en?P.framebufferTextureLayer(P.READ_FRAMEBUFFER,P.COLOR_ATTACHMENT0,Ki.__webglTexture,O,Ve+_i):P.framebufferTexture2D(P.READ_FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_2D,Ki.__webglTexture,O),Ji?P.framebufferTextureLayer(P.DRAW_FRAMEBUFFER,P.COLOR_ATTACHMENT0,ri.__webglTexture,oe,dn+_i):P.framebufferTexture2D(P.DRAW_FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_2D,ri.__webglTexture,oe),0!==O?P.blitFramebuffer(He,Je,ve,De,vt,Pt,ve,De,P.COLOR_BUFFER_BIT,P.NEAREST):Ji?P.copyTexSubImage3D(Qt,oe,vt,Pt,dn+_i,He,Je,ve,De):P.copyTexSubImage2D(Qt,oe,vt,Pt,He,Je,ve,De);J.bindFramebuffer(P.READ_FRAMEBUFFER,null),J.bindFramebuffer(P.DRAW_FRAMEBUFFER,null)}else Ji?E.isDataTexture||E.isData3DTexture?P.texSubImage3D(Qt,oe,vt,Pt,dn,ve,De,Te,Vt,ze,Ut.data):L.isCompressedArrayTexture?P.compressedTexSubImage3D(Qt,oe,vt,Pt,dn,ve,De,Te,Vt,Ut.data):P.texSubImage3D(Qt,oe,vt,Pt,dn,ve,De,Te,Vt,ze,Ut):E.isDataTexture?P.texSubImage2D(P.TEXTURE_2D,oe,vt,Pt,ve,De,Vt,ze,Ut.data):E.isCompressedTexture?P.compressedTexSubImage2D(P.TEXTURE_2D,oe,vt,Pt,Ut.width,Ut.height,Vt,Ut.data):P.texSubImage2D(P.TEXTURE_2D,oe,vt,Pt,ve,De,Vt,ze,Ut);P.pixelStorei(P.UNPACK_ROW_LENGTH,Et),P.pixelStorei(P.UNPACK_IMAGE_HEIGHT,Ui),P.pixelStorei(P.UNPACK_SKIP_PIXELS,il),P.pixelStorei(P.UNPACK_SKIP_ROWS,ki),P.pixelStorei(P.UNPACK_SKIP_IMAGES,cd),0===oe&&L.generateMipmaps&&P.generateMipmap(Qt),J.unbindTexture()},this.copyTextureToTexture3D=function(E,L,U=null,k=null,O=0){return Mc('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(E,L,U,k,O)},this.initRenderTarget=function(E){void 0===ne.get(E).__webglFramebuffer&&he.setupRenderTarget(E)},this.initTexture=function(E){E.isCubeTexture?he.setTextureCube(E,0):E.isData3DTexture?he.setTexture3D(E,0):E.isDataArrayTexture||E.isCompressedArrayTexture?he.setTexture2DArray(E,0):he.setTexture2D(E,0),J.unbindTexture()},this.resetState=function(){C=0,D=0,I=null,J.reset(),_e.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Xi}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=xt._getDrawingBufferColorSpace(e),t.unpackColorSpace=xt._getUnpackColorSpace()}}const Zp={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class sd{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const u7=new id(-1,1,1,-1,0,1),h7=new class d7 extends dt{constructor(){super(),this.setAttribute("position",new we([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new we([0,2,0,0,2,0],2))}};class WR{constructor(e){this._mesh=new ln(h7,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,u7)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class f7 extends sd{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof Rn?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=rp.clone(e.uniforms),this.material=new Rn({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new WR(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class jR extends sd{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),s=e.state;let o,a;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class p7 extends sd{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class m7{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const i=e.getSize(new q);this._width=i.width,this._height=i.height,(t=new Ni(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:cs})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new f7(Zp),this.copyPass.material.blending=0,this.clock=new Q1}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let r=0,s=this.passes.length;r<s;r++){const o=this.passes[r];if(!1!==o.enabled){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==jR&&(o instanceof jR?i=!0:o instanceof p7&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new q);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class g7 extends sd{constructor(e,t,i=null,r=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new xe}render(e,t,i){const r=e.autoClear;let s,o;e.autoClear=!1,null!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(s),null!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=r}}const v7={name:"LuminosityHighPassShader",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new xe(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat v = luminance( texel.xyz );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class el extends sd{constructor(e,t=1,i,r){super(),this.strength=t,this.radius=i,this.threshold=r,this.resolution=void 0!==e?new q(e.x,e.y):new q(256,256),this.clearColor=new xe(0,0,0),this.needsSwap=!1,this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let s=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new Ni(s,o,{type:cs}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let u=0;u<this.nMips;u++){const d=new Ni(s,o,{type:cs});d.texture.name="UnrealBloomPass.h"+u,d.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(d);const h=new Ni(s,o,{type:cs});h.texture.name="UnrealBloomPass.v"+u,h.texture.generateMipmaps=!1,this.renderTargetsVertical.push(h),s=Math.round(s/2),o=Math.round(o/2)}const a=v7;this.highPassUniforms=rp.clone(a.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Rn({uniforms:this.highPassUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.separableBlurMaterials=[];const c=[3,5,7,9,11];s=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);for(let u=0;u<this.nMips;u++)this.separableBlurMaterials.push(this._getSeparableBlurMaterial(c[u])),this.separableBlurMaterials[u].uniforms.invSize.value=new q(1/s,1/o),s=Math.round(s/2),o=Math.round(o/2);this.compositeMaterial=this._getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new T(1,1,1),new T(1,1,1),new T(1,1,1),new T(1,1,1),new T(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.copyUniforms=rp.clone(Zp.uniforms),this.blendMaterial=new Rn({uniforms:this.copyUniforms,vertexShader:Zp.vertexShader,fragmentShader:Zp.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),this._oldClearColor=new xe,this._oldClearAlpha=1,this._basic=new Ks,this._fsQuad=new WR(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this._basic.dispose(),this._fsQuad.dispose()}setSize(e,t){let i=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(i,r);for(let s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(i,r),this.renderTargetsVertical[s].setSize(i,r),this.separableBlurMaterials[s].uniforms.invSize.value=new q(1/i,1/r),i=Math.round(i/2),r=Math.round(r/2)}render(e,t,i,r,s){e.getClearColor(this._oldClearColor),this._oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),s&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this._fsQuad.material=this._basic,this._basic.map=i.texture,e.setRenderTarget(null),e.clear(),this._fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this._fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this._fsQuad.render(e);let a=this.renderTargetBright;for(let c=0;c<this.nMips;c++)this._fsQuad.material=this.separableBlurMaterials[c],this.separableBlurMaterials[c].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[c].uniforms.direction.value=el.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[c]),e.clear(),this._fsQuad.render(e),this.separableBlurMaterials[c].uniforms.colorTexture.value=this.renderTargetsHorizontal[c].texture,this.separableBlurMaterials[c].uniforms.direction.value=el.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[c]),e.clear(),this._fsQuad.render(e),a=this.renderTargetsVertical[c];this._fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this._fsQuad.render(e),this._fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,s&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(i),this._fsQuad.render(e)),e.setClearColor(this._oldClearColor,this._oldClearAlpha),e.autoClear=o}_getSeparableBlurMaterial(e){const t=[];for(let i=0;i<e;i++)t.push(.39894*Math.exp(-.5*i*i/(e*e))/e);return new Rn({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new q(.5,.5)},direction:{value:new q(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}_getCompositeMaterial(e){return new Rn({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}el.BlurDirectionX=new q(1,0),el.BlurDirectionY=new q(0,1);let y7=(()=>{class n{constructor(){this.animationFrameId=null,this.resizeHandler=()=>{},this.rendererDom=null}ngOnInit(){this.startAsciiDonut()}ngOnDestroy(){null!==this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),window.removeEventListener("resize",this.resizeHandler),this.rendererDom&&this.rendererDom.parentNode&&this.rendererDom.parentNode.removeChild(this.rendererDom)}startAsciiDonut(){const t=document.getElementById("ascii-donut");if(!t)return void console.error("Container with id 'ascii-donut' not found.");const i=t.clientWidth,r=t.clientHeight,s=new ZI,o=new id(-1,1,1,-1,0,1),a=new l7({antialias:!0});a.setSize(i,r),t.appendChild(a.domElement),this.rendererDom=a.domElement;const c=new Rn({uniforms:{u_time:{value:0},u_resolution:{value:new q(i,r)}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform float u_time;\n        uniform vec2 u_resolution;\n        varying vec2 vUv;\n\n        #define MAX_STEPS 50\n        #define MAX_DIST 50.0\n        #define SURF_DIST 0.001\n\n        float mandelbulb(vec3 pos) {\n          vec3 z = pos;\n          float dr = 1.0;\n          float r = 0.0;\n          float power = 8.0 + sin(u_time * 0.2) * 2.0;\n          for (int i = 0; i < 4; i++) {\n            r = length(z);\n            if (r > 2.0) break;\n            float theta = acos(z.z / r);\n            float phi = atan(z.y, z.x);\n            dr = pow(r, power - 1.0) * power * dr + 1.0;\n            float zr = pow(r, power);\n            theta = theta * power;\n            phi = phi * power;\n            z = zr * vec3(\n              sin(theta) * cos(phi),\n              sin(phi) * sin(theta),\n              cos(theta)\n            );\n            z += pos;\n          }\n          return 0.5 * log(r) * r / dr;\n        }\n\n        float rayMarch(vec3 ro, vec3 rd) {\n          float dO = 0.0;\n          for (int i = 0; i < MAX_STEPS; i++) {\n            vec3 p = ro + rd * dO;\n            float dS = mandelbulb(p);\n            dO += dS;\n            if (dO > MAX_DIST || dS < SURF_DIST) break;\n          }\n          return dO;\n        }\n\n        vec3 getNormal(vec3 p) {\n          float d = mandelbulb(p);\n          vec2 e = vec2(0.001, 0);\n          vec3 n = d - vec3(\n            mandelbulb(p - e.xyy),\n            mandelbulb(p - e.yxy),\n            mandelbulb(p - e.yyx)\n          );\n          return normalize(n);\n        }\n\n        void main() {\n          vec2 uv = (vUv - 0.5) * u_resolution.xy / u_resolution.y;\n          float camTime = u_time * 0.3;\n          // Move the camera further back so the fractal appears smaller\n          vec3 ro = vec3(\n            sin(camTime) * 2.0,\n            cos(camTime) * 2.0,\n            -2.0\n          );\n          vec3 lookAt = vec3(0.0);\n          vec3 forward = normalize(lookAt - ro);\n          vec3 right = normalize(cross(vec3(0, 1, 0), forward));\n          vec3 up = cross(forward, right);\n          vec3 rd = normalize(forward + uv.x * right + uv.y * up);\n          float d = rayMarch(ro, rd);\n          vec3 col = vec3(0.0);\n          if (d < MAX_DIST) {\n            vec3 p = ro + rd * d;\n            vec3 n = getNormal(p);\n            vec3 lightPos = vec3(sin(u_time), 5.0, cos(u_time));\n            vec3 l = normalize(lightPos - p);\n            vec3 baseColor = vec3(\n              0.25 + 0.25 * sin(p.x + u_time),\n              0.25 + 0.25 * sin(p.y + u_time * 0.7),\n              0.25 + 0.25 * sin(p.z + u_time * 0.3)\n            );\n            float dif = clamp(dot(n, l), 0.0, 1.0);\n            vec3 diffuse = baseColor * dif * 0.5;\n            vec3 r = reflect(-l, n);\n            float spec = pow(max(dot(r, -rd), 0.0), 32.0);\n            float glow = clamp(1.0 - dot(n, -rd), 0.0, 1.0);\n            glow = pow(glow, 2.0) * 0.15;\n            vec3 specColor = vec3(0.5, 0.4, 0.3);\n            col = diffuse +\n                  baseColor * 0.15 +\n                  specColor * spec * 0.5 +\n                  baseColor * glow;\n            float maxComp = max(max(col.r, col.g), col.b);\n            if (maxComp > 0.6) {\n              col = col * (0.6 / maxComp);\n            }\n            col = mix(col, vec3(0.1), 0.2);\n            col = clamp(col, 0.0, 1.0);\n          }\n          vec3 bg = vec3(0.0, 0.0, 0.0);\n          col = mix(bg, col, smoothstep(MAX_DIST - 1.0, MAX_DIST - 5.0, d));\n          col = pow(col, vec3(0.4));\n          gl_FragColor = vec4(col, 1.0);\n        }\n      "}),l=new jc(2,2),u=new ln(l,c);s.add(u);const d=new m7(a);d.addPass(new g7(s,o)),d.addPass(new el(new q(i,r),.5,.2,.4));const h=f=>{c.uniforms.u_time.value=.001*f,d.render(),this.animationFrameId=requestAnimationFrame(h)};this.resizeHandler=()=>{const f=t.clientWidth,p=t.clientHeight;a.setSize(f,p),d.setSize(f,p),c.uniforms.u_resolution.value.set(f,p)},window.addEventListener("resize",this.resizeHandler),h(0)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=Cs({type:n,selectors:[["app-home"]],decls:6,vars:0,consts:[[1,"home-content"],["id","ascii-donut",1,"ascii-donut"]],template:function(i,r){1&i&&(et(0,"div",0)(1,"p"),Ct(2,"Computer Science and Software Engineering "),Yn(3,"br"),Ct(4," at Western University"),ht(),Yn(5,"pre",1),ht())},styles:[".home-content[_ngcontent-%COMP%]{text-align:center;padding:20px}.home-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{font-size:1rem;margin-bottom:5vh}.ascii-donut[_ngcontent-%COMP%]{width:350px;height:350px;margin:0 auto;padding:0;display:block}"]})}}return n})();class Jp{}class Kp{}class Ur{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?"string"==typeof e?this.lazyInit=()=>{this.headers=new Map,e.split("\n").forEach(t=>{const i=t.indexOf(":");if(i>0){const r=t.slice(0,i),s=r.toLowerCase(),o=t.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,i)=>{this.setHeaderEntries(i,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,i])=>{this.setHeaderEntries(t,i)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Ur?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Ur;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Ur?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...i),this.headers.set(t,r);break;case"d":const s=e.value;if(s){let o=this.headers.get(t);if(!o)return;o=o.filter(a=>-1===s.indexOf(a)),0===o.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}else this.headers.delete(t),this.normalizedNames.delete(t)}}setHeaderEntries(e,t){const i=(Array.isArray(t)?t:[t]).map(s=>s.toString()),r=e.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(e,r)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class _7{encodeKey(e){return $R(e)}encodeValue(e){return $R(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const M7=/%(\d[a-f0-9])/gi,S7={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function $R(n){return encodeURIComponent(n).replace(M7,(e,t)=>S7[t]??e)}function Qp(n){return`${n}`}class no{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new _7,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function x7(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[o,a]=-1==s?[e.decodeKey(r),""]:[e.decodeKey(r.slice(0,s)),e.decodeValue(r.slice(s+1))],c=t.get(o)||[];c.push(a),t.set(o,c)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const i=e.fromObject[t],r=Array.isArray(i)?i.map(Qp):[Qp(i)];this.map.set(t,r)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(i=>{const r=e[i];Array.isArray(r)?r.forEach(s=>{t.push({param:i,value:s,op:"a"})}):t.push({param:i,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new no({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(Qp(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let i=this.map.get(e.param)||[];const r=i.indexOf(Qp(e.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class b7{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function qR(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function XR(n){return typeof Blob<"u"&&n instanceof Blob}function YR(n){return typeof FormData<"u"&&n instanceof FormData}class od{constructor(e,t,i,r){let s;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function w7(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new Ur),this.context||(this.context=new b7),this.params){const o=this.params.toString();if(0===o.length)this.urlWithParams=t;else{const a=t.indexOf("?");this.urlWithParams=t+(-1===a?"?":a<t.length-1?"&":"")+o}}else this.params=new no,this.urlWithParams=t}serializeBody(){return null===this.body?null:qR(this.body)||XR(this.body)||YR(this.body)||function E7(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof no?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||YR(this.body)?null:XR(this.body)?this.body.type||null:qR(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof no?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method||this.method,i=e.url||this.url,r=e.responseType||this.responseType,s=void 0!==e.body?e.body:this.body,o=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,a=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let c=e.headers||this.headers,l=e.params||this.params;const u=e.context??this.context;return void 0!==e.setHeaders&&(c=Object.keys(e.setHeaders).reduce((d,h)=>d.set(h,e.setHeaders[h]),c)),e.setParams&&(l=Object.keys(e.setParams).reduce((d,h)=>d.set(h,e.setParams[h]),l)),new od(t,i,s,{params:l,headers:c,context:u,reportProgress:a,responseType:r,withCredentials:o})}}var tl=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(tl||{});class Ux{constructor(e,t=200,i="OK"){this.headers=e.headers||new Ur,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||i,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class kx extends Ux{constructor(e={}){super(e),this.type=tl.ResponseHeader}clone(e={}){return new kx({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class nl extends Ux{constructor(e={}){super(e),this.type=tl.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new nl({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class ZR extends Ux{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function Bx(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let Vx=(()=>{class n{constructor(t){this.handler=t}request(t,i,r={}){let s;if(t instanceof od)s=t;else{let c,l;c=r.headers instanceof Ur?r.headers:new Ur(r.headers),r.params&&(l=r.params instanceof no?r.params:new no({fromObject:r.params})),s=new od(t,i,void 0!==r.body?r.body:null,{headers:c,context:r.context,params:l,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const o=je(s).pipe(ic(c=>this.handler.handle(c)));if(t instanceof od||"events"===r.observe)return o;const a=o.pipe(ts(c=>c instanceof nl));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return a.pipe(Dt(c=>{if(null!==c.body&&!(c.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return c.body}));case"blob":return a.pipe(Dt(c=>{if(null!==c.body&&!(c.body instanceof Blob))throw new Error("Response is not a Blob.");return c.body}));case"text":return a.pipe(Dt(c=>{if(null!==c.body&&"string"!=typeof c.body)throw new Error("Response is not a string.");return c.body}));default:return a.pipe(Dt(c=>c.body))}case"response":return a;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:(new no).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,r={}){return this.request("PATCH",t,Bx(r,i))}post(t,i,r={}){return this.request("POST",t,Bx(r,i))}put(t,i,r={}){return this.request("PUT",t,Bx(r,i))}static{this.\u0275fac=function(i){return new(i||n)(Oe(Jp))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();function QR(n,e){return e(n)}function T7(n,e){return(t,i)=>e.intercept(t,{handle:r=>n(r,i)})}const D7=new Ee(""),ad=new Ee(""),eP=new Ee("");function I7(){let n=null;return(e,t)=>{null===n&&(n=(be(D7,{optional:!0})??[]).reduceRight(T7,QR));const i=be(kh),r=i.add();return n(e,t).pipe(lu(()=>i.remove(r)))}}let tP=(()=>{class n extends Jp{constructor(t,i){super(),this.backend=t,this.injector=i,this.chain=null,this.pendingTasks=be(kh)}handle(t){if(null===this.chain){const r=Array.from(new Set([...this.injector.get(ad),...this.injector.get(eP,[])]));this.chain=r.reduceRight((s,o)=>function A7(n,e,t){return(i,r)=>t.runInContext(()=>e(i,s=>n(s,r)))}(s,o,this.injector),QR)}const i=this.pendingTasks.add();return this.chain(t,r=>this.backend.handle(r)).pipe(lu(()=>this.pendingTasks.remove(i)))}static{this.\u0275fac=function(i){return new(i||n)(Oe(Kp),Oe(Ei))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();const L7=/^\)\]\}',?\n/;let iP=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new ce(-2800,!1);const i=this.xhrFactory;return(i.\u0275loadImpl?Sn(i.\u0275loadImpl()):je(null)).pipe(er(()=>new hn(s=>{const o=i.build();if(o.open(t.method,t.urlWithParams),t.withCredentials&&(o.withCredentials=!0),t.headers.forEach((v,g)=>o.setRequestHeader(v,g.join(","))),t.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const v=t.detectContentTypeHeader();null!==v&&o.setRequestHeader("Content-Type",v)}if(t.responseType){const v=t.responseType.toLowerCase();o.responseType="json"!==v?v:"text"}const a=t.serializeBody();let c=null;const l=()=>{if(null!==c)return c;const v=o.statusText||"OK",g=new Ur(o.getAllResponseHeaders()),m=function O7(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(o)||t.url;return c=new kx({headers:g,status:o.status,statusText:v,url:m}),c},u=()=>{let{headers:v,status:g,statusText:m,url:y}=l(),_=null;204!==g&&(_=typeof o.response>"u"?o.responseText:o.response),0===g&&(g=_?200:0);let x=g>=200&&g<300;if("json"===t.responseType&&"string"==typeof _){const w=_;_=_.replace(L7,"");try{_=""!==_?JSON.parse(_):null}catch(C){_=w,x&&(x=!1,_={error:C,text:_})}}x?(s.next(new nl({body:_,headers:v,status:g,statusText:m,url:y||void 0})),s.complete()):s.error(new ZR({error:_,headers:v,status:g,statusText:m,url:y||void 0}))},d=v=>{const{url:g}=l(),m=new ZR({error:v,status:o.status||0,statusText:o.statusText||"Unknown Error",url:g||void 0});s.error(m)};let h=!1;const f=v=>{h||(s.next(l()),h=!0);let g={type:tl.DownloadProgress,loaded:v.loaded};v.lengthComputable&&(g.total=v.total),"text"===t.responseType&&o.responseText&&(g.partialText=o.responseText),s.next(g)},p=v=>{let g={type:tl.UploadProgress,loaded:v.loaded};v.lengthComputable&&(g.total=v.total),s.next(g)};return o.addEventListener("load",u),o.addEventListener("error",d),o.addEventListener("timeout",d),o.addEventListener("abort",d),t.reportProgress&&(o.addEventListener("progress",f),null!==a&&o.upload&&o.upload.addEventListener("progress",p)),o.send(a),s.next({type:tl.Sent}),()=>{o.removeEventListener("error",d),o.removeEventListener("abort",d),o.removeEventListener("load",u),o.removeEventListener("timeout",d),t.reportProgress&&(o.removeEventListener("progress",f),null!==a&&o.upload&&o.upload.removeEventListener("progress",p)),o.readyState!==o.DONE&&o.abort()}})))}static{this.\u0275fac=function(i){return new(i||n)(Oe(NA))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();const Hx=new Ee("XSRF_ENABLED"),rP=new Ee("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),sP=new Ee("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class oP{}let k7=(()=>{class n{constructor(t,i,r){this.doc=t,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=wA(t,this.cookieName),this.lastCookieString=t),this.lastToken}static{this.\u0275fac=function(i){return new(i||n)(Oe(Ti),Oe(go),Oe(rP))}}static{this.\u0275prov=Be({token:n,factory:n.\u0275fac})}}return n})();function B7(n,e){const t=n.url.toLowerCase();if(!be(Hx)||"GET"===n.method||"HEAD"===n.method||t.startsWith("http://")||t.startsWith("https://"))return e(n);const i=be(oP).getToken(),r=be(sP);return null!=i&&!n.headers.has(r)&&(n=n.clone({headers:n.headers.set(r,i)})),e(n)}var io=function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n}(io||{});function ta(n,e){return{\u0275kind:n,\u0275providers:e}}function V7(...n){const e=[Vx,iP,tP,{provide:Jp,useExisting:tP},{provide:Kp,useExisting:iP},{provide:ad,useValue:B7,multi:!0},{provide:Hx,useValue:!0},{provide:oP,useClass:k7}];for(const t of n)e.push(...t.\u0275providers);return function Ig(n){return{\u0275providers:n}}(e)}const aP=new Ee("LEGACY_INTERCEPTOR_FN");let z7=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Ts({type:n})}static{this.\u0275inj=Vr({providers:[V7(ta(io.LegacyInterceptors,[{provide:aP,useFactory:I7},{provide:ad,useExisting:aP,multi:!0}]))]})}}return n})();function X7(n,e){if(1&n&&(et(0,"li"),Ct(1),ht()),2&n){const t=e.$implicit;an(1),Ar(t)}}function Y7(n,e){if(1&n&&(et(0,"div")(1,"h4"),Ct(2,"Awards:"),ht(),et(3,"ul"),sr(4,X7,2,1,"li",9),ht()()),2&n){const t=Fs().$implicit;an(4),In("ngForOf",t.awards)}}function Z7(n,e){if(1&n){const t=function fE(){return Z()}();et(0,"div",2),qa("click",function(){const s=zm(t).$implicit;return Gm(Fs().navigateToProjectDetail(s.id))}),et(1,"h2",3),Ct(2),ht(),et(3,"div",4),Yn(4,"img",5),ht(),et(5,"p",6),Ct(6),ht(),sr(7,Y7,5,1,"div",7),et(8,"button",8),qa("click",function(r){const o=zm(t).$implicit;return Fs().navigateToProjectDetail(o.id),Gm(r.stopPropagation())}),Ct(9,"See More Details"),ht()()}if(2&n){const t=e.$implicit;an(2),Ar(t.name),an(2),Ah("alt",t.name),In("src",t.image,po),an(2),Ar(t.short_desc),an(1),In("ngIf",t.awards&&t.awards.length>0)}}let J7=(()=>{class n{constructor(t,i){this.http=t,this.router=i,this.projects=[]}ngOnInit(){this.http.get("assets/projects.json").subscribe(t=>{this.projects=t})}navigateToProjectDetail(t){this.router.navigate(["/projects",t])}static{this.\u0275fac=function(i){return new(i||n)(Ue(Vx),Ue(hi))}}static{this.\u0275cmp=Cs({type:n,selectors:[["app-projects"]],decls:2,vars:1,consts:[[1,"projects-grid"],["class","project-card",3,"click",4,"ngFor","ngForOf"],[1,"project-card",3,"click"],["id","name"],["id","img-container"],[1,"project-image",3,"src","alt"],[1,"project-desc"],[4,"ngIf"],[1,"details-button",3,"click"],[4,"ngFor","ngForOf"]],template:function(i,r){1&i&&(et(0,"div",0),sr(1,Z7,10,5,"div",1),ht()),2&i&&(an(1),In("ngForOf",r.projects))},dependencies:[Cy,Ty],styles:[".projects-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,.95fr));gap:20px;margin:20px auto;width:100%;max-width:1280px}.project-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}h2[_ngcontent-%COMP%]{margin-top:0}.project-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:cover;border-radius:8px}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0}li[_ngcontent-%COMP%]{background-color:#e5e5e5;margin:4px 0;padding:6px;border-radius:4px}a[_ngcontent-%COMP%]{display:inline-block;margin-top:10px;padding:8px 16px;background-color:#007bff;color:#fff;text-decoration:none;border-radius:4px}a[_ngcontent-%COMP%]:hover{background-color:#0056b3}a.disabled[_ngcontent-%COMP%]{background-color:gray;color:#fff;cursor:not-allowed;text-decoration:none}a.disabled[_ngcontent-%COMP%]:hover{background-color:gray;color:#fff}.project-desc[_ngcontent-%COMP%]{max-height:70px;min-height:60px;overflow:hidden;text-overflow:ellipsis}.project-card[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px;padding:16px;box-shadow:0 4px 8px #0000001a;transition:transform .2s;display:flex;flex-direction:column;height:70vh;margin:0 auto;max-height:670px}.details-button[_ngcontent-%COMP%]{margin-top:auto;padding:8px 16px;background-color:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;align-self:flex-start}.details-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}#name[_ngcontent-%COMP%]{height:50px}#img-container[_ngcontent-%COMP%]{width:100%;height:200px;overflow:hidden;display:flex;align-items:center;justify-content:center}@media (max-width: 768px){.projects-grid[_ngcontent-%COMP%]{padding:0 15px}.project-card[_ngcontent-%COMP%]{max-width:100%;margin:0 auto}}"]})}}return n})(),K7=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=Cs({type:n,selectors:[["app-contact"]],decls:21,vars:0,consts:[["id","container"],["id","email"],["id","email-links"],["href","https://mail.google.com/mail/?view=cm&fs=1&to=victorpostea@gmail.com","target","_blank"],["width","20px","src","./assets/imgs/gmail-logo.webp","alt","Gmail"],["href","https://outlook.live.com/mail/0/deeplink/compose?to=victorpostea@gmail.com","target","_blank"],["width","20px","src","./assets/imgs/outlook-logo.png","alt","Outlook"],[1,"links"],["href","https://github.com/victorpostea","target","_blank"],["width","20px","src","./assets/imgs/github-logo.png","alt","GitHub"],["href","https://www.linkedin.com/in/victor-postea-070556298/","target","_blank"],["width","20px","src","./assets/imgs/linkedin-logo.png","alt","LinkedIn"]],template:function(i,r){1&i&&(et(0,"div",0)(1,"p",1),Ct(2,"victorpostea@gmail.com"),ht(),et(3,"div",2)(4,"a",3),Yn(5,"img",4),et(6,"p"),Ct(7,"Send via Gmail"),ht()(),et(8,"a",5),Yn(9,"img",6),et(10,"p"),Ct(11,"Send via Outlook"),ht()()(),et(12,"div",7)(13,"a",8),Yn(14,"img",9),et(15,"p"),Ct(16,"GitHub"),ht()(),et(17,"a",10),Yn(18,"img",11),et(19,"p"),Ct(20,"LinkedIn"),ht()()()())},styles:["#email-links[_ngcontent-%COMP%], .links[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:40px;margin-top:20px}#email-links[_ngcontent-%COMP%]{gap:40px}.links[_ngcontent-%COMP%]{gap:100px}#email-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-align:center;text-decoration:none;color:#000;display:flex;flex-direction:column;align-items:center}#email-links[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .links[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;margin:0 auto}#email-links[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .links[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;margin-top:5px}a[_ngcontent-%COMP%]{text-decoration:none;transition:color .3s ease-in-out}a[_ngcontent-%COMP%]:hover{color:gray}#smaller[_ngcontent-%COMP%]{font-size:.8rem}p[_ngcontent-%COMP%], span[_ngcontent-%COMP%]{display:flex;justify-content:center}#email[_ngcontent-%COMP%]{font-size:1.2rem}"]})}}return n})();function Q7(n,e){if(1&n&&(et(0,"li"),Ct(1),ht()),2&n){const t=e.$implicit;an(1),Ar(t)}}function eY(n,e){if(1&n&&(et(0,"li"),Ct(1),ht()),2&n){const t=e.$implicit;an(1),Ar(t)}}function tY(n,e){if(1&n&&(et(0,"li"),Ct(1),ht()),2&n){const t=e.$implicit;an(1),Ar(t)}}function nY(n,e){if(1&n&&(et(0,"div")(1,"h4"),Ct(2,"Awards:"),ht(),et(3,"ul"),sr(4,tY,2,1,"li",2),ht()()),2&n){const t=Fs();an(4),In("ngForOf",null==t.project?null:t.project.awards)}}function iY(n,e){if(1&n&&(et(0,"a",8),Ct(1,"GitHub"),ht()),2&n){const t=Fs();In("href",null==t.project?null:t.project.githubLink,po)}}function rY(n,e){if(1&n&&(et(0,"a",9),Ct(1,"LinkedIn"),ht()),2&n){const t=Fs();In("href",null==t.project?null:t.project.linkedinLink,po)}}function sY(n,e){if(1&n&&(et(0,"a",10),Ct(1,"View Live Project"),ht()),2&n){const t=Fs();In("href",null==t.project?null:t.project.liveProjectLink,po)}}const oY=[{path:"home",component:y7},{path:"projects",component:J7},{path:"projects/:id",component:(()=>{class n{constructor(t,i,r){this.route=t,this.http=i,this.router=r}ngOnInit(){const t=Number(this.route.snapshot.paramMap.get("id"));this.http.get("assets/projects.json").subscribe(i=>{this.project=i.find(r=>r.id===t)})}goBack(){this.router.navigate(["/projects"])}static{this.\u0275fac=function(i){return new(i||n)(Ue(To),Ue(Vx),Ue(hi))}}static{this.\u0275cmp=Cs({type:n,selectors:[["app-project-detail"]],decls:20,vars:10,consts:[[1,"project-detail-container"],[1,"project-image",2,"max-width","400px",3,"src","alt"],[4,"ngFor","ngForOf"],[4,"ngIf"],["target","_blank","class","github",3,"href",4,"ngIf"],["target","_blank","class","linkedin",3,"href",4,"ngIf"],["target","_blank","class","live-project",3,"href",4,"ngIf"],[1,"back-button",3,"click"],["target","_blank",1,"github",3,"href"],["target","_blank",1,"linkedin",3,"href"],["target","_blank",1,"live-project",3,"href"]],template:function(i,r){1&i&&(et(0,"div",0)(1,"h1"),Ct(2),ht(),Yn(3,"img",1),et(4,"p"),Ct(5),ht(),et(6,"h4"),Ct(7,"Languages:"),ht(),et(8,"ul"),sr(9,Q7,2,1,"li",2),ht(),et(10,"h4"),Ct(11,"Skills:"),ht(),et(12,"ul"),sr(13,eY,2,1,"li",2),ht(),sr(14,nY,5,1,"div",3),sr(15,iY,2,1,"a",4),sr(16,rY,2,1,"a",5),sr(17,sY,2,1,"a",6),et(18,"button",7),qa("click",function(){return r.goBack()}),Ct(19,"Back to Projects Page"),ht()()),2&i&&(an(2),Ar(null==r.project?null:r.project.name),an(1),Ah("alt",null==r.project?null:r.project.name),In("src",null==r.project?null:r.project.image,po),an(2),Ar(null==r.project?null:r.project.description),an(4),In("ngForOf",null==r.project?null:r.project.languages),an(4),In("ngForOf",null==r.project?null:r.project.skills),an(1),In("ngIf",null==r.project?null:r.project.awards),an(1),In("ngIf",null==r.project?null:r.project.githubLink),an(1),In("ngIf",null==r.project?null:r.project.linkedinLink),an(1),In("ngIf",null==r.project?null:r.project.liveProjectLink))},dependencies:[Cy,Ty],styles:[".project-detail-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;border:1px solid #ddd;border-radius:8px;box-shadow:0 4px 8px #0000001a;text-align:center}.project-image[_ngcontent-%COMP%]{max-width:400px;width:100%;height:auto;margin:0 auto;display:block}.project-detail-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:20px}.project-detail-container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin-bottom:16px;text-align:left}.project-detail-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{background-color:#e5e5e5;margin:4px 0;padding:6px;border-radius:4px}.project-detail-container[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:10px;text-align:left}.project-detail-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:inline-block;margin-top:20px;margin-right:10px;padding:8px 16px;background-color:#007bff;color:#fff;text-decoration:none;border-radius:4px}.project-detail-container[_ngcontent-%COMP%]   a.github[_ngcontent-%COMP%]{background-color:#333}.project-detail-container[_ngcontent-%COMP%]   a.github[_ngcontent-%COMP%]:hover{background-color:#1b1b1b}.project-detail-container[_ngcontent-%COMP%]   a.linkedin[_ngcontent-%COMP%]{background-color:#0e76a8}.project-detail-container[_ngcontent-%COMP%]   a.linkedin[_ngcontent-%COMP%]:hover{background-color:#064d74}.project-detail-container[_ngcontent-%COMP%]   a.live-project[_ngcontent-%COMP%]{background-color:#28a745}.project-detail-container[_ngcontent-%COMP%]   a.live-project[_ngcontent-%COMP%]:hover{background-color:#218838}.project-detail-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#0056b3}.back-button[_ngcontent-%COMP%]{display:inline-block;margin-top:20px;padding:8px 16px;background-color:#007bff;color:#fff;text-decoration:none;border:none;border-radius:4px;cursor:pointer}.back-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})}}return n})()},{path:"contact",component:K7},{path:"",redirectTo:"/home",pathMatch:"full"},{path:"**",redirectTo:"/home"}];let aY=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Ts({type:n})}static{this.\u0275inj=Vr({imports:[oI.forRoot(oY),oI]})}}return n})(),cY=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=Cs({type:n,selectors:[["app-site-header"]],decls:17,vars:0,consts:[[1,"description"],[1,"location"],["src","assets/icons/location-icon.svg","alt","Location icon",1,"location-icon"],[1,"nav-links"],["routerLink","/home","routerLinkActive","active"],["routerLink","/projects","routerLinkActive","active"],["routerLink","/contact","routerLinkActive","active"]],template:function(i,r){1&i&&(et(0,"div",0)(1,"h1"),Ct(2,"Victor Postea"),ht(),et(3,"h2"),Ct(4,"Full Stack Developer"),ht(),et(5,"h3")(6,"span",1),Yn(7,"img",2),Ct(8," Toronto, ON "),ht()(),Yn(9,"hr"),et(10,"div",3)(11,"a",4),Ct(12,"Home"),ht(),et(13,"a",5),Ct(14,"Projects"),ht(),et(15,"a",6),Ct(16,"Contact"),ht()()())},dependencies:[Ef,KD],styles:[".description[_ngcontent-%COMP%]{font-weight:400;display:flex;justify-content:flex-start;align-items:center;flex-direction:column;padding-top:20px;padding-bottom:15px}.location[_ngcontent-%COMP%]{display:flex;align-items:center;gap:3px}img[_ngcontent-%COMP%], .svg-icon[_ngcontent-%COMP%]{width:20px;height:20px}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%]{font-weight:400;margin:5px 0}h1[_ngcontent-%COMP%]{font-size:2rem}h2[_ngcontent-%COMP%]{font-size:1.1rem}h3[_ngcontent-%COMP%]{font-size:.9rem}.nav-links[_ngcontent-%COMP%]{margin-top:10px;display:flex;gap:10px}hr[_ngcontent-%COMP%]{border:1px solid #FFFF;width:20%}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;font-size:1rem;transition:color .3s ease-in-out}.nav-links[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%], .nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:gray}"]})}}return n})(),lY=(()=>{class n{constructor(){this.title="vpostea"}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=Cs({type:n,selectors:[["app-root"]],decls:4,vars:0,consts:[[1,"site-header"],[1,"content"]],template:function(i,r){1&i&&(et(0,"div",0),Yn(1,"app-site-header"),ht(),et(2,"div",1),Yn(3,"router-outlet"),ht())},dependencies:[r_,cY],styles:[".site-header[_ngcontent-%COMP%]{width:100%;top:0;left:0;z-index:1}.content[_ngcontent-%COMP%]{width:100%;max-width:none}"]})}}return n})(),uY=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Ts({type:n,bootstrap:[lY]})}static{this.\u0275inj=Vr({imports:[B4,aY,z7]})}}return n})();U4().bootstrapModule(uY).catch(n=>console.error(n))}},Ot=>{Ot(Ot.s=920)}]);